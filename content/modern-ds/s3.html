<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lino Galiana">
<meta name="dcterms.date" content="2024-12-20">

<title>Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud – Python pour la data science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/modern-ds/elastic_approfondissement.html" rel="next">
<link href="../../content/modern-ds/continuous_integration.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #e9f3fa;
      }
</style>
<script id="toggle-light-dark-elements" type="application/javascript">
// Extend Quarto theme toggling to allow elements to be displayed/hidden in light/dark themes

// Replicated from https://github.com/quarto-dev/quarto-cli/blob/84d4659/src/resources/formats/html/templates/quarto-html.ejs
const getColorSchemeSentinel = () => {
  const localAlternateSentinel = 'default';
  if (window.location.protocol !== 'file:') {
    const storageValue = window.localStorage.getItem('quarto-color-scheme');
    return storageValue != null ? storageValue : localAlternateSentinel;
  } else {
    return localAlternateSentinel;
  }
};

// Function to toggle light and dark elements based on color scheme
const toggleColorSchemeElements = () => {
  const scheme = getColorSchemeSentinel();
  const lightElements = document.getElementsByClassName('only-light');
  const darkElements = document.getElementsByClassName('only-dark');

  for (var i = 0; i < lightElements.length; i++) {
    lightElements[i].style.display = scheme == 'default' ? 'block' : 'none';
  }
  for (var i = 0; i < darkElements.length; i++) {
    darkElements[i].style.display = scheme == 'default' ? 'none' : 'block';
  }
};

// Function to check if the user's browser prefers dark themes
const prefersDarkTheme = () => {
  if (window.matchMedia) {
    return window.matchMedia('(prefers-color-scheme: dark)').matches;
  }
  return false;
};

document.addEventListener('readystatechange', function() {
  // Set the default color scheme based on browser preference
  if (document.readyState === 'interactive' && window.location.protocol !== 'file:') {
    const storageValue = window.localStorage.getItem('quarto-color-scheme');
    if (storageValue == null && prefersDarkTheme()) {
      window.localStorage.setItem('quarto-color-scheme', 'alternate');
    }
  }
  // Add event listener for when the readyState is complete (and default toggler is set)
  if (document.readyState === 'complete') {
    // Toggle scheme once
    toggleColorSchemeElements();
    // Append our toggle function to the old one
    const oldToggle = window.quartoToggleColorScheme;
    window.quartoToggleColorScheme = () => {
      oldToggle();
      toggleColorSchemeElements();
    }
  }
});

</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud – Python pour la data science">
<meta name="twitter:description" content="Dans les entreprises et administrations, un nombre croissant
d'infrastructure se basent sur des _clouds_, qui sont des sessions non persistentes où les données ne sont pas stockées dans les mêmes…">
<meta name="twitter:image" content="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/python_cloud.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="Python pour la data science">
<meta name="citation_abstract" content="Dans les entreprises et administrations, un nombre croissant
d&amp;amp;#039;infrastructure se basent sur des _clouds_, qui sont des sessions non persistentes où les données ne sont pas stockées dans les mêmes serveurs que les machines qui exécutent du code. L'une des technologies dominantes dans le domaine est un système de stockage nommé `S3`, développé par [Amazon](https://docs.aws.amazon.com/fr_fr/AmazonS3/latest/userguide/Welcome.html).

`Python`, à travers plusieurs _packages_ (notamment `boto3`, `s3fs` ou `pyarrow`),
permet d'utiliser ce système de stockage distant comme si on
accédait à des fichiers depuis son poste personnel. Cette révolution est
étroitement associée à l'émergence du format de
données [`Apache Parquet`](https://parquet.apache.org/), format utilisable en
`Python` par le biais du package [`pyarrow`](https://arrow.apache.org/docs/python/index.html)
ou avec [`Spark`](https://spark.apache.org/) et présentant
de nombreux avantages pour l'analyse de données (vitesse d'import, possibilité de traiter
des données plus volumineuses que la RAM...)
">
<meta name="citation_author" content="Lino Galiana">
<meta name="citation_publication_date" content="2023">
<meta name="citation_cover_date" content="2023">
<meta name="citation_year" content="2023">
<meta name="citation_online_date" content="2024-12-20">
<meta name="citation_fulltext_html_url" content="https://pythonds.linogaliana.fr/">
<meta name="citation_doi" content="10.5281/zenodo.8229676">
<meta name="citation_language" content="fr">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="../../content/getting-started/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/01_environment.html">
 <span class="dropdown-text">Avoir un environnement Python fonctionnel pour la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/02_data_analysis.html">
 <span class="dropdown-text">Démarche à adopter face à un jeu de données</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/03_revisions.html">
 <span class="dropdown-text">Quelques exercices de rappels pour se remettre en selle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manipuler" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Manipuler</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-manipuler">    
        <li>
    <a class="dropdown-item" href="../../content/manipulation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/01_numpy.html">
 <span class="dropdown-text">Numpy, la brique de base de la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02_pandas_intro.html">
 <span class="dropdown-text">Introduction à Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02_pandas_suite.html">
 <span class="dropdown-text">Manipuler des données avec Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_intro.html">
 <span class="dropdown-text">Introduction aux données spatiales avec Geopandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04a_webscraping_TP.html">
 <span class="dropdown-text">Web scraping avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04c_API_TP.html">
 <span class="dropdown-text">Récupérer des données avec des API depuis Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04b_regex_TP.html">
 <span class="dropdown-text">Maîtriser les expressions régulières</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-communiquer" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Communiquer</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-communiquer">    
        <li>
    <a class="dropdown-item" href="../../content/visualisation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/matplotlib.html">
 <span class="dropdown-text">Construire des graphiques avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/maps.html">
 <span class="dropdown-text">Introduction à la cartographie avec Python</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modéliser" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Modéliser</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modéliser">    
        <li>
    <a class="dropdown-item" href="../../content/modelisation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/0_preprocessing.html">
 <span class="dropdown-text">Préparation des données pour construire un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/1_modelevaluation.html">
 <span class="dropdown-text">Evaluer la qualité d’un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/2_classification.html">
 <span class="dropdown-text">Découverte de la classification avec la technique des SVM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/3_regression.html">
 <span class="dropdown-text">Introduction à la régression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/4_featureselection.html">
 <span class="dropdown-text">Sélection de variables : une introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/5_clustering.html">
 <span class="dropdown-text">Introduction à l’apprentissage non supervisée avec le clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/6_pipeline.html">
 <span class="dropdown-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/7_mlapi.html">
 <span class="dropdown-text">Mettre à disposition un modèle par le biais d’une API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nlp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">NLP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nlp">    
        <li>
    <a class="dropdown-item" href="../../content/NLP/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/01_intro.html">
 <span class="dropdown-text">Nettoyer et structurer l’information dans les données textuelles</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/02_exoclean.html">
 <span class="dropdown-text">L’analyse fréquentiste par l’approche bag-of-words : intérêt et limites</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/03_embedding.html">
 <span class="dropdown-text">Les embeddings, où comment synthétiser l’information textuelle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-approfondissements" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Approfondissements</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-approfondissements">    
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/continuous_integration.html">
 <span class="dropdown-text">Intégration continue avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/s3.html">
 <span class="dropdown-text">Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_approfondissement.html">
 <span class="dropdown-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_intro.html">
 <span class="dropdown-text">Introduction à ElasticSearch pour la recherche textuelle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-git" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Git</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-git">    
        <li>
    <a class="dropdown-item" href="../../content/git/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/introgit.html">
 <span class="dropdown-text">Découvrir Git par la pratique: la gymnastique quotidienne</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/exogit.html">
 <span class="dropdown-text">Un cadavre exquis pour découvrir le travail collaboratif <code>Git</code></span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-annexes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Annexes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-annexes">    
        <li>
    <a class="dropdown-item" href="../../content/annexes/evaluation.html">
 <span class="dropdown-text">Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/annexes/corrections.html">
 <span class="dropdown-text">Corrections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://linogaliana.github.io/python-datascientist-slides/#/title-slide">
 <span class="dropdown-text">Slides de présentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/linogaliana/python-datascientist" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Basculer le mode sombre"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Basculer en mode lecteur">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/modern-ds/s3.html">Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Tutoriel</div>
                <div class="quarto-category">Avancé</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Auteur·rice</div>
      <div class="quarto-title-meta-contents">
               <p>Lino Galiana </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Date de publication</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2024-12-20</p>
      </div>
    </div>
    
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">Résumé</div>
      <p>Dans les entreprises et administrations, un nombre croissant
      d’infrastructure se basent sur des <em>clouds</em>, qui sont des sessions non persistentes où les données ne sont pas stockées dans les mêmes serveurs que les machines qui exécutent du code. L’une des technologies dominantes dans le domaine est un système de stockage nommé <code>S3</code>, développé par <a href="https://docs.aws.amazon.com/fr_fr/AmazonS3/latest/userguide/Welcome.html">Amazon</a>.</p>
      <p><code>Python</code>, à travers plusieurs <em>packages</em> (notamment <code>boto3</code>, <code>s3fs</code> ou <code>pyarrow</code>),
      permet d’utiliser ce système de stockage distant comme si on
      accédait à des fichiers depuis son poste personnel. Cette révolution est
      étroitement associée à l’émergence du format de
      données <a href="https://parquet.apache.org/"><code>Apache Parquet</code></a>, format utilisable en
      <code>Python</code> par le biais du package <a href="https://arrow.apache.org/docs/python/index.html"><code>pyarrow</code></a>
      ou avec <a href="https://spark.apache.org/"><code>Spark</code></a> et présentant
      de nombreux avantages pour l’analyse de données (vitesse d’import, possibilité de traiter
      des données plus volumineuses que la RAM…)</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/continuous_integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intégration continue avec Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/s3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/elastic_approfondissement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/elastic_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction à ElasticSearch pour la recherche textuelle</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#elements-de-contexte" id="toc-elements-de-contexte" class="nav-link active" data-scroll-target="#elements-de-contexte"><span class="header-section-number">1</span> Elements de contexte</a>
  <ul class="collapse">
  <li><a href="#principe-du-stockage-de-la-donnée" id="toc-principe-du-stockage-de-la-donnée" class="nav-link" data-scroll-target="#principe-du-stockage-de-la-donnée"><span class="header-section-number">1.1</span> Principe du stockage de la donnée</a></li>
  <li><a href="#les-fichiers" id="toc-les-fichiers" class="nav-link" data-scroll-target="#les-fichiers"><span class="header-section-number">1.2</span> Les fichiers</a></li>
  <li><a href="#les-bases-de-données" id="toc-les-bases-de-données" class="nav-link" data-scroll-target="#les-bases-de-données"><span class="header-section-number">1.3</span> Les bases de données</a></li>
  </ul></li>
  <li><a href="#le-format-parquet" id="toc-le-format-parquet" class="nav-link" data-scroll-target="#le-format-parquet"><span class="header-section-number">2</span> Le format <code>Parquet</code></a>
  <ul class="collapse">
  <li><a href="#lire-un-parquet-en-python-la-librairie-pyarrow" id="toc-lire-un-parquet-en-python-la-librairie-pyarrow" class="nav-link" data-scroll-target="#lire-un-parquet-en-python-la-librairie-pyarrow"><span class="header-section-number">2.1</span> Lire un <code>parquet</code> en <code>Python</code>: la librairie <code>pyarrow</code></a></li>
  </ul></li>
  <li><a href="#les-données-sur-le-cloud" id="toc-les-données-sur-le-cloud" class="nav-link" data-scroll-target="#les-données-sur-le-cloud"><span class="header-section-number">3</span> Les données sur le <em>cloud</em></a>
  <ul class="collapse">
  <li><a href="#quest-ce-que-le-système-de-stockage-s3" id="toc-quest-ce-que-le-système-de-stockage-s3" class="nav-link" data-scroll-target="#quest-ce-que-le-système-de-stockage-s3"><span class="header-section-number">3.1</span> Qu’est-ce que le système de stockage <code>S3</code> ?</a></li>
  <li><a href="#comment-faire-avec-python" id="toc-comment-faire-avec-python" class="nav-link" data-scroll-target="#comment-faire-avec-python"><span class="header-section-number">3.2</span> Comment faire avec Python ?</a>
  <ul class="collapse">
  <li><a href="#les-librairies-principales" id="toc-les-librairies-principales" class="nav-link" data-scroll-target="#les-librairies-principales"><span class="header-section-number">3.2.1</span> Les librairies principales</a></li>
  <li><a href="#connexion-à-un-bucket" id="toc-connexion-à-un-bucket" class="nav-link" data-scroll-target="#connexion-à-un-bucket"><span class="header-section-number">3.2.2</span> Connexion à un bucket</a></li>
  <li><a href="#lister-les-fichiers" id="toc-lister-les-fichiers" class="nav-link" data-scroll-target="#lister-les-fichiers"><span class="header-section-number">3.2.3</span> Lister les fichiers</a></li>
  <li><a href="#télécharger-un-fichier-depuis-s3-pour-lenregistrer-en-local" id="toc-télécharger-un-fichier-depuis-s3-pour-lenregistrer-en-local" class="nav-link" data-scroll-target="#télécharger-un-fichier-depuis-s3-pour-lenregistrer-en-local"><span class="header-section-number">3.2.4</span> Télécharger un fichier depuis <code>S3</code> pour l’enregistrer en local</a></li>
  <li><a href="#lire-un-fichier-directement" id="toc-lire-un-fichier-directement" class="nav-link" data-scroll-target="#lire-un-fichier-directement"><span class="header-section-number">3.2.5</span> Lire un fichier directement</a></li>
  <li><a href="#uploader-un-fichier" id="toc-uploader-un-fichier" class="nav-link" data-scroll-target="#uploader-un-fichier"><span class="header-section-number">3.2.6</span> Uploader un fichier</a></li>
  </ul></li>
  <li><a href="#cas-pratique-stocker-les-données-de-son-projet-sur-le-ssp-cloud" id="toc-cas-pratique-stocker-les-données-de-son-projet-sur-le-ssp-cloud" class="nav-link" data-scroll-target="#cas-pratique-stocker-les-données-de-son-projet-sur-le-ssp-cloud"><span class="header-section-number">3.3</span> Cas pratique : stocker les données de son projet sur le SSP Cloud</a>
  <ul class="collapse">
  <li><a href="#partager-des-fichiers-sur-le-ssp-cloud" id="toc-partager-des-fichiers-sur-le-ssp-cloud" class="nav-link" data-scroll-target="#partager-des-fichiers-sur-le-ssp-cloud"><span class="header-section-number">3.3.1</span> Partager des fichiers sur le SSP Cloud</a></li>
  <li><a href="#récupération-et-stockage-de-données" id="toc-récupération-et-stockage-de-données" class="nav-link" data-scroll-target="#récupération-et-stockage-de-données"><span class="header-section-number">3.3.2</span> Récupération et stockage de données</a></li>
  <li><a href="#utilisation-des-données" id="toc-utilisation-des-données" class="nav-link" data-scroll-target="#utilisation-des-données"><span class="header-section-number">3.3.3</span> Utilisation des données</a></li>
  </ul></li>
  <li><a href="#pour-aller-plus-loin" id="toc-pour-aller-plus-loin" class="nav-link" data-scroll-target="#pour-aller-plus-loin"><span class="header-section-number">3.4</span> Pour aller plus loin</a></li>
  <li><a href="#informations-additionnelles" id="toc-informations-additionnelles" class="nav-link" data-scroll-target="#informations-additionnelles">Informations additionnelles</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/modern-ds/s3.qmd" class="toc-action"><i class="bi bi-github"></i>Modifier cette page</a></li><li><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<a href="#" onclick="this.href = location.href.replace('/fr/', '/').replace(/^(https?:\/\/[^\/]+)\//, '$1/en/');" class="button-cta">
<button class="btn"><i class="fa fa-language"></i> Switch to English version 🇬🇧 🇺🇸</button>
</a></p>
<div class="badge-container"><div class="badge-text">Pour essayer les exemples présents dans ce tutoriel :</div><a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/modern-ds/s3.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=github&amp;label=&amp;message=View%20on%20GitHub&amp;color=181717" alt="View on GitHub"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;name=«s3»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-vscode.sh»&amp;init.personalInitArgs=«modern-ds%20s3%20correction»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Lancer_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;name=«s3»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-jupyter.sh»&amp;init.personalInitArgs=«modern-ds%20s3%20correction»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Lancer_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks//blob/main//notebooks/modern-ds/s3.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a><br></div>
<p>Ce chapitre est une introduction à la question
du stockage des données et aux innovations
récentes dans ce domaine. L’objectif
est d’abord de présenter les avantages
du format <code>Parquet</code> et la manière dont
on peut utiliser les
librairies <a href="https://arrow.apache.org/docs/python/index.html"><code>pyarrow</code></a>
ou <a href="https://duckdb.org/docs/api/python/overview.html"><code>duckdb</code></a> pour traiter
de manière efficace des données volumineuses
au format <code>Parquet</code>. Ensuite, on présentera
la manière dont ce format <code>parquet</code> s’intègre
bien avec des systèmes de stockage <em>cloud</em>,
qui tendent à devenir la norme dans le monde
de la <em>data science</em>.</p>
<section id="elements-de-contexte" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Elements de contexte</h1>
<section id="principe-du-stockage-de-la-donnée" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="principe-du-stockage-de-la-donnée"><span class="header-section-number">1.1</span> Principe du stockage de la donnée</h2>
<p>Pour comprendre les apports du format <code>Parquet</code>, il est nécessaire
de faire un détour pour comprendre la manière dont une information
est stockée et accessible à un langage de traitement de la donnée.</p>
<p>Il existe deux approches dans le monde du stockage de la donnée.
La première est celle de la <strong>base de données relationnelle</strong>. La seconde est le
principe du <strong>fichier</strong>.
La différence entre les deux est dans la manière dont l’accès aux
données est organisé.</p>
</section>
<section id="les-fichiers" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="les-fichiers"><span class="header-section-number">1.2</span> Les fichiers</h2>
<p>Dans un fichier, les données sont organisées selon un certain format et
le logiciel de traitement de la donnée va aller chercher et structurer
l’information en fonction de ce format. Par exemple, dans un fichier
<code>.csv</code>, les différentes informations seront stockées au même niveau
avec un caractère pour les séparer (la virgule <code>,</code> dans les <code>.csv</code> anglosaxons, le point virgule dans les <code>.csv</code> français, la tabulation dans les <code>.tsv</code>). Le fichier suivant</p>
<pre class="raw"><code>nom ; profession 
Astérix ; 
Obélix ; Tailleur de menhir ;
Assurancetourix ; Barde</code></pre>
<p>sera ainsi organisé naturellement sous forme tabulée par <code>Python</code></p>
<div id="7d2faf61" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">nom</th>
<th data-quarto-table-cell-role="th">profession</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Astérix</td>
<td></td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Obélix</td>
<td>Tailleur de menhir</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Assurancetourix</td>
<td>Barde</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A propos des fichiers de ce type, on parle de <strong>fichiers plats</strong> car
les enregistrements relatifs à une observation sont stockés ensemble,
sans hiérarchie.</p>
<p>Certains formats de données vont permettre d’organiser les informations
de manière différente. Par exemple, le format <code>JSON</code> va
hiérarchiser différemment la même information [^1]:</p>
<pre class="raw"><code>[
  {
    "nom": "Astérix"
  },
  {
    "nom": "Obélix",
    "profession": "Tailleur de menhir"
  },
  {
    "nom": "Assurancetourix",
    "profession": "Barde"
  }
]</code></pre>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>La différence entre le CSV et le format <code>JSON</code> va au-delà d’un simple “formattage” des données.</p>
<p>Par sa nature non tabulaire, le format JSON permet des mises à jour beaucoup plus facile de la donnée dans les entrepôts de données.</p>
<p>Par exemple, un site web qui collecte de nouvelles données n’aura pas à mettre à jour l’ensemble de ses enregistrements antérieurs
pour stocker la nouvelle donnée (par exemple pour indiquer que pour tel ou tel client cette donnée n’a pas été collectée)
mais pourra la stocker dans
un nouvel item. Ce sera à l’outil de requête (<code>Python</code> ou un autre outil)
de créer une relation entre les enregistrements stockés à des endroits
différents.</p>
<p>Ce type d’approche flexible est l’un des fondements de l’approche <code>NoSQL</code>,
sur laquelle nous allons revenir, qui a permis l’émergence de technologies au coeur de l’écosystème actuel du <em>big-data</em> comme <code>Hadoop</code> ou <code>ElasticSearch</code>.</p>
</div>
</div>
</div>
<p>Cette fois, quand on n’a pas d’information, on ne se retrouve pas avec nos deux séparateurs accolés (cf.&nbsp;la ligne <em>“Astérix”</em>) mais l’information
n’est tout simplement pas collectée.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Il se peut très bien que l’information sur une observation soit disséminée
dans plusieurs fichiers dont les formats diffèrent.</p>
<p>Par exemple, dans le domaine des données géographiques,
lorsqu’une donnée est disponible sous format de fichier(s), elle peut l’être de deux manières!</p>
<ul>
<li>Soit la donnée est stockée dans un seul fichier qui mélange contours géographiques et valeurs attributaires
(la valeur associée à cette observation géographique, par exemple le taux d’abstention). Ce principe est celui du <code>geojson</code>.</li>
<li>Soit la donnée est stockée dans plusieurs fichiers qui sont spécialisés : un fichier va stocker les contours géographiques,
l’autre les données attributaires et d’autres fichiers des informations annexes (comme le système de projection). Ce principe est celui du <code>shapefile</code>.
C’est alors le logiciel qui requête
les données (<code>Python</code> par exemple) qui saura où aller chercher l’information
dans les différents fichiers et associer celle-ci de manière cohérente.</li>
</ul>
</div>
</div>
</div>
<p>Un concept supplémentaire dans le monde du fichier est celui du <strong>file system</strong>. Le <em>file system</em> est
le système de localisation et de nommage des fichiers.
Pour simplifier, le <em>file system</em> est la manière dont votre ordinateur saura
retrouver, dans son système de stockage, les bits présents dans tel ou tel fichier
appartenant à tel ou tel dossier.</p>
</section>
<section id="les-bases-de-données" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="les-bases-de-données"><span class="header-section-number">1.3</span> Les bases de données</h2>
<p>La logique des bases de données est différente. Elle est plus systémique.
Un système de gestion de base de données (<em>Database Management System</em>)
est un logiciel qui gère à la fois le stockage d’un ensemble de données reliée,
permet de mettre à jour celle-ci (ajout ou suppression d’informations, modification
des caractéristiques d’une table…)
et qui gère également
les modalités d’accès à la donnée (type de requête, utilisateurs
ayant les droits en lecture ou en écriture…).</p>
<p>La relation entre les entités présentes dans une base de données
prend généralement la forme d’un <strong>schéma en étoile</strong>. Une base va centraliser
les informations disponibles qui seront ensuite détaillées dans des tables
dédiées.</p>
<p><img src="https://www.databricks.com/wp-content/uploads/2022/04/star-schema-erd.png" class="img-fluid">
Source: <a href="https://www.databricks.com/fr/glossary/star-schema">La documentation <code>Databricks</code> sur le schéma en étoile</a></p>
<p>Le logiciel associé à la base de données fera ensuite le lien
entre ces tables à partir de requêtes <code>SQL</code>. L’un des logiciels les plus efficaces dans ce domaine
est <a href="https://www.postgresql.org/"><code>PostgreSQL</code></a>. <code>Python</code> est tout à fait
utilisable pour passer une requête SQL à un gestionnaire de base de données.
Les packages <a href="https://www.sqlalchemy.org/"><code>sqlalchemy</code></a> et <a href="https://www.psycopg.org/docs/"><code>psycopg2</code></a>
peuvent servir à utiliser <code>PostgreSQL</code> pour requêter une
base de donnée ou la mettre à jour.</p>
<p>La logique de la base de données est donc très différente de celle du fichier.
Ces derniers sont beaucoup plus légers pour plusieurs raisons.
D’abord, parce qu’ils sont moins adhérents à
un logiciel gestionnaire. Là où le fichier ne nécessite, pour la gestion,
qu’un <em>file system</em>, installé par défaut sur
tout système d’exploitation, une base de données va nécessiter un
logiciel spécialisé. L’inconvénient de l’approche fichier, sous sa forme
standard, est qu’elle
ne permet pas une gestion fine des droits d’accès et amène généralement à une
duplication de la donnée pour éviter que la source initiale soit
ré-écrite (involontairement ou de manière intentionnelle par un utilisateur malveillant).
Résoudre ce problème est l’une des
innovations des systèmes <em>cloud</em>, sur lesquelles nous reviendrons en évoquant le
système <code>S3</code>.
Un deuxième inconvénient de l’approche base de données par
rapport à l’approche fichier, pour un utilisateur de <code>Python</code>,
est que les premiers nécessitent l’intermédiation du logiciel de gestion
de base de données là où, dans le second cas, on va se contenter d’une
librairie, donc un système beaucoup plus léger,
qui sait comment transformer la donnée brute en <code>DataFrame</code>.
Pour ces raisons, entre autres, les bases de données sont donc moins à la
mode dans l’écosystème récent de la <em>data science</em> que les fichiers.</p>
</section>
</section>
<section id="le-format-parquet" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Le format <code>Parquet</code></h1>
<p>Le format <code>CSV</code> a rencontré un grand succès par sa simplicité : il
est lisible par un humain (un bloc-note suffit pour l’ouvrir et
apercevoir les premières lignes), sa nature plate lui permet
de bien correspondre au concept de données tabulées sans hiérarchie
qui peuvent être rapidement valorisées, il est universel (il n’est
pas adhérent à un logiciel). Cependant, le CSV présente
plusieurs inconvénients qui justifient l’émergence d’un format
concurrent :</p>
<ul>
<li>le CSV est un format <strong>lourd</strong> car les informations ne sont pas compressées
(ce qui le rend lisible facilement depuis un bloc-note) mais aussi
parce que toutes les données sont stockées de la même manière.
C’est la
librairie faisant l’import qui va essayer d’optimiser le typage des données
pour trouver le typage qui utilise le moins de mémoire possible sans
altération de l’information. En effet, si <code>pandas</code> détermine qu’une colonne
présente les valeurs <code>6 ; 5 ; 0</code>, il va privilégier l’utilisation du type
<code>int</code> au type <code>double</code> qui sera lui même préféré au type <code>object</code> (objets
de type données textuelles). Cependant, pour faire cela, <code>pandas</code> va devoir
scanner un nombre suffisant de valeurs, ce qui demande du temps et expose
à des erreurs (en se fondant sur trop peu de valeurs, on peut se tromper
de typage) ;</li>
<li>le stockage étant <strong>orienté ligne</strong>,
accéder à une information donnée dans un <code>CSV</code> implique
de le lire le fichier en entier, sélectionner la ou les colonnes
d’intérêt et ensuite les lignes désirées. Par exemple, si on désire
connaître uniquement la profession de la deuxième ligne dans l’exemple
plus haut :point_up:, un algorithme de recherche devra:
prendre le fichier, déterminer que la profession est la deuxième colonne,
et ensuite aller chercher la deuxième ligne dans cette colonne. Si
on désire accéder à un sous-ensemble de lignes dont les indices
sont connus, le <code>CSV</code> est intéressant. Cependant,
si on désire accéder à un sous-ensemble
de colonnes dans un fichier (ce qui est un cas d’usage plus fréquent
pour les <em>data scientists</em>), alors le <code>CSV</code> n’est pas le format le plus
approprié ;</li>
<li>mettre à jour la donnée est coûteux car cela implique de réécrire
l’ensemble du fichier. Par exemple, si après une première
analyse de la donnée,
on désire ajouter une colonne, on ne peut accoler ces nouvelles informations
à celles déjà existantes, il est nécessaire de réécrire l’ensemble
du fichier. Pour reprendre l’exemple de nos gaulois préférés, si on veut
ajouter une colonne <code>cheveux</code> entre les deux déjà existantes,
il faudra changer totalement le fichier:</li>
</ul>
<pre class="raw"><code>"""
nom ; cheveux ; profession
Astérix; blond; ; 
Obélix; roux; Tailleur de menhir
Assurancetourix; blond; Barde
"""</code></pre>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>La plupart des logiciels d’analyse de données proposent
un format de fichier pour sauvegarder des bases de données. On
peut citer le <code>.pickle</code> (<code>Python</code>), le <code>.rda</code> ou <code>.RData</code> (<code>R</code>),
le <code>.dta</code> (<code>Stata</code>) ou le <code>.sas7bdat</code> (<code>SAS</code>). L’utilisation
de ces formats est problématique car cela revient à se lier
les mains pour l’analyse ultérieure des données, surtout
lorsqu’il s’agit d’un format propriétaire (comme avec
<code>SAS</code> ou <code>Stata</code>).</p>
<p>Par exemple, <code>Python</code> ne
sait pas nativement lire un <code>.sas7bdat</code>. Il existe des librairies
pour le faire (notamment <code>Pandas</code>) mais le format
étant propriétaire, les développeurs de la librairie ont dû tâtonner et
on n’est ainsi jamais assuré qu’il n’y ait pas d’altération de la donnée.</p>
<p>Malgré tous les inconvénients du <code>.csv</code> listés plus haut, il présente
l’immense avantage, par rapport à ces formats, de l’universalité.
Il vaut ainsi mieux privilégier un <code>.csv</code> à ces formats pour le stockage
de la donnée. Ceci dit, comme vise à le montrer ce chapitre, il vaut
mieux privilégier le format <code>parquet</code> au <code>CSV</code>.</p>
</div>
</div>
</div>
<p>Pour répondre à ces limites du <code>CSV</code>, le format <code>parquet</code>,
qui est un <a href="https://apache.org/">projet open-source <code>Apache</code></a>, a émergé.
La première différence entre le format <code>parquet</code> et le <code>CSV</code> est
que le premier repose sur un <strong>stockage orienté colonne</strong> là où
le second est orienté ligne. Pour comprendre la différence, voici un
exemple issu du <a href="https://www.upsolver.com/blog/apache-parquet-why-use">blog d’upsolver</a>:</p>
<p><a href="https://www.upsolver.com/wp-content/uploads/2020/05/Screen-Shot-2020-05-26-at-17.52.58.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://www.upsolver.com/wp-content/uploads/2020/05/Screen-Shot-2020-05-26-at-17.52.58.png" class="img-fluid"></a></p>
<p>Dans notre exemple précédent, cela donnera une information prenant
la forme suivante (ignorez l’élément <code>pyarrow.Table</code>, nous
reviendrons dessus) :</p>
<div id="9e47eb4d" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>pyarrow.Table
nom : string
profession: string
----
nom : [["Astérix ","Obélix ","Assurancetourix "]]
profession: [["","Tailleur de menhir","Barde"]]</code></pre>
</div>
</div>
<p>Pour reprendre l’exemple fil rouge :point_up:, il sera ainsi beaucoup plus
facile de récupérer la deuxième ligne de la colonne <code>profession</code>:
on ne considère que le vecteur <code>profession</code> et on récupère la deuxième
valeur.
Le requêtage d’échantillon de données ne nécessite donc pas l’import de
l’ensemble des données. A cela s’ajoute des fonctionnalités supplémentaires
des librairies d’import de données parquet (par exemple <code>pyarrow</code> ou <code>spark</code>)
qui vont faciliter des recherches complexes basées, par exemple, sur des
requêtes de type <code>SQL</code>, ou permettant l’utilisation de données plus volumineuses que la RAM.</p>
<p>Le format <code>parquet</code> présente d’autres avantages par rapport au
<code>CSV</code>:</p>
<ul>
<li>Le format <code>parquet</code> est (très) compressé, ce qui réduit la volumétrie
des données sur disque ;</li>
<li>Des métadonnées, notamment le typage des variables, sont stockées en complément dans le fichier.
Cette partie, nommée le <em>footer</em> du fichier <code>parquet</code>, permet que l’import des données soit
optimisé sans risque d’altération de celle-ci. Pour un producteur de données, c’est une manière
d’assurer la qualité des données. Par exemple, un fournisseur de
données de type code-barre sera
certain que les données <code>000012</code> ne seront pas considérées identiques à un code-barre <code>12</code>.</li>
<li>Il est possible de partitionner un jeu de données en fonction de différents niveaux (par
exemple des niveaux géographiques) en une arborescence de fichiers <code>parquet</code>. Cela
permet de travailler sur un échantillon pour facilement passer à l’échelle ensuite.
Par exemple, une structure partitionnée, empruntée
à la <a href="https://spark.apache.org/docs/latest/sql-data-sources-parquet.html#partition-discovery">documentation <code>Spark</code></a>
peut prendre la forme suivante :</li>
</ul>
<pre class="raw"><code>path
└── to
    └── table
        ├── gender=male
        │   ├── ...
        │   │
        │   ├── country=US
        │   │   └── data.parquet
        │   ├── country=CN
        │   │   └── data.parquet
        │   └── ...
        └── gender=female
            ├── ...
            │
            ├── country=US
            │   └── data.parquet
            ├── country=CN
            │   └── data.parquet
            └── ...</code></pre>
<p>Qu’on lise un ou plusieurs fichiers, on finira avec le schéma suivant :</p>
<pre class="raw"><code>root
|-- name: string (nullable = true)
|-- age: long (nullable = true)
|-- gender: string (nullable = true)
|-- country: string (nullable = true)</code></pre>
<p>Ces différents avantages expliquent le succès du format <code>parquet</code> dans le monde du
<em>big-data</em>. Le paragraphe suivant, extrait du <a href="">post d’upsolver</a> déjà cité,
résume bien l’intérêt:</p>
<blockquote class="blockquote">
<p>Complex data such as logs and event streams would need to be represented as a table with hundreds or thousands of columns, and many millions of rows. Storing this table in a row based format such as CSV would mean:</p>
<ul>
<li>Queries will take longer to run since more data needs to be scanned, rather than only querying the subset of columns we need to answer a query (which typically requires aggregating based on dimension or category)</li>
<li>Storage will be more costly since CSVs are not compressed as efficiently as Parquet</li>
</ul>
</blockquote>
<p>Cependant, <strong><code>Parquet</code> ne devrait pas intéresser que les producteurs ou utilisateurs de données <em>big-data</em></strong>.
C’est l’ensemble
des producteurs de données qui bénéficient des fonctionalités
de <code>Parquet</code>.</p>
<p>Pour en savoir plus sur <code>Arrow</code>,
des éléments supplémentaires sur <code>Parquet</code> sont disponibles sur ce très bon
post de blog d’<a href="https://www.upsolver.com/blog/apache-parquet-why-use">upsolver</a>
et <a href="https://parquet.apache.org/">sur la page officielle du projet <code>Parquet</code></a>.</p>
<section id="lire-un-parquet-en-python-la-librairie-pyarrow" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="lire-un-parquet-en-python-la-librairie-pyarrow"><span class="header-section-number">2.1</span> Lire un <code>parquet</code> en <code>Python</code>: la librairie <code>pyarrow</code></h2>
<p>La librairie <code>pyarrow</code> permet la lecture et l’écriture
de fichiers <code>parquet</code> avec <code>Python</code><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. Elle repose
sur un type particulier de <em>dataframe</em>, le <code>pyarrow.Table</code>
qui peut être utilisé en substitut ou en complément
du <code>DataFrame</code>
de <code>pandas</code>. Il est recommandé de régulièrement
consulter la documentation officielle de <code>pyarrow</code>
concernant <a href="https://arrow.apache.org/docs/python/parquet.html">la lecture et écriture de fichiers</a> et celle relative
aux <a href="https://arrow.apache.org/cookbook/py/data.html">manipulations de données</a>.</p>
<p>Pour illustrer les fonctionalités de <code>pyarrow</code>,
repartons de notre CSV initial que nous allons
enrichir d’une nouvelle variable numérique
et que nous
allons
convertir en objet <code>pyarrow</code> avant de l’écrire au format <code>parquet</code>:</p>
<div id="6468e0a5" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="6468e0a5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="6468e0a5-1"><a href="#6468e0a5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="6468e0a5-2"><a href="#6468e0a5-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="6468e0a5-3"><a href="#6468e0a5-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="6468e0a5-4"><a href="#6468e0a5-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.parquet <span class="im">as</span> pq</span>
<span id="6468e0a5-5"><a href="#6468e0a5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="6468e0a5-6"><a href="#6468e0a5-6" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> <span class="st">"""</span></span>
<span id="6468e0a5-7"><a href="#6468e0a5-7" aria-hidden="true" tabindex="-1"></a><span class="st">nom;cheveux;profession</span></span>
<span id="6468e0a5-8"><a href="#6468e0a5-8" aria-hidden="true" tabindex="-1"></a><span class="st">Astérix;blond;</span></span>
<span id="6468e0a5-9"><a href="#6468e0a5-9" aria-hidden="true" tabindex="-1"></a><span class="st">Obélix;roux;Tailleur de menhir</span></span>
<span id="6468e0a5-10"><a href="#6468e0a5-10" aria-hidden="true" tabindex="-1"></a><span class="st">Assurancetourix;blond;Barde</span></span>
<span id="6468e0a5-11"><a href="#6468e0a5-11" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span></span>
<span id="6468e0a5-12"><a href="#6468e0a5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="6468e0a5-13"><a href="#6468e0a5-13" aria-hidden="true" tabindex="-1"></a>source <span class="op">=</span> StringIO(s)</span>
<span id="6468e0a5-14"><a href="#6468e0a5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="6468e0a5-15"><a href="#6468e0a5-15" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(source, sep<span class="op">=</span><span class="st">";"</span>, index_col<span class="op">=</span><span class="va">False</span>)</span>
<span id="6468e0a5-16"><a href="#6468e0a5-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"taille"</span>] <span class="op">=</span> [<span class="dv">155</span>, <span class="dv">190</span>, <span class="dv">175</span>]</span>
<span id="6468e0a5-17"><a href="#6468e0a5-17" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pa.Table.from_pandas(df)</span>
<span id="6468e0a5-18"><a href="#6468e0a5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="6468e0a5-19"><a href="#6468e0a5-19" aria-hidden="true" tabindex="-1"></a>table</span>
<span id="6468e0a5-20"><a href="#6468e0a5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="6468e0a5-21"><a href="#6468e0a5-21" aria-hidden="true" tabindex="-1"></a>pq.write_table(table, <span class="st">"example.parquet"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>L’utilisation des noms <code>pa</code> pour <code>pyarrow</code> et <code>pq</code> pour
<code>pyarrow.parquet</code> est une convention communautaire
qu’il est recommandé de suivre.</p>
</div>
</div>
</div>
<p>Pour importer et traiter ces données, on peut conserver
les données sous le format <code>pyarrow.Table</code>
ou transformer en <code>pandas.DataFrame</code>. La deuxième
option est plus lente mais présente l’avantage
de permettre ensuite d’appliquer toutes les
manipulations offertes par l’écosystème
<code>pandas</code> qui est généralement mieux connu que
celui d’<code>Arrow</code>.</p>
<p>Supposons qu’on ne s’intéresse qu’à la taille et à la couleur
de cheveux de nos gaulois.
Il n’est pas nécessaire d’importer l’ensemble de la base, cela
ferait perdre du temps pour rien. On appelle
cette approche le <strong><code>column pruning</code></strong> qui consiste à
ne parcourir, dans le fichier, que les colonnes qui nous
intéressent. Du fait du stockage orienté colonne du <code>parquet</code>,
il suffit de ne considérer que les blocs qui nous
intéressent (alors qu’avec un CSV il faudrait scanner tout
le fichier avant de pouvoir éliminer certaines colonnes).
Ce principe du <code>column pruning</code> se matérialise avec
l’argument <code>columns</code> dans <code>parquet</code>.</p>
<p>Ensuite, avec <code>pyarrow</code>, on pourra utiliser <code>pyarrow.compute</code> pour
effectuer des opérations directement sur une table
<code>Arrow</code> :</p>
<div id="f473b57d" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="f473b57d"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="f473b57d-1"><a href="#f473b57d-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.compute <span class="im">as</span> pc</span>
<span id="f473b57d-2"><a href="#f473b57d-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="f473b57d-3"><a href="#f473b57d-3" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pq.read_table(<span class="st">"example.parquet"</span>, columns<span class="op">=</span>[<span class="st">"taille"</span>, <span class="st">"cheveux"</span>])</span>
<span id="f473b57d-4"><a href="#f473b57d-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="f473b57d-5"><a href="#f473b57d-5" aria-hidden="true" tabindex="-1"></a>(table.group_by(<span class="st">"cheveux"</span>).aggregate([(<span class="st">"taille"</span>, <span class="st">"mean"</span>)]))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La manière équivalente de procéder en passant
par l’intermédiaire de <code>pandas</code> est</p>
<div id="b47f1c7c" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="b47f1c7c"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="b47f1c7c-1"><a href="#b47f1c7c-1" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pq.read_table(<span class="st">"example.parquet"</span>, columns<span class="op">=</span>[<span class="st">"taille"</span>, <span class="st">"cheveux"</span>])</span>
<span id="b47f1c7c-2"><a href="#b47f1c7c-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="b47f1c7c-3"><a href="#b47f1c7c-3" aria-hidden="true" tabindex="-1"></a>(table.to_pandas().groupby(<span class="st">"cheveux"</span>)[<span class="st">"taille"</span>].mean())</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>cheveux
blond    165.0
roux     190.0
Name: taille, dtype: float64</code></pre>
</div>
</div>
<p>Ici, comme les données sont peu volumineuses, deux des
avantages du <code>parquet</code> par rapport
au <code>CSV</code> (données moins
volumineuses et vitesse de l’import)
ne s’appliquent pas vraiment.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Un autre principe d’optimisation de la performance qui est
au coeur de la librairie <code>Arrow</code> est le <code>filter pushdown</code>
(ou <code>predicate pushdown</code>).</p>
<p>Quand on exécute un filtre de sélection de ligne
juste après avoir chargé un jeu de données,
<code>Arrow</code> va essayer de le mettre en oeuvre lors de l’étape de lecture
et non après. Autrement dit, <code>Arrow</code> va modifier le plan
d’exécution pour pousser le filtre en amont de la séquence d’exécution
afin de ne pas essayer de lire les lignes inutiles.</p>
</div>
</div>
</div>
</section>
</section>
<section id="les-données-sur-le-cloud" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Les données sur le <em>cloud</em></h1>
<p>Si les fichiers <code>parquet</code> sont une
solution avantageuse pour
les <em>data scientists</em>, ils ne résolvent
pas tous les inconvénients de
l’approche fichier.
En particulier, la question de la
duplication des données pour la mise
à disposition sécurisée des sources
n’est pas résolue. Pour que
l’utilisateur <code>B</code> n’altère pas les
données de l’utilisateur <code>A</code>, il est nécessaire
qu’ils travaillent sur deux fichiers
différents, dont l’un peut être une copie
de l’autre.</p>
<p>La mise à disposition de données dans
les systèmes de stockage <em>cloud</em> est
une réponse à ce problème.
Les <em>data lake</em> qui se sont développés dans les
institutions et entreprises utilisatrices de données</p>
<p>Le principe d’un stockage cloud
est le même que celui d’une
<code>Dropbox</code> ou d’un <code>Drive</code> mais adapté à
l’analyse de données. Un utilisateur de données
accède à un fichier stocké sur un serveur distant
<em>comme s’il</em> était dans son <em>file system</em> local<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.
Donc, du point de vue de l’utilisateur <code>Python</code>,
il n’y a pas de différence fondamentale. Cependant,
les données ne sont pas hebergées dans un dossier
local (par exemple <code>Mes Documents/monsuperfichier</code>)
mais sur un serveur distant auquel l’utilisateur
de <code>Python</code> accède à travers un échange réseau.</p>
<p><a href="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/featured.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/featured.png" class="img-fluid"></a></p>
<p>Dans l’univers du <em>cloud</em>, la hiérarchisation des données
dans des dossiers et des fichiers bien rangés
est d’ailleurs moins
importante que dans le monde du <em>file system</em> local.
Lorsque vous essayez de retrouver un fichier dans
votre arborescence de fichiers, vous utilisez parfois
la barre de recherche de votre explorateur de fichiers,
avec des résultats mitigés<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Dans le monde du <em>cloud</em>,
les fichiers sont parfois accumulés de manière plus
chaotique car les outils de recherche sont plus
efficaces<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>.</p>
<p>En ce qui concerne la sécurité des données,
la gestion des droits de lecture et écriture peut être
fine: on peut autoriser certains utilisateurs uniquement
à la lecture, d’autres peuvent avoir les droits
d’écriture pour modifier les données. Cela permet
de concilier les avantages des bases de données (la sécurisation
des données) avec ceux des fichiers.</p>
<section id="quest-ce-que-le-système-de-stockage-s3" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="quest-ce-que-le-système-de-stockage-s3"><span class="header-section-number">3.1</span> Qu’est-ce que le système de stockage <code>S3</code> ?</h2>
<p>Dans les entreprises et administrations,
un nombre croissant de données sont
disponibles depuis un système de stockage
nommé <code>S3</code>.
Le système <code>S3</code> (<em>Simple Storage System</em>) est un système de stockage développé
par Amazon et qui est maintenant devenu une référence pour le stockage en ligne.
Il s’agit d’une architecture à la fois
sécurisée (données cryptées, accès restreints) et performante.</p>
<p>Le concept central du système S3 est le <strong><em>bucket</em></strong>.
Un <em>bucket</em> est un espace (privé ou partagé) où on peut stocker une
arborescence de fichiers. Pour accéder aux fichiers figurant
dans un <em>bucket</em> privé, il faut des jetons d’accès (l’équivalent d’un mot de passe)
reconnus par le serveur de stockage. On peut alors lire et écrire dans le <em>bucket</em>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Les exemples suivants seront réplicables pour les utilisateurs de la plateforme
SSP Cloud</p>
<div class="badge-container"><div class="badge-text">Pour essayer les exemples présents dans ce tutoriel :</div><a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/modern-ds/s3.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=github&amp;label=&amp;message=View%20on%20GitHub&amp;color=181717" alt="View on GitHub"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;name=«s3»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-vscode.sh»&amp;init.personalInitArgs=«modern-ds%20s3%20correction»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Lancer_avec_VSCode-blue?logo=visualstudiocode&amp;logoColor=blue" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;name=«s3»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-jupyter.sh»&amp;init.personalInitArgs=«modern-ds%20s3%20correction»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Lancer_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks//blob/main//notebooks/modern-ds/s3.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a><br></div>
<p>Ils peuvent également l’être pour des utilisateurs ayant un
accès à AWS, il suffit de changer l’URL du <code>endpoint</code>
présenté ci-dessous.</p>
</div>
</div>
</div>
</section>
<section id="comment-faire-avec-python" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="comment-faire-avec-python"><span class="header-section-number">3.2</span> Comment faire avec Python ?</h2>
<section id="les-librairies-principales" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="les-librairies-principales"><span class="header-section-number">3.2.1</span> Les librairies principales</h3>
<p>L’interaction entre ce système distant de fichiers et une session locale de Python
est possible grâce à des API. Les deux principales librairies sont les suivantes :</p>
<ul>
<li><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html">boto3</a>, une librairie créée et maintenue par Amazon ;</li>
<li><a href="https://s3fs.readthedocs.io/en/latest/">s3fs</a>, une librairie qui permet d’interagir avec les fichiers stockés à l’instar d’un filesystem classique.</li>
</ul>
<p>La librairie <code>pyarrow</code> que nous avons déjà présentée permet également
de traiter des données stockées sur le <em>cloud</em> comme si elles
étaient sur le serveur local. C’est extrêmement pratique
et permet de fiabiliser la lecture ou l’écriture de fichiers
dans une architecture <em>cloud</em>.
Un exemple, assez court, est disponible
<a href="https://arrow.apache.org/docs/python/filesystems.html#s3">dans la documentation officielle</a></p>
<p>Il existe également d’autres librairies permettant de gérer
des <em>pipelines</em> de données (chapitre à venir) de manière
quasi indifférente entre une architecture locale et une architecture
<em>cloud</em>. Parmi celles-ci, nous présenterons quelques exemples
avec <code>snakemake</code>.
En arrière-plan, <code>snakemake</code>
va utiliser <code>boto3</code> pour communiquer avec le système
de stockage.</p>
<p>Enfin, selon le même principe du <em>comme si</em> les données
étaient en local, il existe l’outil en ligne de commande
<code>mc</code> (<a href="https://docs.min.io/docs/minio-client-complete-guide.html"><code>Minio Client</code></a>) qui permet de gérer par des lignes
de commande Linux les dépôts distants comme s’ils étaient
locaux.</p>
<p>Toutes ces librairies offrent la possibilité de se connecter depuis <code>Python</code>,
à un dépôt de fichiers distant, de lister les fichiers disponibles dans un
<em>bucket</em>, d’en télécharger un ou plusieurs ou de faire de l’<em>upload</em>
Nous allons présenter quelques-unes des opérations les plus fréquentes,
en mode <em>cheatsheet</em>.</p>
</section>
<section id="connexion-à-un-bucket" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="connexion-à-un-bucket"><span class="header-section-number">3.2.2</span> Connexion à un bucket</h3>
<p>Par la suite, on va utiliser des alias pour les trois valeurs suivantes, qui servent
à s’authentifier.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>key_id <span class="op">=</span> <span class="st">"MY_KEY_ID"</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>access_key <span class="op">=</span> <span class="st">"MY_ACCESS_KEY"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>token <span class="op">=</span> <span class="st">"MY_TOKEN"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Ces valeurs peuvent être également disponibles dans
les variables d’environnement de <code>Python</code>. Comme il s’agit d’une information
d’authentification personnelle, il ne faut pas stocker les vraies valeurs de ces
variables dans un projet, sous peine de partager des traits d’identité sans le
vouloir lors d’un partage de code.</p>
<div class="cell markdown">
<details><summary><code>boto3</code> 👇</summary>
<p>Avec <code>boto3</code>, on créé d’abord un client puis on exécute des requêtes dessus.
Pour initialiser un client, il suffit, en supposant que l’url du dépôt S3 est
<code>"https://minio.lab.sspcloud.fr"</code>, de faire:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> boto3.client(<span class="st">"s3"</span>, endpoint_url<span class="op">=</span><span class="st">"https://minio.lab.sspcloud.fr"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>S3FS</code> 👇</summary>
<p>La logique est identique avec <code>s3fs</code>.</p>
<p>Si on a des jetons d’accès à jour et dans les variables d’environnement
adéquates:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> s3fs.S3FileSystem(client_kwargs<span class="op">=</span>{<span class="st">"endpoint_url"</span>: <span class="st">"https://minio.lab.sspcloud.fr"</span>})</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Arrow</code> 👇</summary>
<p>La logique d’<code>Arrow</code> est proche de celle de <code>s3fs</code>. Seuls les noms
d’arguments changent</p>
<p>Si on a des jetons d’accès à jour et dans les variables d’environnement
adéquates:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyarrow <span class="im">import</span> fs</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> fs.S3FileSystem(endpoint_override<span class="op">=</span><span class="st">"http://"</span> <span class="op">+</span> <span class="st">"minio.lab.sspcloud.fr"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Snakemake</code> 👇</summary>
<p>La logique de <code>Snakemake</code> est, quant à elle,
plus proche de celle de <code>boto3</code>. Seuls les noms
d’arguments changent</p>
<p>Si on a des jetons d’accès à jour et dans les variables d’environnement
adéquates:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snakemake.remote.S3 <span class="im">import</span> RemoteProvider <span class="im">as</span> S3RemoteProvider</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>S3 <span class="op">=</span> S3RemoteProvider(host<span class="op">=</span><span class="st">"https://"</span> <span class="op">+</span> os.getenv(<span class="st">"AWS_S3_ENDPOINT"</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Il se peut que la connexion à ce stade soit refusée (<code>HTTP error 403</code>).
Cela peut provenir
d’une erreur dans l’URL utilisé. Cependant, cela reflète plus généralement
des paramètres d’authentification erronés.</p>
<div class="cell markdown">
<details><summary><code>boto3</code> 👇</summary>
<p>Les paramètres d’authentification sont des arguments supplémentaires:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> boto3.client(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"s3"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    endpoint_url<span class="op">=</span><span class="st">"https://minio.lab.sspcloud.fr"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    aws_access_key_id<span class="op">=</span>key_id,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    aws_secret_access_key<span class="op">=</span>access_key,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    aws_session_token<span class="op">=</span>token,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>S3FS</code> 👇</summary>
<p>La logique est la même, seuls les noms d’arguments diffèrent</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> s3fs.S3FileSystem(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    client_kwargs<span class="op">=</span>{<span class="st">"endpoint_url"</span>: <span class="st">"https://"</span> <span class="op">+</span> <span class="st">"minio.lab.sspcloud.fr"</span>},</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    key<span class="op">=</span>key_id,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    secret<span class="op">=</span>access_key,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    token<span class="op">=</span>token,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Arrow</code> 👇</summary>
<p>Tout est en argument cette fois:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyarrow <span class="im">import</span> fs</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> fs.S3FileSystem(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    access_key<span class="op">=</span>key_id,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    secret_key<span class="op">=</span>access_key,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    session_token<span class="op">=</span>token,</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    endpoint_override<span class="op">=</span><span class="st">"https://"</span> <span class="op">+</span> <span class="st">"minio.lab.sspcloud.fr"</span>,</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    scheme<span class="op">=</span><span class="st">"https"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Snakemake</code> 👇</summary>
<p>La logique est la même, seuls les noms d’arguments diffèrent</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snakemake.remote.S3 <span class="im">import</span> RemoteProvider <span class="im">as</span> S3RemoteProvider</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>S3 <span class="op">=</span> S3RemoteProvider(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    host<span class="op">=</span><span class="st">"https://"</span> <span class="op">+</span> os.getenv(<span class="st">"AWS_S3_ENDPOINT"</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    access_key_id<span class="op">=</span>key_id,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    secret_access_key<span class="op">=</span>access_key,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Sur le SSP Cloud, les jetons d’accès au stockage S3 sont injectés automatiquement dans les services lors de leur création. Ils sont ensuite valides pour une durée de 7 jours. Si l’icône du service passe du vert au rouge, cela signifie que ces jetons sont périmés, il faut donc sauvegarder son code / ses données et reprendre depuis un nouveau service.</p>
</div>
</div>
</div>
</section>
<section id="lister-les-fichiers" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="lister-les-fichiers"><span class="header-section-number">3.2.3</span> Lister les fichiers</h3>
<p>S’il n’y a pas d’erreur à ce stade, c’est que la connexion est bien effective.
Pour le vérifier, on peut essayer de faire la liste des fichiers disponibles
dans un <code>bucket</code> auquel on désire accéder.</p>
<p>Par exemple, on peut vouloir
tester l’accès aux bases <code>FILOSOFI</code> (données de revenu localisées disponibles
sur <a href="https://www.insee.fr" class="uri">https://www.insee.fr</a>) au sein du bucket <code>donnees-insee</code>.</p>
<div class="cell markdown">
<details><summary><code>boto3</code> 👇</summary>
<p>Pour cela,
la méthode <code>list_objects</code> offre toutes les options nécessaires:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> boto3.client(<span class="st">"s3"</span>, endpoint_url<span class="op">=</span><span class="st">"https://minio.lab.sspcloud.fr"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> s3.list_objects(Bucket<span class="op">=</span><span class="st">"donnees-insee"</span>, Prefix<span class="op">=</span><span class="st">"diffusion/FILOSOFI"</span>)[</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Contents"</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>]:</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(key[<span class="st">"Key"</span>])</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>S3FS</code> 👇</summary>
<p>Pour lister les fichiers, c’est la méthode <code>ls</code> (celle-ci ne liste pas par
défaut les fichiers de manière récursive comme <code>boto3</code>):</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> s3fs.S3FileSystem(client_kwargs<span class="op">=</span>{<span class="st">"endpoint_url"</span>: <span class="st">"https://minio.lab.sspcloud.fr"</span>})</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>fs.ls(<span class="st">"donnees-insee/diffusion"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Arrow</code> 👇</summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyarrow <span class="im">import</span> fs</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> fs.S3FileSystem(endpoint_override<span class="op">=</span><span class="st">"https://"</span> <span class="op">+</span> <span class="st">"minio.lab.sspcloud.fr"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>s3.get_file_info(fs.FileSelector(<span class="st">"donnees-insee/diffusion"</span>, recursive<span class="op">=</span><span class="va">True</span>))</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>mc</code> 👇</summary>
<pre class="shell"><code>mc ls -r</code></pre>
</details>
</div>
</section>
<section id="télécharger-un-fichier-depuis-s3-pour-lenregistrer-en-local" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="télécharger-un-fichier-depuis-s3-pour-lenregistrer-en-local"><span class="header-section-number">3.2.4</span> Télécharger un fichier depuis <code>S3</code> pour l’enregistrer en local</h3>
<p>Cette méthode n’est en général pas recommandée car, comme on va le voir
par la suite, il est possible de lire à la volée des fichiers. Cependant,
télécharger un fichier depuis le <em>cloud</em> pour l’écrire sur le disque
local peut parfois être utile (par exemple, lorsqu’il est nécessaire
de dézipper un fichier).</p>
<div class="cell markdown">
<details><summary><code>boto3</code> 👇</summary>
<p>On utilise cette fois la méthode <code>download_file</code></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> boto3.client(<span class="st">"s3"</span>, endpoint_url<span class="op">=</span><span class="st">"https://minio.lab.sspcloud.fr"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>s3.download_file(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"donnees-insee"</span>, <span class="st">"diffusion/FILOSOFI/2014/FILOSOFI_COM.csv"</span>, <span class="st">"data.csv"</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>S3FS</code> 👇</summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> s3fs.S3FileSystem(client_kwargs<span class="op">=</span>{<span class="st">"endpoint_url"</span>: <span class="st">"https://minio.lab.sspcloud.fr"</span>})</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>fs.download(<span class="st">"donnees-insee/diffusion/FILOSOFI/2014/FILOSOFI_COM.csv"</span>, <span class="st">"test.csv"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Snakemake</code> 👇</summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snakemake.remote.S3 <span class="im">import</span> RemoteProvider <span class="im">as</span> S3RemoteProvider</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>S3 <span class="op">=</span> S3RemoteProvider(host <span class="op">=</span> <span class="st">"https://"</span> <span class="op">+</span> os.getenv(<span class="st">'AWS_S3_ENDPOINT'</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>bucket <span class="op">=</span> <span class="st">"mon-bucket"</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>rule ma_super_regle_s3:</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        fichier <span class="op">=</span> S3.remote(<span class="ss">f'</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/moninput.csv'</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    output:</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        fichier<span class="op">=</span><span class="st">'mon_dossier_local/monoutput.csv'</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    run:</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>        shell(<span class="st">"cp </span><span class="sc">{input[0]}</span><span class="st"> </span><span class="sc">{output[0]}</span><span class="st">"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>mc</code> 👇</summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>mc cp <span class="st">"donnees-insee/FILOSOFI/2014/FILOSOFI_COM.csv"</span> <span class="st">'data.csv'</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="lire-un-fichier-directement" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="lire-un-fichier-directement"><span class="header-section-number">3.2.5</span> Lire un fichier directement</h3>
<p>La méthode précédente n’est pas optimale. En effet, l’un des intérêts des API
est qu’on peut traiter un fichier sur <code>S3</code> comme s’il s’agissait d’un fichier
sur son PC. Cela est d’ailleurs une manière plus sécurisée de procéder puisqu’on
lit les données à la volée, sans les écrire dans un filesystem local.</p>
<div class="cell markdown">
<details><summary><code>boto3</code> 👇</summary>
<div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> boto3.client(<span class="st">"s3"</span>, endpoint_url<span class="op">=</span><span class="st">"https://minio.lab.sspcloud.fr"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>obj <span class="op">=</span> s3.get_object(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    Bucket<span class="op">=</span><span class="st">"donnees-insee"</span>, Key<span class="op">=</span><span class="st">"diffusion/FILOSOFI/2014/FILOSOFI_COM.csv"</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(obj[<span class="st">"Body"</span>], sep<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">2</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>S3FS</code> 👇</summary>
<p>Le code suivant devrait permettre d’effectuer la même opération avec <code>s3fs</code></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> s3fs.S3FileSystem(client_kwargs<span class="op">=</span>{<span class="st">"endpoint_url"</span>: <span class="st">"https://minio.lab.sspcloud.fr"</span>})</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    fs.<span class="bu">open</span>(</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">"</span><span class="sc">{}</span><span class="st">/</span><span class="sc">{}</span><span class="st">"</span>.<span class="bu">format</span>(<span class="st">"donnees-insee"</span>, <span class="st">"diffusion/FILOSOFI/2014/FILOSOFI_COM.csv"</span>),</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        mode<span class="op">=</span><span class="st">"rb"</span>,</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    sep<span class="op">=</span><span class="st">";"</span>,</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">2</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Snakemake</code> 👇</summary>
<div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snakemake.remote.S3 <span class="im">import</span> RemoteProvider <span class="im">as</span> S3RemoteProvider</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>S3 <span class="op">=</span> S3RemoteProvider(host <span class="op">=</span> <span class="st">"https://"</span> <span class="op">+</span> os.getenv(<span class="st">'AWS_S3_ENDPOINT'</span>))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>bucket <span class="op">=</span> <span class="st">"mon-bucket"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>rule ma_super_regle_s3:</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        fichier <span class="op">=</span> S3.remote(<span class="ss">f'</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/moninput.csv'</span>)</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    run:</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_csv(<span class="bu">input</span>.fichier)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># PLUS D'OPERATIONS</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Arrow</code> 👇</summary>
<p><code>Arrow</code> est une librairie qui permet de lire des <code>CSV</code>.
Il est néanmoins
beaucoup plus pratique d’utiliser le format <code>parquet</code> avec <code>arrow</code>.
Dans un premier temps, on configure le <em>filesystem</em> avec les
fonctionalités d’<code>Arrow</code> (cf.&nbsp;précédemment).</p>
<div id="856d536a" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyarrow <span class="im">import</span> fs</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> fs.S3FileSystem(endpoint_override<span class="op">=</span><span class="st">"http://"</span> <span class="op">+</span> <span class="st">"minio.lab.sspcloud.fr"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour lire un csv, on fera:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyarrow <span class="im">import</span> fs</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyarrow <span class="im">import</span> csv</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>s3 <span class="op">=</span> fs.S3FileSystem(endpoint_override<span class="op">=</span><span class="st">"https://"</span> <span class="op">+</span> <span class="st">"minio.lab.sspcloud.fr"</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> s3.open_input_file(</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"donnees-insee/diffusion/FILOSOFI/2014/FILOSOFI_COM.csv"</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> csv.read_csv(<span class="bu">file</span>, parse_options<span class="op">=</span>csv.ParseOptions(delimiter<span class="op">=</span><span class="st">";"</span>)).to_pandas()</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Pour un fichier au format parquet, la démarche est plus simple grâce à l’argument
<code>filesystem</code> dans <code>pyarrow.parquet.ParquetDataset</code> :</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.parquet <span class="im">as</span> pq</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># bucket = ""</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># parquet_file=""</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> (</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    pq.ParquetDataset(<span class="ss">f"</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>parquet_file<span class="sc">}</span><span class="ss">"</span>, filesystem<span class="op">=</span>s3)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    .read_pandas()</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="uploader-un-fichier" class="level3" data-number="3.2.6">
<h3 data-number="3.2.6" class="anchored" data-anchor-id="uploader-un-fichier"><span class="header-section-number">3.2.6</span> Uploader un fichier</h3>
<div class="cell markdown">
<details><summary><code>boto3</code> 👇</summary>
<div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>s3.upload_file(file_name, bucket, object_name)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>S3FS</code> 👇</summary>
<div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fs.put(filepath, <span class="ss">f"</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>object_name<span class="sc">}</span><span class="ss">"</span>, recursive<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Arrow</code> 👇</summary>
<p>Supposons que <code>df</code> soit un <code>pd.DataFrame</code>
Dans un système local, on convertirait
en table <code>Arrow</code> puis on écrirait en <code>parquet</code>
(<a href="https://arrow.apache.org/docs/python/parquet.html#reading-and-writing-single-files">voir la documentation officielle</a>).
Quand on est sur un système <code>S3</code>, il s’agit seulement d’ajouter
notre connexion à <code>S3</code> dans l’argument <code>filesystem</code>
(<a href="https://arrow.apache.org/docs/python/filesystems.html#filesystem-s3">voir la page sur ce sujet dans la documentation Arrow</a>)</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.parquet <span class="im">as</span> pq</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pa.Table.from_pandas(df)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>pq.write_table(table, <span class="ss">f"</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>path<span class="sc">}</span><span class="ss">"</span>, filesystem<span class="op">=</span>s3)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>Snakemake</code> 👇</summary>
<div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> snakemake.remote.S3 <span class="im">import</span> RemoteProvider <span class="im">as</span> S3RemoteProvider</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>S3 <span class="op">=</span> S3RemoteProvider(host <span class="op">=</span> <span class="st">"https://"</span> <span class="op">+</span> os.getenv(<span class="st">'AWS_S3_ENDPOINT'</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>bucket <span class="op">=</span> <span class="st">"mon-bucket"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>rule ma_super_regle_s3:</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">input</span>:</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        fichier<span class="op">=</span><span class="st">'mon_dossier_local/moninput.csv'</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    output:</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        fichier<span class="op">=</span>S3.remote(<span class="ss">f'</span><span class="sc">{</span>bucket<span class="sc">}</span><span class="ss">/monoutput.csv'</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    run:</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        shell(<span class="st">"cp output.fichier input.fichier"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell markdown">
<details><summary><code>mc</code> 👇</summary>
<div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mc cp <span class="st">'data.csv'</span> <span class="st">"MONBUCKET/monoutput.csv"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="cas-pratique-stocker-les-données-de-son-projet-sur-le-ssp-cloud" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="cas-pratique-stocker-les-données-de-son-projet-sur-le-ssp-cloud"><span class="header-section-number">3.3</span> Cas pratique : stocker les données de son projet sur le SSP Cloud</h2>
<p>Une composante essentielle de l’évaluation des projets <code>Python</code> est la <strong>reproductibilité</strong>, i.e.&nbsp;la possibilité de retrouver les mêmes résultats à partir des mêmes données d’entrée et du même code. Dans la mesure du possible, il faut donc que votre rendu final parte des données brutes utilisées comme source dans votre projet. Si les fichiers de données source sont accessibles via une URL publique par exemple, il est idéal de les importer directement à partir de cette URL au début de votre projet (voir le <a href="../../content/manipulation/02_pandas_suite.html">TP Pandas</a> pour un exemple d’un tel import via <code>Pandas</code>).</p>
<p>En pratique, cela n’est pas toujours possible. Peut-être que vos données ne sont pas directement publiquement accessibles, ou bien sont disponibles sous des formats complexes qui demandent des pré-traitements avant d’être exploitables dans un format de donnée standard. Peut-être que vos données résultent d’une phase de récupération automatisée via une <a href="../../content/manipulation/04c_API_TP.html">API</a> ou du <a href="../../content/manipulation/04a_webscraping_TP.html">webscraping</a>, auquel cas l’étape de récupération peut prendre du temps à reproduire. Par ailleurs, les sites internet évoluent fréquemment dans le temps, il est donc préférable de “figer” les données une fois l’étape de récupération effectuée. De la même façon, même s’il ne s’agit pas de données source, vous pouvez vouloir entraîner des modèles et stocker leur version entraînée, car cette étape peut également être chronophage.</p>
<p>Dans toutes ces situations, il est nécessaire de pouvoir stocker des données (ou des modèles). <strong>Votre dépôt <code>Git</code> n’est pas le lieu adapté pour le stockage de fichiers volumineux</strong>. Un projet <code>Python</code> bien construit est modulaire: il sépare le stockage du code (<code>Git</code>), d’éléments de configuration (par exemple des jetons d’API qui ne doivent pas être dans le code) et du stockage des données. Ce principe</p>
<p><a href="environment.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="environment.png" class="img-fluid"></a></p>
<p>Là où <code>Git</code> est fait pour stocker du code, on utilise des solutions adaptées pour le stockage de fichiers. De nombreuses solutions existent pour ce faire. Sur le SSP Cloud, on propose <code>MinIO</code>, une implémentation open-source du stockage <code>S3</code> présenté plus haut. Ce court tutoriel vise à présenter une utilisation standard dans le cadre de vos projets.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Quelle que soit la solution de stockage retenue pour vos données/modèles, <strong>le code ayant servir à produire ces objets doit impérativement figurer dans votre dépôt de projet</strong>.</p>
</div>
</div>
</div>
<section id="partager-des-fichiers-sur-le-ssp-cloud" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="partager-des-fichiers-sur-le-ssp-cloud"><span class="header-section-number">3.3.1</span> Partager des fichiers sur le SSP Cloud</h3>
<p>Comme expliqué plus haut, on stocke les fichiers sur <code>S3</code> dans un bucket. Sur le SSP Cloud, un bucket est créé automatiquement lors de votre création de compte, avec le même nom que votre compte SSP Cloud. L’interface <a href="https://datalab.sspcloud.fr/my-files">Mes Fichiers</a> vous permet d’y accéder de manière visuelle, d’y importer des fichiers, de les télécharger, etc.</p>
<p>Dans ce tutoriel, nous allons plutôt y accéder de manière programmatique, via du code <code>Python</code>. Le package <code>s3fs</code> permet de requêter votre bucket à la manière d’un filesystem classique. Par exemple, vous pouvez lister les fichiers disponibles sur votre <em>bucket</em> avec la commande suivante :</p>
<div id="254b6323" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="254b6323"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="254b6323-1"><a href="#254b6323-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="254b6323-2"><a href="#254b6323-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="254b6323-3"><a href="#254b6323-3" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> s3fs.S3FileSystem(client_kwargs<span class="op">=</span>{<span class="st">"endpoint_url"</span>: <span class="st">"https://minio.lab.sspcloud.fr"</span>})</span>
<span id="254b6323-4"><a href="#254b6323-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="254b6323-5"><a href="#254b6323-5" aria-hidden="true" tabindex="-1"></a>MY_BUCKET <span class="op">=</span> <span class="st">"mon_nom_utilisateur_sspcloud"</span></span>
<span id="254b6323-6"><a href="#254b6323-6" aria-hidden="true" tabindex="-1"></a>fs.ls(MY_BUCKET)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si vous n’avez jamais ajouté de fichier sur MinIO, votre <em>bucket</em> est vide, cette commande devrait donc renvoyer une liste vide. On va donc ajouter un premier dossier pour voir la différence.</p>
<p>Par défaut, un bucket vous est personnel, c’est à dire que les données qui s’y trouvent ne peuvent être lues ou modifiées que par vous. Dans le cadre de votre projet, vous aurez envie de partager ces fichiers avec les membres de votre groupe pour développer de manière collaborative. Mais pas seulement ! Il faudra également que vos correcteurs puissent accéder à ces fichiers pour reproduire vos analyses.</p>
<p>Il existe différentes possibilités de rendre des fichiers plus ou moins publics sur <code>MinIO</code>. La plus simple, et celle que nous vous recommandons, est de créer un dossier <code>diffusion</code> à la racine de votre bucket. Sur le SSP Cloud, tous les fichiers qui se situent dans un dossier <code>diffusion</code> sont accessibles <strong>en lecture</strong> à l’ensemble des utilisateurs authentifiés. Utilisez l’interface <a href="https://datalab.sspcloud.fr/my-files">Mes Fichiers</a> pour créer un dossier <code>diffusion</code> à la racine de votre <em>bucket</em>. Si tout a bien fonctionné, la commande <code>Python</code> ci-dessus devrait désormais afficher le chemin <code>mon_nom_utilisateur_sspcloud/diffusion</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Le stockage <em>cloud</em> favorise le travail collaboratif !</p>
<p>Plutôt que chaque membre du projet travaille avec ses propres fichiers sur son ordinateur, ce qui implique une synchronisation fréquente entre membres du groupe et limite la reproductibilité du fait des risques d’erreur, les fichiers sont mis sur un dépôt central, que chaque membre du groupe peut ensuite requêter.</p>
<p>Pour cela, il faut simplement s’accorder au sein du groupe pour utiliser le bucket d’un des membres du projet, et s’assurer que les autres membres du groupe peuvent accéder aux données, en les mettant dans le dossier <code>diffusion</code> du bucket choisi.</p>
</div>
</div>
</div>
</section>
<section id="récupération-et-stockage-de-données" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="récupération-et-stockage-de-données"><span class="header-section-number">3.3.2</span> Récupération et stockage de données</h3>
<p>Maintenant que nous savons où mettre nos données sur <code>MinIO</code>, regardons comment le faire en pratique depuis <code>Python</code>.</p>
<section id="cas-dun-dataframe" class="level4" data-number="3.3.2.1">
<h4 data-number="3.3.2.1" class="anchored" data-anchor-id="cas-dun-dataframe"><span class="header-section-number">3.3.2.1</span> Cas d’un Dataframe</h4>
<p>Reprenons un exemple issu du cours sur les <a href="../../content/manipulation/04c_API_TP.html#illustration-avec-une-api-de-lademe-pour-obtenir-des-diagnostics-énergétiques">API</a> pour simuler une étape de récupération de données coûteuse en temps.</p>
<div id="6dce6ae7" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="6dce6ae7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="6dce6ae7-1"><a href="#6dce6ae7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="6dce6ae7-2"><a href="#6dce6ae7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="6dce6ae7-3"><a href="#6dce6ae7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="6dce6ae7-4"><a href="#6dce6ae7-4" aria-hidden="true" tabindex="-1"></a>api_query <span class="op">&lt;</span> <span class="op">-</span><span class="st">"https://koumoul.com/data-fair/api/v1/datasets/dpe-france/lines?format=json&amp;q_mode=simple&amp;qs=code_insee_commune_actualise%3A</span><span class="sc">%2201450%</span><span class="st">22&amp;size=100&amp;select=%2A&amp;sampling=neighbors"</span></span>
<span id="6dce6ae7-5"><a href="#6dce6ae7-5" aria-hidden="true" tabindex="-1"></a>response_json <span class="op">=</span> requests.get(url_api).json()</span>
<span id="6dce6ae7-6"><a href="#6dce6ae7-6" aria-hidden="true" tabindex="-1"></a>df_dpe <span class="op">=</span> pd.json_normalize(response_json[<span class="st">"results"</span>])</span>
<span id="6dce6ae7-7"><a href="#6dce6ae7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="6dce6ae7-8"><a href="#6dce6ae7-8" aria-hidden="true" tabindex="-1"></a>df_dpe.head(<span class="dv">2</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette requête nous permet de récupérer un <em>DataFrame</em> <code>Pandas</code>, dont les deux premières lignes sont imprimées ci-dessus. Dans notre cas le processus est volontairement simpliste, mais on peut imaginer que de nombreuses étapes de requêtage / préparation de la données sont nécessaires pour aboutir à un dataframe exploitable dans la suite du projet, et que ce processus est coûteux en temps. On va donc stocker ces données “intermédiaires” sur <code>MinIO</code> afin de pouvoir exécuter la suite du projet sans devoir refaire tourner tout le code qui les a produites.</p>
<p>On peut utiliser les fonctions d’export de <code>Pandas</code>, qui permettent d’exporter dans différents formats de données. Vu qu’on est dans le cloud, une étape supplémentaire est nécessaire : on ouvre une connexion vers <code>MinIO</code>, puis on exporte notre dataframe.</p>
<div id="603e9307" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="603e9307"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="603e9307-1"><a href="#603e9307-1" aria-hidden="true" tabindex="-1"></a>MY_BUCKET <span class="op">=</span> <span class="st">"mon_nom_utilisateur_sspcloud"</span></span>
<span id="603e9307-2"><a href="#603e9307-2" aria-hidden="true" tabindex="-1"></a>FILE_PATH_OUT_S3 <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/df_dpe.csv"</span></span>
<span id="603e9307-3"><a href="#603e9307-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="603e9307-4"><a href="#603e9307-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> fs.<span class="bu">open</span>(FILE_PATH_OUT_S3, <span class="st">"w"</span>) <span class="im">as</span> file_out:</span>
<span id="603e9307-5"><a href="#603e9307-5" aria-hidden="true" tabindex="-1"></a>    df_dpe.to_csv(file_out)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut vérifier que notre fichier a bien été uploadé via l’interface <a href="https://datalab.sspcloud.fr/my-files">Mes Fichiers</a> ou bien directement en <code>Python</code> en interrogeant le contenu du dossier <code>diffusion</code> de notre <em>bucket</em> :</p>
<div id="01adad5e" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="01adad5e"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="01adad5e-1"><a href="#01adad5e-1" aria-hidden="true" tabindex="-1"></a>fs.ls(<span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On pourrait tout aussi simplement exporter notre <em>dataset</em> en <code>Parquet</code>, pour limiter l’espace de stockage et maximiser les performances à la lecture. Attention : vu que <code>Parquet</code> est un format compressé, il faut préciser qu’on écrit un fichier binaire : le mode d’ouverture du fichier passé à la fonction <code>fs.open</code> passe de <code>w</code> (<code>write</code>) à <code>wb</code> (<code>write binary</code>).</p>
<div id="58a1e1f4" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="58a1e1f4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="58a1e1f4-1"><a href="#58a1e1f4-1" aria-hidden="true" tabindex="-1"></a>FILE_PATH_OUT_S3 <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/df_dpe.parquet"</span></span>
<span id="58a1e1f4-2"><a href="#58a1e1f4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="58a1e1f4-3"><a href="#58a1e1f4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> fs.<span class="bu">open</span>(FILE_PATH_OUT_S3, <span class="st">"wb"</span>) <span class="im">as</span> file_out:</span>
<span id="58a1e1f4-4"><a href="#58a1e1f4-4" aria-hidden="true" tabindex="-1"></a>    df_dpe.to_parquet(file_out)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cas-de-fichiers" class="level4" data-number="3.3.2.2">
<h4 data-number="3.3.2.2" class="anchored" data-anchor-id="cas-de-fichiers"><span class="header-section-number">3.3.2.2</span> Cas de fichiers</h4>
<p>Dans la partie précédente, on était dans le cas “simple” d’un dataframe, ce qui nous permettait d’utiliser directement les fonctions d’export de <code>Pandas</code>. Maintenant, imaginons qu’on ait plusieurs fichiers d’entrée, pouvant chacun avoir des formats différents. Un cas typique de tels fichiers sont les fichiers <code>ShapeFile</code>, qui sont des fichiers de données géographiques, et se présentent sous forme d’une combinaison de fichiers (cf.&nbsp;<a href="../../content/manipulation/03_geopandas_intro.html#le-format-shapefile-.shp-et-le-geopackage-.gpkg">chapitre sur GeoPandas</a>). Commençons par récupérer un fichier <code>.shp</code> pour voir sa structure.</p>
<p>On récupère ci-dessous les <a href="https://www.data.gouv.fr/fr/datasets/contours-des-departements-francais-issus-d-openstreetmap/">contours des départements français</a>, sous la forme d’une archive <code>.zip</code> qu’on va décompresser en local dans un dossier <code>departements_fr</code>.</p>
<div id="df8a3159" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="df8a3159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="df8a3159-1"><a href="#df8a3159-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="df8a3159-2"><a href="#df8a3159-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="df8a3159-3"><a href="#df8a3159-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="df8a3159-4"><a href="#df8a3159-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> zipfile</span>
<span id="df8a3159-5"><a href="#df8a3159-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="df8a3159-6"><a href="#df8a3159-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Import et décompression</span></span>
<span id="df8a3159-7"><a href="#df8a3159-7" aria-hidden="true" tabindex="-1"></a>contours_url <span class="op">=</span> (</span>
<span id="df8a3159-8"><a href="#df8a3159-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://www.data.gouv.fr/fr/datasets/r/eb36371a-761d-44a8-93ec-3d728bec17ce"</span></span>
<span id="df8a3159-9"><a href="#df8a3159-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="df8a3159-10"><a href="#df8a3159-10" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(contours_url, stream<span class="op">=</span><span class="va">True</span>)</span>
<span id="df8a3159-11"><a href="#df8a3159-11" aria-hidden="true" tabindex="-1"></a>zipfile <span class="op">=</span> zipfile.ZipFile(io.BytesIO(response.content))</span>
<span id="df8a3159-12"><a href="#df8a3159-12" aria-hidden="true" tabindex="-1"></a>zipfile.extractall(<span class="st">"departements_fr"</span>)</span>
<span id="df8a3159-13"><a href="#df8a3159-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="df8a3159-14"><a href="#df8a3159-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification du dossier (local, pas sur S3)</span></span>
<span id="df8a3159-15"><a href="#df8a3159-15" aria-hidden="true" tabindex="-1"></a>os.listdir(<span class="st">"departements_fr"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vu qu’il s’agit cette fois de fichiers locaux et non d’un <em>dataframe</em> <code>Pandas</code>, on doit utiliser le package <code>s3fs</code> pour transférer les fichiers du filesystem local au filesystem distant (<code>MinIO</code>). Grâce à la commande <code>put</code>, on peut copier en une seule commande le dossier sur <code>MinIO</code>. Attention à bien spécifier le paramètre <code>recursive=True</code>, qui permet de copier à la fois un dossier et son contenu.</p>
<div id="631e5f46" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="631e5f46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="631e5f46-1"><a href="#631e5f46-1" aria-hidden="true" tabindex="-1"></a>fs.put(<span class="st">"departements_fr/"</span>, <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/departements_fr/"</span>, recursive<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Vérifions que le dossier a bien été copié :</p>
<div id="6e09b090" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="6e09b090"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="6e09b090-1"><a href="#6e09b090-1" aria-hidden="true" tabindex="-1"></a>fs.ls(<span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/departements_fr"</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Si tout a bien fonctionné, la commande ci-dessus devrait renvoyer une liste contenant les chemins sur <code>MinIO</code> des différents fichiers (<code>.shp</code>, <code>.shx</code>, <code>.prj</code>, etc.) constitutifs du <code>ShapeFile</code> des départements.</p>
</section>
</section>
<section id="utilisation-des-données" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="utilisation-des-données"><span class="header-section-number">3.3.3</span> Utilisation des données</h3>
<p>En sens inverse, pour récupérer les fichiers depuis <code>MinIO</code> dans une session <code>Python</code>, les commandes sont symétriques.</p>
<section id="cas-dun-dataframe-1" class="level4" data-number="3.3.3.1">
<h4 data-number="3.3.3.1" class="anchored" data-anchor-id="cas-dun-dataframe-1"><span class="header-section-number">3.3.3.1</span> Cas d’un dataframe</h4>
<p>Attention à bien passer cette fois le paramètre <code>r</code> (<code>read</code>, pour lecture) et non plus <code>w</code> (<code>write</code>, pour écriture) à la fonction <code>fs.open</code> afin de ne pas écraser le fichier !</p>
<div id="c6394980" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="c6394980"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="c6394980-1"><a href="#c6394980-1" aria-hidden="true" tabindex="-1"></a>MY_BUCKET <span class="op">=</span> <span class="st">"mon_nom_utilisateur_sspcloud"</span></span>
<span id="c6394980-2"><a href="#c6394980-2" aria-hidden="true" tabindex="-1"></a>FILE_PATH_S3 <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/df_dpe.csv"</span></span>
<span id="c6394980-3"><a href="#c6394980-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="c6394980-4"><a href="#c6394980-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import</span></span>
<span id="c6394980-5"><a href="#c6394980-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> fs.<span class="bu">open</span>(FILE_PATH_S3, <span class="st">"r"</span>) <span class="im">as</span> file_in:</span>
<span id="c6394980-6"><a href="#c6394980-6" aria-hidden="true" tabindex="-1"></a>    df_dpe <span class="op">=</span> pd.read_csv(file_in)</span>
<span id="c6394980-7"><a href="#c6394980-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="c6394980-8"><a href="#c6394980-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification</span></span>
<span id="c6394980-9"><a href="#c6394980-9" aria-hidden="true" tabindex="-1"></a>df_dpe.head(<span class="dv">2</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>De même, si le fichier est en <code>Parquet</code> (en n’oubliant pas de passer de <code>r</code> à <code>rb</code> pour tenir compte de la compression) :</p>
<div id="fe8356e0" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="fe8356e0"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="fe8356e0-1"><a href="#fe8356e0-1" aria-hidden="true" tabindex="-1"></a>MY_BUCKET <span class="op">=</span> <span class="st">"mon_nom_utilisateur_sspcloud"</span></span>
<span id="fe8356e0-2"><a href="#fe8356e0-2" aria-hidden="true" tabindex="-1"></a>FILE_PATH_S3 <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/df_dpe.parquet"</span></span>
<span id="fe8356e0-3"><a href="#fe8356e0-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="fe8356e0-4"><a href="#fe8356e0-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import</span></span>
<span id="fe8356e0-5"><a href="#fe8356e0-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> fs.<span class="bu">open</span>(FILE_PATH_S3, <span class="st">"rb"</span>) <span class="im">as</span> file_in:</span>
<span id="fe8356e0-6"><a href="#fe8356e0-6" aria-hidden="true" tabindex="-1"></a>    df_dpe <span class="op">=</span> pd.read_parquet(file_in)</span>
<span id="fe8356e0-7"><a href="#fe8356e0-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="fe8356e0-8"><a href="#fe8356e0-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification</span></span>
<span id="fe8356e0-9"><a href="#fe8356e0-9" aria-hidden="true" tabindex="-1"></a>df_dpe.head(<span class="dv">2</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cas-de-fichiers-1" class="level4" data-number="3.3.3.2">
<h4 data-number="3.3.3.2" class="anchored" data-anchor-id="cas-de-fichiers-1"><span class="header-section-number">3.3.3.2</span> Cas de fichiers</h4>
<p>Dans le cas de fichiers, on va devoir dans un premier temps rapatrier les fichiers de <code>MinIO</code> vers la machine local (en l’occurence, le service ouvert sur le SSP Cloud).</p>
<div id="c15c8319" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="c15c8319"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="c15c8319-1"><a href="#c15c8319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Récupération des fichiers depuis MinIO vers la machine locale</span></span>
<span id="c15c8319-2"><a href="#c15c8319-2" aria-hidden="true" tabindex="-1"></a>fs.get(<span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/departements_fr/"</span>, <span class="st">"departements_fr/"</span>, recursive<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Puis on les importe classiquement depuis <code>Python</code> avec le <em>package</em> approprié. Dans le cas des <code>ShapeFile</code>, où les différents fichiers sont en fait des parties d’un seul et même fichier, une seule commande permet de les importer après les avoir rappatriés.</p>
<div id="7127b02f" class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="7127b02f"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="7127b02f-1"><a href="#7127b02f-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="7127b02f-2"><a href="#7127b02f-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="7127b02f-3"><a href="#7127b02f-3" aria-hidden="true" tabindex="-1"></a>df_dep <span class="op">=</span> gpd.read_file(<span class="st">"departements_fr"</span>)</span>
<span id="7127b02f-4"><a href="#7127b02f-4" aria-hidden="true" tabindex="-1"></a>df_dep.head(<span class="dv">2</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="pour-aller-plus-loin" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="pour-aller-plus-loin"><span class="header-section-number">3.4</span> Pour aller plus loin</h2>
<ul>
<li><a href="https://docs.sspcloud.fr/content/storage.html">La documentation sur MinIO du SSPCloud</a></li>
</ul>
</section>
<section id="informations-additionnelles" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="informations-additionnelles">Informations additionnelles</h2>
<details>
<summary>
<p><i class="fa-brands fa-python" aria-label="python"></i> environment files have been tested on.</p>
</summary>
<p>Python version used:</p>
<div class="git-details">
<div class="pip-freeze">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Package</th>
<th style="text-align: left;">Version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">affine</td>
<td style="text-align: left;">2.4.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">aiobotocore</td>
<td style="text-align: left;">2.15.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aiohappyeyeballs</td>
<td style="text-align: left;">2.4.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">aiohttp</td>
<td style="text-align: left;">3.10.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aioitertools</td>
<td style="text-align: left;">0.12.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">aiosignal</td>
<td style="text-align: left;">1.3.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">alembic</td>
<td style="text-align: left;">1.13.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">altair</td>
<td style="text-align: left;">5.4.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aniso8601</td>
<td style="text-align: left;">9.0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">annotated-types</td>
<td style="text-align: left;">0.7.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">anyio</td>
<td style="text-align: left;">4.7.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">appdirs</td>
<td style="text-align: left;">1.4.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">archspec</td>
<td style="text-align: left;">0.2.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">asttokens</td>
<td style="text-align: left;">2.4.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">attrs</td>
<td style="text-align: left;">24.2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">babel</td>
<td style="text-align: left;">2.16.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bcrypt</td>
<td style="text-align: left;">4.2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">beautifulsoup4</td>
<td style="text-align: left;">4.12.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">black</td>
<td style="text-align: left;">24.8.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">blinker</td>
<td style="text-align: left;">1.8.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">blis</td>
<td style="text-align: left;">0.7.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">bokeh</td>
<td style="text-align: left;">3.5.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">boltons</td>
<td style="text-align: left;">24.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">boto3</td>
<td style="text-align: left;">1.35.23</td>
</tr>
<tr class="odd">
<td style="text-align: left;">botocore</td>
<td style="text-align: left;">1.35.23</td>
</tr>
<tr class="even">
<td style="text-align: left;">branca</td>
<td style="text-align: left;">0.7.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brotli</td>
<td style="text-align: left;">1.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">bs4</td>
<td style="text-align: left;">0.0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cachetools</td>
<td style="text-align: left;">5.5.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">cartiflette</td>
<td style="text-align: left;">0.0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cartopy</td>
<td style="text-align: left;">0.24.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">catalogue</td>
<td style="text-align: left;">2.0.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cattrs</td>
<td style="text-align: left;">24.1.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">certifi</td>
<td style="text-align: left;">2024.8.30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cffi</td>
<td style="text-align: left;">1.17.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">charset-normalizer</td>
<td style="text-align: left;">3.3.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">chromedriver-autoinstaller</td>
<td style="text-align: left;">0.6.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">click</td>
<td style="text-align: left;">8.1.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">click-plugins</td>
<td style="text-align: left;">1.1.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">cligj</td>
<td style="text-align: left;">0.7.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cloudpathlib</td>
<td style="text-align: left;">0.20.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloudpickle</td>
<td style="text-align: left;">3.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">colorama</td>
<td style="text-align: left;">0.4.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">comm</td>
<td style="text-align: left;">0.2.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">commonmark</td>
<td style="text-align: left;">0.9.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">conda</td>
<td style="text-align: left;">24.9.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">conda-libmamba-solver</td>
<td style="text-align: left;">24.7.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">conda-package-handling</td>
<td style="text-align: left;">2.3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">conda_package_streaming</td>
<td style="text-align: left;">0.10.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">confection</td>
<td style="text-align: left;">0.1.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">contextily</td>
<td style="text-align: left;">1.6.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">contourpy</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cryptography</td>
<td style="text-align: left;">43.0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">cycler</td>
<td style="text-align: left;">0.12.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cymem</td>
<td style="text-align: left;">2.0.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">cytoolz</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dask</td>
<td style="text-align: left;">2024.9.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">dask-expr</td>
<td style="text-align: left;">1.1.15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">databricks-sdk</td>
<td style="text-align: left;">0.33.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">dataclasses-json</td>
<td style="text-align: left;">0.6.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">debugpy</td>
<td style="text-align: left;">1.8.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">decorator</td>
<td style="text-align: left;">5.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Deprecated</td>
<td style="text-align: left;">1.2.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">diskcache</td>
<td style="text-align: left;">5.6.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">distributed</td>
<td style="text-align: left;">2024.9.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">distro</td>
<td style="text-align: left;">1.9.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">docker</td>
<td style="text-align: left;">7.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">duckdb</td>
<td style="text-align: left;">0.10.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">en-core-web-sm</td>
<td style="text-align: left;">3.7.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">entrypoints</td>
<td style="text-align: left;">0.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">et_xmlfile</td>
<td style="text-align: left;">2.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">exceptiongroup</td>
<td style="text-align: left;">1.2.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">executing</td>
<td style="text-align: left;">2.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">fastexcel</td>
<td style="text-align: left;">0.11.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fastjsonschema</td>
<td style="text-align: left;">2.21.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">fiona</td>
<td style="text-align: left;">1.10.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Flask</td>
<td style="text-align: left;">3.0.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">folium</td>
<td style="text-align: left;">0.17.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fontawesomefree</td>
<td style="text-align: left;">6.6.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">fonttools</td>
<td style="text-align: left;">4.54.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fr-core-news-sm</td>
<td style="text-align: left;">3.7.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">frozendict</td>
<td style="text-align: left;">2.4.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">frozenlist</td>
<td style="text-align: left;">1.4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">fsspec</td>
<td style="text-align: left;">2023.12.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gensim</td>
<td style="text-align: left;">4.3.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">geographiclib</td>
<td style="text-align: left;">2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geopandas</td>
<td style="text-align: left;">1.0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">geoplot</td>
<td style="text-align: left;">0.5.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geopy</td>
<td style="text-align: left;">2.4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">gitdb</td>
<td style="text-align: left;">4.0.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">GitPython</td>
<td style="text-align: left;">3.1.43</td>
</tr>
<tr class="even">
<td style="text-align: left;">google-auth</td>
<td style="text-align: left;">2.35.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">graphene</td>
<td style="text-align: left;">3.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">graphql-core</td>
<td style="text-align: left;">3.2.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">graphql-relay</td>
<td style="text-align: left;">3.2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">graphviz</td>
<td style="text-align: left;">0.20.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">great-tables</td>
<td style="text-align: left;">0.12.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">greenlet</td>
<td style="text-align: left;">3.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">gunicorn</td>
<td style="text-align: left;">22.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">h11</td>
<td style="text-align: left;">0.14.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">h2</td>
<td style="text-align: left;">4.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">hpack</td>
<td style="text-align: left;">4.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">htmltools</td>
<td style="text-align: left;">0.6.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">httpcore</td>
<td style="text-align: left;">1.0.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">httpx</td>
<td style="text-align: left;">0.28.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">httpx-sse</td>
<td style="text-align: left;">0.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hyperframe</td>
<td style="text-align: left;">6.0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">idna</td>
<td style="text-align: left;">3.10</td>
</tr>
<tr class="odd">
<td style="text-align: left;">imageio</td>
<td style="text-align: left;">2.36.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">importlib_metadata</td>
<td style="text-align: left;">8.5.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">importlib_resources</td>
<td style="text-align: left;">6.4.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">inflate64</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ipykernel</td>
<td style="text-align: left;">6.29.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">ipython</td>
<td style="text-align: left;">8.28.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">itsdangerous</td>
<td style="text-align: left;">2.2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">jedi</td>
<td style="text-align: left;">0.19.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Jinja2</td>
<td style="text-align: left;">3.1.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">jmespath</td>
<td style="text-align: left;">1.0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">joblib</td>
<td style="text-align: left;">1.4.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">jsonpatch</td>
<td style="text-align: left;">1.33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jsonpointer</td>
<td style="text-align: left;">3.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">jsonschema</td>
<td style="text-align: left;">4.23.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jsonschema-specifications</td>
<td style="text-align: left;">2024.10.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyter-cache</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jupyter_client</td>
<td style="text-align: left;">8.6.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyter_core</td>
<td style="text-align: left;">5.7.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">kaleido</td>
<td style="text-align: left;">0.2.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">kiwisolver</td>
<td style="text-align: left;">1.4.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">langchain</td>
<td style="text-align: left;">0.3.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">langchain-community</td>
<td style="text-align: left;">0.3.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">langchain-core</td>
<td style="text-align: left;">0.3.28</td>
</tr>
<tr class="even">
<td style="text-align: left;">langchain-text-splitters</td>
<td style="text-align: left;">0.3.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">langcodes</td>
<td style="text-align: left;">3.5.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">langsmith</td>
<td style="text-align: left;">0.1.147</td>
</tr>
<tr class="odd">
<td style="text-align: left;">language_data</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">lazy_loader</td>
<td style="text-align: left;">0.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">libmambapy</td>
<td style="text-align: left;">1.5.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">locket</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lxml</td>
<td style="text-align: left;">5.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">lz4</td>
<td style="text-align: left;">4.3.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mako</td>
<td style="text-align: left;">1.3.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">mamba</td>
<td style="text-align: left;">1.5.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mapclassify</td>
<td style="text-align: left;">2.8.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">marisa-trie</td>
<td style="text-align: left;">1.2.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Markdown</td>
<td style="text-align: left;">3.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">markdown-it-py</td>
<td style="text-align: left;">3.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MarkupSafe</td>
<td style="text-align: left;">2.1.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">marshmallow</td>
<td style="text-align: left;">3.23.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">matplotlib</td>
<td style="text-align: left;">3.9.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">matplotlib-inline</td>
<td style="text-align: left;">0.1.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mdurl</td>
<td style="text-align: left;">0.1.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">menuinst</td>
<td style="text-align: left;">2.1.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mercantile</td>
<td style="text-align: left;">1.2.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">mizani</td>
<td style="text-align: left;">0.11.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mlflow</td>
<td style="text-align: left;">2.16.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">mlflow-skinny</td>
<td style="text-align: left;">2.16.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">msgpack</td>
<td style="text-align: left;">1.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">multidict</td>
<td style="text-align: left;">6.1.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">multivolumefile</td>
<td style="text-align: left;">0.2.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">munkres</td>
<td style="text-align: left;">1.1.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">murmurhash</td>
<td style="text-align: left;">1.0.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">mypy-extensions</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">narwhals</td>
<td style="text-align: left;">1.19.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">nbclient</td>
<td style="text-align: left;">0.10.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nbformat</td>
<td style="text-align: left;">5.10.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">nest_asyncio</td>
<td style="text-align: left;">1.6.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">networkx</td>
<td style="text-align: left;">3.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">nltk</td>
<td style="text-align: left;">3.9.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numpy</td>
<td style="text-align: left;">1.26.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">opencv-python-headless</td>
<td style="text-align: left;">4.10.0.84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">openpyxl</td>
<td style="text-align: left;">3.1.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">opentelemetry-api</td>
<td style="text-align: left;">1.16.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">opentelemetry-sdk</td>
<td style="text-align: left;">1.16.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">opentelemetry-semantic-conventions</td>
<td style="text-align: left;">0.37b0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">orjson</td>
<td style="text-align: left;">3.10.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">outcome</td>
<td style="text-align: left;">1.3.0.post0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OWSLib</td>
<td style="text-align: left;">0.28.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">packaging</td>
<td style="text-align: left;">24.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pandas</td>
<td style="text-align: left;">2.2.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">paramiko</td>
<td style="text-align: left;">3.5.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">parso</td>
<td style="text-align: left;">0.8.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">partd</td>
<td style="text-align: left;">1.4.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pathspec</td>
<td style="text-align: left;">0.12.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">patsy</td>
<td style="text-align: left;">0.5.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pebble</td>
<td style="text-align: left;">5.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pexpect</td>
<td style="text-align: left;">4.9.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pickleshare</td>
<td style="text-align: left;">0.7.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">pillow</td>
<td style="text-align: left;">10.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pip</td>
<td style="text-align: left;">24.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">platformdirs</td>
<td style="text-align: left;">4.3.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">plotly</td>
<td style="text-align: left;">5.24.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">plotnine</td>
<td style="text-align: left;">0.13.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pluggy</td>
<td style="text-align: left;">1.5.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">polars</td>
<td style="text-align: left;">1.8.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">preshed</td>
<td style="text-align: left;">3.0.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">prometheus_client</td>
<td style="text-align: left;">0.21.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">prometheus_flask_exporter</td>
<td style="text-align: left;">0.23.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">prompt_toolkit</td>
<td style="text-align: left;">3.0.48</td>
</tr>
<tr class="odd">
<td style="text-align: left;">protobuf</td>
<td style="text-align: left;">4.25.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">psutil</td>
<td style="text-align: left;">6.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ptyprocess</td>
<td style="text-align: left;">0.7.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pure_eval</td>
<td style="text-align: left;">0.2.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">py7zr</td>
<td style="text-align: left;">0.20.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyarrow</td>
<td style="text-align: left;">17.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyarrow-hotfix</td>
<td style="text-align: left;">0.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyasn1</td>
<td style="text-align: left;">0.6.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyasn1_modules</td>
<td style="text-align: left;">0.4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">pybcj</td>
<td style="text-align: left;">1.0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pycosat</td>
<td style="text-align: left;">0.6.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">pycparser</td>
<td style="text-align: left;">2.22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pycryptodomex</td>
<td style="text-align: left;">3.21.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pydantic</td>
<td style="text-align: left;">2.10.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pydantic_core</td>
<td style="text-align: left;">2.27.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">pydantic-settings</td>
<td style="text-align: left;">2.7.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pygments</td>
<td style="text-align: left;">2.18.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">PyNaCl</td>
<td style="text-align: left;">1.5.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pynsee</td>
<td style="text-align: left;">0.1.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyogrio</td>
<td style="text-align: left;">0.10.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyOpenSSL</td>
<td style="text-align: left;">24.2.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyparsing</td>
<td style="text-align: left;">3.1.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyppmd</td>
<td style="text-align: left;">1.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyproj</td>
<td style="text-align: left;">3.7.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyshp</td>
<td style="text-align: left;">2.3.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">PySocks</td>
<td style="text-align: left;">1.7.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">python-dateutil</td>
<td style="text-align: left;">2.9.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">python-dotenv</td>
<td style="text-align: left;">1.0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">python-magic</td>
<td style="text-align: left;">0.4.27</td>
</tr>
<tr class="even">
<td style="text-align: left;">pytz</td>
<td style="text-align: left;">2024.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyu2f</td>
<td style="text-align: left;">0.1.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">pywaffle</td>
<td style="text-align: left;">1.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PyYAML</td>
<td style="text-align: left;">6.0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyzmq</td>
<td style="text-align: left;">26.2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyzstd</td>
<td style="text-align: left;">0.16.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">querystring_parser</td>
<td style="text-align: left;">1.2.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rasterio</td>
<td style="text-align: left;">1.4.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">referencing</td>
<td style="text-align: left;">0.35.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">regex</td>
<td style="text-align: left;">2024.9.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">requests</td>
<td style="text-align: left;">2.32.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">requests-cache</td>
<td style="text-align: left;">1.2.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">requests-toolbelt</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">retrying</td>
<td style="text-align: left;">1.3.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">rich</td>
<td style="text-align: left;">13.9.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rpds-py</td>
<td style="text-align: left;">0.22.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">rsa</td>
<td style="text-align: left;">4.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Rtree</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">ruamel.yaml</td>
<td style="text-align: left;">0.18.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ruamel.yaml.clib</td>
<td style="text-align: left;">0.2.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">s3fs</td>
<td style="text-align: left;">2023.12.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">s3transfer</td>
<td style="text-align: left;">0.10.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">scikit-image</td>
<td style="text-align: left;">0.24.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scikit-learn</td>
<td style="text-align: left;">1.5.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">scipy</td>
<td style="text-align: left;">1.13.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">seaborn</td>
<td style="text-align: left;">0.13.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">selenium</td>
<td style="text-align: left;">4.27.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">setuptools</td>
<td style="text-align: left;">74.1.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">shapely</td>
<td style="text-align: left;">2.0.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">shellingham</td>
<td style="text-align: left;">1.5.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">six</td>
<td style="text-align: left;">1.16.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">smart-open</td>
<td style="text-align: left;">7.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">smmap</td>
<td style="text-align: left;">5.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sniffio</td>
<td style="text-align: left;">1.3.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">sortedcontainers</td>
<td style="text-align: left;">2.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soupsieve</td>
<td style="text-align: left;">2.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">spacy</td>
<td style="text-align: left;">3.7.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">spacy-legacy</td>
<td style="text-align: left;">3.0.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">spacy-loggers</td>
<td style="text-align: left;">1.0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SQLAlchemy</td>
<td style="text-align: left;">2.0.35</td>
</tr>
<tr class="even">
<td style="text-align: left;">sqlparse</td>
<td style="text-align: left;">0.5.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">srsly</td>
<td style="text-align: left;">2.5.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">stack-data</td>
<td style="text-align: left;">0.6.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">statsmodels</td>
<td style="text-align: left;">0.14.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">tabulate</td>
<td style="text-align: left;">0.9.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tblib</td>
<td style="text-align: left;">3.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">tenacity</td>
<td style="text-align: left;">9.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">texttable</td>
<td style="text-align: left;">1.7.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">thinc</td>
<td style="text-align: left;">8.2.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">threadpoolctl</td>
<td style="text-align: left;">3.5.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">tifffile</td>
<td style="text-align: left;">2024.12.12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">toolz</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">topojson</td>
<td style="text-align: left;">1.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tornado</td>
<td style="text-align: left;">6.4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">tqdm</td>
<td style="text-align: left;">4.66.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">traitlets</td>
<td style="text-align: left;">5.14.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">trio</td>
<td style="text-align: left;">0.27.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trio-websocket</td>
<td style="text-align: left;">0.11.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">truststore</td>
<td style="text-align: left;">0.9.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">typer</td>
<td style="text-align: left;">0.15.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">typing_extensions</td>
<td style="text-align: left;">4.12.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">typing-inspect</td>
<td style="text-align: left;">0.9.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">tzdata</td>
<td style="text-align: left;">2024.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unidecode</td>
<td style="text-align: left;">1.3.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">url-normalize</td>
<td style="text-align: left;">1.4.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">urllib3</td>
<td style="text-align: left;">1.26.20</td>
</tr>
<tr class="even">
<td style="text-align: left;">wasabi</td>
<td style="text-align: left;">1.1.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wcwidth</td>
<td style="text-align: left;">0.2.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">weasel</td>
<td style="text-align: left;">0.4.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">webdriver-manager</td>
<td style="text-align: left;">4.0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">websocket-client</td>
<td style="text-align: left;">1.8.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Werkzeug</td>
<td style="text-align: left;">3.0.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">wheel</td>
<td style="text-align: left;">0.44.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wordcloud</td>
<td style="text-align: left;">1.9.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">wrapt</td>
<td style="text-align: left;">1.16.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wsproto</td>
<td style="text-align: left;">1.2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">xgboost</td>
<td style="text-align: left;">2.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">xlrd</td>
<td style="text-align: left;">2.0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">xyzservices</td>
<td style="text-align: left;">2024.9.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">yarl</td>
<td style="text-align: left;">1.13.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">yellowbrick</td>
<td style="text-align: left;">1.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">zict</td>
<td style="text-align: left;">3.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">zipp</td>
<td style="text-align: left;">3.20.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">zstandard</td>
<td style="text-align: left;">0.23.0</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</details>
<details>
<summary>
<p>View file history <i class="fa-brands fa-git-alt" aria-label="git-alt"></i></p>
</summary>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb36" data-startfrom="1543" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1542;"><span id="cb36-1543"><a href="#cb36-1543" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`Ce fichier a été modifié __</span><span class="sc">${</span>table_commit<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs">__ fois depuis sa création le </span><span class="sc">${</span>creation_string<span class="sc">}</span><span class="vs"> (dernière modification le </span><span class="sc">${</span>last_modification_string<span class="sc">}</span><span class="vs">)`</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb37" data-startfrom="1550" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1549;"><span id="cb37-1550"><a href="#cb37-1550" aria-hidden="true" tabindex="-1"></a>creation <span class="op">=</span> d3<span class="op">.</span><span class="fu">min</span>(</span>
<span id="cb37-1551"><a href="#cb37-1551" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb37-1552"><a href="#cb37-1552" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-1553"><a href="#cb37-1553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1554"><a href="#cb37-1554" aria-hidden="true" tabindex="-1"></a>last_modification <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(</span>
<span id="cb37-1555"><a href="#cb37-1555" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb37-1556"><a href="#cb37-1556" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-1557"><a href="#cb37-1557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1558"><a href="#cb37-1558" aria-hidden="true" tabindex="-1"></a>creation_string <span class="op">=</span> creation<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"fr"</span><span class="op">,</span> {</span>
<span id="cb37-1559"><a href="#cb37-1559" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb37-1560"><a href="#cb37-1560" aria-hidden="true" tabindex="-1"></a>  <span class="st">"month"</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb37-1561"><a href="#cb37-1561" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year"</span><span class="op">:</span> <span class="st">"numeric"</span></span>
<span id="cb37-1562"><a href="#cb37-1562" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb37-1563"><a href="#cb37-1563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1564"><a href="#cb37-1564" aria-hidden="true" tabindex="-1"></a>last_modification_string <span class="op">=</span> last_modification<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"fr"</span><span class="op">,</span> {</span>
<span id="cb37-1565"><a href="#cb37-1565" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb37-1566"><a href="#cb37-1566" aria-hidden="true" tabindex="-1"></a>  <span class="st">"month"</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb37-1567"><a href="#cb37-1567" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year"</span><span class="op">:</span> <span class="st">"numeric"</span></span>
<span id="cb37-1568"><a href="#cb37-1568" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb38" data-startfrom="1574" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1573;"><span id="cb38-1574"><a href="#cb38-1574" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>git_history_table<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1579" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1578;"><span id="cb39-1579"><a href="#cb39-1579" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>git_history_plot<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<table class="commit-table" border="1">
<thead>
<tr>
<th>
SHA
</th>
<th>
Date
</th>
<th>
Author
</th>
<th>
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/c1853b9">c1853b9</a>
</td>
<td>
2024-11-20 15:09:19
</td>
<td>
Lino Galiana
</td>
<td>
Reprise eval + reprise S3 (#576)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/005d89b">005d89b</a>
</td>
<td>
2023-12-20 17:23:04
</td>
<td>
Lino Galiana
</td>
<td>
Finalise l’affichage des statistiques Git (#478)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3fba612">3fba612</a>
</td>
<td>
2023-12-17 18:16:42
</td>
<td>
Lino Galiana
</td>
<td>
Remove some badges from python (#476)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/4cd44f3">4cd44f3</a>
</td>
<td>
2023-12-11 17:37:50
</td>
<td>
Antoine Palazzolo
</td>
<td>
Relecture NLP (#474)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/1f23de2">1f23de2</a>
</td>
<td>
2023-12-01 17:25:36
</td>
<td>
Lino Galiana
</td>
<td>
Stockage des images sur S3 (#466)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/a06a268">a06a268</a>
</td>
<td>
2023-11-23 18:23:28
</td>
<td>
Antoine Palazzolo
</td>
<td>
2ème relectures chapitres ML (#457)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/09654c7">09654c7</a>
</td>
<td>
2023-11-14 15:16:44
</td>
<td>
Antoine Palazzolo
</td>
<td>
Suggestions Git &amp; Visualisation (#449)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/889a71b">889a71b</a>
</td>
<td>
2023-11-10 11:40:51
</td>
<td>
Antoine Palazzolo
</td>
<td>
Modification TP 3 (#443)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/a771183">a771183</a>
</td>
<td>
2023-10-09 11:27:45
</td>
<td>
Antoine Palazzolo
</td>
<td>
Relecture TD2 par Antoine (#418)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/8556b79">8556b79</a>
</td>
<td>
2023-09-27 17:29:23
</td>
<td>
Julien PRAMIL
</td>
<td>
Typo chapitre S3 (#415)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/154f09e">154f09e</a>
</td>
<td>
2023-09-26 14:59:11
</td>
<td>
Antoine Palazzolo
</td>
<td>
Des typos corrigées par Antoine (#411)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/9977c5d">9977c5d</a>
</td>
<td>
2023-08-28 10:43:36
</td>
<td>
Lino Galiana
</td>
<td>
Fix bug path pandas (#397)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3bdf3b0">3bdf3b0</a>
</td>
<td>
2023-08-25 11:23:02
</td>
<td>
Lino Galiana
</td>
<td>
Simplification de la structure 🤓 (#393)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/5d4874a">5d4874a</a>
</td>
<td>
2023-08-11 15:09:33
</td>
<td>
Lino Galiana
</td>
<td>
Pimp les introductions des trois premières parties (#387)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3f60d55">3f60d55</a>
</td>
<td>
2023-02-02 18:59:16
</td>
<td>
Lino Galiana
</td>
<td>
WIP: Change path S3 (#349)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/9000723">9000723</a>
</td>
<td>
2023-01-22 12:01:25
</td>
<td>
Lino Galiana
</td>
<td>
Corrige code s3fs upload (#345)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/1fe65ac">1fe65ac</a>
</td>
<td>
2022-12-25 21:39:51
</td>
<td>
Lino Galiana
</td>
<td>
Dark boxes (#336)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/2227f8e">2227f8e</a>
</td>
<td>
2022-12-25 18:56:57
</td>
<td>
Lino Galiana
</td>
<td>
Fix problem s3 chapter (#335)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/8e5edba">8e5edba</a>
</td>
<td>
2022-09-02 11:59:57
</td>
<td>
Lino Galiana
</td>
<td>
Ajoute un chapitre dask (#264)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/688cc15">688cc15</a>
</td>
<td>
2022-09-01 18:38:59
</td>
<td>
Lino Galiana
</td>
<td>
Update index.qmd
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/2117d2c">2117d2c</a>
</td>
<td>
2022-09-01 08:54:38
</td>
<td>
Lino Galiana
</td>
<td>
Ajoute des éléments sur arrow (#262)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/f10815b">f10815b</a>
</td>
<td>
2022-08-25 16:00:03
</td>
<td>
Lino Galiana
</td>
<td>
Notebooks should now look more beautiful (#260)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/d201e3c">d201e3c</a>
</td>
<td>
2022-08-03 15:50:34
</td>
<td>
Lino Galiana
</td>
<td>
Pimp la homepage ✨ (#249)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/bacb5a0">bacb5a0</a>
</td>
<td>
2022-07-04 19:05:20
</td>
<td>
Lino Galiana
</td>
<td>
Enrichir la partie elastic (#241)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/12965ba">12965ba</a>
</td>
<td>
2022-05-25 15:53:27
</td>
<td>
Lino Galiana
</td>
<td>
:launch: Bascule vers quarto (#226)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/aa945cb">aa945cb</a>
</td>
<td>
2022-03-31 09:28:14
</td>
<td>
Lino Galiana
</td>
<td>
corrige une ou deux typos (#225)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/34b08ec">34b08ec</a>
</td>
<td>
2022-03-24 16:37:37
</td>
<td>
Lino Galiana
</td>
<td>
Ajoute code sur write_parquet dans S3
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/c51a87b">c51a87b</a>
</td>
<td>
2022-03-24 16:29:39
</td>
<td>
Lino Galiana
</td>
<td>
retire typo nom bucket (#223)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3b1d9ff">3b1d9ff</a>
</td>
<td>
2022-03-09 10:38:15
</td>
<td>
Lino Galiana
</td>
<td>
Ajoute détails arrow dans la partie S3 (#220)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/9c71d6e">9c71d6e</a>
</td>
<td>
2022-03-08 10:34:26
</td>
<td>
Lino Galiana
</td>
<td>
Plus d’éléments sur S3 (#218)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/2a8809f">2a8809f</a>
</td>
<td>
2021-10-27 12:05:34
</td>
<td>
Lino Galiana
</td>
<td>
Simplification des hooks pour gagner en flexibilité et clarté (#166)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/2e4d586">2e4d586</a>
</td>
<td>
2021-09-02 12:03:39
</td>
<td>
Lino Galiana
</td>
<td>
Simplify badges generation (#130)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/80877d2">80877d2</a>
</td>
<td>
2021-06-28 11:34:24
</td>
<td>
Lino Galiana
</td>
<td>
Ajout d’un exercice de NLP à partir openfood database (#98)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/6729a72">6729a72</a>
</td>
<td>
2021-06-22 18:07:05
</td>
<td>
Lino Galiana
</td>
<td>
Mise à jour badge onyxia (#115)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/4cdb759">4cdb759</a>
</td>
<td>
2021-05-12 10:37:23
</td>
<td>
Lino Galiana
</td>
<td>
:sparkles: :star2: Nouveau thème hugo :snake: :fire: (#105)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/7f9f97b">7f9f97b</a>
</td>
<td>
2021-04-30 21:44:04
</td>
<td>
Lino Galiana
</td>
<td>
🐳 + 🐍 New workflow (docker 🐳) and new dataset for modelization (2020 🇺🇸 elections) (#99)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/0a0d034">0a0d034</a>
</td>
<td>
2021-03-26 20:16:22
</td>
<td>
Lino Galiana
</td>
<td>
Ajout d’une section sur S3 (#97)
</td>
</tr>
</tbody>
</table>
</details>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1590" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1589;"><span id="cb40-1590"><a href="#cb40-1590" aria-hidden="true" tabindex="-1"></a>git_history_table <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">table</span>(</span>
<span id="cb40-1591"><a href="#cb40-1591" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">,</span></span>
<span id="cb40-1592"><a href="#cb40-1592" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb40-1593"><a href="#cb40-1593" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb40-1594"><a href="#cb40-1594" aria-hidden="true" tabindex="-1"></a>      <span class="dt">SHA</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="fu">md</span><span class="vs">`[</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">](</span><span class="sc">${</span>github_repo<span class="sc">}</span><span class="vs">/commit/</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span></span>
<span id="cb40-1595"><a href="#cb40-1595" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Description</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">replacePullRequestPattern</span>(x<span class="op">,</span> github_repo)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb40-1596"><a href="#cb40-1596" aria-hidden="true" tabindex="-1"></a>      <span class="co">/*Date: x =&gt; x.toLocaleString("fr", {</span></span>
<span id="cb40-1597"><a href="#cb40-1597" aria-hidden="true" tabindex="-1"></a><span class="co">        "month": "numeric",</span></span>
<span id="cb40-1598"><a href="#cb40-1598" aria-hidden="true" tabindex="-1"></a><span class="co">        "day": "numeric",</span></span>
<span id="cb40-1599"><a href="#cb40-1599" aria-hidden="true" tabindex="-1"></a><span class="co">        "year": "numeric"</span></span>
<span id="cb40-1600"><a href="#cb40-1600" aria-hidden="true" tabindex="-1"></a><span class="co">        })</span></span>
<span id="cb40-1601"><a href="#cb40-1601" aria-hidden="true" tabindex="-1"></a><span class="co">      */</span></span>
<span id="cb40-1602"><a href="#cb40-1602" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-1603"><a href="#cb40-1603" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-1604"><a href="#cb40-1604" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1610" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1609;"><span id="cb41-1610"><a href="#cb41-1610" aria-hidden="true" tabindex="-1"></a>git_history_plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb41-1611"><a href="#cb41-1611" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb41-1612"><a href="#cb41-1612" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"royalblue"</span>})<span class="op">,</span></span>
<span id="cb41-1613"><a href="#cb41-1613" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(</span>
<span id="cb41-1614"><a href="#cb41-1614" aria-hidden="true" tabindex="-1"></a>          table_commit<span class="op">,</span></span>
<span id="cb41-1615"><a href="#cb41-1615" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">pointerX</span>({<span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"red"</span>}))<span class="op">,</span></span>
<span id="cb41-1616"><a href="#cb41-1616" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(table_commit<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"royalblue"</span>})</span>
<span id="cb41-1617"><a href="#cb41-1617" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb41-1618"><a href="#cb41-1618" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1624" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1623;"><span id="cb42-1624"><a href="#cb42-1624" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">replacePullRequestPattern</span>(inputString<span class="op">,</span> githubRepo) {</span>
<span id="cb42-1625"><a href="#cb42-1625" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use a regular expression to match the pattern #digit</span></span>
<span id="cb42-1626"><a href="#cb42-1626" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> pattern <span class="op">=</span> <span class="ss">/#</span><span class="sc">(\d+)</span><span class="ss">/g</span><span class="op">;</span></span>
<span id="cb42-1627"><a href="#cb42-1627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1628"><a href="#cb42-1628" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Replace the pattern with ${github_repo}/pull/#digit</span></span>
<span id="cb42-1629"><a href="#cb42-1629" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> replacedString <span class="op">=</span> inputString<span class="op">.</span><span class="fu">replace</span>(pattern<span class="op">,</span> <span class="st">'[#$1]('</span> <span class="op">+</span> githubRepo <span class="op">+</span> <span class="st">'/pull/$1)'</span>)<span class="op">;</span></span>
<span id="cb42-1630"><a href="#cb42-1630" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-1631"><a href="#cb42-1631" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> replacedString<span class="op">;</span></span>
<span id="cb42-1632"><a href="#cb42-1632" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1638" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1637;"><span id="cb43-1638"><a href="#cb43-1638" aria-hidden="true" tabindex="-1"></a>github_repo <span class="op">=</span> <span class="st">"https://github.com/linogaliana/python-datascientist"</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1643" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1642;"><span id="cb44-1643"><a href="#cb44-1643" aria-hidden="true" tabindex="-1"></a>table_commit <span class="op">=</span> {</span>
<span id="cb44-1644"><a href="#cb44-1644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1645"><a href="#cb44-1645" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the HTML table by its class name</span></span>
<span id="cb44-1646"><a href="#cb44-1646" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> table <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.commit-table'</span>)<span class="op">;</span></span>
<span id="cb44-1647"><a href="#cb44-1647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1648"><a href="#cb44-1648" aria-hidden="true" tabindex="-1"></a><span class="co">// Check if the table exists</span></span>
<span id="cb44-1649"><a href="#cb44-1649" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (table) {</span>
<span id="cb44-1650"><a href="#cb44-1650" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize an array to store the table data</span></span>
<span id="cb44-1651"><a href="#cb44-1651" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> dataArray <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb44-1652"><a href="#cb44-1652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1653"><a href="#cb44-1653" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Extract headers from the first row</span></span>
<span id="cb44-1654"><a href="#cb44-1654" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> headers <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb44-1655"><a href="#cb44-1655" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> table<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb44-1656"><a href="#cb44-1656" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">.</span><span class="fu">push</span>(table<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">cells</span>[i]<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">trim</span>())<span class="op">;</span></span>
<span id="cb44-1657"><a href="#cb44-1657" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-1658"><a href="#cb44-1658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1659"><a href="#cb44-1659" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate through the rows, starting from the second row</span></span>
<span id="cb44-1660"><a href="#cb44-1660" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> table<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb44-1661"><a href="#cb44-1661" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> row <span class="op">=</span> table<span class="op">.</span><span class="at">rows</span>[i]<span class="op">;</span></span>
<span id="cb44-1662"><a href="#cb44-1662" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> rowData <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb44-1663"><a href="#cb44-1663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1664"><a href="#cb44-1664" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Iterate through the cells in the row</span></span>
<span id="cb44-1665"><a href="#cb44-1665" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> row<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb44-1666"><a href="#cb44-1666" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Use headers as keys and cell content as values</span></span>
<span id="cb44-1667"><a href="#cb44-1667" aria-hidden="true" tabindex="-1"></a>            rowData[headers[j]] <span class="op">=</span> row<span class="op">.</span><span class="at">cells</span>[j]<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb44-1668"><a href="#cb44-1668" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb44-1669"><a href="#cb44-1669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1670"><a href="#cb44-1670" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Push the rowData object to the dataArray</span></span>
<span id="cb44-1671"><a href="#cb44-1671" aria-hidden="true" tabindex="-1"></a>        dataArray<span class="op">.</span><span class="fu">push</span>(rowData)<span class="op">;</span></span>
<span id="cb44-1672"><a href="#cb44-1672" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-1673"><a href="#cb44-1673" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-1674"><a href="#cb44-1674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1675"><a href="#cb44-1675" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> dataArray</span>
<span id="cb44-1676"><a href="#cb44-1676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1677"><a href="#cb44-1677" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1683" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1682;"><span id="cb45-1683"><a href="#cb45-1683" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the element with class 'git-details'</span></span>
<span id="cb45-1684"><a href="#cb45-1684" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb45-1685"><a href="#cb45-1685" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> gitDetails <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.commit-table'</span>)<span class="op">;</span></span>
<span id="cb45-1686"><a href="#cb45-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1687"><a href="#cb45-1687" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if the element exists</span></span>
<span id="cb45-1688"><a href="#cb45-1688" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (gitDetails) {</span>
<span id="cb45-1689"><a href="#cb45-1689" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Hide the element</span></span>
<span id="cb45-1690"><a href="#cb45-1690" aria-hidden="true" tabindex="-1"></a>      gitDetails<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'none'</span><span class="op">;</span></span>
<span id="cb45-1691"><a href="#cb45-1691" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-1692"><a href="#cb45-1692" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-10" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1698" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1697;"><span id="cb46-1698"><a href="#cb46-1698" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@observablehq/plot@0.6.12/dist/plot.umd.min.js'</span>)</span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notes de bas de page</h2>

<ol>
<li id="fn1"><p>Elle permet aussi la lecture et l’écriture
de <code>.csv</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>D’ailleurs, les générations n’ayant connu nativement
que ce type de stockage ne sont pas familiarisées
au concept de <em>file system</em> et préfèrent
payer le temps de recherche. Voir
<a href="https://futurism.com/the-byte/gen-z-kids-file-systems">cet article</a>
sur le sujet.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>D’ailleurs, les générations n’ayant connu nativement
que ce type de stockage ne sont pas familiarisées
au concept de <em>file system</em> et préfèrent
payer le temps de recherche. Voir
<a href="https://futurism.com/the-byte/gen-z-kids-file-systems">cet article</a>
sur le sujet.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>D’ailleurs, les générations n’ayant connu nativement
que ce type de stockage ne sont pas familiarisées
au concept de <em>file system</em> et préfèrent
payer le temps de recherche. Voir
<a href="https://futurism.com/the-byte/gen-z-kids-file-systems">cet article</a>
sur le sujet.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@book{galiana2023,
  author = {Galiana, Lino},
  title = {Python pour la data science},
  date = {2023},
  url = {https://pythonds.linogaliana.fr/},
  doi = {10.5281/zenodo.8229676},
  langid = {fr},
  abstract = {Dans les entreprises et administrations, un nombre
    croissant d’infrastructure se basent sur des \_clouds\_, qui sont
    des sessions non persistentes où les données ne sont pas stockées
    dans les mêmes serveurs que les machines qui exécutent du code.
    L’une des technologies dominantes dans le domaine est un système de
    stockage nommé `S3`, développé par
    {[}Amazon{]}(https://docs.aws.amazon.com/fr\_fr/AmazonS3/latest/userguide/Welcome.html).
    `Python`, à travers plusieurs \_packages\_ (notamment `boto3`,
    `s3fs` ou `pyarrow`), permet d’utiliser ce système de stockage
    distant comme si on accédait à des fichiers depuis son poste
    personnel. Cette révolution est étroitement associée à l’émergence
    du format de données {[}`Apache
    Parquet`{]}(https://parquet.apache.org/), format utilisable en
    `Python` par le biais du package
    {[}`pyarrow`{]}(https://arrow.apache.org/docs/python/index.html) ou
    avec {[}`Spark`{]}(https://spark.apache.org/) et présentant de
    nombreux avantages pour l’analyse de données (vitesse d’import,
    possibilité de traiter des données plus volumineuses que la RAM...)}
}
</code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">Veuillez citer ce travail comme suit&nbsp;:</div><div id="ref-galiana2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Galiana, Lino. 2023. <em>Python pour la data science</em>. <a href="https://doi.org/10.5281/zenodo.8229676">https://doi.org/10.5281/zenodo.8229676</a>.
</div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../content/modern-ds";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/pythonds\.linogaliana\.fr");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="linogaliana/python-datascientist" data-repo-id="MDEwOlJlcG9zaXRvcnkyODAxNjE2Nzc=" data-category="General" data-category-id="DIC_kwDOELLtjc4B-5TX" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/modern-ds/continuous_integration.html" class="pagination-link" aria-label="Intégration continue avec Python">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Intégration continue avec Python</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/modern-ds/elastic_approfondissement.html" class="pagination-link" aria-label="Approfondissement ElasticSearch pour des recherches de proximité géographique">
        <span class="nav-page-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Python pour la <em>data science</em>, Lino Galiana.<br>
Licence <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i><br>
Code source disponible sur <a href="https://github.com/linogaliana/python-datascientist"><code>Github</code></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/modern-ds/s3.qmd" class="toc-action"><i class="bi bi-github"></i>Modifier cette page</a></li><li><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Site construit avec <i class="fa-brands fa-python" aria-label="python"></i> et <a href="https://quarto.org/"><code>Quarto</code></a><br>
Inspiration pour la mise en forme du site <a href="https://www.andreashandel.com">ici</a><br>
<a href="https://github.com/linogaliana/python-datascientist">Code source disponible sur <i class="fa-brands fa-github" aria-label="github"></i> <code>GitHub</code></a></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"loop":false,"selector":".lightbox","descPosition":"bottom","closeEffect":"zoom","openEffect":"zoom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>