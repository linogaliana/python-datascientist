<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lino Galiana">
<meta name="dcterms.date" content="2025-12-12">
<meta name="description" content="Les pipelines Scikit permettent d’intégrer de manière très flexible un ensemble d’opérations de pre-processing et d’entraînement de modèles dans une chaîne d’opérations. Il s’agit d’une approche particulièrement appropriée pour réduire la difficulté à changer d’algorithme ou pour faciliter la ré-application d’un code à de nouvelles données.">

<title>Premier pas vers l’industrialisation avec les pipelines scikit – Python pour la data science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/modelisation/7_mlapi.html" rel="next">
<link href="../../content/modelisation/5_clustering.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d640c705e8c17715bca3574aa719063f.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d6a2ae2cb249da1580f0a11f71b8f854.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d640c705e8c17715bca3574aa719063f.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f595c2c98905acf06c0c277a3aa3c9e4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-a41da460afe5d53e97b4088847509a8d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-f595c2c98905acf06c0c277a3aa3c9e4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/iconify-3.0.0/iconify-icon.min.js"></script>
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #e9f3fa;
      }
</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles/styles.css">
<meta name="twitter:title" content="Premier pas vers l’industrialisation avec les pipelines scikit – Python pour la data science">
<meta name="twitter:description" content="Les pipelines Scikit permettent d’intégrer de manière très flexible
un ensemble d’opérations de pre-processing et d’entraînement de modèles
dans une chaîne d’opérations. Il s’agit d’une approche particulièrement
appropriée pour réduire la difficulté à changer d’algorithme ou pour
faciliter la ré-application d’un code à de nouvelles données.">
<meta name="twitter:image" content="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/capture/image8.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="Python pour la data science">
<meta name="citation_author" content="Lino Galiana">
<meta name="citation_publication_date" content="2025">
<meta name="citation_cover_date" content="2025">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-12-12">
<meta name="citation_fulltext_html_url" content="https://pythonds.linogaliana.fr/">
<meta name="citation_doi" content="10.5281/zenodo.8229676">
<meta name="citation_language" content="fr">
<meta name="citation_reference" content="citation_title=Coding for economists;,citation_author=undefined Turrell;,citation_author=undefined contributors;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://aeturrell.github.io/coding-for-economists;">
<meta name="citation_reference" content="citation_title=psyTeachR book template;,citation_author=Lisa DeBruine;,citation_publication_date=2021-10-14;,citation_cover_date=2021-10-14;,citation_year=2021;,citation_fulltext_html_url=https://github.com/psyteachr/template/;,citation_publisher=https://github.com/psyteachr/template/;">
<meta name="citation_reference" content="citation_title=The hugging face course, 2022;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_publisher=https://huggingface.co/course;">
<meta name="citation_reference" content="citation_title=The signal and the noise: Why so many predictions fail-but some don’t;,citation_author=Nate Silver;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;">
<meta name="citation_reference" content="citation_title=Efficient estimation of word representations in vector space;,citation_author=Tomas Mikolov;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_volume=3781;,citation_journal_title=arXiv preprint arXiv:1301.3781;">
<meta name="citation_reference" content="citation_title=Attention is all you need;,citation_author=A Vaswani;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_journal_title=Advances in Neural Information Processing Systems;">
<meta name="citation_reference" content="citation_title=Caractéristiques socio-économiques des individus aux formes sévères de covid-19 au fil des vagues épidémiques;,citation_author=Lino Galiana;,citation_author=Olivier Meslin;,citation_author=Noémie Courtejoie;,citation_author=Simon Delage;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_publisher=Dossiers de la Drees;">
<meta name="citation_reference" content="citation_title=Quels formats pour quelles données?;,citation_author=Alexis Dondon;,citation_author=Pierre Lamarche;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_journal_title=Courrier des statistiques;">
<meta name="citation_reference" content="citation_title=Tableau politique de la france de l’ouest sous la troisième république: 102 cartes et croquis, 1 carte hors texte;,citation_author=André Siegfried;,citation_publication_date=1913;,citation_cover_date=1913;,citation_year=1913;">
<meta name="citation_reference" content="citation_title=Statistical learning;,citation_author=Gareth James;,citation_author=Daniela Witten;,citation_author=Trevor Hastie;,citation_author=Robert Tibshirani;,citation_author=Jonathan Taylor;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_inbook_title=An introduction to statistical learning: With applications in python;">
<meta name="citation_reference" content="citation_title=Une histoire du conflit politique: Elections et inégalités sociales en france, 1789-2022;,citation_author=Thomas Piketty;,citation_author=Julia Cagé;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;">
<meta name="citation_reference" content="citation_title=Interpretable machine learning: A guide for making black box models explainable;,citation_author=Molnar Christoph;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;">
<meta name="citation_reference" content="citation_title=A gentle introduction to conformal prediction and distribution-free uncertainty quantification;,citation_author=Anastasios N Angelopoulos;,citation_author=Stephen Bates;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_journal_title=arXiv preprint arXiv:2107.07511;">
<meta name="citation_reference" content="citation_title=A brief history of data visualization;,citation_author=Chun-houh Chen;,citation_author=Wolfgang Härdle;,citation_author=Antony Unwin;,citation_author=Michael Friendly;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_journal_title=Handbook of data visualization;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Discovering Statistics Using R;,citation_author=Andy Field;,citation_author=Jeremy Miles;,citation_author=Zoë Field;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_fulltext_html_url=https://uk.sagepub.com/en-gb/eur/discovering-statistics-using-r/book236067;,citation_isbn=9781446200469;">
<meta name="citation_reference" content="citation_title=psyTeachR Book Template;,citation_author=DeBruine Lisa;,citation_publication_date=2021-10;,citation_cover_date=2021-10;,citation_year=2021;,citation_fulltext_html_url=https://github.com/psyteachr/template/;">
<meta name="citation_reference" content="citation_title=The grammar of graphics;,citation_author=Leland Wilkinson;,citation_publication_date=2011;,citation_cover_date=2011;,citation_year=2011;,citation_inbook_title=Handbook of computational statistics: Concepts and methods;">
<meta name="citation_reference" content="citation_title=Data visualisation using r, for researchers who don’t use r;,citation_author=Emily Nordmann;,citation_author=Phil McAleer;,citation_author=William Toivo;,citation_author=Helen Paterson;,citation_author=Lisa DeBruine;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://doi.org/10.1177/25152459221074654;,citation_doi=10.1177/25152459221074654;,citation_journal_title=Advances in Methods and Practices in Psychological Science;">
<meta name="citation_reference" content="citation_title=Hands-on machine learning with scikit-learn, keras, and TensorFlow;,citation_author=Aurélien Géron;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=A brief history of data visualization;,citation_author=Chun-houh Chen;,citation_author=Wolfgang Härdle;,citation_author=Antony Unwin;,citation_author=Michael Friendly;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_journal_title=Handbook of data visualization;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Random forests;,citation_author=Leo Breiman;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_volume=45;,citation_journal_title=Machine learning;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Bagging predictors;,citation_author=Leo Breiman;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_volume=24;,citation_journal_title=Machine learning;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=R for data science;,citation_author=Hadley Wickham;,citation_author=Mine Çetinkaya-Rundel;,citation_author=Garrett Grolemund;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;">
<meta name="citation_reference" content="citation_title=Computational reproducibility of jupyter notebooks from biomedical publications;,citation_author=Sheeba Samuel;,citation_author=Daniel Mietchen;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2308.07333;">
<meta name="citation_reference" content="citation_title=Python data science handbook: Essential tools for working with data;,citation_author=Jake VanderPlas;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;">
<meta name="citation_reference" content="citation_title=Machine learning methods that economists should know about;,citation_author=Susan Athey;,citation_author=Guido W Imbens;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=11;,citation_journal_title=Annual Review of Economics;,citation_publisher=Annual Reviews;">
<meta name="citation_reference" content="citation_title=Fuzzy matching on big-data an illustration with scanner data and crowd-sourced nutritional data;,citation_author=Lino Galiana;,citation_author=Milena Suarez Castillo;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_publisher=Proceedings of the 2022 &amp;amp;amp;quot;Journées de Méthodologie Statistiques&amp;quot;;">
<meta name="citation_reference" content="citation_title=Data visualization with python and JavaScript;,citation_author=Kyran Dale;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=Sémiologie graphique;,citation_author=Jacques Bertin;,citation_publication_date=1967;,citation_cover_date=1967;,citation_year=1967;">
<meta name="citation_reference" content="citation_title=La sémiologie graphique de jacques bertin a cinquante ans;,citation_author=Gilles Palsky;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_journal_title=Visions carto (en ligne);">
<meta name="citation_reference" content="citation_title=Fundamentals of data visualization: A primer on making informative and compelling figures;,citation_author=Claus O Wilke;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=How to train BERT with an academic budget;,citation_author=Peter Izsak;,citation_author=Moshe Berchansky;,citation_author=Omer Levy;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/2104.07705;">
<meta name="citation_reference" content="citation_title=Python for data analysis: Data wrangling with pandas, NumPy, and IPython;,citation_author=Wes McKinney;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;">
<meta name="citation_reference" content="citation_title=Residential segregation, daytime segregation and spatial frictions: An analysis from mobile phone data;,citation_author=Lino Galiana;,citation_author=François Sémécurbe;,citation_author=Benjamin Sakarovitch;,citation_author=Zbigniew Smoreda;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_publisher=Insee Working Paper;">
<meta name="citation_reference" content="citation_title=Fuzzy matching on big-data: An illustration with scanner and crowd-sourced nutritional datasets;,citation_abstract=Food retailers’ scanner data provide unprecedented details on local consumption, provided that product identifiers allow a linkage with features of interest, such as nutritional information. In this paper, we enrich a large retailer dataset with nutritional information extracted from crowd-sourced and administrative nutritional datasets. To compensate for imperfect matching through the barcode, we develop a methodology to efficiently match short textual descriptions. After a preprocessing step to normalize short labels, we resort to fuzzy matching based on several tokenizers (including n-grams) by querying an ElasticSearch customized index and validate candidates echos as matches with a Levensthein edit-distance and an embedding-based similarity measure created from a siamese neural network model. The pipeline is composed of several steps successively relaxing constraints to find relevant matching candidates.;,citation_author=Lino Galiana;,citation_author=Milena Suarez Castillo;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://doi.org/10.1145/3524458.3547244;,citation_doi=10.1145/3524458.3547244;,citation_isbn=9781450392846;,citation_conference_title=Proceedings of the 2022 ACM conference on information technology for social good;,citation_conference=Association for Computing Machinery;,citation_series_title=GoodIT ’22;">
<meta name="citation_reference" content="citation_title=Guide de sémiologie cartographique;,citation_author=undefined Insee;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_publisher=Insee Working Paper;">
<meta name="citation_reference" content="citation_title=Energy and policy considerations for deep learning in NLP;,citation_author=Emma Strubell;,citation_author=Ananya Ganesh;,citation_author=Andrew McCallum;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/1906.02243;">
<meta name="citation_reference" content="citation_title=High-resolution image synthesis with latent diffusion models;,citation_author=Robin Rombach;,citation_author=Andreas Blattmann;,citation_author=Dominik Lorenz;,citation_author=Patrick Esser;,citation_author=Björn Ommer;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_conference_title=Proceedings of the IEEE/CVF conference on computer vision and pattern recognition (CVPR);">
<meta name="citation_reference" content="citation_title=Apache arrow and the&amp;amp;amp;quot; 10 things i hate about pandas;,citation_author=Wes McKinney;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_volume=21;,citation_journal_title=Blog, September;">
<meta name="citation_reference" content="citation_title=Many researchers were not compliant with their published data sharing statement: Mixed-methods study;,citation_author=Mirko Gabelica;,citation_author=Ružica Bojčić;,citation_author=Livia Puljak;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_journal_title=Journal of Clinical Epidemiology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Credit scoring in the era of big data;,citation_author=Mikella Hurley;,citation_author=Julius Adebayo;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_volume=18;,citation_journal_title=Yale JL &amp;amp;amp; Tech.;,citation_publisher=HeinOnline;">
<meta name="citation_reference" content="citation_title=Econometrics and machine learning;,citation_author=Arthur Charpentier;,citation_author=Emmanuel Flachaire;,citation_author=Antoine Ly;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=1;,citation_volume=505;,citation_journal_title=Economie et Statistique;,citation_publisher=Persée-Portail des revues scientifiques en SHS;">
<meta name="citation_reference" content="citation_title=Machine learning: An applied econometric approach;,citation_author=Sendhil Mullainathan;,citation_author=Jann Spiess;,citation_publication_date=2017-05;,citation_cover_date=2017-05;,citation_year=2017;,citation_fulltext_html_url=https://www.aeaweb.org/articles?id=10.1257/jep.31.2.87;,citation_issue=2;,citation_doi=10.1257/jep.31.2.87;,citation_volume=31;,citation_journal_title=Journal of Economic Perspectives;">
<meta name="citation_reference" content="citation_title=Le problème du réalisme des hypothèses en économie politique;,citation_author=Pierre Salmon;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;">
<meta name="citation_reference" content="citation_title=The methodology of positive economics;,citation_author=Milton Friedman;,citation_publication_date=1953;,citation_cover_date=1953;,citation_year=1953;,citation_inbook_title=Essays in positive economics;">
<meta name="citation_reference" content="citation_title=L’empreinte carbone du numérique;,citation_author=undefined Arcep;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=Leakage and the reproducibility crisis in ML-based science;,citation_author=Sayash Kapoor;,citation_author=Arvind Narayanan;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2207.07048;,citation_doi=10.48550/ARXIV.2207.07048;,citation_publisher=arXiv;">
<meta name="citation_reference" content="citation_title=Growth in a time of debt;,citation_author=Carmen M Reinhart;,citation_author=Kenneth S Rogoff;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_issue=2;,citation_volume=100;,citation_journal_title=American economic review;,citation_publisher=American Economic Association;">
<meta name="citation_reference" content="citation_title=We do not know the population of every country in the world for the past two thousand years;,citation_author=Timothy W Guinnane;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=3;,citation_volume=83;,citation_journal_title=The Journal of Economic History;">
<meta name="citation_reference" content="citation_title=Artificial intelligence: A modern approach (4th edition);,citation_author=Stuart J. Russell;,citation_author=Peter Norvig;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=http://aima.cs.berkeley.edu/;,citation_isbn=9781292401133;">
<meta name="citation_reference" content="citation_title=Data scientist, the sexiest job of the 21st century;,citation_author=Thomas H Davenport;,citation_author=DJ Patil;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_fulltext_html_url=https://hbr.org/2012/10/data-scientist-the-sexiest-job-of-the-21st-century;,citation_issue=5;,citation_volume=90;,citation_journal_title=Harvard business review;">
<meta name="citation_reference" content="citation_title=Is data scientist still the sexiest job of the 21st century?;,citation_author=Thomas H Davenport;,citation_author=DJ Patil;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_volume=90;,citation_journal_title=Harvard Business Review;,citation_publisher=Harvard Business Publishing;">
<meta name="citation_reference" content="citation_title=Leakage and the reproducibility crisis in machine-learning-based science;,citation_author=Sayash Kapoor;,citation_author=Arvind Narayanan;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=9;,citation_volume=4;,citation_journal_title=Patterns;,citation_publisher=Elsevier;">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="../../content/getting-started/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/01_environment.html">
 <span class="dropdown-text">Avoir un environnement Python fonctionnel pour la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/02_data_analysis.html">
 <span class="dropdown-text">Démarche à adopter face à un jeu de données</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/03_revisions.html">
 <span class="dropdown-text">Quelques exercices de rappels pour se remettre en selle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-manipuler" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Manipuler</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-manipuler">    
        <li>
    <a class="dropdown-item" href="../../content/manipulation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/01_numpy.html">
 <span class="dropdown-text">Numpy, la brique de base de la data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02_pandas_intro.html">
 <span class="dropdown-text">Introduction à Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02_pandas_suite.html">
 <span class="dropdown-text">Manipuler des données avec Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_intro.html">
 <span class="dropdown-text">Introduction aux données spatiales avec Geopandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04a_webscraping_TP.html">
 <span class="dropdown-text">Web scraping avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04c_API_TP.html">
 <span class="dropdown-text">Récupérer des données avec des API depuis Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04b_regex_TP.html">
 <span class="dropdown-text">Maîtriser les expressions régulières</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/05_parquet_s3.html">
 <span class="dropdown-text">Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-communiquer" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Communiquer</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-communiquer">    
        <li>
    <a class="dropdown-item" href="../../content/visualisation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/matplotlib.html">
 <span class="dropdown-text">Construire des graphiques avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/maps.html">
 <span class="dropdown-text">Introduction à la cartographie avec Python</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-modéliser" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Modéliser</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-modéliser">    
        <li>
    <a class="dropdown-item" href="../../content/modelisation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/0_preprocessing.html">
 <span class="dropdown-text">Préparation des données pour construire un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/1_modelevaluation.html">
 <span class="dropdown-text">Evaluer la qualité d’un modèle</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/2_classification.html">
 <span class="dropdown-text">Découverte de la classification avec la technique des SVM</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/3_regression.html">
 <span class="dropdown-text">Introduction à la régression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/4_featureselection.html">
 <span class="dropdown-text">Sélection de variables : une introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/5_clustering.html">
 <span class="dropdown-text">Introduction à l’apprentissage non supervisé avec le clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/6_pipeline.html">
 <span class="dropdown-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/7_mlapi.html">
 <span class="dropdown-text">Mettre à disposition un modèle par le biais d’une API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nlp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">NLP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nlp">    
        <li>
    <a class="dropdown-item" href="../../content/NLP/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/01_intro.html">
 <span class="dropdown-text">Nettoyer et structurer l’information dans les données textuelles</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/02_exoclean.html">
 <span class="dropdown-text">L’analyse fréquentiste par l’approche bag-of-words : intérêt et limites</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/03_embedding.html">
 <span class="dropdown-text">Les embeddings, ou comment synthétiser l’information textuelle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-git" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Git</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-git">    
        <li>
    <a class="dropdown-item" href="../../content/git/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/introgit.html">
 <span class="dropdown-text">Découvrir Git par la pratique: la gymnastique quotidienne</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/exogit.html">
 <span class="dropdown-text">Un cadavre exquis pour découvrir le travail collaboratif <code>Git</code></span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-annexes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Annexes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-annexes">    
        <li>
    <a class="dropdown-item" href="../../content/annexes/evaluation.html">
 <span class="dropdown-text">Évaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/annexes/corrections.html">
 <span class="dropdown-text">Corrections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://linogaliana.github.io/python-datascientist-slides/#/title-slide">
 <span class="dropdown-text">Slides de présentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/linogaliana/python-datascientist" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Basculer le mode sombre"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Basculer en mode lecteur">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/modelisation/6_pipeline.html">Premier pas vers l’industrialisation avec les pipelines scikit</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Premier pas vers l’industrialisation avec les pipelines scikit</h1>
                  <div>
        <div class="description">
          <p>Les <em>pipelines</em> <code>Scikit</code> permettent d’intégrer de manière très flexible
          un ensemble d’opérations de pre-processing et d’entraînement de modèles
          dans une chaîne d’opérations. Il s’agit d’une approche particulièrement
          appropriée pour réduire la difficulté à changer d’algorithme ou pour
          faciliter la ré-application d’un code à de nouvelles données.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Modélisation</div>
                <div class="quarto-category">Tutoriel</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Auteur·rice</div>
      <div class="quarto-title-meta-contents">
               <p>Lino Galiana </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Date de publication</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2025-12-12</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/0_preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Préparation des données pour construire un modèle</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/1_modelevaluation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Evaluer la qualité d’un modèle</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/2_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Découverte de la classification avec la technique des SVM</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/3_regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction à la régression</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/4_featureselection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sélection de variables : une introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/5_clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction à l’apprentissage non supervisé avec le clustering</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/6_pipeline.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modelisation/7_mlapi.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mettre à disposition un modèle par le biais d’une API</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Sur cette page</h2>
   
  <ul>
  <li><a href="#pourquoi-utiliser-les-pipelines" id="toc-pourquoi-utiliser-les-pipelines" class="nav-link active" data-scroll-target="#pourquoi-utiliser-les-pipelines"><span class="header-section-number">1</span> Pourquoi utiliser les <em>pipelines</em> ?</a>
  <ul class="collapse">
  <li><a href="#définitions-préalables" id="toc-définitions-préalables" class="nav-link" data-scroll-target="#définitions-préalables"><span class="header-section-number">1.1</span> Définitions préalables</a></li>
  <li><a href="#objectif" id="toc-objectif" class="nav-link" data-scroll-target="#objectif"><span class="header-section-number">1.2</span> Objectif</a></li>
  <li><a href="#les-pipelines-scikit" id="toc-les-pipelines-scikit" class="nav-link" data-scroll-target="#les-pipelines-scikit"><span class="header-section-number">1.3</span> Les <em>pipelines</em> <code>Scikit</code></a></li>
  </ul></li>
  <li><a href="#comment-créer-un-pipeline" id="toc-comment-créer-un-pipeline" class="nav-link" data-scroll-target="#comment-créer-un-pipeline"><span class="header-section-number">2</span> Comment créer un <em>pipeline</em></a>
  <ul class="collapse">
  <li><a href="#données-utilisées" id="toc-données-utilisées" class="nav-link" data-scroll-target="#données-utilisées"><span class="header-section-number">2.1</span> Données utilisées</a></li>
  </ul></li>
  <li><a href="#un-premier-pipeline-random-forest-sur-des-variables-standardisées" id="toc-un-premier-pipeline-random-forest-sur-des-variables-standardisées" class="nav-link" data-scroll-target="#un-premier-pipeline-random-forest-sur-des-variables-standardisées"><span class="header-section-number">3</span> Un premier pipeline : <em>random forest</em> sur des variables standardisées</a>
  <ul class="collapse">
  <li><a href="#définition-des-ensembles-train-et-test" id="toc-définition-des-ensembles-train-et-test" class="nav-link" data-scroll-target="#définition-des-ensembles-train-et-test"><span class="header-section-number">3.1</span> Définition des ensembles <em>train</em> et <em>test</em></a></li>
  <li><a href="#définition-du-premier-pipeline" id="toc-définition-du-premier-pipeline" class="nav-link" data-scroll-target="#définition-du-premier-pipeline"><span class="header-section-number">3.2</span> Définition du premier <em>pipeline</em></a></li>
  <li><a href="#variable-importance" id="toc-variable-importance" class="nav-link" data-scroll-target="#variable-importance"><span class="header-section-number">3.3</span> <em>Variable importance</em></a></li>
  </ul></li>
  <li><a href="#restriction-du-champ-du-modèle" id="toc-restriction-du-champ-du-modèle" class="nav-link" data-scroll-target="#restriction-du-champ-du-modèle"><span class="header-section-number">4</span> Restriction du champ du modèle</a></li>
  <li><a href="#recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée" id="toc-recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée" class="nav-link" data-scroll-target="#recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée"><span class="header-section-number">5</span> Recherche des hyperparamètres optimaux avec une validation croisée</a></li>
  <li><a href="#prochaine-étape" id="toc-prochaine-étape" class="nav-link" data-scroll-target="#prochaine-étape"><span class="header-section-number">6</span> Prochaine étape</a></li>
  <li><a href="#références" id="toc-références" class="nav-link" data-scroll-target="#références">Références</a>
  <ul class="collapse">
  <li><a href="#informations-additionnelles" id="toc-informations-additionnelles" class="nav-link" data-scroll-target="#informations-additionnelles">Informations additionnelles</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/modelisation/6_pipeline.qmd" class="toc-action"><i class="bi bi-github"></i>Modifier cette page</a></li><li><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">

<script>
  const langButton = document.createElement("div");
  langButton.className = "lang-switch-button";
  langButton.style.textAlign = "right";
  langButton.style.marginTop = "1rem";
  langButton.style.marginBottom = "1rem";

  const currentPath = window.location.pathname;
  const isEnglish = currentPath.startsWith("/en/");
  let targetHref, label, svg;

  if (isEnglish) {
    targetHref = currentPath.replace(/^\/en\//, "/");
    label = "Passer à la version française";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangFr"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangFr)"><path fill="#0055A4" d="M0 0h512v512H0z"/><path fill="#fff" d="M170.7 0h170.6v512H170.7z"/><path fill="#EF4135" d="M341.3 0H512v512H341.3z"/></g></svg>`;
  } else {
    targetHref = "/en" + currentPath;
    label = "Switch to English version";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangEn"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangEn)"><path fill="#eee" d="M256 0L0 256v64l32 32l-32 32v128l22-8l23 8h23l54-32l54 32h32l48-32l48 32h32l54-32l54 32h68l-8-22l8-23v-23l-32-54l32-54v-32l-32-48l32-48v-32l-32-54l32-54V0z"/><path fill="#d80027" d="M224 64v64h160l64-64zm0 128l32 64l-48 48v208h96V304h208v-96H304l16-16zM0 320v64h128l-64 64H0v64h45l131-131v-45l16-16zm336 16l176 176v-45L381 336Z"/><path fill="#0052b4" d="M0 0v256h256V0zm512 68L404 176h108zM404 336l108 108V336zm-228 68L68 512h108zm160 0v108h108z"/><path fill="#eee" d="m187 243l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67zm162-81l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67Zm162-82l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67Zm-81 0l57-41H12l57 41l-22-67Z"/></g></svg>`;
  }

  langButton.innerHTML = `
    <a href="${targetHref}" class="button-cta">
      <button class="btn"><i class="fa fa-language"></i> ${label} ${svg}</button>
    </a>
  `;

  const main = document.querySelector("main#quarto-document-content");
  if (main) main.insertAdjacentElement("afterbegin", langButton);
</script>
    






<div class="badge-container"><div class="badge-text">Pour essayer les exemples présents dans ce tutoriel :</div><a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/modelisation/6_pipeline.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=github&amp;label=&amp;message=View%20on%20GitHub&amp;color=181717" alt="View on GitHub"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;name=«6_pipeline»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-vscode.sh»&amp;init.personalInitArgs=«modelisation%206_pipeline»" target="_blank" rel="noopener"><img src="https://custom-icon-badges.demolab.com/badge/SSP%20Cloud-Lancer_avec_VSCode-blue?logo=vsc&amp;logoColor=white" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;name=«6_pipeline»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-jupyter.sh»&amp;init.personalInitArgs=«modelisation%206_pipeline»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Lancer_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks-colab//blob/main//notebooks/modelisation/6_pipeline.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a><br></div>
<p>Ce chapitre présente la première application
d’une journée de cours que j’ai
donné à l’Université Dauphine dans le cadre
des <em>PSL Data Week</em>.</p>
<div class="cell markdown">
<details>
<summary>

Dérouler les _slides_ associées ci-dessous ou [cliquer ici](https://linogaliana.github.io/dauphine-week-data/#/title-slide)
pour les afficher en plein écran.

</summary>


<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode yaml code-with-copy"><code class="sourceCode yaml"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><iframe class="sourceCode yaml code-with-copy" src="https://linogaliana.github.io/dauphine-week-data/#/title-slide"></iframe></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>

</details>
</div>
<p>Pour lire les données de manière efficace, nous
proposons d’utiliser le <em>package</em> <code>duckdb</code>.
Pour l’installer, voici la commande :</p>
<div id="e1ce9113" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install duckdb</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="pourquoi-utiliser-les-pipelines" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Pourquoi utiliser les <em>pipelines</em> ?</h1>
<section id="définitions-préalables" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="définitions-préalables"><span class="header-section-number">1.1</span> Définitions préalables</h2>
<p>Ce chapitre nous amènera à explorer plusieurs écosystèmes, pour lesquels on retrouve quelques buzz-words dont voici les définitions :</p>
<table class="caption-top table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead>
<tr class="header">
<th>Terme</th>
<th>Définition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>DevOps</em></td>
<td>Mouvement en ingénierie informatique et une pratique technique visant à l’unification du développement logiciel (dev) et de l’administration des infrastructures informatiques (ops)</td>
</tr>
<tr class="even">
<td><em>MLOps</em></td>
<td>Ensemble de pratiques qui vise à déployer et maintenir des modèles de machine learning en production de manière fiable et efficace</td>
</tr>
</tbody>
</table>
<p>Ce chapitre fera des références régulières au cours
de 3e année de l’ENSAE
<a href="https://ensae-reproductibilite.github.io/website/"><em>“Mise en production de projets data science”</em></a>.</p>
</section>
<section id="objectif" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="objectif"><span class="header-section-number">1.2</span> Objectif</h2>
<p>Les chapitres précédents ont permis de montrer des bouts de code
épars pour entraîner des modèles ou faire du <em>preprocessing</em>.
Cette démarche est intéressante pour tâtonner mais risque d’être coûteuse
ultérieurement s’il est nécessaire d’ajouter une étape de <em>preprocessing</em>
ou de changer d’algorithme.</p>
<p>Les <em>pipelines</em> sont pensés pour simplifier la mise en production
ultérieure d’un modèle de <em>machine learning</em>.
Ils sont au coeur de la démarche de <em>MLOps</em> qui est
présentée
dans le cours de 3e année de l’ENSAE
de <a href="https://ensae-reproductibilite.github.io/website/"><em>“Mise en production de projets data science”</em></a>,
qui vise à simplifier la mise en oeuvre opérationnelle de
projets utilisant des techniques de <em>machine learning</em>.</p>
<div id="507fab1f" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="les-pipelines-scikit" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="les-pipelines-scikit"><span class="header-section-number">1.3</span> Les <em>pipelines</em> <code>Scikit</code></h2>
<p>Heureusement, <code>Scikit</code> propose un excellent outil pour proposer un cadre
général pour créer une chaîne de production <em>machine learning</em>. Il
s’agit des
<a href="https://scikit-learn.org/stable/modules/compose.html"><em>pipelines</em></a>.
Ils présentent de nombreux intérêts, parmi lesquels :</p>
<ul>
<li>Ils sont très <strong>pratiques</strong> et <strong>lisibles</strong>. On rentre des données en entrée, on n’appelle qu’une seule fois les méthodes <code>fit</code> et <code>predict</code> ce qui permet de s’assurer une gestion cohérente des transformations de variables, par exemple après l’appel d’un <code>StandardScaler</code> ;</li>
<li>La <strong>modularité</strong> rend aisée la mise à jour d’un pipeline et renforce la capacité à le réutiliser ;</li>
<li>Ils permettent de facilement chercher les hyperparamètres d’un modèle. Sans <em>pipeline</em>, écrire un code qui fait du <em>tuning</em> d’hyperparamètres peut être pénible. Avec les <em>pipelines</em>, c’est une ligne de code ;</li>
<li>La <strong>sécurité</strong> d’être certain que les étapes de preprocessing sont bien appliquées aux jeux de données désirés avant l’estimation.</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Un des intérêts des <em>pipelines</em> scikit est qu’ils fonctionnent aussi avec
des méthodes qui ne sont pas issues de <code>scikit</code>.</p>
<p>Il est possible d’introduire un modèle de réseau de neurone <code>Keras</code> dans
un pipeline <code>scikit</code>.
Pour introduire un modèle économétrique <code>statsmodels</code>
c’est un peu plus coûteux mais nous allons proposer des exemples
qui peuvent servir de modèle et qui montrent que c’est faisable
sans trop de difficulté.</p>
</div>
</div>
</div>
</section>
</section>
<section id="comment-créer-un-pipeline" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Comment créer un <em>pipeline</em></h1>
<p>Un <em>pipeline</em> est un enchaînement d’opérations qu’on code en enchainant
des pairs <em>(clé, valeur)</em> :</p>
<ul>
<li>la clé est le nom du pipeline, cela peut être utile lorsqu’on va
représenter le <em>pipeline</em> sous forme de diagramme acyclique (visualisation DAG)
ou qu’on veut afficher des informations sur une étape</li>
<li>la valeur représente la transformation à mettre en oeuvre dans le <em>pipeline</em>
(c’est-à-dire, à l’exception de la dernière étape,
mettre en oeuvre une méthode <code>transform</code> et éventuellement une
transformation inverse).</li>
</ul>
<div id="4d6bf41d" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>estimators <span class="op">=</span> [(<span class="st">'reduce_dim'</span>, PCA()), (<span class="st">'clf'</span>, SVC())]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(estimators)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>pipe</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Au sein d’une étape de <em>pipeline</em>, les paramètres d’un estimateur
sont accessibles avec la notation <code>&lt;estimator&gt;__&lt;parameter&gt;</code>.
Cela permet de fixer des valeurs pour les arguments des fonctions <code>scikit</code>
qui sont appelées au sein d’un <em>pipeline</em>.
C’est cela qui rendra l’approche des pipelines particulièrement utile
pour la <em>grid search</em> :</p>
<div id="6e84f218" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {<span class="st">"reduce_dim__n_components"</span>:[<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>], <span class="st">"clf__C"</span>:[<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="dv">100</span>]}</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(pipe, param_grid<span class="op">=</span>param_grid)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>grid_search</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Ces <em>pipelines</em> sont initialisés sans données, il s’agit d’une structure formelle
que nous allons ensuite ajuster en entraînant des modèles.</p>
<section id="données-utilisées" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="données-utilisées"><span class="header-section-number">2.1</span> Données utilisées</h2>
<p>Nous allons utiliser les données
de transactions immobilières <a href="https://app.dvf.etalab.gouv.fr/">DVF</a> pour chercher
la meilleure manière de prédire, sachant les caractéristiques d’un bien, son
prix.</p>
<p>Ces données sont mises à disposition
sur <a href="https://www.data.gouv.fr/fr/datasets/demandes-de-valeurs-foncieres/"><code>data.gouv</code></a>.
Néanmoins, le format csv n’étant pas pratique pour importer des jeux de données
volumineux, nous proposons de privilégier la version <code>Parquet</code> mise à
disposition par Eric Mauvière sur <a href="https://www.data.gouv.fr/fr/datasets/dvf-2022-format-parquet/#/discussions"><code>data.gouv</code></a>.
L’approche la plus efficace pour lire ces données est
d’utiliser <code>DuckDB</code> afin de lire le fichier, extraire les colonnes
d’intérêt puis passer à <code>Pandas</code> (pour en savoir plus sur
l’intérêt de <code>DuckDB</code> pour lire des fichiers volumineux, vous pouvez
consulter <a href="https://ssphub.netlify.app/post/parquetrp/">ce post de blog</a> ou
<a href="https://www.icem7.fr/outils/3-explorations-bluffantes-avec-duckdb-1-interroger-des-fichiers-distants/">celui-ci</a> écrit
par Eric Mauvière).</p>
<p>Même si, en soi, les gains de temps sont faibles car <code>DuckDB</code> optimise
les requêtes HTTPS nécessaires à l’import des données, nous proposons
de télécharger les données pour réduire les besoins de bande passante.</p>
<div id="61828abf" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://www.data.gouv.fr/fr/datasets/r/56bde1e9-e214-408b-888d-34c57ff005c4"</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>file_name <span class="op">=</span> <span class="st">"dvf.parquet"</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if the file already exists</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> os.path.exists(file_name):</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> response.status_code <span class="op">==</span> <span class="dv">200</span>:</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(file_name, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            f.write(response.content)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Téléchargement réussi."</span>)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Échec du téléchargement. Code d'état : </span><span class="sc">{</span>response<span class="sc">.</span>status_code<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Le fichier '</span><span class="sc">{</span>file_name<span class="sc">}</span><span class="ss">' existe déjà. Aucun téléchargement nécessaire."</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>En premier lieu, puisque cela va faciliter les requêtes SQL ultérieures, on crée
une vue :</p>
<div id="566afa79" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>duckdb.sql(<span class="ss">f'CREATE OR REPLACE VIEW dvf AS SELECT * FROM read_parquet("dvf.parquet")'</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Les données prennent la forme suivante :</p>
<div id="af9d2125" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>duckdb.sql(<span class="ss">f"SELECT * FROM dvf LIMIT 5"</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Les variables que nous allons conserver sont les suivantes,
nous allons les reformater pour la suite de l’exercice.</p>
<div id="73402385" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>xvars <span class="op">=</span> [</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Date mutation"</span>, <span class="st">"Valeur fonciere"</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Nombre de lots'</span>, <span class="st">'Code type local'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Nombre pieces principales'</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>xvars <span class="op">=</span> <span class="st">", "</span>.join([<span class="ss">f'"</span><span class="sc">{</span>s<span class="sc">}</span><span class="ss">"'</span> <span class="cf">for</span> s <span class="kw">in</span> xvars])</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="4c5cac97" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mutations <span class="op">=</span> duckdb.sql(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="ss">f'''</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ss">    SELECT</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ss">    date_part('month', "Date mutation") AS month,</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ss">    substring("Code postal", 1, 2) AS dep,</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ss">    </span><span class="sc">{</span>xvars<span class="sc">}</span><span class="ss">,</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="ss">    COLUMNS('Surface Carrez.*')</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="ss">    FROM dvf</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="ss">    '''</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>).to_df()</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>colonnes_surface <span class="op">=</span> mutations.columns[mutations.columns.<span class="bu">str</span>.startswith(<span class="st">'Surface Carrez'</span>)]</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>mutations.loc[:, colonnes_surface] <span class="op">=</span> mutations.loc[:, colonnes_surface].replace({<span class="st">','</span>: <span class="st">'.'</span>}, regex<span class="op">=</span><span class="va">True</span>).astype(<span class="bu">float</span>).fillna(<span class="dv">0</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Le fichier <code>Parquet</code> mis à disposition sur <code>data.gouv</code> présente une incohérence de mise en forme de
certaines colonnes à cause des virgules qui empêchent le formattage sous forme de colonne
numérique.</p>
<p>Le code ci-dessus effectue la conversion adéquate au niveau de <code>Pandas</code>.</p>
</div>
</div>
</div>
<div id="bca41576" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>mutations.head(<span class="dv">2</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell markdown">
<details>
<summary>
Introduire un effet confinement
</summary>
<p>Si vous travaillez avec les données de 2020, n’oubliez pas
d’intégrer l’effet
confinement dans vos modèles puisque cela a lourdement
affecté les possibilités de transaction sur cette période, donc
l’effet potentiel de certaines variables explicatives du prix.</p>
<p>Pour introduire cet effet, vous pouvez créer une variable
indicatrice entre les dates en question:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'confinement'</span>] <span class="op">=</span> (</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    mutations[<span class="st">'Date mutation'</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    .between(pd.to_datetime(<span class="st">"2020-03-17"</span>), pd.to_datetime(<span class="st">"2020-05-03"</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    .astype(<span class="bu">int</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<p>Comme nous travaillons sur les données de 2022,
nous pouvons nous passer de cette variable.</p>
</details>
</div>
<p>Les données DVF proposent une observation par transaction.
Ces transactions
peuvent concerner plusieurs lots. Par exemple, un appartement
avec garage et cave comportera trois lots.</p>
<p>Pour simplifier,
on va créer une variable de surface qui agrège les différentes informations
de surface disponibles dans le jeu de données.
Les agréger revient à supposer que le modèle de fixation des prix est le même
entre chaque lot. C’est une hypothèse simplificatrice qu’une personne plus
experte du marché immobilier, ou qu’une approche propre de sélection
de variable pourrait amener à nier. En effet, les variables
en question sont faiblement corrélées les unes entre elles, à quelques
exceptions près (<a href="#fig-corr-surface" class="quarto-xref">Figure&nbsp;2.1</a>):</p>
<div id="c55fcb0b" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> mutations.loc[</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    :,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    mutations.columns[mutations.columns.<span class="bu">str</span>.startswith(<span class="st">'Surface Carrez'</span>)].tolist()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>corr.columns <span class="op">=</span> corr.columns.<span class="bu">str</span>.replace(<span class="st">"Carrez du "</span>, <span class="st">""</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>corr <span class="op">=</span> corr.corr()</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.triu(np.ones_like(corr, dtype<span class="op">=</span><span class="bu">bool</span>))</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> sns.diverging_palette(<span class="dv">230</span>, <span class="dv">20</span>, as_cmap<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fig-corr-surface" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-execution_count="13">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-corr-surface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.heatmap(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    corr, ax<span class="op">=</span>ax, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    mask<span class="op">=</span>mask,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    vmax<span class="op">=</span><span class="fl">.3</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="fl">.5</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">.5</span>},</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    xticklabels<span class="op">=</span>corr.columns.values,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    yticklabels<span class="op">=</span>corr.columns.values, cmap<span class="op">=</span>cmap, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">".2f"</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>g</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-corr-surface-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1
</figcaption>
</figure>
</div>
<div id="c01adcf0" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'lprix'</span>] <span class="op">=</span> np.log(mutations[<span class="st">"Valeur fonciere"</span>])</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'surface'</span>] <span class="op">=</span> mutations.loc[:, colonnes_surface].<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>).astype(<span class="bu">int</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="a4965f09" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>mutations[<span class="st">'surface'</span>] <span class="op">=</span> mutations.loc[:, mutations.columns[mutations.columns.<span class="bu">str</span>.startswith(<span class="st">'Surface Carrez'</span>)].tolist()].<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
</section>
<section id="un-premier-pipeline-random-forest-sur-des-variables-standardisées" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Un premier pipeline : <em>random forest</em> sur des variables standardisées</h1>
<p>Notre premier <em>pipeline</em> va nous permettre d’intégrer ensemble:</p>
<ol type="1">
<li>Une étape de <em>preprocessing</em> avec la standardisation de variables</li>
<li>Une étape d’estimation du prix en utilisant un modèle de <em>random forest</em></li>
</ol>
<p>Pour le moment, on va prendre comme acquis un certain nombre de variables
explicatives (les <em>features</em>) et les hyperparamètres du modèle.</p>
<p>L’algorithme des <em>random forest</em> est une technique statistique basée sur
les arbres de décision. Elle a été définie explicitement par l’un
des pionniers du <em>machine learning</em>, <span class="citation" data-cites="breiman2001random">Breiman (<a href="#ref-breiman2001random" role="doc-biblioref">2001</a>)</span>.
Il s’agit d’une <a href="https://en.wikipedia.org/wiki/Ensemble_learning">méthode ensembliste</a>
puisqu’elle consiste à utiliser plusieurs algorithmes (en l’occurrence des arbres
de décision) pour obtenir une meilleure prédiction que ne le permettraient
chaque modèle isolément.</p>
<p>Les <em>random forest</em> sont une méthode d’aggrégation<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> d’arbres de décision.
On calcule <span class="math inline">\(K\)</span> arbres de décision et en tire, par une méthode d’agrégation,
une règle de décision moyenne qu’on va appliquer pour tirer une
prédiction de nos données.</p>
<p><a href="https://miro.medium.com/v2/resize:fit:720/format:webp/1*jE1Cb1Dc_p9WEOPMkC95WQ.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*jE1Cb1Dc_p9WEOPMkC95WQ.png" class="img-fluid"></a></p>
<p>L’un des intérêts
des <em>random forest</em> est qu’il existe des méthodes pour déterminer
l’importance relative de chaque variable dans la prédiction.</p>
<p>Nous allons ici partir d’un <em>random forest</em> avec des valeurs d’hyperparamètres
données, à savoir la profondeur de l’arbre.</p>
<section id="définition-des-ensembles-train-et-test" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="définition-des-ensembles-train-et-test"><span class="header-section-number">3.1</span> Définition des ensembles <em>train</em> et <em>test</em></h2>
<p>Nous allons donc nous restreindre à un sous-ensemble de colonnes dans un
premier temps.</p>
<p>Nous allons également ne conserver que les
transactions inférieures à 5 millions
d’euros (on anticipe que celles ayant un montant supérieur sont des transactions
exceptionnelles dont le mécanisme de fixation du prix diffère)</p>
<div id="86725cdc" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mutations2 <span class="op">=</span> mutations.drop(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    colonnes_surface.tolist() <span class="op">+</span> [<span class="st">"Date mutation"</span>, <span class="st">"lprix"</span>], <span class="co"># ajouter "confinement" si données 2020</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="st">"columns"</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    ).copy()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>mutations2 <span class="op">=</span> mutations2.loc[mutations2[<span class="st">'Valeur fonciere'</span>] <span class="op">&lt;</span> <span class="fl">5e6</span>] <span class="co">#keep only values below 5 millions</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>mutations2.columns <span class="op">=</span> mutations2.columns.<span class="bu">str</span>.replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>mutations2  <span class="op">=</span> mutations2.dropna(subset <span class="op">=</span> [<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>,<span class="st">'month'</span>])</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Notre <em>pipeline</em> va incorporer deux types de variables: les variables
catégorielles et les variables numériques.
Ces différents types vont bénéficier d’étapes de <em>preprocessing</em>
différentes.</p>
<div id="0b9b6181" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="op">=</span> mutations2.columns[<span class="op">~</span>mutations2.columns.isin([<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>, <span class="st">'month'</span>, <span class="st">'Valeur_fonciere'</span>])].tolist()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>,<span class="st">'month'</span>]</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Au passage, nous avons abandonné la variable de code postal pour privilégier
le département afin de réduire la dimension de notre jeu de données. Si on voulait
vraiment avoir un bon modèle, il faudrait faire autrement car le code postal
est probablement un très bon prédicteur du prix d’un bien, une fois que
les caractéristiques du bien sont contrôlées.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Exercice 1 : Découpage des échantillons
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Nous allons stratifier notre échantillonage de <em>train/test</em> par département
afin de tenir compte, de manière minimale, de la géographie.
Pour accélérer les calculs pour ce tutoriel, nous n’allons considérer que
30% des transactions observées sur chaque département.</p>
<p>Voici le code pour le faire:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mutations2 <span class="op">=</span> mutations2.groupby(<span class="st">'dep'</span>).sample(frac <span class="op">=</span> <span class="fl">0.1</span>, random_state <span class="op">=</span> <span class="dv">123</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<p>Avec la fonction adéquate de <code>Scikit</code>, faire un découpage de <code>mutations2</code>
en <em>train</em> et <em>test sets</em>
en suivant les consignes suivantes:</p>
<ul>
<li>20% des données dans l’échantillon de <em>test</em> ;</li>
<li>L’échantillonnage est stratifié par départements ;</li>
<li>Pour avoir des résultats reproductibles, choisir une racine égale à 123.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="définition-du-premier-pipeline" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="définition-du-premier-pipeline"><span class="header-section-number">3.2</span> Définition du premier <em>pipeline</em></h2>
<p>Pour commencer, nous allons fixer la taille des arbres de décision avec
l’hyperparamètre <code>max_depth = 2</code>.</p>
<p>Notre <em>pipeline</em> va intégrer les étapes suivantes :</p>
<ol type="1">
<li><strong>Preprocessing</strong> :
<ul>
<li>Les variables numériques vont être standardisées avec un <code>StandardScaler</code>.
Pour cela, nous allons utiliser la liste <code>numeric_features</code> définie précédemment.</li>
<li>Les variables catégorielles vont être explosées avec un <em>one hot encoding</em>
(méthode <code>OneHotEncoder</code> de <code>scikit</code>)
Pour cela, nous allons utiliser la liste <code>categorical_features</code></li>
</ul></li>
<li><strong>Random forest</strong> : nous allons appliquer l’estimateur <em>ad hoc</em> de <code>Scikit</code>.</li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Exercice 2 : Construction d’un premier pipeline formel
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Initialiser un <em>random forest</em> de profondeur 2. Fixer la racine à 123 pour avoir des résultats reproductibles.</li>
<li>La première étape du <em>pipeline</em> (nommer cette couche <em>preprocessor</em>) consiste à appliquer les étapes de <em>preprocessing</em> adaptées à chaque type de variables:
<ul>
<li>Pour les variables numériques, appliquer une étape d’imputation à la moyenne puis standardiser celles-ci</li>
<li>Pour les variables catégorielles, appliquer un <a href="https://en.wikipedia.org/wiki/One-hot"><em>one hot encoding</em></a></li>
</ul></li>
<li>Appliquer comme couche de sortie le modèle défini plus tôt.</li>
</ol>
<p><em>💡 Il est recommandé de s’aider de la documentation de <code>Scikit</code>. Si vous avez besoin d’un indice supplémentaire, consulter le pipeline présenté ci-dessous.</em></p>
</div>
</div>
</div>
<p>A l’issue de cet exercice, nous devrions obtenir le <em>pipeline</em> suivant.</p>
<p>Nous avons construit ce pipeline sous forme de couches successives. La couche
<code>randomforest</code> prendra automatiquement le résultat de la couche <code>preprocessor</code>
en <em>input</em>. La couche <code>features</code> permet d’introduire de manière relativement
simple (quand on a les bonnes méthodes) la complexité du <em>preprocessing</em>
sur données réelles dont les types divergent.</p>
<p>A cette étape, rien n’a encore été estimé.
C’est très simple à mettre en oeuvre
avec un <em>pipeline</em>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Exercice 3 : Mise en oeuvre du pipeline
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Estimer les paramètres du modèle sur le jeu d’entraînement</li>
<li>Observer la manière dont les données d’entraînement sont transformées
par l’étape de <em>preprocessing</em> avec les méthodes adéquates sur 4 observations de <code>X_train</code>
tirées aléatoirement</li>
<li>Utiliser ce modèle pour prédire le prix sur l’échantillon de test. A partir de ces quelques prédictions,
quel semble être le problème ?</li>
<li>Observer la manière dont ce <em>preprocessing</em> peut s’appliquer sur deux exemples fictifs :
<ul>
<li>Un appartement (<code>code_type_local = 2</code>) dans le 75, vendu au mois de mai, unique lot de la vente avec 3 pièces, faisant 75m² ;</li>
<li>Une maison (<code>code_type_local = 1</code>) dans le 06, vendue en décembre, dans une transaction avec 2 lots. La surface complète est de 180m² et le bien comporte 6 pièces.</li>
</ul></li>
<li>Déduire sur ces deux exemples le prix prédit par le modèle.</li>
<li>Calculer et interpréter le RMSE sur l’échantillon de test. Ce modèle est-il satisfaisant ?</li>
</ol>
</div>
</div>
</div>
</section>
<section id="variable-importance" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="variable-importance"><span class="header-section-number">3.3</span> <em>Variable importance</em></h2>
<p>Les prédictions semblent avoir une assez faible variance, comme si des variables
de seuils intervenaient. Nous allons donc devoir essayer de comprendre pourquoi.</p>
<p>La <em>“variable importance”</em>
se réfère à la mesure de l’influence de chaque variable d’entrée sur la performance du modèle.
L’impureté fait référence à l’incertitude ou à l’entropie présente dans un ensemble de données.
Dans le contexte des <em>random forest</em>, cette mesure est souvent calculée en évaluant la réduction moyenne de l’impureté des nœuds de décision causée par une variable spécifique.
Cette approche permet de quantifier l’importance des variables dans le processus de prise de décision du modèle, offrant ainsi des intuitions sur les caractéristiques les plus informatives pour la prédiction (plus de détails <a href="https://mljar.com/blog/feature-importance-in-random-forest/">sur ce blog</a>).</p>
<p>On ne va représenter, parmi notre ensemble important de colonnes, que celles
qui ont une importance non nulle.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Exercice 4 : Compréhension du modèle
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ol type="1">
<li>Récupérer la <em>feature importance</em> directement depuis la couche adaptée de votre <em>pipeline</em></li>
<li>Utiliser le code suivant pour calculer l’intervalle de confiance de cette mesure d’importance:</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>std <span class="op">=</span> np.std([tree.feature_importances_ <span class="cf">for</span> tree <span class="kw">in</span> pipe[<span class="st">'randomforest'</span>].estimators_], axis<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="3" type="1">
<li>Représenter les variables d’importance non nulle. Qu’en concluez-vous ?</li>
</ol>
</div>
</div>
</div>
<p>Le graphique d’importance des variables que vous devriez obtenir à l’issue
de cet exercice est le suivant.</p>
<p>Les statistiques obtenues par le biais de cette <em>variable importance</em>
sont un peu rudimentaires mais permettent déjà de comprendre
le problème de notre modèle.</p>
<p>On voit donc que deux de nos variables déterminantes sont des effets fixes
géographiques (qui servent à ajuster de la différence de prix entre
Paris et les Hauts de Seine et le reste de la France), une autre variable
est un effet fixe type de bien. Les deux variables qui pourraient introduire
de la variabilité, à savoir la surface et, dans une moindre mesure, le
nombre de lots, ont une importance moindre.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Idéalement, on utiliserait <code>Yellowbrick</code> pour représenter l’importance des variables
Mais en l’état actuel du <em>pipeline</em> on a beaucoup de variables dont le poids
est nul qui viennent polluer la visualisation. Vous pouvez
consulter la
<a href="https://www.scikit-yb.org/en/latest/api/model_selection/importances.html">documentation de <code>Yellowbrick</code> sur ce sujet</a></p>
</div>
</div>
</div>
<p>Les prédictions peuvent nous suggérer également
qu’il y a un problème.</p>
</section>
</section>
<section id="restriction-du-champ-du-modèle" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Restriction du champ du modèle</h1>
<p>Mettre en oeuvre un bon modèle de prix au niveau France entière
est complexe. Nous allons donc nous restreindre au champ suivant:
les appartements dans Paris.</p>
<div id="94f4174a" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>mutations_paris <span class="op">=</span> mutations.drop(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    colonnes_surface.tolist() <span class="op">+</span> [<span class="st">"Date mutation"</span>, <span class="st">"lprix"</span>], <span class="co"># ajouter "confinement" si données 2020</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="st">"columns"</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    ).copy()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>mutations_paris <span class="op">=</span> mutations_paris.loc[mutations_paris[<span class="st">'Valeur fonciere'</span>] <span class="op">&lt;</span> <span class="fl">5e6</span>] <span class="co">#keep only values below 5 millions</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>mutations_paris.columns <span class="op">=</span> mutations_paris.columns.<span class="bu">str</span>.replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>mutations_paris  <span class="op">=</span> mutations_paris.dropna(subset <span class="op">=</span> [<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>,<span class="st">'month'</span>])</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>mutations_paris <span class="op">=</span> mutations_paris.loc[mutations_paris[<span class="st">'dep'</span>] <span class="op">==</span> <span class="st">"75"</span>]</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>mutations_paris <span class="op">=</span> mutations_paris.loc[mutations_paris[<span class="st">'Code_type_local'</span>] <span class="op">==</span> <span class="dv">2</span>].drop([<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>], axis <span class="op">=</span> <span class="st">"columns"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>mutations_paris.loc[mutations_paris[<span class="st">'surface'</span>]<span class="op">&gt;</span><span class="dv">0</span>]</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Exercice 4 : Pipeline plus simple
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Reprendre les codes précédents et reconstruire notre <em>pipeline</em> sur
la nouvelle base en mettant en oeuvre une méthode de <em>boosting</em>
plutôt qu’une forêt aléatoire.</p>
<p><em>La correction de cet exercice est apparente pour simplifier les prochaines étapes mais essayez de faire celui-ci de vous-même</em>.</p>
</div>
</div>
</div>
<p>A l’issue de cet exercice, vous devriez avoir des <em>MDI</em> proches
de celles-ci :</p>
<div id="estim-model-paris" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingRegressor</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.impute <span class="im">import</span> SimpleImputer</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, OneHotEncoder</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> make_pipeline, Pipeline</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> make_column_transformer</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>mutations_paris <span class="op">=</span> mutations.drop(</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    colonnes_surface.tolist() <span class="op">+</span> [<span class="st">"Date mutation"</span>, <span class="st">"lprix"</span>], <span class="co"># ajouter "confinement" si données 2020</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    axis <span class="op">=</span> <span class="st">"columns"</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    ).copy()</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>mutations_paris <span class="op">=</span> mutations_paris.loc[mutations_paris[<span class="st">'Valeur fonciere'</span>] <span class="op">&lt;</span> <span class="fl">5e6</span>] <span class="co">#keep only values below 5 millions</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>mutations_paris.columns <span class="op">=</span> mutations_paris.columns.<span class="bu">str</span>.replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>mutations_paris  <span class="op">=</span> mutations_paris.dropna(subset <span class="op">=</span> [<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>,<span class="st">'month'</span>])</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>mutations_paris <span class="op">=</span> mutations_paris.loc[mutations_paris[<span class="st">'dep'</span>] <span class="op">==</span> <span class="st">"75"</span>]</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>mutations_paris <span class="op">=</span> mutations_paris.loc[mutations_paris[<span class="st">'Code_type_local'</span>] <span class="op">==</span> <span class="dv">2</span>].drop([<span class="st">'dep'</span>,<span class="st">'Code_type_local'</span>, <span class="st">'Nombre_de_lots'</span>], axis <span class="op">=</span> <span class="st">"columns"</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>mutations_paris.loc[mutations_paris[<span class="st">'surface'</span>]<span class="op">&gt;</span><span class="dv">0</span>]</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="op">=</span> mutations_paris.columns[<span class="op">~</span>mutations_paris.columns.isin([<span class="st">'month'</span>, <span class="st">'Valeur_fonciere'</span>])].tolist()</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> [<span class="st">'month'</span>]</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>reg <span class="op">=</span> GradientBoostingRegressor(random_state<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>numeric_pipeline <span class="op">=</span> make_pipeline(</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  SimpleImputer(),</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  StandardScaler()</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>transformer <span class="op">=</span> make_column_transformer(</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    (numeric_pipeline, numeric_features),</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    (OneHotEncoder(sparse_output <span class="op">=</span> <span class="va">False</span>, handle_unknown <span class="op">=</span> <span class="st">"ignore"</span>), categorical_features))</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>pipe <span class="op">=</span> Pipeline(steps<span class="op">=</span>[(<span class="st">'preprocessor'</span>, transformer),</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>                      (<span class="st">'boosting'</span>, reg)])</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    mutations_paris.drop(<span class="st">"Valeur_fonciere"</span>, axis <span class="op">=</span> <span class="dv">1</span>),</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    mutations_paris[<span class="st">"Valeur_fonciere"</span>],</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    test_size <span class="op">=</span> <span class="fl">0.2</span>, random_state <span class="op">=</span> <span class="dv">123</span></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>pipe.fit(X_train, y_train)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>pd.DataFrame(</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>    pipe[<span class="st">"boosting"</span>].feature_importances_, </span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>    index <span class="op">=</span> pipe[:<span class="op">-</span><span class="dv">1</span>].get_feature_names_out()</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="recherche-des-hyperparamètres-optimaux-avec-une-validation-croisée" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Recherche des hyperparamètres optimaux avec une validation croisée</h1>
<p>On détecte que le premier modèle n’est pas très bon et ne nous aidera
pas vraiment à évaluer de manière fiable l’appartement de nos rêves.</p>
<p>On va essayer de voir si notre modèle ne serait pas meilleur avec des
hyperparamètres plus adaptés. Après tout, nous avons choisi par défaut
la profondeur de l’arbre mais c’était un choix au doigt mouillé.</p>
<p>❓️ Quels sont les hyperparamètres qu’on peut essayer d’optimiser ?</p>
<div id="d3f5d7f8" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pipe[<span class="st">'boosting'</span>].get_params()</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Un <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestRegressor.html">détour par la documentation</a>
nous aide à comprendre ceux sur lesquels on va jouer. Par exemple, il serait
absurde de jouer sur le paramètre <code>random_state</code> qui est la racine du générateur
pseudo-aléatoire.</p>
<div id="20340fb7" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pd.concat((X_train, X_test), axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>Y <span class="op">=</span> np.concatenate([y_train,y_test])</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Nous allons nous contenter de jouer sur les paramètres:</p>
<ul>
<li><code>n_estimators</code>: Le nombre d’arbres de décision que notre forêt contient</li>
<li><code>max_depth</code>: La profondeur de chaque arbre</li>
</ul>
<p>Il existe plusieurs manières de faire de la validation croisée. Nous allons ici
utiliser la <em>grid search</em> qui consiste à estimer et tester le modèle sur chaque
combinaison d’une grille de paramètres et sélectionner le couple de valeurs
des hyperparamètres amenant à la meilleure prédiction. Par défaut, <code>scikit</code>
effectue une <em>5-fold cross validation</em>. Nous n’allons pas changer
ce comportement.</p>
<p>Comme expliqué précédemment, les paramètres s’appelent sous la forme
<code>&lt;step&gt;__&lt;parameter_name&gt;</code></p>
<p>La validation croisée pouvant être très consommatrice de temps, nous
n’allons l’effectuer que sur un nombre réduit de valeurs de notre grille.
Il est possible de passer la liste des valeurs à passer au crible sous
forme de liste
(comme nous allons le proposer pour l’argument <code>max_depth</code> dans l’exercice ci-dessous) ou
sous forme d’<code>array</code> (comme nous allons le proposer pour l’argument <code>n_estimators</code>) ce qui est
souvent pratique pour générer un criblage d’un intervalle avec <code>np.linspace</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Astuce</span>Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Les estimations sont, par défaut, menées de manière séquentielle (l’une après
l’autre). Nous sommes cependant face à un problème
<em>embarassingly parallel</em>.
Pour gagner en performance, il est recommandé d’utiliser l’argument
<code>n_jobs=-1</code>.</p>
</div>
</div>
</div>
<div id="grid-search" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> GridSearchCV</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters of pipelines can be set using ‘__’ separated parameter names:</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>param_grid <span class="op">=</span> {</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"boosting__n_estimators"</span>: np.linspace(<span class="dv">5</span>,<span class="dv">25</span>, <span class="dv">5</span>).astype(<span class="bu">int</span>),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"boosting__max_depth"</span>: [<span class="dv">2</span>,<span class="dv">4</span>]</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>grid_search <span class="op">=</span> GridSearchCV(pipe, param_grid<span class="op">=</span>param_grid)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>grid_search.fit(X_train, y_train)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>end_time <span class="op">=</span> time.time()</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Elapsed time : </span><span class="sc">{</span><span class="bu">int</span>(end_time <span class="op">-</span> start_time)<span class="sc">}</span><span class="ss"> seconds"</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="2f4a71a5" class="cell" data-execution_count="37">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>grid_search.best_params_</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>grid_search.best_estimator_</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Toutes les performances sur les ensembles d’échantillons et de test sur la grille
d’hyperparamètres sont disponibles dans l’attribut:</p>
<div id="c13fe902" class="cell" data-execution_count="38">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>perf_random_forest <span class="op">=</span> pd.DataFrame(grid_search.cv_results_)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Regardons les résultats moyens pour chaque valeur des hyperparamètres:</p>
<div id="4d8ebdbf" class="cell" data-execution_count="39">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lineplot(data <span class="op">=</span> perf_random_forest, ax <span class="op">=</span> ax,</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>             x <span class="op">=</span> <span class="st">"param_boosting__n_estimators"</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>             y <span class="op">=</span> <span class="st">"mean_test_score"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>             hue <span class="op">=</span> <span class="st">"param_boosting__max_depth"</span>)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>g.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'Number of estimators'</span>, ylabel<span class="op">=</span><span class="st">'Mean score on test sample'</span>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>g</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>plt.legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>, borderaxespad<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>           title<span class="op">=</span><span class="st">'Depth of trees'</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Globalement, à profondeur d’arbre donnée, le nombre d’arbres affecte
la performance. Changer la profondeur de l’arbre améliore la
performance de manière plus marquée.</p>
<p>Maintenant, il nous reste à re-entraîner le modèle avec ces nouveaux
paramètres sur l’ensemble du jeu de <em>train</em> et l’évaluer sur l’ensemble
du jeu de <em>test</em> :</p>
<div id="ece2c632" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pipe_optimal <span class="op">=</span> grid_search.best_estimator_</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>pipe_optimal.fit(X_train, y_train)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>compar <span class="op">=</span> pd.DataFrame([y_test, pipe_optimal.predict(X_test)]).T</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>compar.columns <span class="op">=</span> [<span class="st">'obs'</span>,<span class="st">'pred'</span>]</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>compar[<span class="st">'diff'</span>] <span class="op">=</span> compar.obs <span class="op">-</span> compar.pred</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>On obtient le RMSE suivant :</p>
<p>Et si on regarde la qualité en prédiction:</p>
<p>On obtient plus de variance dans la prédiction, c’est déjà un peu mieux.
Cependant, cela reste décevant pour plusieurs raisons:</p>
<ul>
<li>nous n’avons pas fait d’étape de sélection de variable</li>
<li>nous n’avons pas chercher à déterminer si la variable à prédire la plus
pertinente était le prix ou une transformation de celle-ci
(par exemple le prix au <span class="math inline">\(m^2\)</span>)</li>
</ul>
</section>
<section id="prochaine-étape" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Prochaine étape</h1>
<p>Nous avons un modèle certes perfectible mais fonctionnel.
La question qui se pose maintenant c’est d’essayer d’en faire
quelque chose au service des utilisateurs. Cela nous amène vers
la question de la <strong>mise en production</strong>.</p>
<p>Ceci est l’objet du prochain chapitre. Il s’agira d’une version introductive
des enjeux évoqués dans le cadre du cours de
3e année de <a href="https://ensae-reproductibilite.github.io/website/">mise en production de projets de <em>data science</em></a>.</p>
</section>
<section id="références" class="level1 unnumbered">
<h1 class="unnumbered">Références</h1>
<section id="informations-additionnelles" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="informations-additionnelles">Informations additionnelles</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Environnement Python   
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Ce site a été construit automatiquement par le biais d’une action <code>Github</code> <i class="fa-brands fa-github" aria-label="github"></i> utilisant le logiciel de publication reproductible <code>Quarto</code> <iconify-icon role="img" inline="" icon="simple-icons:quarto" aria-label="Icon quarto from simple-icons Iconify.design set." title="Icon quarto from simple-icons Iconify.design set."></iconify-icon> (version 1.8.26).</p>
<p>L’environnement <i class="fa-brands fa-python" aria-label="python"></i> utilisé pour obtenir les résultats est reproductible par le biais d’<a href="https://docs.astral.sh/uv/guides/install-python/">uv</a>. Le fichier <code>pyproject.toml</code> utilisé pour construire cet environnement est disponible sur le dépôt <a href="https://github.com/linogaliana/python-datascientist/blob/main/pyproject.toml"><code>linogaliana/python-datascientist</code></a></p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>pyproject.toml</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29" data-filename="pyproject.toml" data-code-fold="true" data-code-summary="pyproject.toml"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>[project]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">"python-datascientist"</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>version <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>description <span class="op">=</span> <span class="st">"Source code for Lino Galiana's Python for data science course"</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>readme <span class="op">=</span> <span class="st">"README.md"</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>requires<span class="op">-</span>python <span class="op">=</span> <span class="st">"&gt;=3.12,&lt;3.13"</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>dependencies <span class="op">=</span> [</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"altair==5.4.1"</span>,</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"black==24.8.0"</span>,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cartiflette"</span>,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"contextily==1.6.2"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"duckdb&gt;=0.10.1"</span>,</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"folium&gt;=0.19.6"</span>,</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"geoplot==0.5.1"</span>,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"graphviz==0.20.3"</span>,</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"great-tables==0.12.0"</span>,</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ipykernel&gt;=6.29.5"</span>,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jupyter&gt;=1.1.1"</span>,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jupyter-cache==1.0.0"</span>,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"kaleido==0.2.1"</span>,</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"langchain-community==0.3.9"</span>,</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"loguru==0.7.3"</span>,</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"markdown&gt;=3.8"</span>,</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nbclient==0.10.0"</span>,</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nbformat==5.10.4"</span>,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nltk&gt;=3.9.1"</span>,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pip&gt;=25.1.1"</span>,</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"plotly&gt;=6.1.2"</span>,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"plotnine&gt;=0.15"</span>,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"polars==1.8.2"</span>,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pyarrow==17.0.0"</span>,</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pynsee==0.1.8"</span>,</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"python-dotenv==1.0.1"</span>,</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pywaffle==1.1.1"</span>,</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"requests&gt;=2.32.3"</span>,</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"scikit-image==0.24.0"</span>,</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"scipy==1.13.0"</span>,</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"selenium&lt;4.39.0"</span>,</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"spacy==3.8.4"</span>,</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"webdriver-manager==4.0.2"</span>,</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"wordcloud==1.9.3"</span>,</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"xlrd==2.0.1"</span>,</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"yellowbrick==1.5"</span>,</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>[tool.uv.sources]</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>cartiflette <span class="op">=</span> { git <span class="op">=</span> <span class="st">"https://github.com/inseefrlab/cartiflette"</span> }</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>[dependency<span class="op">-</span>groups]</span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>dev <span class="op">=</span> [</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nb-clean&gt;=4.0.1"</span>,</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Pour utiliser exactement le même environnement (version de <code>Python</code> et <em>packages</em>), se reporter à la <a href="https://docs.astral.sh/uv/pip/environments/">documentation d’<code>uv</code></a>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Historique du fichier   
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="1067" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1066;"><span id="cb30-1067"><a href="#cb30-1067" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`Ce fichier a été modifié __</span><span class="sc">${</span>table_commit<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs">__ fois depuis sa création le </span><span class="sc">${</span>creation_string<span class="sc">}</span><span class="vs"> (dernière modification le </span><span class="sc">${</span>last_modification_string<span class="sc">}</span><span class="vs">)`</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="1072" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1071;"><span id="cb31-1072"><a href="#cb31-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>git_history_table<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-2" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="1077" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1076;"><span id="cb32-1077"><a href="#cb32-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>git_history_plot<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
<table class="commit-table" border="1">
<thead>
<tr>
<th>
SHA
</th>
<th>
Date
</th>
<th>
Author
</th>
<th>
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/d56f6e9e">d56f6e9e</a>
</td>
<td>
2025-11-25 08:30:59
</td>
<td>
lgaliana
</td>
<td>
Un petit coup de neuf sur les consignes et corrections pandas related
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3e04ed3c">3e04ed3c</a>
</td>
<td>
2025-11-24 20:08:05
</td>
<td>
lgaliana
</td>
<td>
Avoid deprecated ravel method and fix notebooks launch url
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/94648290">94648290</a>
</td>
<td>
2025-07-22 18:57:48
</td>
<td>
Lino Galiana
</td>
<td>
Fix boxes now that it is better supported by jupyter (#628)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/91431fa2">91431fa2</a>
</td>
<td>
2025-06-09 17:08:00
</td>
<td>
Lino Galiana
</td>
<td>
Improve homepage hero banner (#612)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/80fa8152">80fa8152</a>
</td>
<td>
2025-01-31 20:10:50
</td>
<td>
Lino Galiana
</td>
<td>
Mise en forme notebook colab (#593)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/5ff770b5">5ff770b5</a>
</td>
<td>
2024-12-04 10:07:34
</td>
<td>
lgaliana
</td>
<td>
Partie ML plus esthétique
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/d2422572">d2422572</a>
</td>
<td>
2024-08-22 18:51:51
</td>
<td>
Lino Galiana
</td>
<td>
At this point, notebooks should now all be functional ! (#547)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/c641de05">c641de05</a>
</td>
<td>
2024-08-22 11:37:13
</td>
<td>
Lino Galiana
</td>
<td>
A series of fix for notebooks that were bugging (#545)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/0908656f">0908656f</a>
</td>
<td>
2024-08-20 16:30:39
</td>
<td>
Lino Galiana
</td>
<td>
English sidebar (#542)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/8f0d2e16">8f0d2e16</a>
</td>
<td>
2024-05-07 15:06:45
</td>
<td>
lgaliana
</td>
<td>
Duplicate data from datagouv
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/c9f9f8a7">c9f9f8a7</a>
</td>
<td>
2024-04-24 15:09:35
</td>
<td>
Lino Galiana
</td>
<td>
Dark mode and CSS improvements (#494)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/06d003a1">06d003a1</a>
</td>
<td>
2024-04-23 10:09:22
</td>
<td>
Lino Galiana
</td>
<td>
Continue la restructuration des sous-parties (#492)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/8c316d0a">8c316d0a</a>
</td>
<td>
2024-04-05 19:00:59
</td>
<td>
Lino Galiana
</td>
<td>
Fix cartiflette deprecated snippets (#487)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/005d89b8">005d89b8</a>
</td>
<td>
2023-12-20 17:23:04
</td>
<td>
Lino Galiana
</td>
<td>
Finalise l’affichage des statistiques Git (#478)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3fba6124">3fba6124</a>
</td>
<td>
2023-12-17 18:16:42
</td>
<td>
Lino Galiana
</td>
<td>
Remove some badges from python (#476)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/4cd44f35">4cd44f35</a>
</td>
<td>
2023-12-11 17:37:50
</td>
<td>
Antoine Palazzolo
</td>
<td>
Relecture NLP (#474)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/16842200">16842200</a>
</td>
<td>
2023-12-02 12:06:40
</td>
<td>
Antoine Palazzolo
</td>
<td>
Première partie de relecture de fin du cours (#467)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/e4642eeb">e4642eeb</a>
</td>
<td>
2023-11-27 17:02:05
</td>
<td>
Lino Galiana
</td>
<td>
Deploy ML model as API (#460)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/a06a2689">a06a2689</a>
</td>
<td>
2023-11-23 18:23:28
</td>
<td>
Antoine Palazzolo
</td>
<td>
2ème relectures chapitres ML (#457)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/4960f2b7">4960f2b7</a>
</td>
<td>
2023-11-22 12:02:32
</td>
<td>
Lino Galiana
</td>
<td>
Chapitre pipeline scikit sur DVF (#454)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/69cf52bd">69cf52bd</a>
</td>
<td>
2023-11-21 16:12:37
</td>
<td>
Antoine Palazzolo
</td>
<td>
[On-going] Suggestions chapitres modélisation (#452)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/889a71ba">889a71ba</a>
</td>
<td>
2023-11-10 11:40:51
</td>
<td>
Antoine Palazzolo
</td>
<td>
Modification TP 3 (#443)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/652009df">652009df</a>
</td>
<td>
2023-10-09 13:56:34
</td>
<td>
Lino Galiana
</td>
<td>
Finalise le cleaning (#430)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/a7711832">a7711832</a>
</td>
<td>
2023-10-09 11:27:45
</td>
<td>
Antoine Palazzolo
</td>
<td>
Relecture TD2 par Antoine (#418)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/154f09e4">154f09e4</a>
</td>
<td>
2023-09-26 14:59:11
</td>
<td>
Antoine Palazzolo
</td>
<td>
Des typos corrigées par Antoine (#411)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3bdf3b06">3bdf3b06</a>
</td>
<td>
2023-08-25 11:23:02
</td>
<td>
Lino Galiana
</td>
<td>
Simplification de la structure 🤓 (#393)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/78ea2cbd">78ea2cbd</a>
</td>
<td>
2023-07-20 20:27:31
</td>
<td>
Lino Galiana
</td>
<td>
Change titles levels (#381)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/29ff3f58">29ff3f58</a>
</td>
<td>
2023-07-07 14:17:53
</td>
<td>
linogaliana
</td>
<td>
description everywhere
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/f21a24d3">f21a24d3</a>
</td>
<td>
2023-07-02 10:58:15
</td>
<td>
Lino Galiana
</td>
<td>
Pipeline Quarto &amp; Pages 🚀 (#365)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/38693f62">38693f62</a>
</td>
<td>
2023-04-19 17:22:36
</td>
<td>
Lino Galiana
</td>
<td>
Rebuild visualisation part (#357)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/32486330">32486330</a>
</td>
<td>
2023-02-18 13:11:52
</td>
<td>
Lino Galiana
</td>
<td>
Shortcode rawhtml (#354)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/f10815b5">f10815b5</a>
</td>
<td>
2022-08-25 16:00:03
</td>
<td>
Lino Galiana
</td>
<td>
Notebooks should now look more beautiful (#260)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/494a85ae">494a85ae</a>
</td>
<td>
2022-08-05 14:49:56
</td>
<td>
Lino Galiana
</td>
<td>
Images featured ✨ (#252)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/d201e3cd">d201e3cd</a>
</td>
<td>
2022-08-03 15:50:34
</td>
<td>
Lino Galiana
</td>
<td>
Pimp la homepage ✨ (#249)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/12965bac">12965bac</a>
</td>
<td>
2022-05-25 15:53:27
</td>
<td>
Lino Galiana
</td>
<td>
:launch: Bascule vers quarto (#226)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/9c71d6e7">9c71d6e7</a>
</td>
<td>
2022-03-08 10:34:26
</td>
<td>
Lino Galiana
</td>
<td>
Plus d’éléments sur S3 (#218)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/ed2ddec8">ed2ddec8</a>
</td>
<td>
2022-01-04 13:32:43
</td>
<td>
Expressso
</td>
<td>
retire typo (#212)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/66e2837c">66e2837c</a>
</td>
<td>
2021-12-24 16:54:45
</td>
<td>
Lino Galiana
</td>
<td>
Fix a few typos in the new pipeline tutorial (#208)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/e94c1c5b">e94c1c5b</a>
</td>
<td>
2021-12-23 21:34:46
</td>
<td>
Lino Galiana
</td>
<td>
Un tutoriel sur les pipelines :tada: (#203)
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="1135" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1134;"><span id="cb33-1135"><a href="#cb33-1135" aria-hidden="true" tabindex="-1"></a>creation <span class="op">=</span> d3<span class="op">.</span><span class="fu">min</span>(</span>
<span id="cb33-1136"><a href="#cb33-1136" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb33-1137"><a href="#cb33-1137" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-1138"><a href="#cb33-1138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1139"><a href="#cb33-1139" aria-hidden="true" tabindex="-1"></a>last_modification <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(</span>
<span id="cb33-1140"><a href="#cb33-1140" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb33-1141"><a href="#cb33-1141" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-1142"><a href="#cb33-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1143"><a href="#cb33-1143" aria-hidden="true" tabindex="-1"></a>creation_string <span class="op">=</span> creation<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"fr"</span><span class="op">,</span> {</span>
<span id="cb33-1144"><a href="#cb33-1144" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb33-1145"><a href="#cb33-1145" aria-hidden="true" tabindex="-1"></a>  <span class="st">"month"</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb33-1146"><a href="#cb33-1146" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year"</span><span class="op">:</span> <span class="st">"numeric"</span></span>
<span id="cb33-1147"><a href="#cb33-1147" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb33-1148"><a href="#cb33-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-1149"><a href="#cb33-1149" aria-hidden="true" tabindex="-1"></a>last_modification_string <span class="op">=</span> last_modification<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"fr"</span><span class="op">,</span> {</span>
<span id="cb33-1150"><a href="#cb33-1150" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb33-1151"><a href="#cb33-1151" aria-hidden="true" tabindex="-1"></a>  <span class="st">"month"</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb33-1152"><a href="#cb33-1152" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year"</span><span class="op">:</span> <span class="st">"numeric"</span></span>
<span id="cb33-1153"><a href="#cb33-1153" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="1165" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1164;"><span id="cb34-1165"><a href="#cb34-1165" aria-hidden="true" tabindex="-1"></a>git_history_table <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">table</span>(</span>
<span id="cb34-1166"><a href="#cb34-1166" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">,</span></span>
<span id="cb34-1167"><a href="#cb34-1167" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb34-1168"><a href="#cb34-1168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb34-1169"><a href="#cb34-1169" aria-hidden="true" tabindex="-1"></a>      <span class="dt">SHA</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="fu">md</span><span class="vs">`[</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">](</span><span class="sc">${</span>github_repo<span class="sc">}</span><span class="vs">/commit/</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span></span>
<span id="cb34-1170"><a href="#cb34-1170" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Description</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">replacePullRequestPattern</span>(x<span class="op">,</span> github_repo)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb34-1171"><a href="#cb34-1171" aria-hidden="true" tabindex="-1"></a>      <span class="co">/*Date: x =&gt; x.toLocaleString("fr", {</span></span>
<span id="cb34-1172"><a href="#cb34-1172" aria-hidden="true" tabindex="-1"></a><span class="co">        "month": "numeric",</span></span>
<span id="cb34-1173"><a href="#cb34-1173" aria-hidden="true" tabindex="-1"></a><span class="co">        "day": "numeric",</span></span>
<span id="cb34-1174"><a href="#cb34-1174" aria-hidden="true" tabindex="-1"></a><span class="co">        "year": "numeric"</span></span>
<span id="cb34-1175"><a href="#cb34-1175" aria-hidden="true" tabindex="-1"></a><span class="co">        })</span></span>
<span id="cb34-1176"><a href="#cb34-1176" aria-hidden="true" tabindex="-1"></a><span class="co">      */</span></span>
<span id="cb34-1177"><a href="#cb34-1177" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb34-1178"><a href="#cb34-1178" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-1179"><a href="#cb34-1179" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="1185" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1184;"><span id="cb35-1185"><a href="#cb35-1185" aria-hidden="true" tabindex="-1"></a>git_history_plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb35-1186"><a href="#cb35-1186" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb35-1187"><a href="#cb35-1187" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"royalblue"</span>})<span class="op">,</span></span>
<span id="cb35-1188"><a href="#cb35-1188" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(</span>
<span id="cb35-1189"><a href="#cb35-1189" aria-hidden="true" tabindex="-1"></a>          table_commit<span class="op">,</span></span>
<span id="cb35-1190"><a href="#cb35-1190" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">pointerX</span>({<span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"red"</span>}))<span class="op">,</span></span>
<span id="cb35-1191"><a href="#cb35-1191" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(table_commit<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"royalblue"</span>})</span>
<span id="cb35-1192"><a href="#cb35-1192" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb35-1193"><a href="#cb35-1193" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="1199" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1198;"><span id="cb36-1199"><a href="#cb36-1199" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">replacePullRequestPattern</span>(inputString<span class="op">,</span> githubRepo) {</span>
<span id="cb36-1200"><a href="#cb36-1200" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use a regular expression to match the pattern #digit</span></span>
<span id="cb36-1201"><a href="#cb36-1201" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> pattern <span class="op">=</span> <span class="ss">/#</span><span class="sc">(\d+)</span><span class="ss">/g</span><span class="op">;</span></span>
<span id="cb36-1202"><a href="#cb36-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1203"><a href="#cb36-1203" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Replace the pattern with ${github_repo}/pull/#digit</span></span>
<span id="cb36-1204"><a href="#cb36-1204" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> replacedString <span class="op">=</span> inputString<span class="op">.</span><span class="fu">replace</span>(pattern<span class="op">,</span> <span class="st">'[#$1]('</span> <span class="op">+</span> githubRepo <span class="op">+</span> <span class="st">'/pull/$1)'</span>)<span class="op">;</span></span>
<span id="cb36-1205"><a href="#cb36-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-1206"><a href="#cb36-1206" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> replacedString<span class="op">;</span></span>
<span id="cb36-1207"><a href="#cb36-1207" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="1213" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1212;"><span id="cb37-1213"><a href="#cb37-1213" aria-hidden="true" tabindex="-1"></a>github_repo <span class="op">=</span> <span class="st">"https://github.com/linogaliana/python-datascientist"</span></span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="1218" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1217;"><span id="cb38-1218"><a href="#cb38-1218" aria-hidden="true" tabindex="-1"></a>table_commit <span class="op">=</span> {</span>
<span id="cb38-1219"><a href="#cb38-1219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1220"><a href="#cb38-1220" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the HTML table by its class name</span></span>
<span id="cb38-1221"><a href="#cb38-1221" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> table <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.commit-table'</span>)<span class="op">;</span></span>
<span id="cb38-1222"><a href="#cb38-1222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1223"><a href="#cb38-1223" aria-hidden="true" tabindex="-1"></a><span class="co">// Check if the table exists</span></span>
<span id="cb38-1224"><a href="#cb38-1224" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (table) {</span>
<span id="cb38-1225"><a href="#cb38-1225" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize an array to store the table data</span></span>
<span id="cb38-1226"><a href="#cb38-1226" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> dataArray <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb38-1227"><a href="#cb38-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1228"><a href="#cb38-1228" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Extract headers from the first row</span></span>
<span id="cb38-1229"><a href="#cb38-1229" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> headers <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb38-1230"><a href="#cb38-1230" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> table<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb38-1231"><a href="#cb38-1231" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">.</span><span class="fu">push</span>(table<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">cells</span>[i]<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">trim</span>())<span class="op">;</span></span>
<span id="cb38-1232"><a href="#cb38-1232" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-1233"><a href="#cb38-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1234"><a href="#cb38-1234" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate through the rows, starting from the second row</span></span>
<span id="cb38-1235"><a href="#cb38-1235" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> table<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb38-1236"><a href="#cb38-1236" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> row <span class="op">=</span> table<span class="op">.</span><span class="at">rows</span>[i]<span class="op">;</span></span>
<span id="cb38-1237"><a href="#cb38-1237" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> rowData <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb38-1238"><a href="#cb38-1238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1239"><a href="#cb38-1239" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Iterate through the cells in the row</span></span>
<span id="cb38-1240"><a href="#cb38-1240" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> row<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb38-1241"><a href="#cb38-1241" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Use headers as keys and cell content as values</span></span>
<span id="cb38-1242"><a href="#cb38-1242" aria-hidden="true" tabindex="-1"></a>            rowData[headers[j]] <span class="op">=</span> row<span class="op">.</span><span class="at">cells</span>[j]<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb38-1243"><a href="#cb38-1243" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb38-1244"><a href="#cb38-1244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1245"><a href="#cb38-1245" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Push the rowData object to the dataArray</span></span>
<span id="cb38-1246"><a href="#cb38-1246" aria-hidden="true" tabindex="-1"></a>        dataArray<span class="op">.</span><span class="fu">push</span>(rowData)<span class="op">;</span></span>
<span id="cb38-1247"><a href="#cb38-1247" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb38-1248"><a href="#cb38-1248" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-1249"><a href="#cb38-1249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1250"><a href="#cb38-1250" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> dataArray</span>
<span id="cb38-1251"><a href="#cb38-1251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1252"><a href="#cb38-1252" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1258" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1257;"><span id="cb39-1258"><a href="#cb39-1258" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the element with class 'git-details'</span></span>
<span id="cb39-1259"><a href="#cb39-1259" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb39-1260"><a href="#cb39-1260" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> gitDetails <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.commit-table'</span>)<span class="op">;</span></span>
<span id="cb39-1261"><a href="#cb39-1261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-1262"><a href="#cb39-1262" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if the element exists</span></span>
<span id="cb39-1263"><a href="#cb39-1263" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (gitDetails) {</span>
<span id="cb39-1264"><a href="#cb39-1264" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Hide the element</span></span>
<span id="cb39-1265"><a href="#cb39-1265" aria-hidden="true" tabindex="-1"></a>      gitDetails<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'none'</span><span class="op">;</span></span>
<span id="cb39-1266"><a href="#cb39-1266" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-1267"><a href="#cb39-1267" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-13" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1273" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1272;"><span id="cb40-1273"><a href="#cb40-1273" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@observablehq/plot@0.6.12/dist/plot.umd.min.js'</span>)</span></code></pre></div><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>



</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Retour au sommet</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Les références</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-breiman1996bagging" class="csl-entry" role="listitem">
Breiman, Leo. 1996. <span>«&nbsp;Bagging predictors&nbsp;»</span>. <em>Machine learning</em> 24: 123‑40.
</div>
<div id="ref-breiman2001random" class="csl-entry" role="listitem">
———. 2001. <span>«&nbsp;Random forests&nbsp;»</span>. <em>Machine learning</em> 45: 5‑32.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notes de bas de page</h2>

<ol>
<li id="fn1"><p>Les <em>random forest</em> sont l’une des principales méthodes
ensemblistes. Outre cette approche, les plus connues sont
le <a href="https://en.wikipedia.org/wiki/Bootstrap_aggregating"><em>bagging</em> (<em>boostrap aggregating</em>)</a> et le <em>boosting</em>
qui consistent à choisir la prédiction à privilégier
selon des algorithmes de choix différens.
Par exemple le <em>bagging</em> est une technique basée sur le vote majoritaire <span class="citation" data-cites="breiman1996bagging">(<a href="#ref-breiman1996bagging" role="doc-biblioref">Breiman 1996</a>)</span>.
Cette technique s’inspire du <em>bootstrap</em> qui, en économétrie,
consiste à ré-estimer sur <em>K</em> sous-échantillons
aléatoires des données un estimateur afin d’en tirer, par exemple, un intervalle
de confiance empirique à 95%. Le principe du <em>bagging</em> est le même. On ré-estime
<em>K</em> fois notre estimateur (par exemple un arbre de décision) et propose une
règle d’agrégation pour en tirer une règle moyennisée et donc une prédiction.
Le <em>boosting</em> fonctionne selon un principe différent, basé sur
l’optimisation de combinaisons de classifieurs faibles.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@book{galiana2025,
  author = {Galiana, Lino},
  title = {Python pour la data science},
  date = {2025},
  url = {https://pythonds.linogaliana.fr/},
  doi = {10.5281/zenodo.8229676},
  langid = {fr}
}
</code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">Veuillez citer ce travail comme suit&nbsp;:</div><div id="ref-galiana2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Galiana, Lino. 2025. <em>Python pour la data science</em>. <a href="https://doi.org/10.5281/zenodo.8229676">https://doi.org/10.5281/zenodo.8229676</a>.
</div></div></section></div></main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

// tweak headings in pymd
document.querySelectorAll(".pymd span.co").forEach(el => {
   if (!el.innerText.startsWith("#|")) {
      el.style.fontWeight = 1000;
   }
});

</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../content/modelisation";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copié");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copié");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pythonds\.linogaliana\.fr");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      if (authorPrefersDark) {
          [baseTheme, altTheme] = [altTheme, baseTheme];
      }
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "linogaliana/python-datascientist";
    script.dataset.repoId = "MDEwOlJlcG9zaXRvcnkyODAxNjE2Nzc=";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOELLtjc4B-5TX";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/modelisation/5_clustering.html" class="pagination-link" aria-label="Introduction à l'apprentissage non supervisé avec le clustering">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Introduction à l’apprentissage non supervisé avec le clustering</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../content/modelisation/7_mlapi.html" class="pagination-link" aria-label="Mettre à disposition un modèle par le biais d'une API">
        <span class="nav-page-text">Mettre à disposition un modèle par le biais d’une API</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Python pour la <em>data science</em>, Lino Galiana.<br>
Licence <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i><br>
Code source disponible sur <a href="https://github.com/linogaliana/python-datascientist"><code>Github</code></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/modelisation/6_pipeline.qmd" class="toc-action"><i class="bi bi-github"></i>Modifier cette page</a></li><li><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Site construit avec <i class="fa-brands fa-python" aria-label="python"></i> et <a href="https://quarto.org/"><code>Quarto</code></a><br>
<a href="https://github.com/linogaliana/python-datascientist">Code source disponible sur <i class="fa-brands fa-github" aria-label="github"></i> <code>GitHub</code></a></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>