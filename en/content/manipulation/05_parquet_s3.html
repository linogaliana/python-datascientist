<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lino Galiana">
<meta name="dcterms.date" content="2025-12-07">
<meta name="description" content="Parquet is a very popular data format, thanks to its technical characteristics (column orientation, compression, interoperability…), its open-source nature and the rich associated ecosystem, whose most prominent frameworks are Arrow and DuckDB. Added to these numerous advantages are native integration with cloud infrastructures based on S3, numerous extensions for handling complex data such as geographic data or, more recently, the WASM porting of DuckDB enabling responsive applications involving data transformations to be built directly from the browser.">

<title>New ways of accessing data: Parquet format and data in the cloud – Python for data science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d640c705e8c17715bca3574aa719063f.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-d6a2ae2cb249da1580f0a11f71b8f854.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-d640c705e8c17715bca3574aa719063f.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f595c2c98905acf06c0c277a3aa3c9e4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-a41da460afe5d53e97b4088847509a8d.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-f595c2c98905acf06c0c277a3aa3c9e4.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/iconify-3.0.0/iconify-icon.min.js"></script>
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #e9f3fa;
      }
</style>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles/styles.css">
<meta name="twitter:title" content="New ways of accessing data: Parquet format and data in the cloud – Python for data science">
<meta name="twitter:description" content="Le format Parquet est un format de données connaissant une popularité importante du fait de ses caractéristiques techniques (orientation colonne, compression, interopérabilité…), de sa nature open source et du riche écosystème associé dont les frameworks les plus proéminents sont Arrow et DuckDB. A ces nombreux avantages s’ajoutent une intégration native aux infrastructures cloud basées sur S3, des extensions nombreuses pour traiter des données complexes comme les données géographiques ou, plus récemment, le portage en WASM de DuckDB permettant de construire des applications réactives impliquant des transformations de données directement depuis le navigateur.">
<meta name="twitter:image" content="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/python_cloud.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="Python pour la data science">
<meta name="citation_author" content="Lino Galiana">
<meta name="citation_publication_date" content="2025">
<meta name="citation_cover_date" content="2025">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-12-07">
<meta name="citation_fulltext_html_url" content="https://pythonds.linogaliana.fr/">
<meta name="citation_doi" content="10.5281/zenodo.8229676">
<meta name="citation_language" content="en">
</head>

<body class="nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const queryPrefersDark = window.matchMedia('(prefers-color-scheme: dark)');
    const darkModeDefault = queryPrefersDark.matches;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    queryPrefersDark.addEventListener("change", e => {
      if(window.localStorage.getItem("quarto-color-scheme") !== null)
        return;
      const alternate = e.matches
      toggleColorMode(alternate);
      localAlternateSentinel = e.matches ? 'alternate' : 'default'; // this is used alongside local storage!
      toggleGiscusIfUsed(alternate, darkModeDefault);
    });
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="../../content/getting-started/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/01_environment.html">
 <span class="dropdown-text">A functional Python environment for data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/02_data_analysis.html">
 <span class="dropdown-text">How to deal with a data set</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/03_revisions.html">
 <span class="dropdown-text">A few refresher exercises to get back in the saddle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-wrangle" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Wrangle</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-wrangle">    
        <li>
    <a class="dropdown-item" href="../../content/manipulation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/01_numpy.html">
 <span class="dropdown-text">Numpy, the foundation of data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02_pandas_intro.html">
 <span class="dropdown-text">Introduction to Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02_pandas_suite.html">
 <span class="dropdown-text">Data wrangling with Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_intro.html">
 <span class="dropdown-text">Introduction to spatial data with Geopandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04a_webscraping_TP.html">
 <span class="dropdown-text">Web scraping with Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04c_API_TP.html">
 <span class="dropdown-text">Retrieve data with APIs from Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04b_regex_TP.html">
 <span class="dropdown-text">Mastering regular expressions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-communicate" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Communicate</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-communicate">    
        <li>
    <a class="dropdown-item" href="../../content/visualisation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/matplotlib.html">
 <span class="dropdown-text">Building graphics with Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/maps.html">
 <span class="dropdown-text">Introduction to cartography with Python</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-model" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Model</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-model">    
        <li>
    <a class="dropdown-item" href="../../content/modelisation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/0_preprocessing.html">
 <span class="dropdown-text">Preprocessing before building machine learning models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/1_modelevaluation.html">
 <span class="dropdown-text">Evaluating model quality</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/2_classification.html">
 <span class="dropdown-text">Discovering classification with the SVM technique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/3_regression.html">
 <span class="dropdown-text">An introduction to regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/4_featureselection.html">
 <span class="dropdown-text">Variable selection: an introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/5_clustering.html">
 <span class="dropdown-text">Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/6_pipeline.html">
 <span class="dropdown-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/7_mlapi.html">
 <span class="dropdown-text">Mettre à disposition un modèle par le biais d’une API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nlp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">NLP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nlp">    
        <li>
    <a class="dropdown-item" href="../../content/NLP/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/01_intro.html">
 <span class="dropdown-text">Cleaning and structuring information in textual data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/02_exoclean.html">
 <span class="dropdown-text">Frequentist analysis using the bag-of-words approach: forces and limitations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/03_embedding.html">
 <span class="dropdown-text">Synthetizing textual information with embeddings</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-git" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Git</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-git">    
        <li>
    <a class="dropdown-item" href="../../content/git/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/introgit.html">
 <span class="dropdown-text">Découvrir Git par la pratique: la gymnastique quotidienne</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/exogit.html">
 <span class="dropdown-text">Un cadavre exquis pour découvrir le travail collaboratif <code>Git</code></span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-annexes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Annexes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-annexes">    
        <li>
    <a class="dropdown-item" href="../../content/annexes/evaluation.html">
 <span class="dropdown-text">Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/annexes/corrections.html">
 <span class="dropdown-text">Corrections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://linogaliana.github.io/python-datascientist-slides/#/title-slide">
 <span class="dropdown-text">Slides de présentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/linogaliana/python-datascientist" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">New ways of accessing data: Parquet format and data in the cloud</h1>
                  <div>
        <div class="description">
          <p><code>Parquet</code> is a very popular data format, thanks to its technical characteristics (column orientation, compression, interoperability…), its open-source nature and the rich associated ecosystem, whose most prominent frameworks are <code>Arrow</code> and <code>DuckDB</code>. Added to these numerous advantages are native integration with cloud infrastructures based on <code>S3</code>, numerous extensions for handling complex data such as geographic data or, more recently, the WASM porting of <code>DuckDB</code> enabling responsive applications involving data transformations to be built directly from the browser.</p>
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Lino Galiana </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2025-12-07</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#contextual-elements" id="toc-contextual-elements" class="nav-link active" data-scroll-target="#contextual-elements"><span class="header-section-number">1</span> Contextual Elements</a>
  <ul class="collapse">
  <li><a href="#principles-of-data-storage" id="toc-principles-of-data-storage" class="nav-link" data-scroll-target="#principles-of-data-storage"><span class="header-section-number">1.1</span> Principles of Data Storage</a></li>
  <li><a href="#file-based-storage" id="toc-file-based-storage" class="nav-link" data-scroll-target="#file-based-storage"><span class="header-section-number">1.2</span> File-Based Storage</a>
  <ul class="collapse">
  <li><a href="#flat-files" id="toc-flat-files" class="nav-link" data-scroll-target="#flat-files"><span class="header-section-number">1.2.1</span> Flat Files</a></li>
  <li><a href="#hierarchical-files" id="toc-hierarchical-files" class="nav-link" data-scroll-target="#hierarchical-files"><span class="header-section-number">1.2.2</span> Hierarchical files</a></li>
  <li><a href="#data-split-across-multiple-files" id="toc-data-split-across-multiple-files" class="nav-link" data-scroll-target="#data-split-across-multiple-files"><span class="header-section-number">1.2.3</span> Data split across multiple files</a></li>
  <li><a href="#the-role-of-the-file-system" id="toc-the-role-of-the-file-system" class="nav-link" data-scroll-target="#the-role-of-the-file-system"><span class="header-section-number">1.2.4</span> The role of the <em>file system</em></a></li>
  </ul></li>
  <li><a href="#storing-data-in-a-database" id="toc-storing-data-in-a-database" class="nav-link" data-scroll-target="#storing-data-in-a-database"><span class="header-section-number">1.3</span> Storing Data in a Database</a>
  <ul class="collapse">
  <li><a href="#why-file-based-storage-is-gaining-popularity" id="toc-why-file-based-storage-is-gaining-popularity" class="nav-link" data-scroll-target="#why-file-based-storage-is-gaining-popularity">Why File-Based Storage is gaining popularity</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#the-parquet-format" id="toc-the-parquet-format" class="nav-link" data-scroll-target="#the-parquet-format"><span class="header-section-number">2</span> The <code>Parquet</code> format</a>
  <ul class="collapse">
  <li><a href="#limitations-of-the-csv-format" id="toc-limitations-of-the-csv-format" class="nav-link" data-scroll-target="#limitations-of-the-csv-format"><span class="header-section-number">2.1</span> Limitations of the <code>CSV</code> format</a></li>
  <li><a href="#the-rise-of-the-parquet-format" id="toc-the-rise-of-the-parquet-format" class="nav-link" data-scroll-target="#the-rise-of-the-parquet-format"><span class="header-section-number">2.2</span> The Rise of the <code>Parquet</code> Format</a></li>
  <li><a href="#a-format-designed-for-analysis-not-just-big-data" id="toc-a-format-designed-for-analysis-not-just-big-data" class="nav-link" data-scroll-target="#a-format-designed-for-analysis-not-just-big-data"><span class="header-section-number">2.3</span> A format designed for analysis — not just big data</a></li>
  <li><a href="#reading-a-parquet-file-in-python-example" id="toc-reading-a-parquet-file-in-python-example" class="nav-link" data-scroll-target="#reading-a-parquet-file-in-python-example"><span class="header-section-number">2.4</span> Reading a <code>Parquet</code> file in <code>Python</code>: example</a></li>
  <li><a href="#exercises-to-learn-more" id="toc-exercises-to-learn-more" class="nav-link" data-scroll-target="#exercises-to-learn-more"><span class="header-section-number">2.5</span> Exercises to Learn More</a></li>
  </ul></li>
  <li><a href="#data-in-the-cloud" id="toc-data-in-the-cloud" class="nav-link" data-scroll-target="#data-in-the-cloud"><span class="header-section-number">3</span> Data in the <em>Cloud</em></a>
  <ul class="collapse">
  <li><a href="#why-not-use-dropbox-or-google-drive" id="toc-why-not-use-dropbox-or-google-drive" class="nav-link" data-scroll-target="#why-not-use-dropbox-or-google-drive"><span class="header-section-number">3.1</span> Why Not Use <code>Dropbox</code> or <code>Google Drive</code>?</a></li>
  <li><a href="#the-s3-system" id="toc-the-s3-system" class="nav-link" data-scroll-target="#the-s3-system"><span class="header-section-number">3.2</span> The <code>S3</code> System</a>
  <ul class="collapse">
  <li><a href="#the-concept-of-a-bucket" id="toc-the-concept-of-a-bucket" class="nav-link" data-scroll-target="#the-concept-of-a-bucket"><span class="header-section-number">3.2.1</span> The Concept of a <em>Bucket</em></a></li>
  </ul></li>
  <li><a href="#how-to-do-it-with-python" id="toc-how-to-do-it-with-python" class="nav-link" data-scroll-target="#how-to-do-it-with-python"><span class="header-section-number">3.3</span> How to do it with Python?</a>
  <ul class="collapse">
  <li><a href="#key-libraries" id="toc-key-libraries" class="nav-link" data-scroll-target="#key-libraries"><span class="header-section-number">3.3.1</span> Key libraries</a></li>
  </ul></li>
  <li><a href="#practical-case-storing-your-projects-data-on-ssp-cloud" id="toc-practical-case-storing-your-projects-data-on-ssp-cloud" class="nav-link" data-scroll-target="#practical-case-storing-your-projects-data-on-ssp-cloud"><span class="header-section-number">3.4</span> Practical Case: Storing Your Project’s Data on SSP Cloud</a>
  <ul class="collapse">
  <li><a href="#sharing-files-on-ssp-cloud" id="toc-sharing-files-on-ssp-cloud" class="nav-link" data-scroll-target="#sharing-files-on-ssp-cloud"><span class="header-section-number">3.4.1</span> Sharing files on SSP Cloud</a></li>
  <li><a href="#retrieving-and-storing-data" id="toc-retrieving-and-storing-data" class="nav-link" data-scroll-target="#retrieving-and-storing-data"><span class="header-section-number">3.4.2</span> Retrieving and storing data</a></li>
  <li><a href="#using-the-data" id="toc-using-the-data" class="nav-link" data-scroll-target="#using-the-data"><span class="header-section-number">3.4.3</span> Using the data</a></li>
  </ul></li>
  <li><a href="#to-go-further" id="toc-to-go-further" class="nav-link" data-scroll-target="#to-go-further"><span class="header-section-number">3.5</span> To go further</a></li>
  <li><a href="#informations-additionnelles" id="toc-informations-additionnelles" class="nav-link" data-scroll-target="#informations-additionnelles">Informations additionnelles</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/manipulation/05_parquet_s3.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">

<script>
  const langButton = document.createElement("div");
  langButton.className = "lang-switch-button";
  langButton.style.textAlign = "right";
  langButton.style.marginTop = "1rem";
  langButton.style.marginBottom = "1rem";

  const currentPath = window.location.pathname;
  const isEnglish = currentPath.startsWith("/en/");
  let targetHref, label, svg;

  if (isEnglish) {
    targetHref = currentPath.replace(/^\/en\//, "/");
    label = "Passer à la version française";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangFr"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangFr)"><path fill="#0055A4" d="M0 0h512v512H0z"/><path fill="#fff" d="M170.7 0h170.6v512H170.7z"/><path fill="#EF4135" d="M341.3 0H512v512H341.3z"/></g></svg>`;
  } else {
    targetHref = "/en" + currentPath;
    label = "Switch to English version";
    svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="20" height="20" style="vertical-align: middle; margin-left: 0.5em; display: inline-block;"><mask id="circleFlagsLangEn"><circle cx="256" cy="256" r="256" fill="#fff"/></mask><g mask="url(#circleFlagsLangEn)"><path fill="#eee" d="M256 0L0 256v64l32 32l-32 32v128l22-8l23 8h23l54-32l54 32h32l48-32l48 32h32l54-32l54 32h68l-8-22l8-23v-23l-32-54l32-54v-32l-32-48l32-48v-32l-32-54l32-54V0z"/><path fill="#d80027" d="M224 64v64h160l64-64zm0 128l32 64l-48 48v208h96V304h208v-96H304l16-16zM0 320v64h128l-64 64H0v64h45l131-131v-45l16-16zm336 16l176 176v-45L381 336Z"/><path fill="#0052b4" d="M0 0v256h256V0zm512 68L404 176h108zM404 336l108 108V336zm-228 68L68 512h108zm160 0v108h108z"/><path fill="#eee" d="m187 243l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67zm162-81l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67zm-81 0l57-41H12l57 41l-22-67Zm162-82l57-41h-70l57 41l-22-67zm-81 0l57-41H93l57 41l-22-67Zm-81 0l57-41H12l57 41l-22-67Z"/></g></svg>`;
  }

  langButton.innerHTML = `
    <a href="${targetHref}" class="button-cta">
      <button class="btn"><i class="fa fa-language"></i> ${label} ${svg}</button>
    </a>
  `;

  const main = document.querySelector("main#quarto-document-content");
  if (main) main.insertAdjacentElement("afterbegin", langButton);
</script>
    






<div class="badge-container"><div class="badge-text">If you want to try the examples in this tutorial:</div><a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/en/manipulation/05_parquet_s3.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=github&amp;label=&amp;message=View%20on%20GitHub&amp;color=181717" alt="View on GitHub"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;name=«05_parquet_s3»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-vscode.sh»&amp;init.personalInitArgs=«en/manipulation%2005_parquet_s3»" target="_blank" rel="noopener"><img src="https://custom-icon-badges.demolab.com/badge/SSP%20Cloud-Lancer_avec_VSCode-blue?logo=vsc&amp;logoColor=white" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;name=«05_parquet_s3»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-jupyter.sh»&amp;init.personalInitArgs=«en/manipulation%2005_parquet_s3»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Lancer_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks-colab//en/blob/main//notebooks/en/manipulation/05_parquet_s3.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a><br></div>
<p>In the previous chapters, we explored how to retrieve and harmonize data from various source: CSV files, APIs, web scraping, and more. However, no overview of data access methods would be complete without mentioning a relatively recent addition to the data ecosystem: the <code>Parquet</code> data format.</p>
<p>Thanks to its technical advantages - specifically designed for analytical workloads - and its seamless integration with Python, <code>Parquet</code> is becoming increasingly essential. It has, in fact, become a key component of modern cloud infrastructures, which have emerged since the mid-2010s as the standard environment for data science workflows.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Objectives
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Understand the challenges involved in storing and processing different types of data formats<br>
</li>
<li>Distinguish between file-based storage and database systems<br>
</li>
<li>Discover <code>Parquet</code> format and its advantages over flat files and proprietary formats<br>
</li>
<li>Learn how to work with <code>Parquet</code> data using <code>Arrow</code> and <code>DuckDB</code><br>
</li>
<li>Explore the implications of cloud-based storage and how <code>Python</code> can adapt to modern data infrastructures</li>
</ul>
</div>
</div>
</div>
<section id="contextual-elements" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Contextual Elements</h1>
<section id="principles-of-data-storage" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="principles-of-data-storage"><span class="header-section-number">1.1</span> Principles of Data Storage</h2>
<p>Before exploring the advantages of the <code>Parquet</code> format, it is helpful to briefly review how data is stored and made accessible to a processing language like <code>Python</code><a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<p>Two main approaches coexist: <strong>file-based storage</strong> and <strong>relational database storage</strong>. The key distinction between these paradigms lies in how access to data is structured and managed.</p>
</section>
<section id="file-based-storage" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="file-based-storage"><span class="header-section-number">1.2</span> File-Based Storage</h2>
<section id="flat-files" class="level3" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="flat-files"><span class="header-section-number">1.2.1</span> Flat Files</h3>
<p>In a flat file, data is organized in a linear fashion, with values typically separated by a delimiter such as a comma, semicolon, or tab. Here’s a simple example using a <code>.csv</code> file:</p>
<pre class="raw"><code>nom ; profession 
Astérix ; 
Obélix ; Tailleur de menhir ;
Assurancetourix ; Barde</code></pre>
<p><code>Python</code> can easily structure this information:</p>
<div id="876e52c2" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">nom</th>
<th data-quarto-table-cell-role="th">profession</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Astérix</td>
<td></td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>Obélix</td>
<td>Tailleur de menhir</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Assurancetourix</td>
<td>Barde</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<ol type="1">
<li><code>StringIO</code> permet de traiter la chaîne de caractère comme le contenu d’un fichier.</li>
</ol>
<p>These are referred to as <strong>flat files</strong> because all the records related to a given observation are stored sequentially, without any hierarchical structure.</p>
</section>
<section id="hierarchical-files" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="hierarchical-files"><span class="header-section-number">1.2.2</span> Hierarchical files</h3>
<p>Other formats, such as <code>JSON</code>, structure data in a hierarchical way:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode json code-with-copy"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ot">[</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"nom"</span><span class="fu">:</span> <span class="st">"Astérix"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"nom"</span><span class="fu">:</span> <span class="st">"Obélix"</span><span class="fu">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"profession"</span><span class="fu">:</span> <span class="st">"Tailleur de menhir"</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">{</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"nom"</span><span class="fu">:</span> <span class="st">"Assurancetourix"</span><span class="fu">,</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">"profession"</span><span class="fu">:</span> <span class="st">"Barde"</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">}</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ot">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>In such cases, when information is missing - as in the line for <em>“Astérix”</em> - you don’t see two delimiters side by side. Instead, the missing data is simply left out.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Caution</span>Caution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The difference between a <code>.csv</code> file and a <code>JSON</code> file lies not only in their format but also in their underlying logic of data storage.</p>
<p><code>JSON</code> is a non-tabular format that offers greater flexibility: it allows the structure of the data to evolve over time without requiring previous entries to be modified or recompiled. This makes it particularly well-suited for dynamic data collection environments, such as APIs.</p>
<p>For instance, a website that begins collecting a new piece of information doesn’t need to retroactively update all prior records. It can simply add the new field to the relevant entries—omitting it from others where the information wasn’t collected.</p>
<p>It is then up to the query tool—such as <code>Python</code> or another platform—to reconcile and link data across these differing structures.</p>
<p>This flexible approach underpins many <code>NoSQL</code> databases (like <code>ElasticSearch</code>), which play a central role in the <em>big data</em> ecosystem.</p>
</div>
</div>
</div>
</section>
<section id="data-split-across-multiple-files" class="level3" data-number="1.2.3">
<h3 data-number="1.2.3" class="anchored" data-anchor-id="data-split-across-multiple-files"><span class="header-section-number">1.2.3</span> Data split across multiple files</h3>
<p>It is common for a single observation to be distributed across multiple files in different formats. In geomatics, for example, geographic boundaries are often stored separately from the data that gives them context:</p>
<ul>
<li>In some cases, everything is bundled into a single file that contains both the geographic shapes and the associated attribute values. This is the approach used by formats like <code>GeoJSON</code>;</li>
<li>In other cases, the data is split across several files, and reading the full information - geographic shapes, data for each zone, projection system, etc. - requires combining them. This is the case with the <code>Shapefile</code> format.</li>
</ul>
<p>When data is distributed across multiple files, this is up to the processing tool (e.g., <code>Python</code>) to perform the necessary joins and link the information together.</p>
</section>
<section id="the-role-of-the-file-system" class="level3" data-number="1.2.4">
<h3 data-number="1.2.4" class="anchored" data-anchor-id="the-role-of-the-file-system"><span class="header-section-number">1.2.4</span> The role of the <em>file system</em></h3>
<p>The <strong>file system</strong> enables the computer to locate files physically on the disk. It plays a central role in file management, handling file naming, folder hierarchy, and access permissions.</p>
</section>
</section>
<section id="storing-data-in-a-database" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="storing-data-in-a-database"><span class="header-section-number">1.3</span> Storing Data in a Database</h2>
<p>The logic behind databases differs fundamentally and is more systematic in nature. A <strong>relational database</strong> is managed by a <strong>Database Management System (DBMS)</strong>, which provides capabilities for:</p>
<ul>
<li>storing coherent datasets;</li>
<li>performing updates (insertions, deletions, modifications);</li>
<li>controlling access (user permissions, query types, etc.).</li>
</ul>
<p>Data is organized into <strong>tables</strong> connected by <strong>relationships</strong>, often structured according to a <strong>star schema</strong>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.databricks.com/wp-content/uploads/2022/04/star-schema-erd.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Source: Databricks Documentation"><img src="https://www.databricks.com/wp-content/uploads/2022/04/star-schema-erd.png" class="img-fluid figure-img" alt="Source: Databricks Documentation"></a></p>
<figcaption>Source: <a href="https://www.databricks.com/fr/glossary/star-schema">Databricks Documentation</a></figcaption>
</figure>
</div>
<p>The software managing the database links these tables together using <code>SQL</code> queries. One of the most powerful and widely used systems for this purpose is <a href="https://www.postgresql.org/"><code>PostgreSQL</code></a>.</p>
<p><code>Python</code> can interact with databases by issuing SQL queries. Historically, packages such as <a href="https://www.sqlalchemy.org/"><code>sqlalchemy</code></a> and <a href="https://www.psycopg.org/docs/"><code>psycopg2</code></a> have been standard tools for communicating with <code>PostgreSQL</code> databases, enabling both reading and updating operations. More recently, <a href="https://duckdb.org/"><code>DuckDB</code></a> has emerged as a lightweight and user-friendly alternative for querying relational data, and it will be discussed again in the context of the <code>Parquet</code> format.</p>
<section id="why-file-based-storage-is-gaining-popularity" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="why-file-based-storage-is-gaining-popularity">Why File-Based Storage is gaining popularity</h3>
<p>The increasing popularity of file-based storage in the data science ecosystem is due to a number of technical and practical advantages that make it well-suited for modern analytical workflows.</p>
<p>Files are generally more lightweight and easier to manage than databases. They do not require the installation or maintenance of specialized software; a basic file system, available on every operating system, is sufficient for accessing them.</p>
<p>Reading a file in <code>Python</code> simply involves using a library such as <code>Pandas</code>. In contrast, interacting with a database typically requires:</p>
<ul>
<li>installing and configuring a DBMS (e.g., <code>PostgreSQL</code>, <code>MySQL</code>);</li>
<li>managing network connections;</li>
<li>relying on libraries such as <code>sqlalchemy</code> or <code>psycopg2</code>.</li>
</ul>
<p>This additional complexity makes file-based workflows more flexible and faster for exploratory tasks.</p>
<p>However, this simplicity comes with limitations. File-based systems generally lack fine-grained access control. For instance, preventing a user from modifying or deleting a file is difficult without duplicating it and working from a copy. This represents a constraint in multi-user environments, although cloud-based storage solutions — particularly <code>S3</code> technology, which will be addressed later — offer effective remedies.</p>
<p>The primary reason why files are often preferred over DBMSs lies in the nature of the operations being performed. Relational databases are particularly well-suited for contexts involving frequent updates or complex operations on structured data — a typical <strong>application logic</strong>, in which data is continuously evolving (through insertions, updates, or deletions).</p>
<p>By contrast, in <strong>analytical</strong> contexts, the focus is on reading and temporarily manipulating data without altering the original source. The objective is to query, aggregate, and filter — not to persist changes. In such scenarios, files (especially when stored in optimized formats like <code>Parquet</code>) are ideal: they offer fast read times, high portability, and eliminate the overhead associated with running a full database engine.</p>
</section>
</section>
</section>
<section id="the-parquet-format" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The <code>Parquet</code> format</h1>
<p>The <code>CSV</code> format has long been popular for its simplicity:</p>
<ul>
<li>It is <strong>human-readable</strong> (any text editor can open it);</li>
<li>It relies on a <strong>simple tabular structure</strong>, well-suited for many analytical situations;</li>
<li>It is <strong>universal</strong> and interoperable, as it is not tied to any specific software.</li>
</ul>
<p>However, this simplicity comes at a cost. Several limitations of the <code>CSV</code> format have led to the emergence of more efficient formats for data analysis, such as <code>Parquet</code>.</p>
<section id="limitations-of-the-csv-format" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="limitations-of-the-csv-format"><span class="header-section-number">2.1</span> Limitations of the <code>CSV</code> format</h2>
<p>CSV is a <strong>heavy</strong> format:</p>
<ul>
<li>It is not compressed, increasing its disk size;</li>
<li>All data is stored as raw text. Data type optimization (integer, float, string, etc.) is deferred to the importing library (like <code>Pandas</code>), which must <strong>scan the data</strong> at load time—slowing down performance and increasing error risk.</li>
</ul>
<p>CSV is <strong>row-oriented</strong>:</p>
<ul>
<li>To access a specific column, every <strong>row must be read</strong>, and the relevant column extracted;</li>
<li>This model performs poorly when only a <strong>subset of columns</strong> is needed—a common case in data science.</li>
</ul>
<p>CSV is <strong>expensive to modify</strong>:</p>
<ul>
<li><p>Adding a column or inserting intermediate data requires <strong>rewriting the entire file</strong>. For example, adding a <code>hair</code> column would mean generating a new version of the file:</p>
<pre class="raw"><code>name ; hair ; profession
Asterix ; blond ; 
Obelix ; redhead ; Menhir sculptor
Assurancetourix ; blond ; Bard</code></pre></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>About proprietary formats
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Most data science tools offer their own serialization formats:</p>
<ul>
<li><code>.pickle</code> for <code>Python</code>,<br>
</li>
<li><code>.rda</code> or <code>.RData</code> for <code>R</code>,<br>
</li>
<li><code>.dta</code> for <code>Stata</code>,<br>
</li>
<li><code>.sas7bdat</code> for <code>SAS</code>.</li>
</ul>
<p>However, these formats are <strong>proprietary</strong> or <strong>tightly coupled to one language</strong>, which raises interoperability issues. For example, <code>Python</code> cannot natively read <code>.sas7bdat</code>. Even when third-party libraries exist, the lack of official documentation makes support unreliable.</p>
<p>In this regard, despite its limitations, <code>.csv</code> remains popular for its universality. But the <code>Parquet</code> format offers both this portability and significantly better performance.</p>
</div>
</div>
</div>
</section>
<section id="the-rise-of-the-parquet-format" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="the-rise-of-the-parquet-format"><span class="header-section-number">2.2</span> The Rise of the <code>Parquet</code> Format</h2>
<p>To address these limitations, the <code>Parquet</code> format—developed as an <a href="https://parquet.apache.org/">Apache open-source project</a> offers a radically different approach.</p>
<p>Its key characteristic: it is <strong>column-oriented</strong>. Unlike CSVs, data for each column is stored <strong>separately</strong>. This allows:</p>
<ul>
<li>loading only the columns relevant for analysis;</li>
<li>more efficient data compression;</li>
<li>significantly faster selective queries.</li>
</ul>
<p>Here’s a diagram from the <a href="https://www.upsolver.com/blog/apache-parquet-why-use">Upsolver blog</a> illustrating the difference between row-based and columnar storage:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.upsolver.com/wp-content/uploads/2020/05/Screen-Shot-2020-05-26-at-17.52.58.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Parquet vs CSV"><img src="https://www.upsolver.com/wp-content/uploads/2020/05/Screen-Shot-2020-05-26-at-17.52.58.png" class="img-fluid figure-img" alt="Parquet vs CSV"></a></p>
<figcaption>Parquet vs CSV</figcaption>
</figure>
</div>
<p>In our example, you could read the <code>profession</code> column without parsing names, making access faster (ignore the <code>pyarrow.Table</code> element—we’ll return to it later):</p>
<div id="ca8b6ef3" class="cell" data-execution_count="2">
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>pyarrow.Table
nom : string
profession: string
----
nom : [["Astérix ","Obélix ","Assurancetourix "]]
profession: [["","Tailleur de menhir","Barde"]]</code></pre>
</div>
</div>
<p>Thanks to the column-oriented structure, it is possible to read only a single variable (such as <code>profession</code>) without having to scan every row in the file.</p>
<pre class="raw"><code>path
└── to
    └── table
        ├── gender=male
        │   ├── country=US
        │   │   └── data.parquet
        │   ├── country=CN
        │   │   └── data.parquet
        └── gender=female
            ├── country=US
            │   └── data.parquet
            ├── country=CN
            │   └── data.parquet</code></pre>
<p>When read, the entire dataset is reconstructed into a tabular format:</p>
<pre class="raw"><code>root
|-- name: string (nullable = true)
|-- age: long (nullable = true)
|-- gender: string (nullable = true)
|-- country: string (nullable = true)</code></pre>
</section>
<section id="a-format-designed-for-analysis-not-just-big-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="a-format-designed-for-analysis-not-just-big-data"><span class="header-section-number">2.3</span> A format designed for analysis — not just big data</h2>
<p>As emphasized in the Upsolver blog:</p>
<blockquote class="blockquote">
<p><em>Complex data such as logs and event streams would need to be represented as a table with hundreds or thousands of columns, and many millions of rows. Storing this table in a row-based format such as CSV would mean:</em></p>
<ul>
<li><em>Queries will take longer to run since more data needs to be scanned…</em></li>
<li><em>Storage will be more costly since CSVs are not compressed as efficiently as Parquet</em></li>
</ul>
</blockquote>
<p>However, the <code>Parquet</code> format <strong>is not limited to <em>big data</em> architectures</strong>. Its advantages are accessible to anyone who produces or works with datasets, regardless of scale:</p>
<ul>
<li>significantly reduced file sizes;</li>
<li>fast, reliable, and memory-efficient data import.</li>
</ul>
<!---

fin traduction pour le moment

---->
<p>The translation of this chapter is still in progress. The remaining sections will be available soon.</p>
</section>
<section id="reading-a-parquet-file-in-python-example" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="reading-a-parquet-file-in-python-example"><span class="header-section-number">2.4</span> Reading a <code>Parquet</code> file in <code>Python</code>: example</h2>
<p>There are many libraries that integrate well with the <code>Parquet</code> format, but the two most important to know are <code>PyArrow</code> and <code>DuckDB</code>. These libraries were previously mentioned as alternatives to <code>Pandas</code> for handling larger-than-memory datasets. They are often used to perform heavy initial operations before converting the results into a lightweight <code>pd.DataFrame</code> for further analysis.</p>
<p>The <a href="https://arrow.apache.org/docs/python/"><code>PyArrow</code></a> library enables efficient reading and writing of <code>Parquet</code> files by taking advantage of their columnar structure<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. It operates on a <code>pyarrow.Table</code> object, which—after processing—can be converted to a <code>Pandas</code> <code>DataFrame</code> to leverage the broader capabilities of the <code>Pandas</code> ecosystem.</p>
<p>The <a href="https://duckdb.org/docs/api/python/"><code>DuckDB</code></a> library allows you to query <code>Parquet</code> files directly using <code>SQL</code>, without loading the entire file into memory. In essence, it brings the database philosophy (structured queries via SQL) to file-based storage. The results of such queries can also be converted into a <code>Pandas</code> <code>DataFrame</code>, combining the convenience of <code>Pandas</code> with the efficiency of an embedded SQL engine.</p>
<p>A lesser-known but valuable feature of <code>DuckDB</code> is its ability to perform SQL queries directly on a <code>Pandas</code> <code>DataFrame</code>. This can be especially useful when <code>Pandas</code> syntax becomes verbose or cumbersome—for example, when computing a new column based on grouped statistics, where SQL expressions can be more concise and readable.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Tip
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Using <code>pa</code> for <code>pyarrow</code> and <code>pq</code> for <code>pyarrow.parquet</code> is a widely adopted convention, much like using <code>pd</code> for <code>pandas</code>.</p>
</div>
</div>
</div>
<p>To demonstrate these features, we will use a dataset derived from the synthetic census data published by Insee, the French national statistics agency.</p>
<div id="eeb02c47" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.parquet <span class="im">as</span> pq</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Example Parquet</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://minio.lab.sspcloud.fr/projet-formation/bonnes-pratiques/data/RPindividus/REGION=93/part-0.parquet"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Télécharger le fichier et l'enregistrer en local</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"example.parquet"</span>, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    f.write(response.content)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" href=""><code>Arrow</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false" href=""><code>DuckDB</code></a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>To fully benefit from the optimizations provided by the <code>Parquet</code> format, it is recommended to use <code>pyarrow.dataset</code>. This approach makes it possible to take full advantage of the performance gains offered by the combination of <code>Parquet</code> and <code>Arrow</code>, which are not always accessible when reading <code>Parquet</code> files using other methods available in the <code>Arrow</code> ecosystem (as will be explored in upcoming exercises).</p>
<div id="0f085d00" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.dataset <span class="im">as</span> ds</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> ds.dataset(</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"example.parquet"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>).scanner(columns <span class="op">=</span> [<span class="st">"AGED"</span>, <span class="st">"IPONDI"</span>, <span class="st">"DEPT"</span>])</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> dataset.to_table()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>table</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>pyarrow.Table
AGED: int32
IPONDI: double
DEPT: dictionary&lt;values=string, indices=int32, ordered=0&gt;
----
AGED: [[9,12,40,70,52,...,29,66,72,75,77],[46,76,46,32,2,...,7,5,37,29,4],...,[67,37,45,56,75,...,64,37,47,20,18],[16,25,51,6,11,...,93,90,92,21,65]]
IPONDI: [[2.73018871840726,2.73018871840726,2.73018871840726,0.954760150327854,3.75907197064638,...,3.27143319621654,4.83980378599556,4.83980378599556,4.83980378599556,4.83980378599556],[3.02627578376137,3.01215358930406,3.01215358930406,2.93136309038958,2.93136309038958,...,2.96848755763453,2.96848755763453,3.25812879950072,3.25812879950072,1.12514509319438],...,[2.57931132917563,2.85579410739065,0.845993555838931,2.50296716736141,3.70786113613679,...,3.08375347880892,2.88038807573222,3.22776230929947,3.22776230929947,3.22776230929947],[3.22776230929947,3.22776230929947,3.22776230929947,3.29380242174036,3.29380242174036,...,5.00000768518755,5.00000768518755,5.00000768518755,5.00000768518755,1.00000153703751]]
DEPT: [  -- dictionary:
["01","02","03","04","05",...,"95","971","972","973","974"]  -- indices:
[5,5,5,5,5,...,5,5,5,5,5],  -- dictionary:
["01","02","03","04","05",...,"95","971","972","973","974"]  -- indices:
[5,5,5,5,5,...,5,5,5,5,5],...,  -- dictionary:
["01","02","03","04","05",...,"95","971","972","973","974"]  -- indices:
[84,84,84,84,84,...,84,84,84,84,84],  -- dictionary:
["01","02","03","04","05",...,"95","971","972","973","974"]  -- indices:
[84,84,84,84,84,...,84,84,84,84,84]]</code></pre>
</div>
</div>
<p>To import and process these data, one can either keep the data in <code>pyarrow.Table</code> format or convert it into a <code>pandas.DataFrame</code>. The second option is slower but has the advantage of enabling all the manipulations offered by the <code>pandas</code> ecosystem, which is generally more familiar than that of <code>Arrow</code>.</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div id="b00d7f9d" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>duckdb.sql(<span class="st">"""</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="st">FROM read_parquet('example.parquet')</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="st">SELECT AGED, IPONDI, DEPT</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>┌───────┬───────────────────┬─────────┐
│ AGED  │      IPONDI       │  DEPT   │
│ int32 │      double       │ varchar │
├───────┼───────────────────┼─────────┤
│     9 │  2.73018871840726 │ 06      │
│    12 │  2.73018871840726 │ 06      │
│    40 │  2.73018871840726 │ 06      │
│    70 │ 0.954760150327854 │ 06      │
│    52 │  3.75907197064638 │ 06      │
│    82 │  3.21622922493506 │ 06      │
│     6 │  3.44170061276923 │ 06      │
│    12 │  3.44170061276923 │ 06      │
│    15 │  3.44170061276923 │ 06      │
│    43 │  3.44170061276923 │ 06      │
│     · │          ·        │ ·       │
│     · │          ·        │ ·       │
│     · │          ·        │ ·       │
│    68 │  2.73018871840726 │ 06      │
│    35 │  3.46310256220757 │ 06      │
│     2 │  3.46310256220757 │ 06      │
│    37 │  3.46310256220757 │ 06      │
│    84 │  3.69787960424482 │ 06      │
│    81 │   4.7717265388427 │ 06      │
│    81 │   4.7717265388427 │ 06      │
│    51 │  3.60566450823737 │ 06      │
│    25 │  3.60566450823737 │ 06      │
│    13 │  3.60566450823737 │ 06      │
├───────┴───────────────────┴─────────┤
│    ? rows (&gt;9999 rows, 20 shown)    │
└─────────────────────────────────────┘</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="exercises-to-learn-more" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="exercises-to-learn-more"><span class="header-section-number">2.5</span> Exercises to Learn More</h2>
<p>The following is a series of exercises adapted from the <a href="https://ensae-reproductibilite.github.io/website/chapters/big-data.html#sec-new-formats">production deployment of data science projects</a> course, which Romain Avouac and I teach in the final year of the engineering program at ENSAE.</p>
<p>These exercises progressively illustrate some of the key concepts discussed above, while also emphasizing best practices for working with large-scale data. Solutions to all exercises are available on the corresponding course page.</p>
<p>In this practical section, we will explore how to use the <code>Parquet</code> format as efficiently as possible. To compare different data formats and access strategies, we will <strong>measure and compare the execution time and memory usage of a standard query</strong>. We will begin with a lightweight example that compares the performance of reading data in <code>CSV</code> versus <code>Parquet</code> format.</p>
<p>To do so, we will first retrieve a dataset in <code>Parquet</code> format. We suggest using the detailed and anonymized French population census data, which contains approximately 20 million rows and 80 columns. The code to download and access this dataset is provided below.</p>
<div id="6c18ba10" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Program to retrieve exercise dataset</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="annotated-cell-26"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-26-1"><a href="#annotated-cell-26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.parquet <span class="im">as</span> pq</span>
<span id="annotated-cell-26-2"><a href="#annotated-cell-26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow <span class="im">as</span> pa</span>
<span id="annotated-cell-26-3"><a href="#annotated-cell-26-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="annotated-cell-26-4"><a href="#annotated-cell-26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-5"><a href="#annotated-cell-26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Définir le fichier de destination</span></span>
<span id="annotated-cell-26-6"><a href="#annotated-cell-26-6" aria-hidden="true" tabindex="-1"></a>filename_table_individu <span class="op">=</span> <span class="st">"data/RPindividus.parquet"</span></span>
<span id="annotated-cell-26-7"><a href="#annotated-cell-26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-8"><a href="#annotated-cell-26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Copier le fichier depuis le stockage distant (remplacer par une méthode adaptée si nécessaire)</span></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-26" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-26-9" class="code-annotation-target"><a href="#annotated-cell-26-9" aria-hidden="true" tabindex="-1"></a>os.system(<span class="st">"mc cp s3/projet-formation/bonnes-pratiques/data/RPindividus.parquet data/RPindividus.parquet"</span>)</span>
<span id="annotated-cell-26-10"><a href="#annotated-cell-26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-11"><a href="#annotated-cell-26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Charger le fichier Parquet</span></span>
<span id="annotated-cell-26-12"><a href="#annotated-cell-26-12" aria-hidden="true" tabindex="-1"></a>table <span class="op">=</span> pq.read_table(filename_table_individu)</span>
<span id="annotated-cell-26-13"><a href="#annotated-cell-26-13" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> table.to_pandas()</span>
<span id="annotated-cell-26-14"><a href="#annotated-cell-26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-15"><a href="#annotated-cell-26-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Filtrer les données pour REGION == "24"</span></span>
<span id="annotated-cell-26-16"><a href="#annotated-cell-26-16" aria-hidden="true" tabindex="-1"></a>df_filtered <span class="op">=</span> df.loc[df[<span class="st">"REGION"</span>] <span class="op">==</span> <span class="st">"24"</span>]</span>
<span id="annotated-cell-26-17"><a href="#annotated-cell-26-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-18"><a href="#annotated-cell-26-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Sauvegarder en CSV</span></span>
<span id="annotated-cell-26-19"><a href="#annotated-cell-26-19" aria-hidden="true" tabindex="-1"></a>df_filtered.to_csv(<span class="st">"data/RPindividus_24.csv"</span>, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="annotated-cell-26-20"><a href="#annotated-cell-26-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-26-21"><a href="#annotated-cell-26-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Sauvegarder en Parquet</span></span>
<span id="annotated-cell-26-22"><a href="#annotated-cell-26-22" aria-hidden="true" tabindex="-1"></a>pq.write_table(pa.Table.from_pandas(df_filtered), <span class="st">"data/RPindividus_24.parquet"</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-26" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-26" data-code-lines="9" data-code-annotation="1">This line of code uses the Minio Client utility available on the <code>SSPCloud</code>. If you’re not on this infrastructure, please refer to the dedicated box.</span>
</dd>
</dl>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>If you are not on SSPCloud
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>You will need to replace the line</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>os.system(<span class="st">"mc cp s3/projet-formation/bonnes-pratiques/data/RPindividus.parquet data/RPindividus.parquet"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>which uses the <code>mc</code> command-line tool, with code that downloads this data from the URL <a href="https://projet-formation.minio.lab.sspcloud.fr/bonnes-pratiques/data/RPindividus.parquet">https://projet-formation.minio.lab.sspcloud.fr/bonnes-pratiques/data/RPindividus.parquet</a>.</p>
<p>There are many ways to do this. For instance, you can use plain <code>Python</code> with <code>requests</code>. If you have <code>curl</code> installed, you can use it as well. Via <code>Python</code>, this would translate to the command: <code>os.system("curl -o data/RPindividus.parquet https://projet-formation/bonnes-pratiques/data/RPindividus.parquet")</code>.</p>
</div>
</div>
</div>
<p>These exercises will make use of <code>Python</code> decorators - functions that modify or extend the behavior of other functions. In our case, we will define a function that performs a series of operations, and then apply a decorator to it that tracks both memory usage and execution time.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Part 1: From CSV to Parquet
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Create a notebook named <code>benchmark_parquet.ipynb</code> to perform various performance comparisons throughout the application.<br>
</li>
<li>Define a custom decorator that will be used to benchmark the <code>Python</code> code by measuring execution time and memory usage.</li>
</ul>
<details>
<summary>
Click to expand and view the code for the performance-measuring decorator.
</summary>
<p>::: {#15dc94e5 .cell execution_count=11}
``` {.python .cell-code}
import time
from memory_profiler import memory_usage
from functools import wraps
import warnings</p>
<pre><code>def convert_size(size_bytes):
if size_bytes == 0:
    return "0B"
size_name = ("B", "KB", "MB", "GB", "TB", "PB", "EB", "ZB", "YB")
i = int(math.floor(math.log(size_bytes, 1024)))
p = math.pow(1024, i)
s = round(size_bytes / p, 2)
return "%s %s" % (s, size_name[i])

# Decorator to measure execution time and memory usage
def measure_performance(func, return_output=False):
    @wraps(func)
    def wrapper(return_output=False, *args, **kwargs):
        warnings.filterwarnings("ignore")
        start_time = time.time()
        mem_usage = memory_usage((func, args, kwargs), interval=0.1)
        end_time = time.time()
        warnings.filterwarnings("always")

        exec_time = end_time - start_time
        peak_mem = max(mem_usage)  # Peak memory usage
        exec_time_formatted = f"\033[92m{exec_time:.4f} sec\033[0m"
        peak_mem_formatted = f"\033[92m{convert_size(1024*peak_mem)}\033[0m"

        print(f"{func.__name__} - Execution Time: {exec_time_formatted} | Peak Memory Usage: {peak_mem_formatted}")
        if return_output is True:
            return func(*args, **kwargs)

    return wrapper</code></pre>
<pre><code>:::


&lt;/details&gt;

* Reuse this code to wrap the logic for constructing the age pyramid into a function named `process_csv_appli1`.

&lt;details&gt;

&lt;summary&gt;
Click to expand and view the code used to measure the performance of reading CSV files.
&lt;/summary&gt;


::: {#9405ceb3 .cell execution_count=12}
``` {.python .cell-code}
# Apply the decorator to functions
@measure_performance
def process_csv_appli1(*args, **kwargs):
    df = pd.read_csv("data/RPindividus_24.csv")
    return (
        df.loc[df["DEPT"] == 36]
        .groupby(["AGED", "DEPT"])["IPONDI"]
        .sum().reset_index()
        .rename(columns={"IPONDI": "n_indiv"})
    )</code></pre>
<p>:::</p>
</details>
<ul>
<li><p>Run <code>process_csv_appli1()</code> and <code>process_csv_appli1(return_output=True)</code> to observe performance and optionally return the processed data.</p></li>
<li><p>Using the same approach, define a new function named <code>process_parquet_appli1</code>, this time based on the <code>data/RPindividus_24.parquet</code> file, and load it using <code>Pandas</code>’ <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_parquet.html"><code>read_parquet</code></a> function.</p></li>
<li><p>Compare the performance (execution time and memory usage) of the two methods using the benchmarking decorator.</p></li>
</ul>
<details>
<summary>
Full correction
</summary>
<div id="c802ab4b" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> memory_profiler <span class="im">import</span> memory_usage</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> wraps</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> convert_size(size_bytes):</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> size_bytes <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>       <span class="cf">return</span> <span class="st">"0B"</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>   size_name <span class="op">=</span> (<span class="st">"B"</span>, <span class="st">"KB"</span>, <span class="st">"MB"</span>, <span class="st">"GB"</span>, <span class="st">"TB"</span>, <span class="st">"PB"</span>, <span class="st">"EB"</span>, <span class="st">"ZB"</span>, <span class="st">"YB"</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>   i <span class="op">=</span> <span class="bu">int</span>(math.floor(math.log(size_bytes, <span class="dv">1024</span>)))</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>   p <span class="op">=</span> math.<span class="bu">pow</span>(<span class="dv">1024</span>, i)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>   s <span class="op">=</span> <span class="bu">round</span>(size_bytes <span class="op">/</span> p, <span class="dv">2</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> <span class="st">"</span><span class="sc">%s</span><span class="st"> </span><span class="sc">%s</span><span class="st">"</span> <span class="op">%</span> (s, size_name[i])</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Decorator to measure execution time and memory usage</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> measure_performance(func, return_output<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">@wraps</span>(func)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> wrapper(return_output<span class="op">=</span><span class="va">False</span>, <span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>        warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>        start_time <span class="op">=</span> time.time()</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>        mem_usage <span class="op">=</span> memory_usage((func, args, kwargs), interval<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>        end_time <span class="op">=</span> time.time()</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>        warnings.filterwarnings(<span class="st">"always"</span>)</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>        exec_time <span class="op">=</span> end_time <span class="op">-</span> start_time</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        peak_mem <span class="op">=</span> <span class="bu">max</span>(mem_usage)  <span class="co"># Peak memory usage</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>        exec_time_formatted <span class="op">=</span> <span class="ss">f"</span><span class="ch">\033</span><span class="ss">[92m</span><span class="sc">{</span>exec_time<span class="sc">:.4f}</span><span class="ss"> sec</span><span class="ch">\033</span><span class="ss">[0m"</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        peak_mem_formatted <span class="op">=</span> <span class="ss">f"</span><span class="ch">\033</span><span class="ss">[92m</span><span class="sc">{</span>convert_size(<span class="dv">1024</span><span class="op">*</span>peak_mem)<span class="sc">}</span><span class="ch">\033</span><span class="ss">[0m"</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>func<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss"> - Execution Time: </span><span class="sc">{</span>exec_time_formatted<span class="sc">}</span><span class="ss"> | Peak Memory Usage: </span><span class="sc">{</span>peak_mem_formatted<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> return_output <span class="kw">is</span> <span class="va">True</span>:</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> func(<span class="op">*</span>args, <span class="op">**</span>kwargs)</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> wrapper</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the decorator to functions</span></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_csv(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(<span class="st">"data/RPindividus_24.csv"</span>)</span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"DEPT"</span>] <span class="op">==</span> <span class="dv">36</span>]</span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>])[<span class="st">"IPONDI"</span>]</span>
<span id="cb15-45"><a href="#cb15-45" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">sum</span>().reset_index()</span>
<span id="cb15-46"><a href="#cb15-46" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span>{<span class="st">"IPONDI"</span>: <span class="st">"n_indiv"</span>})</span>
<span id="cb15-47"><a href="#cb15-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-48"><a href="#cb15-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-49"><a href="#cb15-49" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb15-50"><a href="#cb15-50" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_parquet(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb15-51"><a href="#cb15-51" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_parquet(<span class="st">"data/RPindividus_24.parquet"</span>)</span>
<span id="cb15-52"><a href="#cb15-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb15-53"><a href="#cb15-53" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"DEPT"</span>] <span class="op">==</span> <span class="st">"36"</span>]</span>
<span id="cb15-54"><a href="#cb15-54" aria-hidden="true" tabindex="-1"></a>        .groupby([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>])[<span class="st">"IPONDI"</span>]</span>
<span id="cb15-55"><a href="#cb15-55" aria-hidden="true" tabindex="-1"></a>        .<span class="bu">sum</span>().reset_index()</span>
<span id="cb15-56"><a href="#cb15-56" aria-hidden="true" tabindex="-1"></a>        .rename(columns<span class="op">=</span>{<span class="st">"IPONDI"</span>: <span class="st">"n_indiv"</span>})</span>
<span id="cb15-57"><a href="#cb15-57" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-58"><a href="#cb15-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-59"><a href="#cb15-59" aria-hidden="true" tabindex="-1"></a>process_csv()</span>
<span id="cb15-60"><a href="#cb15-60" aria-hidden="true" tabindex="-1"></a>process_parquet()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</details>
</div>
</div>
</div>
<p><em>❓️ What seems to be the limitation of the <code>read_parquet</code> function?</em></p>
<p>Although we already observe a significant speed improvement during file reading, we are not fully leveraging the optimizations provided by the <code>Parquet</code> format. This is because the data is immediately loaded into a <code>Pandas</code> <code>DataFrame</code>, where transformations are applied afterward.</p>
<p>As a result, we miss out on one of <code>Parquet</code>’s core performance features: <strong>predicate pushdown</strong>. This optimization allows filters to be applied as early as possible—at the file scan level—so that only the relevant columns and rows are read into memory. By bypassing this mechanism, we lose much of what makes <code>Parquet</code> so efficient in analytical workflows.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Part 2: Leveraging Lazy Evaluation and the Optimizations of Arrow or DuckDB
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>In the previous section, we observed a <strong>significant improvement in read times</strong> when switching from <code>CSV</code> to <code>Parquet</code>. However, <strong>memory usage remained high</strong>, even though only a small portion of the data was actually used.</p>
<p>In this section, we will explore how to take advantage of <strong><em>lazy evaluation</em></strong> and <strong>execution plan optimizations</strong> offered by <code>Arrow</code> to fully unlock the performance benefits of the <code>Parquet</code> format.</p>
<ul>
<li>Open the file <code>data/RPindividus_24.parquet</code> using <a href="https://arrow.apache.org/docs/python/dataset.html"><code>pyarrow.dataset</code></a>. Check the class of the resulting object.</li>
<li>Run the code below to read a sample of the data:</li>
</ul>
<div id="9b741173" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    dataset.scanner()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">5</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .to_pandas()</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Can you identify the difference compared to the previous approach? Consult the documentation for the <code>to_table</code> method—do you understand what it does and why it matters?</p>
<ul>
<li><p>Create a function <code>summarize_parquet_arrow</code> (and a corresponding <code>summarize_parquet_duckdb</code>) that imports the data using <a href="https://arrow.apache.org/docs/python/dataset.html"><code>pyarrow.dataset</code></a> (or <code>DuckDB</code>) and performs the required aggregation.</p></li>
<li><p>Use the benchmarking decorator to compare the performance (execution time and memory usage) of the three approaches: reading and processing <code>Parquet</code> data using <code>Pandas</code>, <code>PyArrow</code>, and <code>DuckDB</code>.</p></li>
</ul>
<details>
<summary>
Correction
</summary>
<div id="7c38a5c8" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code complet de l’application</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.dataset <span class="im">as</span> ds</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_parquet_duckdb(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    con <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">":memory:"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM read_parquet('data/RPindividus_24.parquet')</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT AGED, DEPT, SUM(IPONDI) AS n_indiv</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY AGED, DEPT</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (con.sql(query).to_df())</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_parquet_arrow(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> ds.dataset(<span class="st">"data/RPindividus_24.parquet"</span>, <span class="bu">format</span><span class="op">=</span><span class="st">"parquet"</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> dataset.to_table()</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>    grouped_table <span class="op">=</span> (</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        table</span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        .group_by([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>])</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        .aggregate([(<span class="st">"IPONDI"</span>, <span class="st">"sum"</span>)])</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        .rename_columns([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>, <span class="st">"n_indiv"</span>])</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        .to_pandas()</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        grouped_table</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>process_parquet()</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>summarize_parquet_duckdb()</span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>summarize_parquet_arrow()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</details>
</div>
</div>
</div>
<p>With lazy evaluation, the process unfolds in several stages:</p>
<ul>
<li><code>Arrow</code> or <code>DuckDB</code> receives a set of instructions, builds an execution plan, optimizes it, and then executes the query;</li>
<li>Only the final result of this pipeline is returned to <code>Python</code>, rather than the entire dataset.</li>
</ul>
<p><a href="https://linogaliana.github.io/parquet-recensement-tutomate/img/duckdb-delegation1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="https://linogaliana.github.io/parquet-recensement-tutomate/img/duckdb-delegation1.png" class="img-fluid"></a></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Part 3a: What Happens When We Filter Rows?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Let us now add a row-level filtering step to our queries:</p>
<ul>
<li><p>With <code>DuckDB</code>, modify the SQL query to include a <code>WHERE</code> clause:<br>
<code>WHERE DEPT IN ('18', '28', '36')</code></p></li>
<li><p>With <code>Arrow</code>, update the <code>to_table</code> call as follows:<br>
<code>dataset.to_table(filter=pc.field("DEPT").isin(['18', '28', '36']))</code></p></li>
</ul>
<div id="5c69be72" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Correction</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.dataset <span class="im">as</span> ds</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.compute <span class="im">as</span> pc</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_filter_parquet_arrow(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> ds.dataset(<span class="st">"data/RPindividus.parquet"</span>, <span class="bu">format</span><span class="op">=</span><span class="st">"parquet"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> dataset.to_table(<span class="bu">filter</span><span class="op">=</span>pc.field(<span class="st">"DEPT"</span>).isin([<span class="st">'18'</span>, <span class="st">'28'</span>, <span class="st">'36'</span>]))</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    grouped_table <span class="op">=</span> (</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        table</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        .group_by([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>])</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        .aggregate([(<span class="st">"IPONDI"</span>, <span class="st">"sum"</span>)])</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        .rename_columns([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>, <span class="st">"n_indiv"</span>])</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>        .to_pandas()</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>        grouped_table</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_filter_parquet_duckdb(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    con <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">":memory:"</span>)</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM read_parquet('data/RPindividus_24.parquet')</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT AGED, DEPT, SUM(IPONDI) AS n_indiv</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE DEPT IN ('11','31','34')</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY AGED, DEPT</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (con.sql(query).to_df())</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>summarize_filter_parquet_arrow()</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>summarize_filter_parquet_duckdb()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</div>
<p><em>❓️ Why do row filters not improve performance (and sometimes even slow things down), unlike column filters?</em></p>
<p>This is because data is not stored in row blocks the way it is in column blocks. As a result, filtering rows does not allow the system to skip over large sections of the file as efficiently.</p>
<p>Fortunately, there is a solution: <strong>partitioning</strong>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Part 3: Partitioned Parquet
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><em>Lazy evaluation</em> and the optimizations available through <code>Arrow</code> already provide significant performance improvements. But we can go even further. When you know in advance that your queries will frequently <strong>filter data based on a specific variable</strong>, it is highly advantageous to <strong>partition</strong> the <code>Parquet</code> file using that variable.</p>
<ol type="1">
<li><p>Review the documentation for <a href="https://arrow.apache.org/docs/python/parquet.html#writing-to-partitioned-datasets"><code>pyarrow.parquet.write_to_dataset</code></a> to understand how to define a partitioning key when writing a <code>Parquet</code> file. Several approaches are available.</p></li>
<li><p>Import the full individuals table from the census using <code>pyarrow.dataset.dataset("data/RPindividus.parquet")</code>, and export it as a partitioned dataset to <code>"data/RPindividus_partitionne.parquet"</code>, using both <code>REGION</code> and <code>DEPT</code> as partitioning keys.</p></li>
<li><p>Explore the resulting directory structure to examine how partitioning was applied—each partition key should create a subfolder representing a unique value.</p></li>
<li><p>Update your data loading, filtering, and aggregation functions (using either <code>Arrow</code> or <code>DuckDB</code>) to operate on the partitioned <code>Parquet</code> file. Then compare the performance with the non-partitioned version.</p></li>
</ol>
<div id="fed17d5d" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Correction de la question 2 (écriture du Parquet partitionné)</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.parquet <span class="im">as</span> pq</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> ds.dataset(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/RPindividus.parquet"</span>, <span class="bu">format</span><span class="op">=</span><span class="st">"parquet"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>).to_table()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>pq.write_to_dataset(</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    dataset,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    root_path<span class="op">=</span><span class="st">"data/RPindividus_partitionne"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    partition_cols<span class="op">=</span>[<span class="st">"REGION"</span>, <span class="st">"DEPT"</span>]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="cd592818" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Correction de la question 4 (lecture du Parquet partitionné)</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.dataset <span class="im">as</span> ds</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyarrow.compute <span class="im">as</span> pc</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_filter_parquet_partitioned_arrow(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> ds.dataset(<span class="st">"data/RPindividus_partitionne/"</span>, partitioning<span class="op">=</span><span class="st">"hive"</span>)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> dataset.to_table(<span class="bu">filter</span><span class="op">=</span>pc.field(<span class="st">"DEPT"</span>).isin([<span class="st">'18'</span>, <span class="st">'28'</span>, <span class="st">'36'</span>]))</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    grouped_table <span class="op">=</span> (</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>        table</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>        .group_by([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>])</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>        .aggregate([(<span class="st">"IPONDI"</span>, <span class="st">"sum"</span>)])</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>        .rename_columns([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>, <span class="st">"n_indiv"</span>])</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>        .to_pandas()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        grouped_table</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_filter_parquet_complete_arrow(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    dataset <span class="op">=</span> ds.dataset(<span class="st">"data/RPindividus.parquet"</span>)</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> dataset.to_table(<span class="bu">filter</span><span class="op">=</span>pc.field(<span class="st">"DEPT"</span>).isin([<span class="st">'18'</span>, <span class="st">'28'</span>, <span class="st">'36'</span>]))</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    grouped_table <span class="op">=</span> (</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>        table</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>        .group_by([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>])</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>        .aggregate([(<span class="st">"IPONDI"</span>, <span class="st">"sum"</span>)])</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>        .rename_columns([<span class="st">"AGED"</span>, <span class="st">"DEPT"</span>, <span class="st">"n_indiv"</span>])</span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>        .to_pandas()</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>        grouped_table</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_filter_parquet_complete_duckdb(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>    con <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">":memory:"</span>)</span>
<span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM read_parquet('data/RPindividus.parquet')</span></span>
<span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT AGED, DEPT, SUM(IPONDI) AS n_indiv</span></span>
<span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE DEPT IN ('11','31','34')</span></span>
<span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY AGED, DEPT</span></span>
<span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (con.sql(query).to_df())</span>
<span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-54"><a href="#cb20-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-55"><a href="#cb20-55" aria-hidden="true" tabindex="-1"></a><span class="at">@measure_performance</span></span>
<span id="cb20-56"><a href="#cb20-56" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summarize_filter_parquet_partitioned_duckdb(<span class="op">*</span>args, <span class="op">**</span>kwargs):</span>
<span id="cb20-57"><a href="#cb20-57" aria-hidden="true" tabindex="-1"></a>    con <span class="op">=</span> duckdb.<span class="ex">connect</span>(<span class="st">":memory:"</span>)</span>
<span id="cb20-58"><a href="#cb20-58" aria-hidden="true" tabindex="-1"></a>    query <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb20-59"><a href="#cb20-59" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM read_parquet('data/RPindividus_partitionne/**/*.parquet', hive_partitioning = True)</span></span>
<span id="cb20-60"><a href="#cb20-60" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT AGED, DEPT, SUM(IPONDI) AS n_indiv</span></span>
<span id="cb20-61"><a href="#cb20-61" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE DEPT IN ('11','31','34')</span></span>
<span id="cb20-62"><a href="#cb20-62" aria-hidden="true" tabindex="-1"></a><span class="st">    GROUP BY AGED, DEPT</span></span>
<span id="cb20-63"><a href="#cb20-63" aria-hidden="true" tabindex="-1"></a><span class="st">    """</span></span>
<span id="cb20-64"><a href="#cb20-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-65"><a href="#cb20-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (con.sql(query).to_df())</span>
<span id="cb20-66"><a href="#cb20-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-67"><a href="#cb20-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-68"><a href="#cb20-68" aria-hidden="true" tabindex="-1"></a>summarize_filter_parquet_complete_arrow()</span>
<span id="cb20-69"><a href="#cb20-69" aria-hidden="true" tabindex="-1"></a>summarize_filter_parquet_partitioned_arrow()</span>
<span id="cb20-70"><a href="#cb20-70" aria-hidden="true" tabindex="-1"></a>summarize_filter_parquet_complete_duckdb()</span>
<span id="cb20-71"><a href="#cb20-71" aria-hidden="true" tabindex="-1"></a>summarize_filter_parquet_partitioned_duckdb()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</div>
<p><em>❓️ When delivering data in <code>Parquet</code> format, how should you choose the partitioning key(s)? What limitations should you keep in mind?</em></p>
</section>
</section>
<section id="data-in-the-cloud" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data in the <em>Cloud</em></h1>
<p>Cloud storage, in the context of data science, follows the same principle as services like <code>Dropbox</code> or <code>Google Drive</code>: users can access remote files as if they were stored locally on their machines<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. In other words, for a <code>Python</code> user, <strong>working with cloud-stored files can feel exactly the same</strong> as working with local files.</p>
<p>However, unlike a local path such as <code>My Documents/mysuperfile</code>, the files are not physically stored on the user’s computer. They are hosted on a remote server, and every operation—reading or writing—relies on a network connection.</p>
<section id="why-not-use-dropbox-or-google-drive" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="why-not-use-dropbox-or-google-drive"><span class="header-section-number">3.1</span> Why Not Use <code>Dropbox</code> or <code>Google Drive</code>?</h2>
<p>Despite their similarities, services like <code>Dropbox</code> or <code>Google Drive</code> are not intended for large-scale data storage and processing. For data-intensive use cases, it is strongly recommended to rely on dedicated storage technologies (see <a href="https://ensae-reproductibilite.github.io/website/chapters/big-data.html">the production deployment course</a>).</p>
<p>All major cloud providers—AWS, Google Cloud Platform (GCP), Microsoft Azure—rely on a common principle: <strong>object storage</strong>, often implemented through <code>S3</code>-compatible systems.</p>
<p>This is why leading cloud platforms offer specialized storage services, typically based on object storage, with <code>S3</code> (Simple Storage Service) being the most widely used and recognized standard.</p>
</section>
<section id="the-s3-system" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="the-s3-system"><span class="header-section-number">3.2</span> The <code>S3</code> System</h2>
<p><code>S3</code> (Simple Storage Service), developed by Amazon, has become the de facto standard for cloud-based storage. It is:</p>
<ul>
<li><strong>Reliable</strong>: Data is replicated across multiple servers or zones;</li>
<li><strong>Secure</strong>: It supports encryption and fine-grained access control;</li>
<li><strong>Scalable</strong>: It is designed to handle massive volumes of data without performance degradation.</li>
</ul>
<section id="the-concept-of-a-bucket" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="the-concept-of-a-bucket"><span class="header-section-number">3.2.1</span> The Concept of a <em>Bucket</em></h3>
<p>The fundamental unit in <code>S3</code> is the <strong>bucket</strong>—a storage container (either private or public) that can contain a virtual file system of folders and files.</p>
<p>To access a file stored in a bucket:</p>
<ul>
<li>The user must be <strong>authorized</strong>, typically via credentials or secure access tokens;</li>
<li>Once authenticated, the user can <strong>read, write, or modify</strong> the contents of the bucket, similar to interacting with a remote file system.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The following examples are fully reproducible for<br>
SSP Cloud platform users.</p>
<div class="badge-container"><div class="badge-text">If you want to try the examples in this tutorial:</div><a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/en/manipulation/05_parquet_s3.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=github&amp;label=&amp;message=View%20on%20GitHub&amp;color=181717" alt="View on GitHub"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;name=«05_parquet_s3»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-vscode.sh»&amp;init.personalInitArgs=«en/manipulation%2005_parquet_s3»" target="_blank" rel="noopener"><img src="https://custom-icon-badges.demolab.com/badge/SSP%20Cloud-Lancer_avec_VSCode-blue?logo=vsc&amp;logoColor=white" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;name=«05_parquet_s3»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-jupyter.sh»&amp;init.personalInitArgs=«en/manipulation%2005_parquet_s3»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Lancer_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks-colab//en/blob/main//notebooks/en/manipulation/05_parquet_s3.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a><br></div>
<p>They can also be used by AWS users—simply update the <code>endpoint</code> URL as shown below.</p>
</div>
</div>
</div>
</section>
</section>
<section id="how-to-do-it-with-python" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="how-to-do-it-with-python"><span class="header-section-number">3.3</span> How to do it with Python?</h2>
<section id="key-libraries" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="key-libraries"><span class="header-section-number">3.3.1</span> Key libraries</h3>
<p>Interaction between a remote file system and a local Python session<br>
is made possible through APIs. The two main libraries for this purpose are:</p>
<ul>
<li><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html"><code>boto3</code></a>, a library developed and maintained by Amazon;</li>
<li><a href="https://s3fs.readthedocs.io/en/latest/"><code>s3fs</code></a>, a library that enables interaction with stored files as if they were part of a traditional local filesystem.</li>
</ul>
<p>The <code>pyarrow</code> and <code>duckdb</code> libraries we previously introduced also support working with cloud-stored data as if it were located on the local machine. This functionality is extremely convenient and helps ensure reliable reading and writing of files in cloud-based environments.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>On SSP Cloud, access tokens for S3 storage are automatically injected into services when they are launched. These tokens remain valid for 7 days.<br>
If the service icon changes from green to red, it indicates that the tokens have expired — you should save your code and data, then restart the session by launching a new service.</p>
</div>
</div>
</div>
</section>
</section>
<section id="practical-case-storing-your-projects-data-on-ssp-cloud" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="practical-case-storing-your-projects-data-on-ssp-cloud"><span class="header-section-number">3.4</span> Practical Case: Storing Your Project’s Data on SSP Cloud</h2>
<p>A key criterion for evaluating <code>Python</code> projects is <strong>reproducibility</strong>—the ability to obtain the same results using the same input data and code. Whenever possible, your final submission should begin with the raw data used as input for your project. If the source files are publicly available via a URL, the ideal approach is to import them directly at the start of your project (see the <a href="../../content/manipulation/02_pandas_suite.html">Pandas lab</a> for an example of such an import using <code>Pandas</code>).</p>
<p>In practice, this is not always feasible. Your data may not be publicly accessible, or it might come in complex formats that require preprocessing before it can be used in standard workflows. In other cases, your dataset may be the result of an automated retrieval process—such as through an <a href="../../content/manipulation/04c_API_TP.html">API</a> or <a href="../../content/manipulation/04a_webscraping_TP.html">web scraping</a>—which can be time-consuming to reproduce. Moreover, since websites frequently change over time, it is often better to “freeze” the data once collected. Similarly, even if you are not storing raw data, you may want to preserve trained models, as the training process can also be resource-intensive.</p>
<p>In all of these situations, you need a reliable way to store data or models. <strong>Your <code>Git</code> repository is not the appropriate place to store large files.</strong> A well-structured <code>Python</code> project follows a modular design: it separates code (versioned with <code>Git</code>), configuration elements (such as API tokens, which should never be hardcoded), and data storage. This conceptual separation leads to cleaner, more maintainable projects.</p>
<p>While <code>Git</code> is designed for source code management, file storage requires dedicated solutions. Many such tools exist. On SSP Cloud, the recommended option is <code>MinIO</code>, an open-source implementation of the <code>S3</code> storage protocol introduced earlier. This brief tutorial will walk you through a standard workflow for using <code>MinIO</code> in your project.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Warning
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>No matter which storage solution you use for your data or models, **you must include the code that generates these objects in your project repository</p>
</div>
</div>
</div>
<section id="sharing-files-on-ssp-cloud" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="sharing-files-on-ssp-cloud"><span class="header-section-number">3.4.1</span> Sharing files on SSP Cloud</h3>
<p>As mentioned earlier, files are stored on <code>S3</code> in a bucket. On SSP Cloud, a bucket is automatically created when your account is set up, and it has the same name as your SSP Cloud username. The <a href="https://datalab.sspcloud.fr/my-files">My Files</a> interface allows you to access it visually, upload files, download them, and more.</p>
<p>In this tutorial, however, we’ll access it programmatically using <code>Python</code> code. The <code>s3fs</code> package lets you interact with your bucket just like a regular file system. For example, you can list the files available in your <em>bucket</em> using the following command:</p>
<div id="14cc5918" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>fs <span class="op">=</span> s3fs.S3FileSystem(client_kwargs<span class="op">=</span>{<span class="st">"endpoint_url"</span>: <span class="st">"https://minio.lab.sspcloud.fr"</span>})</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>MY_BUCKET <span class="op">=</span> <span class="st">"mon_nom_utilisateur_sspcloud"</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>fs.ls(MY_BUCKET)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If you’ve never added any files to MinIO, your <em>bucket</em> will be empty, so the command above should return an empty list. Let’s add a first folder to see the difference.</p>
<p>By default, a bucket is personal, meaning the data inside can only be read or modified by you. For your project, you’ll want to share these files with your group members to collaborate efficiently. But that’s not all! Your instructors will also need to access these files to reproduce your analyses.</p>
<p>There are several ways to make files more or less public on <code>MinIO</code>. The simplest—and the one we recommend—is to create a folder named <code>diffusion</code> at the root of your bucket. On SSP Cloud, all files inside a <code>diffusion</code> folder are <strong>readable</strong> by all authenticated users. Use the <a href="https://datalab.sspcloud.fr/my-files">My Files</a> interface to create a <code>diffusion</code> folder at the root of your <em>bucket</em>. If everything worked correctly, the Python command above should now display the path <code>your_sspcloud_username/diffusion</code>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Cloud storage encourages collaborative work!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Instead of each project member working with their own files on their personal machine—which would require frequent syncing and makes reproducibility more error-prone—files are placed in a central repository that every group member can access.</p>
<p>To do this, the group should agree to use one member’s bucket, and ensure that other members can access the data by placing it in the <code>diffusion</code> folder of the selected bucket.</p>
</div>
</div>
</div>
</section>
<section id="retrieving-and-storing-data" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="retrieving-and-storing-data"><span class="header-section-number">3.4.2</span> Retrieving and storing data</h3>
<p>Now that we know where to place our data on <code>MinIO</code>, let’s look at how to do it in practice using <code>Python</code>.</p>
<section id="case-of-a-dataframe" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="case-of-a-dataframe">Case of a DataFrame</h4>
<p>Let’s revisit an example from the course on <a href="../../content/manipulation/04c_API_TP.html#illustration-avec-une-api-de-lademe-pour-obtenir-des-diagnostics-énergétiques">APIs</a> to simulate a time-consuming data retrieval step.</p>
<div id="2d11c562" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>url_api <span class="op">=</span> <span class="st">"https://koumoul.com/data-fair/api/v1/datasets/dpe-france/lines?format=json&amp;q_mode=simple&amp;qs=code_insee_commune_actualise%3A</span><span class="sc">%2201450%</span><span class="st">22&amp;size=100&amp;select=%2A&amp;sampling=neighbors"</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>response_json <span class="op">=</span> requests.get(url_api).json()</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>df_dpe <span class="op">=</span> pd.json_normalize(response_json[<span class="st">"results"</span>])</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>df_dpe.head(<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">classe_consommation_energie</th>
<th data-quarto-table-cell-role="th">tr001_modele_dpe_type_libelle</th>
<th data-quarto-table-cell-role="th">annee_construction</th>
<th data-quarto-table-cell-role="th">_geopoint</th>
<th data-quarto-table-cell-role="th">latitude</th>
<th data-quarto-table-cell-role="th">surface_thermique_lot</th>
<th data-quarto-table-cell-role="th">numero_dpe</th>
<th data-quarto-table-cell-role="th">_i</th>
<th data-quarto-table-cell-role="th">tr002_type_batiment_description</th>
<th data-quarto-table-cell-role="th">geo_adresse</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">geo_score</th>
<th data-quarto-table-cell-role="th">classe_estimation_ges</th>
<th data-quarto-table-cell-role="th">nom_methode_dpe</th>
<th data-quarto-table-cell-role="th">tv016_departement_code</th>
<th data-quarto-table-cell-role="th">consommation_energie</th>
<th data-quarto-table-cell-role="th">date_etablissement_dpe</th>
<th data-quarto-table-cell-role="th">longitude</th>
<th data-quarto-table-cell-role="th">_score</th>
<th data-quarto-table-cell-role="th">_id</th>
<th data-quarto-table-cell-role="th">version_methode_dpe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>E</td>
<td>Vente</td>
<td>1</td>
<td>45.927488,5.230195</td>
<td>45.927488</td>
<td>106.87</td>
<td>1301V2000001S</td>
<td>2</td>
<td>Maison Individuelle</td>
<td>Rue du Chateau 01800 Villieu-Loyes-Mollon</td>
<td>...</td>
<td>0.58</td>
<td>B</td>
<td>Méthode Facture</td>
<td>01</td>
<td>286.0</td>
<td>2013-04-15</td>
<td>5.230195</td>
<td>None</td>
<td>HJt4TdUa1W0wZiNoQkskk</td>
<td>NaN</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>G</td>
<td>Vente</td>
<td>1960</td>
<td>45.931376,5.230461</td>
<td>45.931376</td>
<td>70.78</td>
<td>1301V1000010R</td>
<td>9</td>
<td>Maison Individuelle</td>
<td>552 Rue Royale 01800 Villieu-Loyes-Mollon</td>
<td>...</td>
<td>0.34</td>
<td>D</td>
<td>Méthode 3CL</td>
<td>01</td>
<td>507.0</td>
<td>2013-04-22</td>
<td>5.230461</td>
<td>None</td>
<td>UhMxzza1hsUo0syBh9DxH</td>
<td>3CL-DPE, version 1.3</td>
</tr>
</tbody>
</table>

<p>2 rows × 23 columns</p>
</div>
</div>
</div>
<p>This request returns a <code>Pandas</code> <em>DataFrame</em>, and the first two rows are printed above. In our example, the process is deliberately simple, but in practice, you might have many steps of querying and preparing the data before obtaining a usable DataFrame for the rest of the project. This process might be time-consuming, so we’ll store these “intermediate” data on <code>MinIO</code> to avoid rerunning all the code that generated them each time.</p>
<p>We can use <code>Pandas</code> export functions, which allow saving data in various formats. Since we’re working in the cloud, one additional step is needed: we open a connection to <code>MinIO</code>, then export our DataFrame.</p>
<div id="ca21d5aa" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>MY_BUCKET <span class="op">=</span> <span class="st">"mon_nom_utilisateur_sspcloud"</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>FILE_PATH_OUT_S3 <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/df_dpe.csv"</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> fs.<span class="bu">open</span>(FILE_PATH_OUT_S3, <span class="st">'w'</span>) <span class="im">as</span> file_out:</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    df_dpe.to_csv(file_out)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>You can verify that your file has been successfully uploaded either via the <a href="https://datalab.sspcloud.fr/my-files">My Files</a> interface, or directly in <code>Python</code> by checking the contents of the <code>diffusion</code> folder in your <em>bucket</em>:</p>
<div id="68eec445" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fs.ls(<span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We could just as easily export our dataset in <code>Parquet</code> format to reduce storage space and improve read performance. Note: since <code>Parquet</code> is a compressed format, you must specify that you’re writing a binary file — the file opening mode passed to <code>fs.open</code> should be changed from <code>w</code> (write) to <code>wb</code> (write binary).</p>
<div id="46c3c91b" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>FILE_PATH_OUT_S3 <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/df_dpe.parquet"</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> fs.<span class="bu">open</span>(FILE_PATH_OUT_S3, <span class="st">'wb'</span>) <span class="im">as</span> file_out:</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    df_dpe.to_parquet(file_out)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="file-based-use-case" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="file-based-use-case">File-based use case</h4>
<p>In the previous section, we dealt with the “simple” case of a DataFrame, which allowed us to use <code>Pandas</code>’ built-in export functions. Now, let’s imagine we have multiple input files, each potentially in a different format. A typical example of such files are <code>ShapeFile</code>s, which are geographic data files and are composed of several related files (see <a href="../../content/manipulation/03_geopandas_intro.html#le-format-shapefile-.shp-et-le-geopackage-.gpkg">GeoPandas chapter</a>). Let’s start by downloading a <code>.shp</code> file to inspect its structure.</p>
<p>Below are the outlines of the department of Réunion <a href="https://geoservices.ign.fr/telechargement-api/ADMIN-EXPRESS-COG-CARTO">produced by the IGN</a>, in the form of a <code>..7z</code> archive that we will unzip locally into a folder called <code>departements_fr</code>.</p>
<div id="31b7894c" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> io</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> py7zr</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Import et décompression</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>contours_url <span class="op">=</span> <span class="st">"https://data.geopf.fr/telechargement/download/ADMIN-EXPRESS-COG-CARTO/ADMIN-EXPRESS-COG-CARTO_3-2__SHP_RGR92UTM40S_REU_2023-05-03/ADMIN-EXPRESS-COG-CARTO_3-2__SHP_RGR92UTM40S_REU_2023-05-03.7z"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(contours_url, stream<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> py7zr.SevenZipFile(io.BytesIO(response.content), mode<span class="op">=</span><span class="st">'r'</span>) <span class="im">as</span> archive:</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    archive.extractall(path<span class="op">=</span><span class="st">"departements_fr"</span>)</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérification du dossier (local, pas sur S3)</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>os.listdir(<span class="st">"departements_fr"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>['ADMIN-EXPRESS-COG-CARTO_3-2__SHP_RGR92UTM40S_REU_2023-05-03']</code></pre>
</div>
</div>
<p>Since we’re now dealing with local files rather than a <code>Pandas</code> <em>DataFrame</em>, we need to use the <code>s3fs</code> package to transfer files from the local filesystem to the remote filesystem (<code>MinIO</code>). Using the <code>put</code> command, we can copy an entire folder to <code>MinIO</code> in a single step. Be sure to set the <code>recursive=True</code> parameter so that both the folder and its contents are copied.</p>
<div id="9e2e8072" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>fs.put(<span class="st">"departements_fr/"</span>, <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/departements_fr/"</span>, recursive<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s check that the folder was successfully copied:</p>
<div id="568fe677" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>fs.ls(<span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/departements_fr"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If the folder, as in this case, contains files at multiple levels, you will need to browse the list recursively to access the files. If, for example, you are only interested in municipal divisions, you can use a <a href="https://docs.python.org/fr/3/library/glob.html"><code>glob</code></a>:</p>
<div id="ac7c7cc1" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fs.glob(<span class="ss">f'</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/departements_fr/**/COMMUNE.*'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>If everything worked correctly, the command above should return a list of file paths on <code>MinIO</code> for the various components of the Réunion cities <code>ShapeFile</code> (<code>.shp</code>, <code>.shx</code>, <code>.prj</code>, etc.).</p>
</section>
</section>
<section id="using-the-data" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="using-the-data"><span class="header-section-number">3.4.3</span> Using the data</h3>
<p>In the reverse direction, to retrieve files from <code>MinIO</code> in a <code>Python</code> session, the commands are symmetrical.</p>
<section id="case-of-a-dataframe-1" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="case-of-a-dataframe-1">Case of a dataframe</h4>
<p>Make sure to pass the <code>r</code> parameter (<code>read</code>, for reading) instead of <code>w</code> (<code>write</code>, for writing) to the <code>fs.open</code> function to avoid overwriting the file!</p>
<div id="35481570" class="cell" data-execution_count="40">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>MY_BUCKET <span class="op">=</span> <span class="st">"your_sspcloud_username"</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>FILE_PATH_S3 <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/df_dpe.csv"</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> fs.<span class="bu">open</span>(FILE_PATH_S3, <span class="st">'r'</span>) <span class="im">as</span> file_in:</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    df_dpe <span class="op">=</span> pd.read_csv(file_in)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>df_dpe.head(<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Similarly, if the file is in <code>Parquet</code> format (don’t forget to use <code>rb</code> instead of <code>r</code> due to compression):</p>
<div id="2d7cc70e" class="cell" data-execution_count="41">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>MY_BUCKET <span class="op">=</span> <span class="st">"your_sspcloud_username"</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>FILE_PATH_S3 <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/df_dpe.parquet"</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Import</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> fs.<span class="bu">open</span>(FILE_PATH_S3, <span class="st">'rb'</span>) <span class="im">as</span> file_in:</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    df_dpe <span class="op">=</span> pd.read_parquet(file_in)</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>df_dpe.head(<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="case-of-files" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="case-of-files">Case of files</h4>
<p>For file collections, you’ll first need to download the files from <code>MinIO</code> to your local machine (i.e., the current SSP Cloud session).</p>
<div id="d0ba1a1b" class="cell" data-execution_count="42">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve files from MinIO to the local machine</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>fs.get(<span class="ss">f"</span><span class="sc">{</span>MY_BUCKET<span class="sc">}</span><span class="ss">/diffusion/departements_fr/"</span>, <span class="st">"departements_fr/"</span>, recursive<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then, you can import them in the usual way using the appropriate <code>Python</code> package. For <code>ShapeFile</code>s, where multiple files make up a single dataset, one command is sufficient after retrieval:</p>
<div id="ff13ab8b" class="cell" data-execution_count="43">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="annotated-cell-43"><pre class="sourceCode python code-annotation-code code-with-copy code-annotated"><code class="sourceCode python"><span id="annotated-cell-43-1"><a href="#annotated-cell-43-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="annotated-cell-43-2"><a href="#annotated-cell-43-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="annotated-cell-43-3"><a href="#annotated-cell-43-3" aria-hidden="true" tabindex="-1"></a></span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-43" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-43-4" class="code-annotation-target"><a href="#annotated-cell-43-4" aria-hidden="true" tabindex="-1"></a>localpath <span class="op">=</span> Path(<span class="st">"departements_fr"</span>)</span>
<span id="annotated-cell-43-5"><a href="#annotated-cell-43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-43-6"><a href="#annotated-cell-43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-43-7"><a href="#annotated-cell-43-7" aria-hidden="true" tabindex="-1"></a>df_dep <span class="op">=</span> gpd.read_file(</span>
<span id="annotated-cell-43-8"><a href="#annotated-cell-43-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">list</span>(</span>
<span id="annotated-cell-43-9"><a href="#annotated-cell-43-9" aria-hidden="true" tabindex="-1"></a>    localpath.glob(<span class="st">"**/COMMUNE.shp"</span>)</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-43" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-43-10" class="code-annotation-target"><a href="#annotated-cell-43-10" aria-hidden="true" tabindex="-1"></a>  )[<span class="dv">0</span>]</span>
<span id="annotated-cell-43-11"><a href="#annotated-cell-43-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="annotated-cell-43-12"><a href="#annotated-cell-43-12" aria-hidden="true" tabindex="-1"></a>df_dep.head(<span class="dv">2</span>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-43" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-43" data-code-lines="4" data-code-annotation="1">As our file contains many files, we will need to search through it using, once again, a <a href="https://docs.python.org/fr/3/library/glob.html"><code>glob</code></a></span>
</dd>
<dt data-target-cell="annotated-cell-43" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-43" data-code-lines="10" data-code-annotation="2"><code>Pathlib</code> gives us a list, so we restrict ourselves to the first echo and import it with <code>GeoPandas</code></span>
</dd>
</dl>
</div>
</div>
</section>
</section>
</section>
<section id="to-go-further" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="to-go-further"><span class="header-section-number">3.5</span> To go further</h2>
<ul>
<li><a href="https://docs.sspcloud.fr/content/storage.html">SSPCloud documentation on MinIO</a></li>
</ul>
</section>
<section id="informations-additionnelles" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="informations-additionnelles">Informations additionnelles</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Python environment   
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This site was built automatically through a <code>Github</code> <i class="fa-brands fa-github" aria-label="github"></i> action using the <code>Quarto</code> <iconify-icon role="img" inline="" icon="simple-icons:quarto" aria-label="Icon quarto from simple-icons Iconify.design set." title="Icon quarto from simple-icons Iconify.design set."></iconify-icon> reproducible publishing software (version 1.8.26).</p>
<p>The <i class="fa-brands fa-python" aria-label="python"></i> environment used to obtain the results is reproducible via <a href="https://docs.astral.sh/uv/guides/install-python/">uv</a>. The <code>pyproject.toml</code> file used to build this environment is available on the <a href="https://github.com/linogaliana/python-datascientist/blob/main/pyproject.toml"><code>linogaliana/python-datascientist</code></a> repository</p>
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>pyproject.toml</strong></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34" data-filename="pyproject.toml" data-code-fold="true" data-code-summary="pyproject.toml"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>[project]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>name <span class="op">=</span> <span class="st">"python-datascientist"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>version <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>description <span class="op">=</span> <span class="st">"Source code for Lino Galiana's Python for data science course"</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>readme <span class="op">=</span> <span class="st">"README.md"</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>requires<span class="op">-</span>python <span class="op">=</span> <span class="st">"&gt;=3.12,&lt;3.13"</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>dependencies <span class="op">=</span> [</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"altair==5.4.1"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"black==24.8.0"</span>,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cartiflette"</span>,</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"contextily==1.6.2"</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"duckdb&gt;=0.10.1"</span>,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"folium&gt;=0.19.6"</span>,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"geoplot==0.5.1"</span>,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"graphviz==0.20.3"</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"great-tables==0.12.0"</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ipykernel&gt;=6.29.5"</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jupyter&gt;=1.1.1"</span>,</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"jupyter-cache==1.0.0"</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"kaleido==0.2.1"</span>,</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"langchain-community==0.3.9"</span>,</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"loguru==0.7.3"</span>,</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"markdown&gt;=3.8"</span>,</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nbclient==0.10.0"</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nbformat==5.10.4"</span>,</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nltk&gt;=3.9.1"</span>,</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pip&gt;=25.1.1"</span>,</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"plotly&gt;=6.1.2"</span>,</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"plotnine&gt;=0.15"</span>,</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"polars==1.8.2"</span>,</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pyarrow==17.0.0"</span>,</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pynsee==0.1.8"</span>,</span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"python-dotenv==1.0.1"</span>,</span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"pywaffle==1.1.1"</span>,</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"requests&gt;=2.32.3"</span>,</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"scikit-image==0.24.0"</span>,</span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"scipy==1.13.0"</span>,</span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"selenium&lt;4.39.0"</span>,</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"spacy==3.8.4"</span>,</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"webdriver-manager==4.0.2"</span>,</span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"wordcloud==1.9.3"</span>,</span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"xlrd==2.0.1"</span>,</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"yellowbrick==1.5"</span>,</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a>[tool.uv.sources]</span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>cartiflette <span class="op">=</span> { git <span class="op">=</span> <span class="st">"https://github.com/inseefrlab/cartiflette"</span> }</span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a>[dependency<span class="op">-</span>groups]</span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>dev <span class="op">=</span> [</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">"nb-clean&gt;=4.0.1"</span>,</span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>To use exactly the same environment (version of <code>Python</code> and <em>packages</em>), please refer to the <a href="https://docs.astral.sh/uv/pip/environments/">documentation for <code>uv</code></a>.</p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>File history   
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="1592" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1591;"><span id="cb35-1592"><a href="#cb35-1592" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`This file has been modified __</span><span class="sc">${</span>table_commit<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs">__ times since its creation on </span><span class="sc">${</span>creation_string<span class="sc">}</span><span class="vs"> (last modified on </span><span class="sc">${</span>last_modification_string<span class="sc">}</span><span class="vs">)`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="1597" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1596;"><span id="cb36-1597"><a href="#cb36-1597" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>git_history_table<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-5" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="1602" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1601;"><span id="cb37-1602"><a href="#cb37-1602" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>git_history_plot<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-6" data-nodetype="expression">

</div>
</div>
</div>
<table class="commit-table" border="1">
<thead>
<tr>
<th>
SHA
</th>
<th>
Date
</th>
<th>
Author
</th>
<th>
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/60518fdb">60518fdb</a>
</td>
<td>
2025-08-20 15:45:42
</td>
<td>
lgaliana
</td>
<td>
clean process
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/73043ee7">73043ee7</a>
</td>
<td>
2025-08-20 14:50:30
</td>
<td>
Lino Galiana
</td>
<td>
retire l’historique inutile des données velib (#638)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/c3d51646">c3d51646</a>
</td>
<td>
2025-08-12 17:28:51
</td>
<td>
Lino Galiana
</td>
<td>
Ajoute un résumé au début de chaque chapitre (première partie) (#634)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/94648290">94648290</a>
</td>
<td>
2025-07-22 18:57:48
</td>
<td>
Lino Galiana
</td>
<td>
Fix boxes now that it is better supported by jupyter (#628)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/7611f138">7611f138</a>
</td>
<td>
2025-06-18 13:43:09
</td>
<td>
Lino Galiana
</td>
<td>
Traduction du chapitre S3 (#616)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/e4a1e0bd">e4a1e0bd</a>
</td>
<td>
2025-06-17 16:57:25
</td>
<td>
lgaliana
</td>
<td>
commence la traduction du chapitre S3
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/78e4efe5">78e4efe5</a>
</td>
<td>
2025-06-17 12:40:57
</td>
<td>
lgaliana
</td>
<td>
change variable that make pipeline fail
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/14790b01">14790b01</a>
</td>
<td>
2025-06-16 16:57:32
</td>
<td>
lgaliana
</td>
<td>
fix error api komoul
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/8f8e6563">8f8e6563</a>
</td>
<td>
2025-06-16 15:42:32
</td>
<td>
lgaliana
</td>
<td>
Les chapitres dans le bon ordre, ça serait mieux…
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/d8bacc63">d8bacc63</a>
</td>
<td>
2025-06-16 17:34:16
</td>
<td>
Lino Galiana
</td>
<td>
Ménage de printemps: retire les vieux chapitres inutiles (#615)
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="1619" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1618;"><span id="cb38-1619"><a href="#cb38-1619" aria-hidden="true" tabindex="-1"></a>creation <span class="op">=</span> d3<span class="op">.</span><span class="fu">min</span>(</span>
<span id="cb38-1620"><a href="#cb38-1620" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb38-1621"><a href="#cb38-1621" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-1622"><a href="#cb38-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1623"><a href="#cb38-1623" aria-hidden="true" tabindex="-1"></a>last_modification <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(</span>
<span id="cb38-1624"><a href="#cb38-1624" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb38-1625"><a href="#cb38-1625" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-1626"><a href="#cb38-1626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1627"><a href="#cb38-1627" aria-hidden="true" tabindex="-1"></a>creation_string <span class="op">=</span> creation<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"fr"</span><span class="op">,</span> {</span>
<span id="cb38-1628"><a href="#cb38-1628" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb38-1629"><a href="#cb38-1629" aria-hidden="true" tabindex="-1"></a>  <span class="st">"month"</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb38-1630"><a href="#cb38-1630" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year"</span><span class="op">:</span> <span class="st">"numeric"</span></span>
<span id="cb38-1631"><a href="#cb38-1631" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb38-1632"><a href="#cb38-1632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-1633"><a href="#cb38-1633" aria-hidden="true" tabindex="-1"></a>last_modification_string <span class="op">=</span> last_modification<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"fr"</span><span class="op">,</span> {</span>
<span id="cb38-1634"><a href="#cb38-1634" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb38-1635"><a href="#cb38-1635" aria-hidden="true" tabindex="-1"></a>  <span class="st">"month"</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb38-1636"><a href="#cb38-1636" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year"</span><span class="op">:</span> <span class="st">"numeric"</span></span>
<span id="cb38-1637"><a href="#cb38-1637" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-7-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell hidden">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1649" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1648;"><span id="cb39-1649"><a href="#cb39-1649" aria-hidden="true" tabindex="-1"></a>git_history_table <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">table</span>(</span>
<span id="cb39-1650"><a href="#cb39-1650" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">,</span></span>
<span id="cb39-1651"><a href="#cb39-1651" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb39-1652"><a href="#cb39-1652" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb39-1653"><a href="#cb39-1653" aria-hidden="true" tabindex="-1"></a>      <span class="dt">SHA</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="fu">md</span><span class="vs">`[</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">](</span><span class="sc">${</span>github_repo<span class="sc">}</span><span class="vs">/commit/</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span></span>
<span id="cb39-1654"><a href="#cb39-1654" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Description</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">replacePullRequestPattern</span>(x<span class="op">,</span> github_repo)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb39-1655"><a href="#cb39-1655" aria-hidden="true" tabindex="-1"></a>      <span class="co">/*Date: x =&gt; x.toLocaleString("fr", {</span></span>
<span id="cb39-1656"><a href="#cb39-1656" aria-hidden="true" tabindex="-1"></a><span class="co">        "month": "numeric",</span></span>
<span id="cb39-1657"><a href="#cb39-1657" aria-hidden="true" tabindex="-1"></a><span class="co">        "day": "numeric",</span></span>
<span id="cb39-1658"><a href="#cb39-1658" aria-hidden="true" tabindex="-1"></a><span class="co">        "year": "numeric"</span></span>
<span id="cb39-1659"><a href="#cb39-1659" aria-hidden="true" tabindex="-1"></a><span class="co">        })</span></span>
<span id="cb39-1660"><a href="#cb39-1660" aria-hidden="true" tabindex="-1"></a><span class="co">      */</span></span>
<span id="cb39-1661"><a href="#cb39-1661" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-1662"><a href="#cb39-1662" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-1663"><a href="#cb39-1663" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1669" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1668;"><span id="cb40-1669"><a href="#cb40-1669" aria-hidden="true" tabindex="-1"></a>git_history_plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb40-1670"><a href="#cb40-1670" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb40-1671"><a href="#cb40-1671" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"royalblue"</span>})<span class="op">,</span></span>
<span id="cb40-1672"><a href="#cb40-1672" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(</span>
<span id="cb40-1673"><a href="#cb40-1673" aria-hidden="true" tabindex="-1"></a>          table_commit<span class="op">,</span></span>
<span id="cb40-1674"><a href="#cb40-1674" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">pointerX</span>({<span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"red"</span>}))<span class="op">,</span></span>
<span id="cb40-1675"><a href="#cb40-1675" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(table_commit<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"royalblue"</span>})</span>
<span id="cb40-1676"><a href="#cb40-1676" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb40-1677"><a href="#cb40-1677" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1683" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1682;"><span id="cb41-1683"><a href="#cb41-1683" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">replacePullRequestPattern</span>(inputString<span class="op">,</span> githubRepo) {</span>
<span id="cb41-1684"><a href="#cb41-1684" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use a regular expression to match the pattern #digit</span></span>
<span id="cb41-1685"><a href="#cb41-1685" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> pattern <span class="op">=</span> <span class="ss">/#</span><span class="sc">(\d+)</span><span class="ss">/g</span><span class="op">;</span></span>
<span id="cb41-1686"><a href="#cb41-1686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1687"><a href="#cb41-1687" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Replace the pattern with ${github_repo}/pull/#digit</span></span>
<span id="cb41-1688"><a href="#cb41-1688" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> replacedString <span class="op">=</span> inputString<span class="op">.</span><span class="fu">replace</span>(pattern<span class="op">,</span> <span class="st">'[#$1]('</span> <span class="op">+</span> githubRepo <span class="op">+</span> <span class="st">'/pull/$1)'</span>)<span class="op">;</span></span>
<span id="cb41-1689"><a href="#cb41-1689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1690"><a href="#cb41-1690" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> replacedString<span class="op">;</span></span>
<span id="cb41-1691"><a href="#cb41-1691" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-10" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1697" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1696;"><span id="cb42-1697"><a href="#cb42-1697" aria-hidden="true" tabindex="-1"></a>github_repo <span class="op">=</span> <span class="st">"https://github.com/linogaliana/python-datascientist"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1702" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1701;"><span id="cb43-1702"><a href="#cb43-1702" aria-hidden="true" tabindex="-1"></a>table_commit <span class="op">=</span> {</span>
<span id="cb43-1703"><a href="#cb43-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1704"><a href="#cb43-1704" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the HTML table by its class name</span></span>
<span id="cb43-1705"><a href="#cb43-1705" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> table <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.commit-table'</span>)<span class="op">;</span></span>
<span id="cb43-1706"><a href="#cb43-1706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1707"><a href="#cb43-1707" aria-hidden="true" tabindex="-1"></a><span class="co">// Check if the table exists</span></span>
<span id="cb43-1708"><a href="#cb43-1708" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (table) {</span>
<span id="cb43-1709"><a href="#cb43-1709" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize an array to store the table data</span></span>
<span id="cb43-1710"><a href="#cb43-1710" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> dataArray <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb43-1711"><a href="#cb43-1711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1712"><a href="#cb43-1712" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Extract headers from the first row</span></span>
<span id="cb43-1713"><a href="#cb43-1713" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> headers <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb43-1714"><a href="#cb43-1714" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> table<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb43-1715"><a href="#cb43-1715" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">.</span><span class="fu">push</span>(table<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">cells</span>[i]<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">trim</span>())<span class="op">;</span></span>
<span id="cb43-1716"><a href="#cb43-1716" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-1717"><a href="#cb43-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1718"><a href="#cb43-1718" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate through the rows, starting from the second row</span></span>
<span id="cb43-1719"><a href="#cb43-1719" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> table<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb43-1720"><a href="#cb43-1720" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> row <span class="op">=</span> table<span class="op">.</span><span class="at">rows</span>[i]<span class="op">;</span></span>
<span id="cb43-1721"><a href="#cb43-1721" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> rowData <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb43-1722"><a href="#cb43-1722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1723"><a href="#cb43-1723" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Iterate through the cells in the row</span></span>
<span id="cb43-1724"><a href="#cb43-1724" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> row<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb43-1725"><a href="#cb43-1725" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Use headers as keys and cell content as values</span></span>
<span id="cb43-1726"><a href="#cb43-1726" aria-hidden="true" tabindex="-1"></a>            rowData[headers[j]] <span class="op">=</span> row<span class="op">.</span><span class="at">cells</span>[j]<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb43-1727"><a href="#cb43-1727" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-1728"><a href="#cb43-1728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1729"><a href="#cb43-1729" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Push the rowData object to the dataArray</span></span>
<span id="cb43-1730"><a href="#cb43-1730" aria-hidden="true" tabindex="-1"></a>        dataArray<span class="op">.</span><span class="fu">push</span>(rowData)<span class="op">;</span></span>
<span id="cb43-1731"><a href="#cb43-1731" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb43-1732"><a href="#cb43-1732" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb43-1733"><a href="#cb43-1733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1734"><a href="#cb43-1734" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> dataArray</span>
<span id="cb43-1735"><a href="#cb43-1735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-1736"><a href="#cb43-1736" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-12" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1742" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1741;"><span id="cb44-1742"><a href="#cb44-1742" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the element with class 'git-details'</span></span>
<span id="cb44-1743"><a href="#cb44-1743" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb44-1744"><a href="#cb44-1744" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> gitDetails <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.commit-table'</span>)<span class="op">;</span></span>
<span id="cb44-1745"><a href="#cb44-1745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-1746"><a href="#cb44-1746" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if the element exists</span></span>
<span id="cb44-1747"><a href="#cb44-1747" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (gitDetails) {</span>
<span id="cb44-1748"><a href="#cb44-1748" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Hide the element</span></span>
<span id="cb44-1749"><a href="#cb44-1749" aria-hidden="true" tabindex="-1"></a>      gitDetails<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'none'</span><span class="op">;</span></span>
<span id="cb44-1750"><a href="#cb44-1750" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-1751"><a href="#cb44-1751" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-13" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1757" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1756;"><span id="cb45-1757"><a href="#cb45-1757" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@observablehq/plot@0.6.12/dist/plot.umd.min.js'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-14" data-nodetype="declaration">

</div>
</div>
</div>


</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>For more details, see the <a href="https://ensae-reproductibilite.github.io/website/chapters/big-data.html">production deployment course by Romain Avouac and myself</a>. Apologies to non-French-speaking readers—this resource is currently only available in French.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For a deeper discussion of data format selection challenges, see <span class="citation" data-cites="dondon2023quels">@dondon2023quels</span>.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>It is recommended to regularly
consult official <code>pyarrow</code> documentation on <a href="https://arrow.apache.org/docs/python/parquet.html">reading and writing files</a> and <a href="https://arrow.apache.org/cookbook/py/data.html">data manipulation</a>.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>This functionality is often enabled through virtual file systems or filesystem wrappers compatible with libraries such as <code>pandas</code>, <code>pyarrow</code>, <code>duckdb</code>, and others.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@book{galiana2025,
  author = {Galiana, Lino},
  title = {Python Pour La Data Science},
  date = {2025},
  url = {https://pythonds.linogaliana.fr/},
  doi = {10.5281/zenodo.8229676},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-galiana2025" class="csl-entry quarto-appendix-citeas" role="listitem">
Galiana, Lino. 2025. <em>Python Pour La Data Science</em>. <a href="https://doi.org/10.5281/zenodo.8229676">https://doi.org/10.5281/zenodo.8229676</a>.
</div></div></section></div></main> <!-- /main -->
<script type="text/javascript">

// replace cmd keyboard shortcut w/ control on non-Mac platforms
const kPlatformMac = typeof navigator !== 'undefined' ? /Mac/.test(navigator.platform) : false;
if (!kPlatformMac) {
   var kbds = document.querySelectorAll("kbd")
   kbds.forEach(function(kbd) {
      kbd.innerHTML = kbd.innerHTML.replace(/⌘/g, '⌃');
   });
}

// tweak headings in pymd
document.querySelectorAll(".pymd span.co").forEach(el => {
   if (!el.innerText.startsWith("#|")) {
      el.style.fontWeight = 1000;
   }
});

</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYENlIGZpY2hpZXIgYSDDqXTDqSBtb2RpZmnDqSBfXyR7dGFibGVfY29tbWl0Lmxlbmd0aH1fXyBmb2lzIGRlcHVpcyBzYSBjcsOpYXRpb24gbGUgJHtjcmVhdGlvbl9zdHJpbmd9IChkZXJuacOocmUgbW9kaWZpY2F0aW9uIGxlICR7bGFzdF9tb2RpZmljYXRpb25fc3RyaW5nfSlgXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodG1sYDxkaXY+JHtnaXRfaGlzdG9yeV90YWJsZX08L2Rpdj5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodG1sYDxkaXY+JHtnaXRfaGlzdG9yeV9wbG90fTwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYFRoaXMgZmlsZSBoYXMgYmVlbiBtb2RpZmllZCBfXyR7dGFibGVfY29tbWl0Lmxlbmd0aH1fXyB0aW1lcyBzaW5jZSBpdHMgY3JlYXRpb24gb24gJHtjcmVhdGlvbl9zdHJpbmd9IChsYXN0IG1vZGlmaWVkIG9uICR7bGFzdF9tb2RpZmljYXRpb25fc3RyaW5nfSlgXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodG1sYDxkaXY+JHtnaXRfaGlzdG9yeV90YWJsZX08L2Rpdj5gXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJodG1sYDxkaXY+JHtnaXRfaGlzdG9yeV9wbG90fTwvZGl2PmBcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNyZWF0aW9uID0gZDMubWluKFxuICB0YWJsZV9jb21taXQubWFwKGQgPT4gbmV3IERhdGUoZC5EYXRlKSlcbilcblxubGFzdF9tb2RpZmljYXRpb24gPSBkMy5tYXgoXG4gIHRhYmxlX2NvbW1pdC5tYXAoZCA9PiBuZXcgRGF0ZShkLkRhdGUpKVxuKVxuXG5jcmVhdGlvbl9zdHJpbmcgPSBjcmVhdGlvbi50b0xvY2FsZVN0cmluZyhcImZyXCIsIHtcbiAgXCJkYXlcIjogXCJudW1lcmljXCIsXG4gIFwibW9udGhcIjogXCJsb25nXCIsXG4gIFwieWVhclwiOiBcIm51bWVyaWNcIlxufSlcblxubGFzdF9tb2RpZmljYXRpb25fc3RyaW5nID0gbGFzdF9tb2RpZmljYXRpb24udG9Mb2NhbGVTdHJpbmcoXCJmclwiLCB7XG4gIFwiZGF5XCI6IFwibnVtZXJpY1wiLFxuICBcIm1vbnRoXCI6IFwibG9uZ1wiLFxuICBcInllYXJcIjogXCJudW1lcmljXCJcbn0pXG5cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImdpdF9oaXN0b3J5X3RhYmxlID0gSW5wdXRzLnRhYmxlKFxuICB0YWJsZV9jb21taXQsXG4gIHtcbiAgICBmb3JtYXQ6IHtcbiAgICAgIFNIQTogeCA9PiBtZGBbJHt4fV0oJHtnaXRodWJfcmVwb30vY29tbWl0LyR7eH0pYCxcbiAgICAgIERlc2NyaXB0aW9uOiB4ID0+IG1kYCR7cmVwbGFjZVB1bGxSZXF1ZXN0UGF0dGVybih4LCBnaXRodWJfcmVwbyl9YCxcbiAgICAgIC8qRGF0ZTogeCA9PiB4LnRvTG9jYWxlU3RyaW5nKFwiZnJcIiwge1xuICAgICAgICBcIm1vbnRoXCI6IFwibnVtZXJpY1wiLFxuICAgICAgICBcImRheVwiOiBcIm51bWVyaWNcIixcbiAgICAgICAgXCJ5ZWFyXCI6IFwibnVtZXJpY1wiXG4gICAgICAgIH0pXG4gICAgICAqL1xuICAgIH1cbiAgfVxuKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZ2l0X2hpc3RvcnlfcGxvdCA9IFBsb3QucGxvdCh7XG4gIG1hcmtzOiBbXG4gICAgUGxvdC5ydWxlWShbMF0sIHtzdHJva2U6IFwicm95YWxibHVlXCJ9KSxcbiAgICBQbG90LmRvdChcbiAgICAgICAgICB0YWJsZV9jb21taXQsXG4gICAgICAgICAgUGxvdC5wb2ludGVyWCh7eDogKGQpID0+IG5ldyBEYXRlKGQuZGF0ZSksIHk6IDAsIHN0cm9rZTogXCJyZWRcIn0pKSxcbiAgICBQbG90LmRvdCh0YWJsZV9jb21taXQsIHt4OiAoZCkgPT4gbmV3IERhdGUoZC5EYXRlKSwgeTogMCwgZmlsbDogXCJyb3lhbGJsdWVcIn0pXG4gIF1cbn0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gcmVwbGFjZVB1bGxSZXF1ZXN0UGF0dGVybihpbnB1dFN0cmluZywgZ2l0aHViUmVwbykge1xuICAgIC8vIFVzZSBhIHJlZ3VsYXIgZXhwcmVzc2lvbiB0byBtYXRjaCB0aGUgcGF0dGVybiAjZGlnaXRcbiAgICB2YXIgcGF0dGVybiA9IC8jKFxcZCspL2c7XG5cbiAgICAvLyBSZXBsYWNlIHRoZSBwYXR0ZXJuIHdpdGggJHtnaXRodWJfcmVwb30vcHVsbC8jZGlnaXRcbiAgICB2YXIgcmVwbGFjZWRTdHJpbmcgPSBpbnB1dFN0cmluZy5yZXBsYWNlKHBhdHRlcm4sICdbIyQxXSgnICsgZ2l0aHViUmVwbyArICcvcHVsbC8kMSknKTtcblxuICAgIHJldHVybiByZXBsYWNlZFN0cmluZztcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJnaXRodWJfcmVwbyA9IFwiaHR0cHM6Ly9naXRodWIuY29tL2xpbm9nYWxpYW5hL3B5dGhvbi1kYXRhc2NpZW50aXN0XCJcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ0YWJsZV9jb21taXQgPSB7XG5cbi8vIEdldCB0aGUgSFRNTCB0YWJsZSBieSBpdHMgY2xhc3MgbmFtZVxudmFyIHRhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmNvbW1pdC10YWJsZScpO1xuXG4vLyBDaGVjayBpZiB0aGUgdGFibGUgZXhpc3RzXG5pZiAodGFibGUpIHtcbiAgICAvLyBJbml0aWFsaXplIGFuIGFycmF5IHRvIHN0b3JlIHRoZSB0YWJsZSBkYXRhXG4gICAgdmFyIGRhdGFBcnJheSA9IFtdO1xuXG4gICAgLy8gRXh0cmFjdCBoZWFkZXJzIGZyb20gdGhlIGZpcnN0IHJvd1xuICAgIHZhciBoZWFkZXJzID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0YWJsZS5yb3dzWzBdLmNlbGxzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGhlYWRlcnMucHVzaCh0YWJsZS5yb3dzWzBdLmNlbGxzW2ldLnRleHRDb250ZW50LnRyaW0oKSk7XG4gICAgfVxuXG4gICAgLy8gSXRlcmF0ZSB0aHJvdWdoIHRoZSByb3dzLCBzdGFydGluZyBmcm9tIHRoZSBzZWNvbmQgcm93XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0YWJsZS5yb3dzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByb3cgPSB0YWJsZS5yb3dzW2ldO1xuICAgICAgICB2YXIgcm93RGF0YSA9IHt9O1xuXG4gICAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgY2VsbHMgaW4gdGhlIHJvd1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHJvdy5jZWxscy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgLy8gVXNlIGhlYWRlcnMgYXMga2V5cyBhbmQgY2VsbCBjb250ZW50IGFzIHZhbHVlc1xuICAgICAgICAgICAgcm93RGF0YVtoZWFkZXJzW2pdXSA9IHJvdy5jZWxsc1tqXS50ZXh0Q29udGVudC50cmltKCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQdXNoIHRoZSByb3dEYXRhIG9iamVjdCB0byB0aGUgZGF0YUFycmF5XG4gICAgICAgIGRhdGFBcnJheS5wdXNoKHJvd0RhdGEpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBkYXRhQXJyYXlcblxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlxuLy8gR2V0IHRoZSBlbGVtZW50IHdpdGggY2xhc3MgJ2dpdC1kZXRhaWxzJ1xue1xuICB2YXIgZ2l0RGV0YWlscyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5jb21taXQtdGFibGUnKTtcblxuICAvLyBDaGVjayBpZiB0aGUgZWxlbWVudCBleGlzdHNcbiAgaWYgKGdpdERldGFpbHMpIHtcbiAgICAgIC8vIEhpZGUgdGhlIGVsZW1lbnRcbiAgICAgIGdpdERldGFpbHMuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IlBsb3QgPSByZXF1aXJlKCdAb2JzZXJ2YWJsZWhxL3Bsb3RAMC42LjEyL2Rpc3QvcGxvdC51bWQubWluLmpzJylcbiJ9XX0=
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../content/manipulation";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pythonds\.linogaliana\.fr");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      if (authorPrefersDark) {
          [baseTheme, altTheme] = [altTheme, baseTheme];
      }
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "linogaliana/python-datascientist";
    script.dataset.repoId = "MDEwOlJlcG9zaXRvcnkyODAxNjE2Nzc=";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOELLtjc4B-5TX";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Python pour la <em>data science</em>, Lino Galiana.<br>
Licence <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i><br>
Code source disponible sur <a href="https://github.com/linogaliana/python-datascientist"><code>Github</code></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/manipulation/05_parquet_s3.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Site construit avec <i class="fa-brands fa-python" aria-label="python"></i> et <a href="https://quarto.org/"><code>Quarto</code></a><br>
<a href="https://github.com/linogaliana/python-datascientist">Code source disponible sur <i class="fa-brands fa-github" aria-label="github"></i> <code>GitHub</code></a></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>