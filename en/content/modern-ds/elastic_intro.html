<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lino Galiana">
<meta name="dcterms.date" content="2025-06-05">
<meta name="description" content="ElasticSearch est un moteur de recherche extrêmement rapide et flexible. Cette technologie s’est imposée dans le domaine du traitement des données textuelles. L’API Python permet d’intégrer cette technologie dans des processus Python afin de les accélérer. Ce chapitre présente cette intégration d’ Elastic avec l’exemple de la recherche dans les données alimentaires de l’ OpenFoodFacts Database">

<title>Introduction à ElasticSearch pour la recherche textuelle – Python for data science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../content/modern-ds/elastic_approfondissement.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-b9ffe74b40eb372d9442c4c226909c50.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-bcbb2d467579df28201c3c7b6c17bce5.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../site_libs/bootstrap/bootstrap-b9ffe74b40eb372d9442c4c226909c50.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #e9f3fa;
      }
</style>
<script id="toggle-light-dark-elements" type="application/javascript">
// Extend Quarto theme toggling to allow elements to be displayed/hidden in light/dark themes

// Replicated from https://github.com/quarto-dev/quarto-cli/blob/84d4659/src/resources/formats/html/templates/quarto-html.ejs
const getColorSchemeSentinel = () => {
  const localAlternateSentinel = 'default';
  if (window.location.protocol !== 'file:') {
    const storageValue = window.localStorage.getItem('quarto-color-scheme');
    return storageValue != null ? storageValue : localAlternateSentinel;
  } else {
    return localAlternateSentinel;
  }
};

// Function to toggle light and dark elements based on color scheme
const toggleColorSchemeElements = () => {
  const scheme = getColorSchemeSentinel();
  const lightElements = document.getElementsByClassName('only-light');
  const darkElements = document.getElementsByClassName('only-dark');

  for (var i = 0; i < lightElements.length; i++) {
    lightElements[i].style.display = scheme == 'default' ? 'block' : 'none';
  }
  for (var i = 0; i < darkElements.length; i++) {
    darkElements[i].style.display = scheme == 'default' ? 'none' : 'block';
  }
};

// Function to check if the user's browser prefers dark themes
const prefersDarkTheme = () => {
  if (window.matchMedia) {
    return window.matchMedia('(prefers-color-scheme: dark)').matches;
  }
  return false;
};

document.addEventListener('readystatechange', function() {
  // Set the default color scheme based on browser preference
  if (document.readyState === 'interactive' && window.location.protocol !== 'file:') {
    const storageValue = window.localStorage.getItem('quarto-color-scheme');
    if (storageValue == null && prefersDarkTheme()) {
      window.localStorage.setItem('quarto-color-scheme', 'alternate');
    }
  }
  // Add event listener for when the readyState is complete (and default toggler is set)
  if (document.readyState === 'complete') {
    // Toggle scheme once
    toggleColorSchemeElements();
    // Append our toggle function to the old one
    const oldToggle = window.quartoToggleColorScheme;
    window.quartoToggleColorScheme = () => {
      oldToggle();
      toggleColorSchemeElements();
    }
  }
});

</script>
<script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles/styles.css">
<meta name="twitter:title" content="Introduction à ElasticSearch pour la recherche textuelle – Python for data science">
<meta name="twitter:description" content="ElasticSearch est un moteur de recherche extrêmement rapide et flexible.
Cette technologie s’est imposée dans le domaine du traitement des
données textuelles. L’API Python permet d’intégrer cette
technologie dans des processus Python afin de les accélérer. Ce chapitre
présente cette intégration d’ Elastic avec l’exemple de la recherche
dans les données alimentaires de l’ OpenFoodFacts Database">
<meta name="twitter:image" content="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/detective_words.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="citation_title" content="Python pour la data science">
<meta name="citation_author" content="Lino Galiana">
<meta name="citation_publication_date" content="2023">
<meta name="citation_cover_date" content="2023">
<meta name="citation_year" content="2023">
<meta name="citation_online_date" content="2025-06-05">
<meta name="citation_fulltext_html_url" content="https://pythonds.linogaliana.fr/">
<meta name="citation_doi" content="10.5281/zenodo.8229676">
<meta name="citation_language" content="en">
<meta name="citation_reference" content="citation_title=Coding for economists;,citation_author=undefined Turrell;,citation_author=undefined contributors;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://aeturrell.github.io/coding-for-economists;">
<meta name="citation_reference" content="citation_title=The hugging face course, 2022;,citation_author=Hugging Face;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_publisher=https://huggingface.co/course;">
<meta name="citation_reference" content="citation_title=The signal and the noise: Why so many predictions fail-but some don’t;,citation_author=Nate Silver;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;">
<meta name="citation_reference" content="citation_title=Efficient estimation of word representations in vector space;,citation_author=Tomas Mikolov;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_volume=3781;,citation_journal_title=arXiv preprint arXiv:1301.3781;">
<meta name="citation_reference" content="citation_title=Attention is all you need;,citation_author=A Vaswani;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_journal_title=Advances in Neural Information Processing Systems;">
<meta name="citation_reference" content="citation_title=Tableau politique de la france de l’ouest sous la troisième république: 102 cartes et croquis, 1 carte hors texte;,citation_author=André Siegfried;,citation_publication_date=1913;,citation_cover_date=1913;,citation_year=1913;">
<meta name="citation_reference" content="citation_title=Statistical learning;,citation_author=Gareth James;,citation_author=Daniela Witten;,citation_author=Trevor Hastie;,citation_author=Robert Tibshirani;,citation_author=Jonathan Taylor;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_inbook_title=An introduction to statistical learning: With applications in python;">
<meta name="citation_reference" content="citation_title=Une histoire du conflit politique: Elections et inégalités sociales en france, 1789-2022;,citation_author=Thomas Piketty;,citation_author=Julia Cagé;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;">
<meta name="citation_reference" content="citation_title=Interpretable machine learning: A guide for making black box models explainable;,citation_author=Molnar Christoph;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;">
<meta name="citation_reference" content="citation_title=A gentle introduction to conformal prediction and distribution-free uncertainty quantification;,citation_author=Anastasios N Angelopoulos;,citation_author=Stephen Bates;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_journal_title=arXiv preprint arXiv:2107.07511;">
<meta name="citation_reference" content="citation_title=A brief history of data visualization;,citation_author=Chun-houh Chen;,citation_author=Wolfgang Härdle;,citation_author=Antony Unwin;,citation_author=Michael Friendly;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_journal_title=Handbook of data visualization;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Discovering statistics using r;,citation_author=A Field;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_publisher=Sage;">
<meta name="citation_reference" content="citation_title=psyTeachR Book Template;,citation_author=DeBruine Lisa;,citation_publication_date=2021-10;,citation_cover_date=2021-10;,citation_year=2021;,citation_fulltext_html_url=https://github.com/psyteachr/template/;">
<meta name="citation_reference" content="citation_title=The grammar of graphics;,citation_author=Leland Wilkinson;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;">
<meta name="citation_reference" content="citation_title=Hands-on machine learning with scikit-learn, keras, and TensorFlow;,citation_author=Aurélien Géron;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=A brief history of data visualization;,citation_author=Chun-houh Chen;,citation_author=Wolfgang Härdle;,citation_author=Antony Unwin;,citation_author=Michael Friendly;,citation_publication_date=2008;,citation_cover_date=2008;,citation_year=2008;,citation_journal_title=Handbook of data visualization;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Random forests;,citation_author=Leo Breiman;,citation_publication_date=2001;,citation_cover_date=2001;,citation_year=2001;,citation_volume=45;,citation_journal_title=Machine learning;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=Bagging predictors;,citation_author=Leo Breiman;,citation_publication_date=1996;,citation_cover_date=1996;,citation_year=1996;,citation_volume=24;,citation_journal_title=Machine learning;,citation_publisher=Springer;">
<meta name="citation_reference" content="citation_title=R for data science;,citation_author=Hadley Wickham;,citation_author=Mine Çetinkaya-Rundel;,citation_author=Garrett Grolemund;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;">
<meta name="citation_reference" content="citation_title=Computational reproducibility of jupyter notebooks from biomedical publications;,citation_author=Sheeba Samuel;,citation_author=Daniel Mietchen;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://arxiv.org/abs/2308.07333;">
<meta name="citation_reference" content="citation_title=Python data science handbook: Essential tools for working with data;,citation_author=Jake VanderPlas;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;">
<meta name="citation_reference" content="citation_title=Machine learning methods that economists should know about;,citation_author=Susan Athey;,citation_author=Guido W Imbens;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_volume=11;,citation_journal_title=Annual Review of Economics;,citation_publisher=Annual Reviews;">
<meta name="citation_reference" content="citation_title=Fuzzy matching on big-data an illustration with scanner data and crowd-sourced nutritional data;,citation_author=Lino Galiana;,citation_author=Milena Suarez Castillo;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_publisher=Proceedings of the 2022 &amp;amp;amp;quot;Journées de Méthodologie Statistiques&amp;quot;;">
<meta name="citation_reference" content="citation_title=Data visualization with python and JavaScript;,citation_author=Kyran Dale;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;">
<meta name="citation_reference" content="citation_title=Sémiologie graphique;,citation_author=Jacques Bertin;,citation_publication_date=1967;,citation_cover_date=1967;,citation_year=1967;">
<meta name="citation_reference" content="citation_title=La sémiologie graphique de jacques bertin a cinquante ans;,citation_author=Gilles Palsky;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_journal_title=Visions carto (en ligne);">
<meta name="citation_reference" content="citation_title=Fundamentals of data visualization: A primer on making informative and compelling figures;,citation_author=Claus O Wilke;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=How to train BERT with an academic budget;,citation_author=Peter Izsak;,citation_author=Moshe Berchansky;,citation_author=Omer Levy;,citation_publication_date=2021;,citation_cover_date=2021;,citation_year=2021;,citation_fulltext_html_url=https://arxiv.org/abs/2104.07705;">
<meta name="citation_reference" content="citation_title=Python for data analysis: Data wrangling with pandas, NumPy, and IPython;,citation_author=Wes McKinney;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;">
<meta name="citation_reference" content="citation_title=Residential segregation, daytime segregation and spatial frictions: An analysis from mobile phone data;,citation_author=Lino Galiana;,citation_author=François Sémécurbe;,citation_author=Benjamin Sakarovitch;,citation_author=Zbigniew Smoreda;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_publisher=Insee Working Paper;">
<meta name="citation_reference" content="citation_title=Fuzzy matching on big-data: An illustration with scanner and crowd-sourced nutritional datasets;,citation_abstract=Food retailers’ scanner data provide unprecedented details on local consumption, provided that product identifiers allow a linkage with features of interest, such as nutritional information. In this paper, we enrich a large retailer dataset with nutritional information extracted from crowd-sourced and administrative nutritional datasets. To compensate for imperfect matching through the barcode, we develop a methodology to efficiently match short textual descriptions. After a preprocessing step to normalize short labels, we resort to fuzzy matching based on several tokenizers (including n-grams) by querying an ElasticSearch customized index and validate candidates echos as matches with a Levensthein edit-distance and an embedding-based similarity measure created from a siamese neural network model. The pipeline is composed of several steps successively relaxing constraints to find relevant matching candidates.;,citation_author=Lino Galiana;,citation_author=Milena Suarez Castillo;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://doi.org/10.1145/3524458.3547244;,citation_doi=10.1145/3524458.3547244;,citation_isbn=9781450392846;,citation_conference_title=Proceedings of the 2022 ACM conference on information technology for social good;,citation_conference=Association for Computing Machinery;,citation_series_title=GoodIT ’22;">
<meta name="citation_reference" content="citation_title=Guide de sémiologie cartographique;,citation_author=undefined Insee;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_publisher=Insee Working Paper;">
<meta name="citation_reference" content="citation_title=Energy and policy considerations for deep learning in NLP;,citation_author=Emma Strubell;,citation_author=Ananya Ganesh;,citation_author=Andrew McCallum;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=https://arxiv.org/abs/1906.02243;">
<meta name="citation_reference" content="citation_title=High-resolution image synthesis with latent diffusion models;,citation_author=Robin Rombach;,citation_author=Andreas Blattmann;,citation_author=Dominik Lorenz;,citation_author=Patrick Esser;,citation_author=Björn Ommer;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_conference_title=Proceedings of the IEEE/CVF conference on computer vision and pattern recognition (CVPR);">
<meta name="citation_reference" content="citation_title=Apache arrow and the&amp;amp;amp;quot; 10 things i hate about pandas;,citation_author=Wes McKinney;,citation_publication_date=2017;,citation_cover_date=2017;,citation_year=2017;,citation_volume=21;,citation_journal_title=Blog, September;">
<meta name="citation_reference" content="citation_title=Many researchers were not compliant with their published data sharing statement: Mixed-methods study;,citation_author=Mirko Gabelica;,citation_author=Ružica Bojčić;,citation_author=Livia Puljak;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_journal_title=Journal of Clinical Epidemiology;,citation_publisher=Elsevier;">
<meta name="citation_reference" content="citation_title=Credit scoring in the era of big data;,citation_author=Mikella Hurley;,citation_author=Julius Adebayo;,citation_publication_date=2016;,citation_cover_date=2016;,citation_year=2016;,citation_volume=18;,citation_journal_title=Yale JL &amp;amp;amp; Tech.;,citation_publisher=HeinOnline;">
<meta name="citation_reference" content="citation_title=Econometrics and machine learning;,citation_author=Arthur Charpentier;,citation_author=Emmanuel Flachaire;,citation_author=Antoine Ly;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=1;,citation_volume=505;,citation_journal_title=Economie et Statistique;,citation_publisher=Persée-Portail des revues scientifiques en SHS;">
<meta name="citation_reference" content="citation_title=Machine learning: An applied econometric approach;,citation_author=Sendhil Mullainathan;,citation_author=Jann Spiess;,citation_publication_date=2017-05;,citation_cover_date=2017-05;,citation_year=2017;,citation_fulltext_html_url=https://www.aeaweb.org/articles?id=10.1257/jep.31.2.87;,citation_issue=2;,citation_doi=10.1257/jep.31.2.87;,citation_volume=31;,citation_journal_title=Journal of Economic Perspectives;">
<meta name="citation_reference" content="citation_title=Le problème du réalisme des hypothèses en économie politique;,citation_author=Pierre Salmon;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;">
<meta name="citation_reference" content="citation_title=The methodology of positive economics;,citation_author=Milton Friedman;,citation_publication_date=1953;,citation_cover_date=1953;,citation_year=1953;,citation_inbook_title=Essays in positive economics;">
<meta name="citation_reference" content="citation_title=L’empreinte carbone du numérique;,citation_author=undefined Arcep;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=Leakage and the reproducibility crisis in ML-based science;,citation_author=Sayash Kapoor;,citation_author=Arvind Narayanan;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://arxiv.org/abs/2207.07048;,citation_doi=10.48550/ARXIV.2207.07048;,citation_publisher=arXiv;">
<meta name="citation_reference" content="citation_title=Growth in a time of debt;,citation_author=Carmen M Reinhart;,citation_author=Kenneth S Rogoff;,citation_publication_date=2010;,citation_cover_date=2010;,citation_year=2010;,citation_issue=2;,citation_volume=100;,citation_journal_title=American economic review;,citation_publisher=American Economic Association;">
<meta name="citation_reference" content="citation_title=We do not know the population of every country in the world for the past two thousand years;,citation_author=Timothy W Guinnane;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=3;,citation_volume=83;,citation_journal_title=The Journal of Economic History;">
<meta name="citation_reference" content="citation_title=Artificial intelligence: A modern approach (4th edition);,citation_author=Stuart J. Russell;,citation_author=Peter Norvig;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=http://aima.cs.berkeley.edu/;,citation_isbn=9781292401133;">
<meta name="citation_reference" content="citation_title=Data scientist, the sexiest job of the 21st century;,citation_author=Thomas H Davenport;,citation_author=DJ Patil;,citation_publication_date=2012;,citation_cover_date=2012;,citation_year=2012;,citation_fulltext_html_url=https://hbr.org/2012/10/data-scientist-the-sexiest-job-of-the-21st-century;,citation_issue=5;,citation_volume=90;,citation_journal_title=Harvard business review;">
<meta name="citation_reference" content="citation_title=Is data scientist still the sexiest job of the 21st century?;,citation_author=Thomas H Davenport;,citation_author=DJ Patil;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_volume=90;,citation_journal_title=Harvard Business Review;,citation_publisher=Harvard Business Publishing;">
<meta name="citation_reference" content="citation_title=Leakage and the reproducibility crisis in machine-learning-based science;,citation_author=Sayash Kapoor;,citation_author=Arvind Narayanan;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_issue=9;,citation_volume=4;,citation_journal_title=Patterns;,citation_publisher=Elsevier;">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="../../content/getting-started/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/01_environment.html">
 <span class="dropdown-text">A functional Python environment for data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/02_data_analysis.html">
 <span class="dropdown-text">How to deal with a data set</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/getting-started/03_revisions.html">
 <span class="dropdown-text">A few refresher exercises to get back in the saddle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-wrangle" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Wrangle</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-wrangle">    
        <li>
    <a class="dropdown-item" href="../../content/manipulation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/01_numpy.html">
 <span class="dropdown-text">Numpy, the foundation of data science</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02_pandas_intro.html">
 <span class="dropdown-text">Introduction to Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/02_pandas_suite.html">
 <span class="dropdown-text">Data wrangling with Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/03_geopandas_intro.html">
 <span class="dropdown-text">Introduction to spatial data with Geopandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04a_webscraping_TP.html">
 <span class="dropdown-text">Web scraping with Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04c_API_TP.html">
 <span class="dropdown-text">Retrieve data with APIs from Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/manipulation/04b_regex_TP.html">
 <span class="dropdown-text">Mastering regular expressions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-communicate" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Communicate</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-communicate">    
        <li>
    <a class="dropdown-item" href="../../content/visualisation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/matplotlib.html">
 <span class="dropdown-text">Building graphics with Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/visualisation/maps.html">
 <span class="dropdown-text">Introduction to cartography with Python</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-model" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Model</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-model">    
        <li>
    <a class="dropdown-item" href="../../content/modelisation/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/0_preprocessing.html">
 <span class="dropdown-text">Preprocessing before building machine learning models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/1_modelevaluation.html">
 <span class="dropdown-text">Evaluating model quality</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/3_regression.html">
 <span class="dropdown-text">An introduction to regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/4_featureselection.html">
 <span class="dropdown-text">Variable selection: an introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/5_clustering.html">
 <span class="dropdown-text">Clustering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/6_pipeline.html">
 <span class="dropdown-text">Premier pas vers l’industrialisation avec les pipelines scikit</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modelisation/7_mlapi.html">
 <span class="dropdown-text">Mettre à disposition un modèle par le biais d’une API</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nlp" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">NLP</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nlp">    
        <li>
    <a class="dropdown-item" href="../../content/NLP/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/01_intro.html">
 <span class="dropdown-text">Cleaning and structuring information in textual data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/02_exoclean.html">
 <span class="dropdown-text">Frequentist analysis using the bag-of-words approach: forces and limitations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/NLP/03_embedding.html">
 <span class="dropdown-text">Synthetizing textual information with embeddings</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-depth" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-depth</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-depth">    
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/continuous_integration.html">
 <span class="dropdown-text">Intégration continue avec Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/s3.html">
 <span class="dropdown-text">Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_approfondissement.html">
 <span class="dropdown-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/modern-ds/elastic_intro.html">
 <span class="dropdown-text">Introduction à ElasticSearch pour la recherche textuelle</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-git" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Git</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-git">    
        <li>
    <a class="dropdown-item" href="../../content/git/index.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/introgit.html">
 <span class="dropdown-text">Découvrir Git par la pratique: la gymnastique quotidienne</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/git/exogit.html">
 <span class="dropdown-text">Un cadavre exquis pour découvrir le travail collaboratif <code>Git</code></span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-annexes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Annexes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-annexes">    
        <li>
    <a class="dropdown-item" href="../../content/annexes/evaluation.html">
 <span class="dropdown-text">Évaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../content/annexes/corrections.html">
 <span class="dropdown-text">Corrections</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://linogaliana.github.io/python-datascientist-slides/#/title-slide">
 <span class="dropdown-text">Slides de présentation</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/linogaliana/python-datascientist" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../content/modern-ds/elastic_intro.html">Introduction à ElasticSearch pour la recherche textuelle</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Introduction à ElasticSearch pour la recherche textuelle</h1>
                  <div>
        <div class="description">
          <p><code>ElasticSearch</code> est un moteur de recherche extrêmement rapide et flexible.
          Cette technologie s’est imposée dans le domaine du traitement des
          données textuelles. L’API <code>Python</code> permet d’intégrer cette
          technologie dans des processus <code>Python</code> afin de les accélérer. Ce chapitre
          présente cette intégration d’ <code>Elastic</code> avec l’exemple de la recherche
          dans les données alimentaires de l’ <code>OpenFoodFacts</code> Database</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Tutoriel</div>
                <div class="quarto-category">Avancé</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Lino Galiana </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">2025-06-05</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/continuous_integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intégration continue avec Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/s3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Les nouveaux modes d’accès aux données : le format Parquet et les données sur le cloud</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/elastic_approfondissement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../content/modern-ds/elastic_intro.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Introduction à ElasticSearch pour la recherche textuelle</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#réplication-de-ce-chapitre" id="toc-réplication-de-ce-chapitre" class="nav-link" data-scroll-target="#réplication-de-ce-chapitre"><span class="header-section-number">1.1</span> Réplication de ce chapitre</a></li>
  <li><a href="#cas-dusage" id="toc-cas-dusage" class="nav-link" data-scroll-target="#cas-dusage"><span class="header-section-number">1.2</span> Cas d’usage</a></li>
  </ul></li>
  <li><a href="#données-utilisées" id="toc-données-utilisées" class="nav-link" data-scroll-target="#données-utilisées"><span class="header-section-number">2</span> Données utilisées</a>
  <ul class="collapse">
  <li><a href="#les-bases-offrant-des-informations-nutritionnelles" id="toc-les-bases-offrant-des-informations-nutritionnelles" class="nav-link" data-scroll-target="#les-bases-offrant-des-informations-nutritionnelles"><span class="header-section-number">2.1</span> Les bases offrant des informations nutritionnelles</a></li>
  <li><a href="#import" id="toc-import" class="nav-link" data-scroll-target="#import"><span class="header-section-number">2.2</span> Import</a></li>
  </ul></li>
  <li><a href="#elasticsearch-mais-ce-nest-pas-du-python" id="toc-elasticsearch-mais-ce-nest-pas-du-python" class="nav-link" data-scroll-target="#elasticsearch-mais-ce-nest-pas-du-python"><span class="header-section-number">3</span> ElasticSearch ? Mais ce n’est pas du Python ?!</a>
  <ul class="collapse">
  <li><a href="#quest-ce-quelastic" id="toc-quest-ce-quelastic" class="nav-link" data-scroll-target="#quest-ce-quelastic"><span class="header-section-number">3.1</span> Qu’est-ce qu’Elastic ?</a></li>
  <li><a href="#elasticsearch-et-python" id="toc-elasticsearch-et-python" class="nav-link" data-scroll-target="#elasticsearch-et-python"><span class="header-section-number">3.2</span> <code>ElasticSearch</code> et <code>Python</code></a></li>
  </ul></li>
  <li><a href="#premières-limites-de-la-distance-de-levenshtein" id="toc-premières-limites-de-la-distance-de-levenshtein" class="nav-link" data-scroll-target="#premières-limites-de-la-distance-de-levenshtein"><span class="header-section-number">4</span> Premières limites de la distance de Levenshtein</a>
  <ul class="collapse">
  <li><a href="#premier-essai-les-produits-ciqual-les-plus-similaires-aux-produits-de-la-recette" id="toc-premier-essai-les-produits-ciqual-les-plus-similaires-aux-produits-de-la-recette" class="nav-link" data-scroll-target="#premier-essai-les-produits-ciqual-les-plus-similaires-aux-produits-de-la-recette"><span class="header-section-number">4.1</span> Premier essai: les produits <code>Ciqual</code> les plus similaires aux produits de la recette</a></li>
  </ul></li>
  <li><a href="#preprocessing-pour-améliorer-la-pertinence-des-matches" id="toc-preprocessing-pour-améliorer-la-pertinence-des-matches" class="nav-link" data-scroll-target="#preprocessing-pour-améliorer-la-pertinence-des-matches"><span class="header-section-number">5</span> Preprocessing pour améliorer la pertinence des matches</a>
  <ul class="collapse">
  <li><a href="#objectif" id="toc-objectif" class="nav-link" data-scroll-target="#objectif"><span class="header-section-number">5.1</span> Objectif</a></li>
  <li><a href="#démarche" id="toc-démarche" class="nav-link" data-scroll-target="#démarche"><span class="header-section-number">5.2</span> Démarche</a></li>
  <li><a href="#approche-systématique" id="toc-approche-systématique" class="nav-link" data-scroll-target="#approche-systématique"><span class="header-section-number">5.3</span> Approche systématique</a></li>
  <li><a href="#réduire-les-temps-de-recherche" id="toc-réduire-les-temps-de-recherche" class="nav-link" data-scroll-target="#réduire-les-temps-de-recherche"><span class="header-section-number">5.4</span> Réduire les temps de recherche</a></li>
  </ul></li>
  <li><a href="#indexer-une-base" id="toc-indexer-une-base" class="nav-link" data-scroll-target="#indexer-une-base"><span class="header-section-number">6</span> Indexer une base</a>
  <ul class="collapse">
  <li><a href="#créer-un-cluster-elastic-sur-le-datalab" id="toc-créer-un-cluster-elastic-sur-le-datalab" class="nav-link" data-scroll-target="#créer-un-cluster-elastic-sur-le-datalab"><span class="header-section-number">6.1</span> Créer un cluster <code>Elastic</code> sur le DataLab</a></li>
  <li><a href="#première-indexation" id="toc-première-indexation" class="nav-link" data-scroll-target="#première-indexation"><span class="header-section-number">6.2</span> Première indexation</a></li>
  <li><a href="#première-recherche" id="toc-première-recherche" class="nav-link" data-scroll-target="#première-recherche"><span class="header-section-number">6.3</span> Première recherche</a></li>
  <li><a href="#limite-de-cette-première-indexation" id="toc-limite-de-cette-première-indexation" class="nav-link" data-scroll-target="#limite-de-cette-première-indexation"><span class="header-section-number">6.4</span> Limite de cette première indexation</a></li>
  </ul></li>
  <li><a href="#améliorer-lindexation" id="toc-améliorer-lindexation" class="nav-link" data-scroll-target="#améliorer-lindexation"><span class="header-section-number">7</span> Améliorer l’indexation</a>
  <ul class="collapse">
  <li><a href="#une-indexation-plus-adaptée" id="toc-une-indexation-plus-adaptée" class="nav-link" data-scroll-target="#une-indexation-plus-adaptée"><span class="header-section-number">7.0.1</span> Une indexation plus adaptée</a></li>
  <li><a href="#nos-premières-requêtes" id="toc-nos-premières-requêtes" class="nav-link" data-scroll-target="#nos-premières-requêtes"><span class="header-section-number">7.1</span> Nos premières requêtes</a></li>
  <li><a href="#informations-additionnelles" id="toc-informations-additionnelles" class="nav-link" data-scroll-target="#informations-additionnelles">Informations additionnelles</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/modern-ds/elastic_intro.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<a href="#" onclick="this.href = location.href.replace('/en/', '/');" class="button-cta">
<button class="btn"><i class="fa fa-language"></i> Passer à la version française 🇫🇷</button>
</a></p>
<p>Pour essayer les exemples présents dans ce tutoriel :</p>
<div class="badge-container"><div class="badge-text">If you want to try the examples in this tutorial:</div><a href="https://github.com/linogaliana/python-datascientist-notebooks/blob/main/notebooks/en/modern-ds/elastic_intro.ipynb" target="_blank" rel="noopener"><img src="https://img.shields.io/static/v1?logo=github&amp;label=&amp;message=View%20on%20GitHub&amp;color=181717" alt="View on GitHub"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/vscode-python?autoLaunch=true&amp;name=«elastic_intro»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-vscode.sh»&amp;init.personalInitArgs=«en/modern-ds%20elastic_intro%20correction»" target="_blank" rel="noopener"><img src="https://custom-icon-badges.demolab.com/badge/SSP%20Cloud-Lancer_avec_VSCode-blue?logo=vsc&amp;logoColor=white" alt="Onyxia"></a>
<a href="https://datalab.sspcloud.fr/launcher/ide/jupyter-python?autoLaunch=true&amp;name=«elastic_intro»&amp;init.personalInit=«https%3A%2F%2Fraw.githubusercontent.com%2Flinogaliana%2Fpython-datascientist%2Fmain%2Fsspcloud%2Finit-jupyter.sh»&amp;init.personalInitArgs=«en/modern-ds%20elastic_intro%20correction»" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/SSP%20Cloud-Lancer_avec_Jupyter-orange?logo=Jupyter&amp;logoColor=orange" alt="Onyxia"></a>
<a href="https://colab.research.google.com/github/linogaliana/python-datascientist-notebooks-colab//en/blob/main//notebooks/en/modern-ds/elastic_intro.ipynb" target="_blank" rel="noopener"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a><br></div>
<p>Ce chapitre a été écrit avec <a href="https://milenasuarezcastillo.netlify.app/">Milena Suarez-Castillo</a>
et présente quelques éléments qui servent de base à un travail en cours
sur les inégalités socioéconomiques dans les
choix de consommation alimentaire.</p>
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<section id="réplication-de-ce-chapitre" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="réplication-de-ce-chapitre"><span class="header-section-number">1.1</span> Réplication de ce chapitre</h2>
<p>Ce chapitre est plus exigeant en termes d’infrastructures que les précédents.
Si la première partie de ce chapitre peut être menée avec une
installation standard de <code>Python</code>, ce n’est pas le cas de la
deuxième qui nécessite un serveur <code>ElasticSearch</code>. Les utilisateurs du
<a href="datalab.sspcloud.fr/">SSP Cloud</a> pourront répliquer les exemples de ce cours
car cette technologie est disponible (que ce soit pour indexer une base ou
pour requêter une base existante).</p>
<p>⚠️ Ce
chapitre nécessite une version particulière du
package <code>ElasticSearch</code> pour tenir compte de l’héritage de la version 7 du moteur <code>Elastic</code>.
Pour cela, faire</p>
<div id="90ff885b" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install elasticsearch<span class="op">==</span><span class="fl">8.2.0</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install unidecode</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install rapidfuzz</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install xlrd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>La première partie de ce tutoriel ne nécessite pas d’architecture particulière et
peut ainsi être exécutée en utilisant les packages suivants :</p>
<div id="41397010" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le script <code>functions.py</code>, disponible sur <code>Github</code>,
regroupe un certain nombre de fonctions utiles permettant
d’automatiser certaines tâches de nettoyage classiques
en NLP.</p>
<div class="cell markdown">
<div class="alert alert-warning" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-lightbulb"></i> Hint</h3>
<p>Plusieurs méthodes peuvent être mises en oeuvre pour récupérer
le script d’utilitaires. Vous pouvez trouver en dessous
de cet encadré une méthode qui va chercher la dernière
version sur le dépôt <code>Github</code> du cours</p>
</div>
</div>
<div id="77e5dc8f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://github.com/linogaliana/python-datascientist/raw/main/content/modern-ds/functions.py"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> requests.get(url, allow_redirects<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="bu">open</span>(<span class="st">'functions.py'</span>, <span class="st">'wb'</span>).write(r.content)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Après l’avoir récupéré (cf.&nbsp;encadré dédié),
il convient d’importer les fonctions sous forme de module:</p>
<div id="e7058497" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> functions <span class="im">as</span> fc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cas-dusage" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="cas-dusage"><span class="header-section-number">1.2</span> Cas d’usage</h2>
<p>Ce <em>notebook</em> recense et propose d’appréhender quelques outils utilisés
pour le papier présenté aux
<a href="http://jms-insee.fr/jms2022s28_2/">Journées de Méthodologie Statistiques 2022: Galiana and Suarez-Castillo, <em>“Fuzzy matching on big-data: an illustration with scanner data and crowd-sourced nutritional data”</em></a>
(travail en cours!)</p>
<p>On va partir du cas d’usage suivant :</p>
<blockquote class="blockquote">
<p>Combien de calories dans ma recette de cuisine de ce soir? Combien de calories dans mes courses de la semaine?</p>
</blockquote>
<p>L’objectif est de reconstituer, à partir de libellés de produits, les caractéristiques nutritionnelles d’une recette.
Le problème est que les libellés des tickets de caisse ne sont pas des champs textuels très propres, ils contiennent,
par exemple, beaucoup d’abbréviations, toutes n’étant pas évidentes.</p>
<p>Voici par exemple une série de noms de produits qu’on va utiliser par la suite:</p>
<div id="23a2d32c" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ticket <span class="op">=</span> [<span class="st">'CROISSANTS X6 400G'</span>,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">'MAQUEREAUX MOUTAR.'</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">'IGP OC SAUVIGNON B'</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">'LAIT 1/2 ECRM UHT'</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">'6 OEUFS FRAIS LOCA'</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">'ANANAS C2'</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'L POMME FUDJI X6 CAL 75/80 1KG ENV'</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'PLT MIEL'</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'STELLA ARTOIS X6'</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">'COTES DU LUBERON AIGUEBRUN 75C'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A ces produits, s’ajoutent les ingrédients suivants, issus de la
<a href="https://www.marmiton.org/recettes/recette_veloute-de-potiron-et-carottes_19009.aspx">recette du velouté de potiron et carottes de Marmiton</a>
qui sera notre plat principal :</p>
<div id="96654daf" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ingredients <span class="op">=</span> [<span class="st">'500 g de carottes'</span>,</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'2 pommes de terre'</span>,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="st">"1 gousse d'ail"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'1/2 l de lait'</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'1/2 l de bouillon de volaille'</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a> <span class="st">"1 cuillère à soupe de huile d'olive"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'1 kg de potiron'</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'1 oignon'</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'10 cl de crème liquide (facultatif)'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Essayer de récupérer par web scraping cette liste est un bon exercice pour réviser
les concepts <a href="#webscraping">vus précédemment</a></p>
<p>On va donc créer une liste de course compilant
ces deux
listes hétérogènes de noms de produits:</p>
<div id="c1166931" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>libelles <span class="op">=</span> ticket <span class="op">+</span> ingredients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On part avec cette liste dans notre supermarché virtuel. L’objectif sera de trouver
une méthode permettant de passer à l’échelle:
automatiser les traitements, effectuer des recherches efficaces, garder une certaine généralité et flexibilité.</p>
<p>Ce chapitre montrera par l’exemple l’intérêt d’<code>Elastic</code> par rapport à une solution
qui n’utiliserait que du <code>Python</code>.</p>
</section>
</section>
<section id="données-utilisées" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Données utilisées</h1>
<section id="les-bases-offrant-des-informations-nutritionnelles" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="les-bases-offrant-des-informations-nutritionnelles"><span class="header-section-number">2.1</span> Les bases offrant des informations nutritionnelles</h2>
<p>Pour un nombre restreint de produits, on pourrait bien sûr chercher à
la main les caractéristiques des produits en utilisant les
fonctionalités d’un moteur de recherche:</p>
<p><a href="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/fraise.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/fraise.png" class="img-fluid"></a></p>
<p>Cependant, cette approche serait très fastidieuse et
nécessiterait de récuperer, à la main, chaque caractéristique
pour chaque produit. Ce n’est donc pas envisageable.</p>
<p>Les données disponibles sur <code>Google</code> viennent de l’<a href="https://fdc.nal.usda.gov/">USDA</a>,
l’équivalent américain de notre Ministère de l’Agriculture.
Cependant, pour des recettes comportant des noms de produits français, ainsi que
des produits potentiellement transformés, ce n’est pas très pratique d’utiliser
une base de données de produits agricoles en Français. Pour cette raison,
nous proposons d’utiliser les deux bases suivantes,
qui servent de base au travail de
<a href="https://dl.acm.org/doi/10.1145/3524458.3547244"><span class="citation" data-cites="galiana2022">Galiana and Suarez Castillo (<span>2022</span>)</span></a></p>
<ul>
<li>L’<a href="https://fr.openfoodfacts.org/"><code>OpenFoodFacts</code> database</a> qui est une base<br>
collaborative française de produits alimentaires. Issue d’un projet <a href="https://dataforgood.fr/">Data4Good</a>, il s’agit d’une
alternative <em>opensource</em> et <em>opendata</em> à la base de données de l’application <a href="https://yuka.io/">Yuka</a>.</li>
<li>La table de composition nutritionnelle <a href="https://ciqual.anses.fr"><code>Ciqual</code></a> produite par l’Anses. Celle-ci
propose la composition nutritionnelle <em>moyenne</em> des aliments les plus consommés en France. Il s’agit d’une base de données
enrichie par rapport à celle de l’USDA puisqu’elle ne se cantonne pas aux produits agricoles non transformés.
Avec cette base, il ne s’agit pas de trouver un produit exact mais essayer de trouver un produit type proche du produit
dont on désire connaître les caractéristiques.</li>
</ul>
<p><a href="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/openfood.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/openfood.png" class="img-fluid"></a></p>
</section>
<section id="import" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="import"><span class="header-section-number">2.2</span> Import</h2>
<p>Quelques fonctions utiles sont regroupées dans le script <code>functions.py</code> et importées dans le <em>notebook</em>.</p>
<p>La base <code>OpenFood</code> peut être récupérée en ligne
via la fonction <code>fc.import_openfood</code>. Néanmoins, cette opération nécessitant
un certain temps (les données brutes faisant autour de 2Go), nous proposons une méthode
pour les utilisateurs du <code>SSP Cloud</code> où une version est disponible sur
l’espace de stockage.</p>
<p>La base <code>Ciqual</code>, qui plus légère, est récupérée elle directement en ligne
via la fonction <code>fc.import_ciqual</code>.</p>
<div id="2b88bdc4" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les utilisateurs du SSP Cloud</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>openfood <span class="op">=</span> fc.import_openfood_s3()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Pour les utilisateurs hors du SSP Cloud</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># openfood = fc.import_openfood()</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>ciqual <span class="op">=</span> fc.import_ciqual()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="56bb6ecb" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>openfood.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="295fe683" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>ciqual.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="elasticsearch-mais-ce-nest-pas-du-python" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> ElasticSearch ? Mais ce n’est pas du Python ?!</h1>
<section id="quest-ce-quelastic" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="quest-ce-quelastic"><span class="header-section-number">3.1</span> Qu’est-ce qu’Elastic ?</h2>
<p><code>ElasticSearch</code> c’est un logiciel qui fournit un moteur de recherche installé sur
un serveur (ou une machine personnelle) qu’il est possible de requêter depuis un client
(une session <code>Python</code> par exemple).
C’est un moteur de recherche
très performant, puissant et flexible, extrêmement utilisé dans le domaine de la datascience
sur données textuelles.</p>
<p>Un cas d’usage est par exemple de trouver,
dans un corpus de grande dimension
(plusieurs sites web, livres…), un certain texte en s’autorisant des termes voisins
(verbes conjugués, fautes de frappes…).</p>
<p>Un <strong>index</strong> est une collection de documents dans lesquels on souhaite chercher, préalablement ingérés dans un moteur de recherche les documents sont les établissements.
L’<strong>indexation</strong> consiste à pré-réaliser les traitements des termes des documents pour gagner en efficacité lors de la phase de recherche.
L’indexation est faite une fois pour de nombreuses recherches potentielles, pour lesquelles la rapidité de réponse peut être cruciale.
Après avoir indexé une base, on effectuera des <strong>requêtes</strong> qui sont des recherches
d’un document dans la base indexé (équivalent de notre <em>web</em>) à partir de
termes de recherche normalisés.</p>
<p>Le principe est le même que celui d’un moteur de recherche du web comme <code>Google</code>.
D’un côté, l’ensemble à parcourir est indexé pour être en
mesure de parcourir de manière efficace l’ensemble du corpus.
De l’autre côté, la phase de recherche permet de retrouver l’élément du corpus le
plus cohérent avec la requête de recherche.
L’indexation consiste, par exemple,
à pré-définir des traitements des termes du corpus pour gagner en efficacité
lors de la phase de recherche. En effet, l’indexation est une opération peu fréquente
par rapport à la recherche. Pour cette dernière, l’efficacité est cruciale (un site web
qui prend plusieurs secondes à interpréter une requête simple ne sera pas utilisé). Mais, pour
l’indexation, ceci est moins crucial.</p>
<p>Les documents sont constitués de variables, les <strong>champs</strong> (<em>‘fields’</em>),
dont le type est spécifié (<em>“text”</em>, <em>“keywoard”</em>, <em>“geo_point”</em>, <em>“numeric”</em>…) à l’indexation.</p>
<p><code>ElasticSearch</code> propose une interface graphique nommée <code>Kibana</code>.
Celle-ci est pratique
pour tester des requêtes et pour superviser le serveur Elastic. Cependant,
pour le passage à l’échelle, notamment pour mettre en lien une base indexée dans
Elastic avec une autre source de données, les API proposées par <code>ElasticSearch</code>
sont beaucoup plus pratiques. Ces API permettent de connecter une session <code>Python</code> (idem pour <code>R</code>)
à un serveur <code>Elastic</code> afin de communiquer avec lui
(échanger des flux via une API REST).</p>
</section>
<section id="elasticsearch-et-python" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="elasticsearch-et-python"><span class="header-section-number">3.2</span> <code>ElasticSearch</code> et <code>Python</code></h2>
<p>En <code>Python</code>, le package officiel est <a href="https://elasticsearch-py.readthedocs.io/en/v7.12.0/"><code>elasticsearch</code></a>.
Ce dernier permet de configurer les paramètres pour interagir avec un serveur, indexer
une ou plusieurs bases, envoyer de manière automatisée un ensemble de requêtes
au serveur, récupérer les résultats directement dans une session <code>Python</code>…</p>
</section>
</section>
<section id="premières-limites-de-la-distance-de-levenshtein" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Premières limites de la distance de Levenshtein</h1>
<p>Pour évaluer la similarité entre deux données textuelles, il est
nécessaire de transformer l’information qualitative qu’est le nom
du produit en information quantitative qui permettra de rapprocher
différents types de produits.
Les ordinateurs ont en effet besoin de transformer les informations
textuelles en information numérique pour être en mesure
de les exploiter.</p>
<p>On appelle <strong>distance de Levenshtein</strong> entre deux chaînes de caractères
le coût minimal (en nombre d’opérations)
pour transformer la première en la seconde par:</p>
<ul>
<li>substitution</li>
<li>insertion</li>
<li>suppression</li>
</ul>
<p>La distance de Levenshtein est une mesure très utilisée pour comparer la similarité entre deux
chaînes de caractères. Il existe plusieurs packages pour calculer cette dernière.
<code>fuzzywuzzy</code> est le plus connu mais ce dernier est assez lent (implémentation en pur <code>Python</code>).
Le package <code>rapidfuzz</code>, présenté ici, propose les mêmes fonctionalités mais est plus rapide car implémenté
en <code>C++</code> qui est plus efficace.
Cependant, nous allons le voir, ce package ne nous
offrira pas des performances
assez bonnes pour que nous puissions
passer à l’échelle.</p>
<p>Voici trois exemples pour évaluer le coût de chaque
opération:</p>
<div id="b10c7757" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rapidfuzz</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>[</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  rapidfuzz.distance.Levenshtein.distance(<span class="st">'salut'</span>,<span class="st">'slut'</span>, weights <span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)), <span class="co"># Suppression </span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  rapidfuzz.distance.Levenshtein.distance(<span class="st">'salut'</span>,<span class="st">'saalut'</span>, weights <span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)), <span class="co"># Addition </span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  rapidfuzz.distance.Levenshtein.distance(<span class="st">'salut'</span>,<span class="st">'selut'</span>, weights <span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)) <span class="co"># Substitution</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="premier-essai-les-produits-ciqual-les-plus-similaires-aux-produits-de-la-recette" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="premier-essai-les-produits-ciqual-les-plus-similaires-aux-produits-de-la-recette"><span class="header-section-number">4.1</span> Premier essai: les produits <code>Ciqual</code> les plus similaires aux produits de la recette</h2>
<p>On pourrait écrire une fonction qui prend en argument
une liste de libellés d’intérêt et une liste de candidat au <em>match</em> et
renvoie le libellé le plus proche.
Cependant, le risque est que cet algorithme soit relativement lent s’il n’est pas codé
parfaitement.</p>
<p>Il est, à mon avis, plus simple, quand
on est habitué à la logique <code>Pandas</code>,
de faire un produit cartésien pour obtenir un vecteur mettant en miroir
chaque produit de notre recette avec l’ensembles des produits <code>Ciqual</code> et ensuite comparer les deux vecteurs pour prendre,
pour chaque produit, le meilleur <em>match</em>.</p>
<p>Les bases étant de taille limitée, le produit cartésien n’est pas problématique.
Avec des bases plus conséquentes, une stratégie plus parcimonieuse en mémoire devrait être envisagée.</p>
<p>Pour faire cette opération, on va utiliser la fonction <code>match_product</code> de
note script d’utilitaires.</p>
<div id="59887cc3" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dist_leven <span class="op">=</span> fc.match_product(libelles, ciqual)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dist_leven</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cette première étape naïve est décevante à plusieurs égards:</p>
<ul>
<li>Certes, on a des matches cohérent (par exemple “Oignon rouge, cru” et “1 oignon”)
mais on a plus de couples incohérents ;</li>
<li>Le temps de calcul peut apparaître faible mais le passage à l’échelle risque d’être compliqué ;</li>
<li>Les besoins mémoires sont potentiellement importants lors de l’appel à
<code>rapidfuzz.process.extract</code> ce qui peut bloquer le passage à l’échelle ;</li>
<li>La distance textuelle n’est pas nécessairement la plus pertinente.</li>
</ul>
<p>On a, en fait, négligé une étape importante: la normalisation (ou nettoyage des textes) présentée dans la
partie <a href="#nlp">NLP</a>, notamment:</p>
<ul>
<li>harmonisation de la casse, suppression des accents…</li>
<li>suppressions des mots outils (e.g.&nbsp;ici on va d’abord négliger les quantités pour trouver la nature de l’aliment, en particulier pour <code>Ciqual</code>)</li>
</ul>
<div class="quarto-layout-panel" data-layout-nrow="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/wordcloud_relevanc_start.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Scanner-data avant nettoyage"><img src="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/wordcloud_relevanc_start.png" class="img-fluid figure-img" alt="Scanner-data avant nettoyage"></a></p>
<figcaption>Scanner-data avant nettoyage</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/wordcloud_openfood_start.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="OpenFood data avant nettoyage"><img src="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/wordcloud_openfood_start.png" class="img-fluid figure-img" alt="OpenFood data avant nettoyage"></a></p>
<figcaption>OpenFood data avant nettoyage</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/wordcloud_relevanc_clean.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Scanner-data après nettoyage"><img src="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/wordcloud_relevanc_clean.png" class="img-fluid figure-img" alt="Scanner-data après nettoyage"></a></p>
<figcaption>Scanner-data après nettoyage</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/wordcloud_openfood_clean.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="OpenFood data après nettoyage"><img src="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/wordcloud_openfood_clean.png" class="img-fluid figure-img" alt="OpenFood data après nettoyage"></a></p>
<figcaption>OpenFood data après nettoyage</figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>Faisons donc en apparence un retour en arrière qui sera
néanmoins salvateur pour améliorer
la pertinence des liens faits entre nos
bases de données.</p>
</section>
</section>
<section id="preprocessing-pour-améliorer-la-pertinence-des-matches" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Preprocessing pour améliorer la pertinence des matches</h1>
<section id="objectif" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="objectif"><span class="header-section-number">5.1</span> Objectif</h2>
<p>Le <em>preprocessing</em> correspond à l’ensemble des opérations
ayant lieu avant l’analyse à proprement parler.
Ici, ce <em>preprocessing</em> est intéressant à plusieurs
égards:</p>
<ul>
<li>Il réduit le bruit dans nos jeux de données (par exemple des mots de liaisons) ;</li>
<li>Il permet de normaliser et harmoniser les syntaxes dans nos différentes sources.</li>
</ul>
<p>L’objectif est ainsi de réduire nos noms de produits à la substantifique moelle
pour améliorer la pertinence de la recherche.</p>
<p>Pour être pertinent, le <em>preprocessing</em> comporte généralement deux types de
traitements. En premier lieu, ceux qui sont généraux et applicables
à tous types de corpus textuels: retrait des <em>stopwords</em>, de la ponctuation, etc.
les méthodes disponibles dans la partie <a href="#NLP">NLP</a>.
Ensuite, il est nécessaire de mettre en oeuvre des nettoyages plus spécifiques à chaque corpus.
Par exemple dans la source <code>Ciqual</code>,
la cuisson est souvent renseignée et bruite les appariemments.</p>
</section>
<section id="démarche" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="démarche"><span class="header-section-number">5.2</span> Démarche</h2>
<div class="cell markdown">
<div class="alert alert-success" role="alert">
<h3 class="alert-heading anchored"><i class="fa-solid fa-pencil"></i> Exercice 1: preprocessing</h3>
<ol type="1">
<li><p>Pour transformer les lettres avec accents en leur équivalent
sans accent, la fonction <code>unidecode</code>
(du package du même nom) est pratique.
La tester sur le jeu de données <code>ciqual</code> en créant une nouvelle
colonne nommée <code>libel_clean</code></p></li>
<li><p>La casse différente selon les jeux de données peut être pénalisante
pour trouver des produits similaires. Pour éviter ces problèmes,
mettre tout en majuscule.</p></li>
<li><p>Les informations sur les quantités ou le <em>packaging</em> peuvent apporter
du bruit dans notre comparaison. Nous allons retirer ces mots,
à travers la liste <code>['KG','CL','G','L','CRUE?S?', 'PREEMBALLEE?S?']</code>,
qu’on peut considérer comme un dictionnaire de <em>stop-words</em> métier.
Pour cela, il convient d’utiliser une expression régulière dans la méthode
<code>str.replace</code> de <code>Pandas</code>.
Avec ceux-ci, on va utiliser la liste des <em>stop-words</em> de
la librairie <code>nltk</code> pour retirer les <em>stop-words</em> classiques (_“le”,“la”, etc.).
La librairie <code>SpaCy</code>, plus riche, pourrait être utilisée ; nous laissons
cela sous la forme d’exercice supplémentaire.</p></li>
<li><p>On a encore des signes de ponctuation ou des chiffres qui peuvent
poluer la comparaison. Les retirer grâce à la méthode <code>replace</code> et
une regex <code>[^a-zA-Z]</code></p></li>
<li><p>Enfin, par sécurité, on peut supprimer les espaces multiples.
Utiliser la regex <code>'([ ]{2,})'</code> pour cela. Observer le résultat
final.</p></li>
<li><p><strong>(Optionnel)</strong>. Comme exercice supplémentaire, faire la même chose avec les
<em>pipelines</em> <code>SpaCy</code>.</p></li>
</ol>
</div>
</div>
<p>A l’issue de la question 1, le jeu de données <code>ciqual</code> devrait
ressembler à celui-ci :</p>
<p>Après avoir mis en majuscule, on se retrouve avec le jeu de données
suivant :</p>
<p>Après retrait des <em>stop-words</em>, nos libellés prennent
la forme suivante :</p>
<p>La regex pour éliminer les caractères de ponctuation permet ainsi d’obtenir:</p>
<p>Enfin, à l’issue de la question 5, le <code>DataFrame</code> obtenu est le suivant :</p>
<p>Ces étapes de nettoyage ont ainsi permis de concentrer l’information
dans les noms de produits sur ce qui l’identifie vraiment.</p>
</section>
<section id="approche-systématique" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="approche-systématique"><span class="header-section-number">5.3</span> Approche systématique</h2>
<p>Pour systématiser cette approche à nos différents <code>DataFrame</code>, rien de mieux
qu’une fonction. Celle-ci est présente dans le module <code>functions</code>
sous le nom <code>clean_libelle</code>.</p>
<div id="f62c956d" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functions <span class="im">import</span> clean_libelle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour résumer l’exercice précédent, cette fonction va :</p>
<ul>
<li>Harmoniser la casse et retirer les accents (voir <code>functions.py</code>) ;</li>
<li>Retirer tout les caractères qui ne sont pas des lettres (chiffres, ponctuations) ;</li>
<li>Retirer les caractères isolés.</li>
</ul>
<div id="74f40423" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nltk</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nltk.corpus <span class="im">import</span> stopwords</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>nltk.download(<span class="st">'stopwords'</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>stop_words <span class="op">=</span> [<span class="st">'KG'</span>,<span class="st">'CL'</span>,<span class="st">'G'</span>,<span class="st">'L'</span>,<span class="st">'CRUE?S?'</span>, <span class="st">'PREEMBALLEE?S?'</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>stop_words <span class="op">+=</span> [l.upper() <span class="cf">for</span> l <span class="kw">in</span> stopwords.words(<span class="st">'french'</span>)]</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>replace_regex <span class="op">=</span> {<span class="vs">r'</span><span class="pp">[^A-Z]</span><span class="vs">'</span>: <span class="st">' '</span>, <span class="vs">r'</span><span class="dv">\b</span><span class="pp">[A-Z0-9]</span><span class="op">{1,2}?</span><span class="dv">\b</span><span class="vs">'</span>:<span class="st">' '</span>} <span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Cela permet d’obtenir les bases nettoyées suivantes :</p>
<div id="fa45f892" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ciqual <span class="op">=</span> clean_libelle(ciqual, yvar <span class="op">=</span> <span class="st">'alim_nom_fr'</span>, replace_regex <span class="op">=</span> replace_regex, stopWords <span class="op">=</span> stop_words)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ciqual.sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b82a09d5" class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>openfood <span class="op">=</span> clean_libelle(openfood, yvar <span class="op">=</span> <span class="st">'product_name'</span>, replace_regex <span class="op">=</span> replace_regex, stopWords <span class="op">=</span> stop_words)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>openfood.sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="77fab742" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>courses <span class="op">=</span> pd.DataFrame(libelles, columns <span class="op">=</span> [<span class="st">'libel'</span>])</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>courses <span class="op">=</span> clean_libelle(courses, yvar <span class="op">=</span> <span class="st">'libel'</span>, replace_regex <span class="op">=</span> replace_regex, stopWords <span class="op">=</span> stop_words)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>courses.sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Les noms de produits sont déjà plus harmonisés.
Voyons voir si cela permet de trouver un
<em>match</em> dans l’Openfood database:</p>
<div id="7b2e14f3" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dist_leven_openfood <span class="op">=</span> fc.match_product(courses[<span class="st">"libel_clean"</span>], openfood, <span class="st">"libel_clean"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dist_leven_openfood.sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pas encore parfait, mais on progresse sur les produits appariés!
Concernant le temps de calcul, les quelques secondes nécessaires à
ce calcul peuvent apparaître un faible prix à payer. Cependant,
il convient de rappeler que le nombre de produits dans l’ensemble
de recherche est faible. Cette solution n’est donc pas généralisable.</p>
</section>
<section id="réduire-les-temps-de-recherche" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="réduire-les-temps-de-recherche"><span class="header-section-number">5.4</span> Réduire les temps de recherche</h2>
<p>Finalement, l’idéal serait de disposer d’un <strong>moteur de recherche</strong> adapté à notre besoin,
contenant les produits candidats, que l’on pourrait interroger, rapide en lecture, capable de classer les échos renvoyés par pertinence, que l’on pourrait requêter de manière flexible.</p>
<p>Par exemple, on pourrait vouloir signaler qu’un
écho nous intéresse seulement si la donnée calorique n’est pas manquante.
On pourrait même vouloir qu’il effectue pour nous des prétraitements sur les données.</p>
<p>Cela paraît beaucoup demander. Mais c’est exactement ce que fait <code>ElasticSearch</code>.</p>
</section>
</section>
<section id="indexer-une-base" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Indexer une base</h1>
<p>A partir de maintenant, commence, à proprement parler, la démonstration <code>Elastic</code>.
Cette
partie développe les éléments les plus techniques, à savoir l’indexation d’une base.
Tous les utilisateurs d’<code>Elastic</code> n’ont pas nécessairement à passer par là, ils peuvent
trouver une base déjà indexée, idéalement par un <em>data engineer</em> qui aura optimisé
les traitements.</p>
<p>Les utilisateurs du <a href="https://datalab.sspcloud.fr/accueil">SSP Cloud</a>, architecture qui
repose sur la technologie <a href="https://kubernetes.io/">Kubernetes</a> peuvent
répliquer les éléments de la suite du document.</p>
<section id="créer-un-cluster-elastic-sur-le-datalab" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="créer-un-cluster-elastic-sur-le-datalab"><span class="header-section-number">6.1</span> Créer un cluster <code>Elastic</code> sur le DataLab</h2>
<p>Pour lancer un service <code>Elastic</code>, il faut cliquer sur <a href="https://datalab.sspcloud.fr/launcher/databases/elastic?autoLaunch=false">ce lien</a>.</p>
<p>Une fois créé, vous pouvez explorer l’interface graphique <code>Kibana</code>.
Cependant, grâce à l’API <code>Elastic</code>
de <code>Python</code>, on se passera de celle-ci. Donc, en pratique,
une fois lancé, pas besoin d’ouvrir ce service <code>Elastic</code> pour continuer à suivre<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<p>Dans un terminal, vous pouvez aussi vérifier que vous êtes en mesure de dialoguer avec votre cluster <code>Elastic</code>,
qui est prêt à vous écouter:</p>
<pre class="shell"><code>kubectl get statefulset</code></pre>
<p>Passer par la ligne de commande serait peu commode pour industrialiser notre
recherche.
Nous allons utiliser la librairie <code>elasticsearch</code> pour dialoguer avec notre moteur de recherche Elastic.
Les instructions ci-dessous indiquent comment établir la connection.</p>
<div id="19d11b1c" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> elasticsearch <span class="im">import</span> Elasticsearch</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>HOST <span class="op">=</span> <span class="st">'elasticsearch-master'</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> elastic():</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Connection avec Elastic sur le data lab"""</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>    es <span class="op">=</span> Elasticsearch([{<span class="st">'host'</span>: HOST, <span class="st">'port'</span>: <span class="dv">9200</span>, <span class="st">'scheme'</span>: <span class="st">'http'</span>}], http_compress<span class="op">=</span><span class="va">True</span>, request_timeout<span class="op">=</span><span class="dv">200</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> es</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>es <span class="op">=</span> elastic()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>&lt;Elasticsearch([{'host': 'elasticsearch-master', 'port': 9200}])&gt;</code></pre>
<p>Maintenant que la connection est établie, deux étapes nous attendent:</p>
<ol type="1">
<li><strong>Indexation</strong> Envoyer les documents parmi lesquels on veut chercher des echos pertinents dans notre elastic. Un index est une collection de document. Nous pourrions en créer deux : un pour les produits ciqual, un pour les produits openfood</li>
<li><strong>Requête</strong> Chercher les documents les plus pertinents suivant une recherche textuelle flexible. Nous allons rechercher les libellés de notre recette et de notre liste de course.</li>
</ol>
</section>
<section id="première-indexation" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="première-indexation"><span class="header-section-number">6.2</span> Première indexation</h2>
<p>On crée donc nos deux index:</p>
<div id="c89d407d" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> es.indices.exists(index <span class="op">=</span> <span class="st">'openfood'</span>):</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    es.indices.create(index <span class="op">=</span> <span class="st">'openfood'</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> es.indices.exists(index <span class="op">=</span> <span class="st">'ciqual'</span>):</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    es.indices.create(index <span class="op">=</span> <span class="st">'ciqual'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour l’instant, nos index sont vides! Ils contiennent 0 documents.</p>
<div id="1111cdd7" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>es.count(index <span class="op">=</span> <span class="st">'openfood'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>{'count': 0, '_shards': {'total': 1, 'successful': 1, 'skipped': 0, 'failed': 0}}</code></pre>
<p>Nous allons en rajouter quelques-uns !</p>
<div id="3b3b85e2" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>es.create(index <span class="op">=</span> <span class="st">'openfood'</span>,  <span class="bu">id</span> <span class="op">=</span> <span class="dv">1</span>, body <span class="op">=</span> {<span class="st">'product_name'</span>: <span class="st">'Tarte noix de coco'</span>, <span class="st">'product_name_clean'</span>: <span class="st">'TARTE NOIX COCO'</span>})</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>es.create(index <span class="op">=</span> <span class="st">'openfood'</span>,  <span class="bu">id</span> <span class="op">=</span> <span class="dv">2</span>, body <span class="op">=</span> {<span class="st">'product_name'</span>: <span class="st">'Noix de coco'</span>, <span class="st">'product_name_clean'</span>: <span class="st">'NOIX COCO'</span>})</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>es.create(index <span class="op">=</span> <span class="st">'openfood'</span>,  <span class="bu">id</span> <span class="op">=</span> <span class="dv">3</span>, body <span class="op">=</span> {<span class="st">'product_name'</span>: <span class="st">'Beurre doux'</span>, <span class="st">'product_name_clean'</span>: <span class="st">'BEURRE DOUX'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5e52f78d" class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>es.count(index <span class="op">=</span> <span class="st">'openfood'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>{'count': 3, '_shards': {'total': 1, 'successful': 1, 'skipped': 0, 'failed': 0}}</code></pre>
<p>Dans l’interface graphique <code>Kibana</code>,
on peut vérifier que l’indexation
a bien eue lieu en allant dans <code>Management &gt; Stack Management</code></p>
<p><a href="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/index_management.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="https://minio.lab.sspcloud.fr/lgaliana/generative-art/pythonds/index_management.png" class="img-fluid"></a></p>
</section>
<section id="première-recherche" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="première-recherche"><span class="header-section-number">6.3</span> Première recherche</h2>
<p>Faisons notre première recherche: cherchons des noix de pécan!</p>
<div id="c8a4c26e" class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>es.search(index <span class="op">=</span> <span class="st">'openfood'</span>, q <span class="op">=</span> <span class="st">'noix de pécan'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>ObjectApiResponse({'took': 116, 'timed_out': False, '_shards': {'total': 1, 'successful': 1, 'skipped': 0, 'failed': 0}, 'hits': {'total': {'value': 2, 'relation': 'eq'}, 'max_score': 0.9400072, 'hits': [{'_index': 'openfood', '_type': '_doc', '_id': '2', '_score': 0.9400072, '_source': {'product_name': 'Noix de coco', 'product_name_clean': 'NOIX COCO'}}, {'_index': 'openfood', '_type': '_doc', '_id': '1', '_score': 0.8272065, '_source': {'product_name': 'Tarte noix de coco', 'product_name_clean': 'TARTE NOIX COCO'}}]}})</code></pre>
<p>Intéressons nous aux <code>hits</code> (résultats pertinents, ou echos) : nous en avons 2.
Le score maximal parmi les hits est mentionné dans <code>max_score</code> et correspond à celui du deuxième document indexé.</p>
<p><code>Elastic</code> nous fournit ici un <strong>score de pertinence</strong> dans notre recherche d’information, et classe ainsi les documents renvoyés.</p>
<p>Ici nous utilisons la configuration par défaut. Mais comment est calculé ce score? Demandons à Elastic de nous expliquer le score du document <code>2</code> dans la requête <code>"noix de pécan"</code>.</p>
<div id="bb70feb5" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>es.explain(index <span class="op">=</span> <span class="st">'openfood'</span>, <span class="bu">id</span> <span class="op">=</span> <span class="dv">2</span>, q <span class="op">=</span> <span class="st">'noix de pécan'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>ObjectApiResponse({'_index': 'openfood', '_type': '_doc', '_id': '2', 'matched': True, 'explanation': {'value': 0.9400072, 'description': 'max of:', 'details': [{'value': 0.49917626, 'description': 'sum of:', 'details': [{'value': 0.49917626, 'description': 'weight(product_name_clean:noix in 1) [PerFieldSimilarity], result of:', 'details': [{'value': 0.49917626, 'description': 'score(freq=1.0), computed as boost * idf * tf from:', 'details': [{'value': 2.2, 'description': 'boost', 'details': []}, {'value': 0.47000363, 'description': 'idf, computed as log(1 + (N - n + 0.5) / (n + 0.5)) from:', 'details': [{'value': 2, 'description': 'n, number of documents containing term', 'details': []}, {'value': 3, 'description': 'N, total number of documents with field', 'details': []}]}, {'value': 0.48275858, 'description': 'tf, computed as freq / (freq + k1 * (1 - b + b * dl / avgdl)) from:', 'details': [{'value': 1.0, 'description': 'freq, occurrences of term within document', 'details': []}, {'value': 1.2, 'description': 'k1, term saturation parameter', 'details': []}, {'value': 0.75, 'description': 'b, length normalization parameter', 'details': []}, {'value': 2.0, 'description': 'dl, length of field', 'details': []}, {'value': 2.3333333, 'description': 'avgdl, average length of field', 'details': []}]}]}]}]}, {'value': 0.9400072, 'description': 'sum of:', 'details': [{'value': 0.4700036, 'description': 'weight(product_name:noix in 1) [PerFieldSimilarity], result of:', 'details': [{'value': 0.4700036, 'description': 'score(freq=1.0), computed as boost * idf * tf from:', 'details': [{'value': 2.2, 'description': 'boost', 'details': []}, {'value': 0.47000363, 'description': 'idf, computed as log(1 + (N - n + 0.5) / (n + 0.5)) from:', 'details': [{'value': 2, 'description': 'n, number of documents containing term', 'details': []}, {'value': 3, 'description': 'N, total number of documents with field', 'details': []}]}, {'value': 0.45454544, 'description': 'tf, computed as freq / (freq + k1 * (1 - b + b * dl / avgdl)) from:', 'details': [{'value': 1.0, 'description': 'freq, occurrences of term within document', 'details': []}, {'value': 1.2, 'description': 'k1, term saturation parameter', 'details': []}, {'value': 0.75, 'description': 'b, length normalization parameter', 'details': []}, {'value': 3.0, 'description': 'dl, length of field', 'details': []}, {'value': 3.0, 'description': 'avgdl, average length of field', 'details': []}]}]}]}, {'value': 0.4700036, 'description': 'weight(product_name:de in 1) [PerFieldSimilarity], result of:', 'details': [{'value': 0.4700036, 'description': 'score(freq=1.0), computed as boost * idf * tf from:', 'details': [{'value': 2.2, 'description': 'boost', 'details': []}, {'value': 0.47000363, 'description': 'idf, computed as log(1 + (N - n + 0.5) / (n + 0.5)) from:', 'details': [{'value': 2, 'description': 'n, number of documents containing term', 'details': []}, {'value': 3, 'description': 'N, total number of documents with field', 'details': []}]}, {'value': 0.45454544, 'description': 'tf, computed as freq / (freq + k1 * (1 - b + b * dl / avgdl)) from:', 'details': [{'value': 1.0, 'description': 'freq, occurrences of term within document', 'details': []}, {'value': 1.2, 'description': 'k1, term saturation parameter', 'details': []}, {'value': 0.75, 'description': 'b, length normalization parameter', 'details': []}, {'value': 3.0, 'description': 'dl, length of field', 'details': []}, {'value': 3.0, 'description': 'avgdl, average length of field', 'details': []}]}]}]}]}]}})</code></pre>
<p><code>Elastic</code> nous explique donc que le score <code>0.9400072</code> est le maximum entre deux sous-scores, <code>0.4991</code> et <code>0.9400072</code>.</p>
<p>Pour chacun de ces sous-scores, le détail de son calcul est donné.
Le premier sous-score n’a accordé un score que par rapport au premier mot (noix), tandis que le second a accordé un score sur la base des deux mots déjà connu dans les documents (“noix” et “de”). Il a ignoré pécan! Jusqu’à présent, ce terme n’est pas connu dans l’index.</p>
<p>La pertinence d’un mot pour notre recherche est construite sur une variante de la <code>TF-IDF</code>,
considérant qu’un terme est pertinent s’il est souvent présent dans le document (Term Frequency)
alors qu’il est peu fréquent dans les autres document (inverse document frequency).
Ici les notations des documents 1 et 2 sont très proches, la différence est dûe à des IDF plus faibles dans le document 1,
qui est pénalisé pour être légérement plus long.</p>
<p>Bref, tout ça est un peu lourd, mais assez efficace,
en tout cas moins rudimentaire que les distances caractères à caractères pour ramener des echos pertinents.</p>
</section>
<section id="limite-de-cette-première-indexation" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="limite-de-cette-première-indexation"><span class="header-section-number">6.4</span> Limite de cette première indexation</h2>
<p>Pour l’instant, Elastic n’a pas l’air de gérer les fautes de frappes!
Pas le droit à l’erreur dans la requête:</p>
<div id="ad81a1c9" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>es.search(index <span class="op">=</span> <span class="st">'openfood'</span>,q <span class="op">=</span> <span class="st">'TART NOI'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>ObjectApiResponse({'took': 38, 'timed_out': False, '_shards': {'total': 1, 'successful': 1, 'skipped': 0, 'failed': 0}, 'hits': {'total': {'value': 0, 'relation': 'eq'}, 'max_score': None, 'hits': []}})</code></pre>
<p>Cela s’explique par la représentation des champs (<em>‘product_name’</em> par exemple) qu’<code>Elastic</code> a inféré,
puisque nous n’avons rien spécifié.
La représentation d’une variable conditionne la façon dont les champs sont analysés pour calculer la pertinence.
Par exemple, regardons la représentation du champ <code>product_name</code></p>
<div id="280bf983" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>es.indices.get_field_mapping(index <span class="op">=</span> <span class="st">'openfood'</span>, fields <span class="op">=</span> <span class="st">'product_name'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>ObjectApiResponse({'openfood': {'mappings': {'product_name': {'full_name': 'product_name', 'mapping': {'product_name': {'type': 'text', 'fields': {'keyword': {'type': 'keyword', 'ignore_above': 256}}}}}}}})</code></pre>
<p><code>Elastic</code> a compris qu’il s’agissait d’un champ textuel.
En revanche, le type est <code>keyword</code> n’autorise pas des analyses approximatives donc
ne permet pas de tenir compte de fautes de frappes.</p>
<p>Pour qu’un echo remonte, un des termes doit matcher exactement. Dommage !
Mais c’est parce qu’on a utilisé le <em>mapping</em> par défaut.
En réalité, il est assez simple de préciser un <em>mapping</em> plus riche,
autorisant une analyse <em>“fuzzy”</em> ou <em>“flou”</em>.</p>
</section>
</section>
<section id="améliorer-lindexation" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Améliorer l’indexation</h1>
<p>On peut spécifier la façon dont l’on souhaite analyser le texte.
Par exemple, on peut préciser que l’on souhaite enlever des <em>stopwords</em>, raciniser, analyser les termes via des <em>n-grammes</em>
pour rendre la recherche plus robuste aux fautes de frappes…</p>
<p>Ces concepts sont présentés dans la partie <a href="#nlp">NLP</a>.
Pour une présentation plus complète, voir
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping.html">la documentation officielle d’Elastic</a></p>
<p>On propose les analyseurs stockés dans un fichier <a href="#schema.json">schema.json</a></p>
<p>Les <em>n-grammes</em> sont des séquences de <em>n</em> caractères ou plus généralement <em>n</em> éléments qui s’enchaînent séquentiellement.
Par exemple, NOI et OIX sont des tri-grammes de caractères dans NOIX.</p>
<p>Comparer les <em>n-grammes</em> composant des libellés peut permettre d’avoir dans des comparaisons à fautes de frappe/abbréviations près.
Cela fait aussi plus de comparaisons à opérer ! D’où également, l’intérêt d’Elastic, qui intégre facilement et efficacement ces comparaisons.</p>
<p>On va préciser un peu le schéma de données qu’on souhaite <em>indexer</em>, et aussi préciser comment les différents champs seront <em>analysés</em>.</p>
<section id="une-indexation-plus-adaptée" class="level3" data-number="7.0.1">
<h3 data-number="7.0.1" class="anchored" data-anchor-id="une-indexation-plus-adaptée"><span class="header-section-number">7.0.1</span> Une indexation plus adaptée</h3>
<div id="a1f32763" class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> es.indices.exists(index <span class="op">=</span> <span class="st">'openfood'</span>):</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    es.indices.delete(index <span class="op">=</span> <span class="st">'openfood'</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'schema.json'</span>) <span class="im">as</span> f:</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    mapping <span class="op">=</span> json.load(f)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>es.indices.create(index <span class="op">=</span> <span class="st">"openfood"</span>, body <span class="op">=</span> mapping)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Maintenant, les champs textuels <em>“product_name”</em> et <em>“product_name_clean”</em>
vont pouvoir être analysé aussi via leur n-grammes et après racinisation (et l’un n’exclut pas l’autre!)</p>
<div id="02dd0221" class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>es.indices.get_field_mapping(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  index <span class="op">=</span> <span class="st">'openfood'</span>, fields <span class="op">=</span> <span class="st">'product_name'</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>ObjectApiResponse({'openfood': {'mappings': {'product_name': {'full_name': 'product_name', 'mapping': {'product_name': {'type': 'text', 'fields': {'keyword': {'type': 'keyword', 'ignore_above': 256}, 'ngr': {'type': 'text', 'analyzer': 'ngram_analyzer'}, 'stem': {'type': 'text', 'analyzer': 'stem_analyzer'}}}}}}}})</code></pre>
<p>C’est parti, on envoie toute notre base OpenFood pour pouvoir la requêter !
La fonction suivante (<code>index_elastic</code>) va vous faire gagner du temps pour indexer
car indexer chaque produit à la main n’est pas très efficace.</p>
<p>Du coup ça prend quelques minutes… mais c’est pour nous en faire gagner ensuite.
Cette opération est faite une fois, pour préparer des requêtes potentiellement nombreuses!</p>
<div id="60ddea93" class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>fc.index_elastic(es <span class="op">=</span>es, index_name <span class="op">=</span> <span class="st">"openfood"</span>,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>        setting_file <span class="op">=</span> <span class="st">'schema.json'</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> openfood[[<span class="st">'product_name'</span>,<span class="st">"libel_clean"</span>,<span class="st">"energy_100g"</span>,<span class="st">"nutriscore_score"</span>]].drop_duplicates())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Temps d'exécution total : 125.57 secondes ---</code></pre>
<div id="7da9e5ea" class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>es.count(index <span class="op">=</span> <span class="st">'openfood'</span>)[<span class="st">'count'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>738366</code></pre>
</section>
<section id="nos-premières-requêtes" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="nos-premières-requêtes"><span class="header-section-number">7.1</span> Nos premières requêtes</h2>
<p>Vérifions qu’on recupère quelques tartes aux noix même si l’on fait plein de fautes:</p>
<div id="3580ea0f" class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>es.search(index <span class="op">=</span> <span class="st">'openfood'</span>, q <span class="op">=</span> <span class="st">'TART NOI'</span>, size <span class="op">=</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>ObjectApiResponse({'took': 60, 'timed_out': False, '_shards': {'total': 1, 'successful': 1, 'skipped': 0, 'failed': 0}, 'hits': {'total': {'value': 10000, 'relation': 'gte'}, 'max_score': 22.837925, 'hits': [{'_index': 'openfood', '_type': '_doc', '_id': '405332', '_score': 22.837925, '_source': {'product_name': 'Tarte noix', 'libel_clean': 'TARTE NOIX', 'energy_100g': 1833.0, 'nutriscore_score': 23.0}}, {'_index': 'openfood', '_type': '_doc', '_id': '1103594', '_score': 22.82367, '_source': {'product_name': 'Tarte aux noix', 'libel_clean': 'TARTE NOIX', 'energy_100g': 4.0, 'nutriscore_score': 4.0}}, {'_index': 'openfood', '_type': '_doc', '_id': '1150755', '_score': 22.82367, '_source': {'product_name': 'Tarte aux noix', 'libel_clean': 'TARTE NOIX', 'energy_100g': 1929.0, 'nutriscore_score': 21.0}}]}})</code></pre>
<p>Si on préfère sous une forme de <code>DataFrame</code>:</p>
<div id="728fce75" class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.json_normalize(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    es.search(index <span class="op">=</span> <span class="st">'openfood'</span>, q <span class="op">=</span> <span class="st">'TART NOI'</span>, size <span class="op">=</span> <span class="dv">3</span>)[<span class="st">'hits'</span>][<span class="st">'hits'</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>df.columns <span class="op">=</span> df.columns.<span class="bu">str</span>.replace(<span class="st">"_source."</span>, <span class="st">""</span>, regex <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
\n  \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n<table class="dataframe table table-sm table-striped small"><thead><tr><th></th><th>_index</th><th>_type</th><th>_id</th><th>_score</th><th>product_name</th><th>libel_clean</th><th>energy_100g</th><th>nutriscore_score</th></tr></thead><tbody><tr><th>0</th><td>openfood</td><td>_doc</td><td>405332</td><td>22.837925</td><td>Tarte noix</td><td>TARTE NOIX</td><td>1833.0</td><td>23.0</td></tr><tr><th>1</th><td>openfood</td><td>_doc</td><td>1103594</td><td>22.823670</td><td>Tarte aux noix</td><td>TARTE NOIX</td><td>4.0</td><td>4.0</td></tr><tr><th>2</th><td>openfood</td><td>_doc</td><td>1150755</td><td>22.823670</td><td>Tarte aux noix</td><td>TARTE NOIX</td><td>1929.0</td><td>21.0</td></tr></tbody></table>
<p>Pour automatiser l’envoi de requêtes et la récupération du meilleur
écho, on peut définir la fonction suivante</p>
<div id="003f5a53" class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> matchElastic(libelles):</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    start_time <span class="op">=</span> time.time()</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    matches <span class="op">=</span> {}</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> l <span class="kw">in</span> libelles:</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>        response <span class="op">=</span> es.search(index <span class="op">=</span> <span class="st">'openfood'</span>, q <span class="op">=</span> l, size <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(response[<span class="st">'hits'</span>][<span class="st">'hits'</span>])<span class="op">&gt;</span><span class="dv">0</span>:</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>            matches[l] <span class="op">=</span> pd.json_normalize(</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>              response[<span class="st">'hits'</span>][<span class="st">'hits'</span>]</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="dv">80</span><span class="op">*</span><span class="st">'-'</span>)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Temps d'exécution total : </span><span class="sc">{</span>(time.time() <span class="op">-</span> start_time)<span class="sc">:.2f}</span><span class="ss"> secondes ---"</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> matches</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="44aabd2f" class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>matches <span class="op">=</span> matchElastic(courses[<span class="st">'libel_clean'</span>])</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>matches <span class="op">=</span> pd.concat(matches)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>matches.sample(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
\n  \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n<table class="dataframe table table-sm table-striped small"><thead><tr><th></th><th></th><th>_index</th><th>_type</th><th>_id</th><th>_score</th><th>_source.product_name</th><th>_source.libel_clean</th><th>_source.energy_100g</th><th>_source.nutriscore_score</th></tr></thead><tbody><tr><th>GOUSSE AIL</th><th>0</th><td>openfood</td><td>_doc</td><td>1982062</td><td>57.93140</td><td>Gousse d\'ail</td><td>GOUSSE AIL</td><td>498.0</td><td>5.0</td></tr><tr><th>IGP SAUVIGNON</th><th>0</th><td>openfood</td><td>_doc</td><td>1801406</td><td>96.55756</td><td>vin blanc Sauvignon</td><td>VIN BLANC SAUVIGNON</td><td>66.3</td><td>1.0</td></tr><tr><th>POTIRON</th><th>0</th><td>openfood</td><td>_doc</td><td>1043961</td><td>75.96385</td><td>Potiron</td><td>POTIRON</td><td>172.0</td><td>0.0</td></tr></tbody></table>
<p>Et voilà, on a un outil très rapide de requête !
La pertinence des résultats est encore douteuse.
Pour cela, il conviendrait de préciser des requêtes plus sophistiquées!<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div id="75d618a1" class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>req <span class="op">=</span> {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"bool"</span>: {</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"should"</span>: [</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>        { <span class="st">"match"</span>: { <span class="st">"libel_clean"</span>:  { <span class="st">"query"</span>:  <span class="st">"HUILE OLIVE"</span> , <span class="st">"boost"</span> : <span class="dv">10</span>}}},</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>        { <span class="st">"match"</span>: { <span class="st">"libel_clean.ngr"</span>:   <span class="st">"HUILE OLIVE"</span> }}</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"minimum_should_match"</span>: <span class="dv">1</span>,</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"filter"</span>: [</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>      { </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"range"</span> : {</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nutriscore_score"</span> : {</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"gte"</span> : <span class="dv">10</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"lte"</span> : <span class="dv">20</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="478d9208" class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>out <span class="op">=</span> es.search(index <span class="op">=</span> <span class="st">'openfood'</span>, query <span class="op">=</span> req, size <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>pd.json_normalize(out[<span class="st">'hits'</span>][<span class="st">'hits'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
\n  \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n<table class="dataframe table table-sm table-striped small"><thead><tr><th></th><th>_index</th><th>_type</th><th>_id</th><th>_score</th><th>_source.product_name</th><th>_source.libel_clean</th><th>_source.energy_100g</th><th>_source.nutriscore_score</th></tr></thead><tbody><tr><th>0</th><td>openfood</td><td>_doc</td><td>960041</td><td>174.27896</td><td>Huile d olive</td><td>HUILE OLIVE</td><td>3761.0</td><td>11.0</td></tr></tbody></table>
<p>Qu’a-t-on demandé ici?
- De renvoyer 1 et 1 seul echo (<code>"size":"1"</code>) et seulement si celui ci a:
+ <code>"should"</code>: Au moins un (<code>"minimum_should_match":"1"</code>) des termes des deux champs <code>libel_clean</code> et <code>libel_clean.ngr</code> qui matche sur un terme de <em>HUILE OLIVE</em>, l’analyse (la définition du “terme”) étant réalisé soit en tant que <code>text</code> (“libel_clean”) soit en tant que n-gramme <code>ngr</code> (“libel_clean.ngr”, une analyse que nous avons spécifié dans le mapping)
+ <code>"filter"</code>: Le champ <code>float</code> <code>nutriscore_score</code> doit être compris entre 10 et 20 (“filter”).</p>
<p>A noter :</p>
<ol type="1">
<li>Les clauses (<code>"should"</code>+<code>"minimum_should_match":"1"</code>) peuvent être remplacé par un <code>"must"</code>. Auquel cas, l’écho doit obligatoirement matcher sur chaque clause.</li>
<li>Préciser dans <code>"filter"</code> (plutôt que dans <code>"should"</code>) une condition signifie que celle-ci ne participe pas au score de pertinence.</li>
</ol>
<p>On n’a pas encore un appariemment très satisfaisant, en particulier sur les boissons. Comment faire ? La réponse est dans <span class="citation" data-cites="galiana2022">Galiana and Suarez Castillo (<a href="#ref-galiana2022" role="doc-biblioref">2022</a>)</span></p>
<div class="alert alert-success" role="alert">
<p>A vous, de calculer le nombre de calories de notre recette de course !</p>
</div>
</section>
<section id="informations-additionnelles" class="level2 unnumbered">
<h2 class="unnumbered anchored" data-anchor-id="informations-additionnelles">Informations additionnelles</h2>
<details>
<summary>
<p><i class="fa-brands fa-python" aria-label="python"></i> environment files have been tested on.</p>
</summary>
<p>Python version used:</p>
<div class="git-details">
<div class="pip-freeze">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Package</th>
<th style="text-align: left;">Version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">affine</td>
<td style="text-align: left;">2.4.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">aiobotocore</td>
<td style="text-align: left;">2.22.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aiohappyeyeballs</td>
<td style="text-align: left;">2.6.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">aiohttp</td>
<td style="text-align: left;">3.11.18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">aioitertools</td>
<td style="text-align: left;">0.12.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">aiosignal</td>
<td style="text-align: left;">1.3.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">altair</td>
<td style="text-align: left;">5.4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">annotated-types</td>
<td style="text-align: left;">0.7.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">anyio</td>
<td style="text-align: left;">4.9.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">appdirs</td>
<td style="text-align: left;">1.4.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">argon2-cffi</td>
<td style="text-align: left;">25.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">argon2-cffi-bindings</td>
<td style="text-align: left;">21.2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">arrow</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">asttokens</td>
<td style="text-align: left;">3.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">async-lru</td>
<td style="text-align: left;">2.0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">attrs</td>
<td style="text-align: left;">25.3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">babel</td>
<td style="text-align: left;">2.17.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">beautifulsoup4</td>
<td style="text-align: left;">4.13.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">black</td>
<td style="text-align: left;">24.8.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">bleach</td>
<td style="text-align: left;">6.2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">blis</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">boto3</td>
<td style="text-align: left;">1.37.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">botocore</td>
<td style="text-align: left;">1.37.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">branca</td>
<td style="text-align: left;">0.8.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Brotli</td>
<td style="text-align: left;">1.1.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">bs4</td>
<td style="text-align: left;">0.0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cartiflette</td>
<td style="text-align: left;">0.0.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cartopy</td>
<td style="text-align: left;">0.24.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">catalogue</td>
<td style="text-align: left;">2.0.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">cattrs</td>
<td style="text-align: left;">24.1.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">certifi</td>
<td style="text-align: left;">2025.4.26</td>
</tr>
<tr class="even">
<td style="text-align: left;">cffi</td>
<td style="text-align: left;">1.17.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">charset-normalizer</td>
<td style="text-align: left;">3.4.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">chromedriver-autoinstaller</td>
<td style="text-align: left;">0.6.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">click</td>
<td style="text-align: left;">8.2.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">click-plugins</td>
<td style="text-align: left;">1.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cligj</td>
<td style="text-align: left;">0.7.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">cloudpathlib</td>
<td style="text-align: left;">0.21.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">comm</td>
<td style="text-align: left;">0.2.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">commonmark</td>
<td style="text-align: left;">0.9.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">confection</td>
<td style="text-align: left;">0.1.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">contextily</td>
<td style="text-align: left;">1.6.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">contourpy</td>
<td style="text-align: left;">1.3.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">cycler</td>
<td style="text-align: left;">0.12.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cymem</td>
<td style="text-align: left;">2.0.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">dataclasses-json</td>
<td style="text-align: left;">0.6.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">debugpy</td>
<td style="text-align: left;">1.8.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">decorator</td>
<td style="text-align: left;">5.2.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">defusedxml</td>
<td style="text-align: left;">0.7.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">diskcache</td>
<td style="text-align: left;">5.6.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">duckdb</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">en_core_web_sm</td>
<td style="text-align: left;">3.8.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">et_xmlfile</td>
<td style="text-align: left;">2.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">executing</td>
<td style="text-align: left;">2.2.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fastexcel</td>
<td style="text-align: left;">0.14.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">fastjsonschema</td>
<td style="text-align: left;">2.21.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fiona</td>
<td style="text-align: left;">1.10.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">folium</td>
<td style="text-align: left;">0.19.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fontawesomefree</td>
<td style="text-align: left;">6.6.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">fonttools</td>
<td style="text-align: left;">4.58.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fqdn</td>
<td style="text-align: left;">1.5.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">fr_core_news_sm</td>
<td style="text-align: left;">3.8.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">frozenlist</td>
<td style="text-align: left;">1.6.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">fsspec</td>
<td style="text-align: left;">2025.5.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geographiclib</td>
<td style="text-align: left;">2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">geopandas</td>
<td style="text-align: left;">1.0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">geoplot</td>
<td style="text-align: left;">0.5.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">geopy</td>
<td style="text-align: left;">2.4.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">graphviz</td>
<td style="text-align: left;">0.20.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">great-tables</td>
<td style="text-align: left;">0.12.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">greenlet</td>
<td style="text-align: left;">3.2.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">h11</td>
<td style="text-align: left;">0.16.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">htmltools</td>
<td style="text-align: left;">0.6.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">httpcore</td>
<td style="text-align: left;">1.0.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">httpx</td>
<td style="text-align: left;">0.28.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">httpx-sse</td>
<td style="text-align: left;">0.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">idna</td>
<td style="text-align: left;">3.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">imageio</td>
<td style="text-align: left;">2.37.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">importlib_metadata</td>
<td style="text-align: left;">8.7.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">importlib_resources</td>
<td style="text-align: left;">6.5.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">inflate64</td>
<td style="text-align: left;">1.0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">ipykernel</td>
<td style="text-align: left;">6.29.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ipython</td>
<td style="text-align: left;">9.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">ipython_pygments_lexers</td>
<td style="text-align: left;">1.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ipywidgets</td>
<td style="text-align: left;">8.1.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">isoduration</td>
<td style="text-align: left;">20.11.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jedi</td>
<td style="text-align: left;">0.19.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Jinja2</td>
<td style="text-align: left;">3.1.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jmespath</td>
<td style="text-align: left;">1.0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">joblib</td>
<td style="text-align: left;">1.5.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">json5</td>
<td style="text-align: left;">0.12.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">jsonpatch</td>
<td style="text-align: left;">1.33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jsonpointer</td>
<td style="text-align: left;">3.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">jsonschema</td>
<td style="text-align: left;">4.23.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jsonschema-specifications</td>
<td style="text-align: left;">2025.4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyter</td>
<td style="text-align: left;">1.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jupyter-cache</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyter_client</td>
<td style="text-align: left;">8.6.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jupyter-console</td>
<td style="text-align: left;">6.6.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyter_core</td>
<td style="text-align: left;">5.7.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jupyter-events</td>
<td style="text-align: left;">0.12.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyter-lsp</td>
<td style="text-align: left;">2.2.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jupyter_server</td>
<td style="text-align: left;">2.16.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyter_server_terminals</td>
<td style="text-align: left;">0.5.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jupyterlab</td>
<td style="text-align: left;">4.4.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyterlab_pygments</td>
<td style="text-align: left;">0.3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">jupyterlab_server</td>
<td style="text-align: left;">2.27.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">jupyterlab_widgets</td>
<td style="text-align: left;">3.0.15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">kaleido</td>
<td style="text-align: left;">0.2.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">kiwisolver</td>
<td style="text-align: left;">1.4.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">langchain</td>
<td style="text-align: left;">0.3.25</td>
</tr>
<tr class="even">
<td style="text-align: left;">langchain-community</td>
<td style="text-align: left;">0.3.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">langchain-core</td>
<td style="text-align: left;">0.3.61</td>
</tr>
<tr class="even">
<td style="text-align: left;">langchain-text-splitters</td>
<td style="text-align: left;">0.3.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">langcodes</td>
<td style="text-align: left;">3.5.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">langsmith</td>
<td style="text-align: left;">0.1.147</td>
</tr>
<tr class="odd">
<td style="text-align: left;">language_data</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">lazy_loader</td>
<td style="text-align: left;">0.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">loguru</td>
<td style="text-align: left;">0.7.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">lxml</td>
<td style="text-align: left;">5.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mapclassify</td>
<td style="text-align: left;">2.8.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">marisa-trie</td>
<td style="text-align: left;">1.2.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Markdown</td>
<td style="text-align: left;">3.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">markdown-it-py</td>
<td style="text-align: left;">3.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MarkupSafe</td>
<td style="text-align: left;">3.0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">marshmallow</td>
<td style="text-align: left;">3.26.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">matplotlib</td>
<td style="text-align: left;">3.10.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">matplotlib-inline</td>
<td style="text-align: left;">0.1.7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mdurl</td>
<td style="text-align: left;">0.1.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">mercantile</td>
<td style="text-align: left;">1.2.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mistune</td>
<td style="text-align: left;">3.1.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">mizani</td>
<td style="text-align: left;">0.11.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">multidict</td>
<td style="text-align: left;">6.4.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">multivolumefile</td>
<td style="text-align: left;">0.2.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">murmurhash</td>
<td style="text-align: left;">1.0.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">mypy_extensions</td>
<td style="text-align: left;">1.1.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">narwhals</td>
<td style="text-align: left;">1.40.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">nbclient</td>
<td style="text-align: left;">0.10.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nbconvert</td>
<td style="text-align: left;">7.16.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">nbformat</td>
<td style="text-align: left;">5.10.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nest-asyncio</td>
<td style="text-align: left;">1.6.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">networkx</td>
<td style="text-align: left;">3.4.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nltk</td>
<td style="text-align: left;">3.9.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">notebook</td>
<td style="text-align: left;">7.4.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">notebook_shim</td>
<td style="text-align: left;">0.2.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">numpy</td>
<td style="text-align: left;">2.2.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">openpyxl</td>
<td style="text-align: left;">3.1.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">orjson</td>
<td style="text-align: left;">3.10.18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">outcome</td>
<td style="text-align: left;">1.3.0.post0</td>
</tr>
<tr class="even">
<td style="text-align: left;">overrides</td>
<td style="text-align: left;">7.7.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">OWSLib</td>
<td style="text-align: left;">0.33.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">packaging</td>
<td style="text-align: left;">24.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pandas</td>
<td style="text-align: left;">2.2.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">pandocfilters</td>
<td style="text-align: left;">1.5.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">parso</td>
<td style="text-align: left;">0.8.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">pathspec</td>
<td style="text-align: left;">0.12.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">patsy</td>
<td style="text-align: left;">1.0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pebble</td>
<td style="text-align: left;">5.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pexpect</td>
<td style="text-align: left;">4.9.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pillow</td>
<td style="text-align: left;">11.2.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pip</td>
<td style="text-align: left;">25.1.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">platformdirs</td>
<td style="text-align: left;">4.3.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">plotly</td>
<td style="text-align: left;">6.1.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">plotnine</td>
<td style="text-align: left;">0.13.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">polars</td>
<td style="text-align: left;">1.8.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">preshed</td>
<td style="text-align: left;">3.0.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">prometheus_client</td>
<td style="text-align: left;">0.22.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">prompt_toolkit</td>
<td style="text-align: left;">3.0.51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">propcache</td>
<td style="text-align: left;">0.3.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">psutil</td>
<td style="text-align: left;">7.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ptyprocess</td>
<td style="text-align: left;">0.7.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pure_eval</td>
<td style="text-align: left;">0.2.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">py7zr</td>
<td style="text-align: left;">0.22.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyarrow</td>
<td style="text-align: left;">17.0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pybcj</td>
<td style="text-align: left;">1.0.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">pycparser</td>
<td style="text-align: left;">2.22</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pycryptodomex</td>
<td style="text-align: left;">3.23.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pydantic</td>
<td style="text-align: left;">2.11.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pydantic_core</td>
<td style="text-align: left;">2.33.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">pydantic-settings</td>
<td style="text-align: left;">2.9.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pygments</td>
<td style="text-align: left;">2.19.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">pynsee</td>
<td style="text-align: left;">0.1.8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyogrio</td>
<td style="text-align: left;">0.11.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyparsing</td>
<td style="text-align: left;">3.2.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyppmd</td>
<td style="text-align: left;">1.1.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyproj</td>
<td style="text-align: left;">3.7.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyshp</td>
<td style="text-align: left;">2.3.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">PySocks</td>
<td style="text-align: left;">1.7.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">python-dateutil</td>
<td style="text-align: left;">2.9.0.post0</td>
</tr>
<tr class="even">
<td style="text-align: left;">python-dotenv</td>
<td style="text-align: left;">1.0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">python-json-logger</td>
<td style="text-align: left;">3.3.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">python-magic</td>
<td style="text-align: left;">0.4.27</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pytz</td>
<td style="text-align: left;">2025.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">pywaffle</td>
<td style="text-align: left;">1.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PyYAML</td>
<td style="text-align: left;">6.0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">pyzmq</td>
<td style="text-align: left;">26.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pyzstd</td>
<td style="text-align: left;">0.17.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">rasterio</td>
<td style="text-align: left;">1.4.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">referencing</td>
<td style="text-align: left;">0.36.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">regex</td>
<td style="text-align: left;">2024.11.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">requests</td>
<td style="text-align: left;">2.32.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">requests-cache</td>
<td style="text-align: left;">1.2.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">requests-toolbelt</td>
<td style="text-align: left;">1.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">retrying</td>
<td style="text-align: left;">1.3.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rfc3339-validator</td>
<td style="text-align: left;">0.1.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">rfc3986-validator</td>
<td style="text-align: left;">0.1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rich</td>
<td style="text-align: left;">14.0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">rpds-py</td>
<td style="text-align: left;">0.25.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rtree</td>
<td style="text-align: left;">1.4.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">s3fs</td>
<td style="text-align: left;">2025.5.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">s3transfer</td>
<td style="text-align: left;">0.11.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">scikit-image</td>
<td style="text-align: left;">0.24.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">scikit-learn</td>
<td style="text-align: left;">1.6.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">scipy</td>
<td style="text-align: left;">1.13.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">seaborn</td>
<td style="text-align: left;">0.13.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">selenium</td>
<td style="text-align: left;">4.33.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Send2Trash</td>
<td style="text-align: left;">1.8.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">setuptools</td>
<td style="text-align: left;">80.8.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">shapely</td>
<td style="text-align: left;">2.1.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">shellingham</td>
<td style="text-align: left;">1.5.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">six</td>
<td style="text-align: left;">1.17.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">smart-open</td>
<td style="text-align: left;">7.1.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sniffio</td>
<td style="text-align: left;">1.3.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">sortedcontainers</td>
<td style="text-align: left;">2.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">soupsieve</td>
<td style="text-align: left;">2.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">spacy</td>
<td style="text-align: left;">3.8.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">spacy-legacy</td>
<td style="text-align: left;">3.0.12</td>
</tr>
<tr class="even">
<td style="text-align: left;">spacy-loggers</td>
<td style="text-align: left;">1.0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">SQLAlchemy</td>
<td style="text-align: left;">2.0.41</td>
</tr>
<tr class="even">
<td style="text-align: left;">srsly</td>
<td style="text-align: left;">2.5.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">stack-data</td>
<td style="text-align: left;">0.6.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">statsmodels</td>
<td style="text-align: left;">0.14.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tabulate</td>
<td style="text-align: left;">0.9.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">tenacity</td>
<td style="text-align: left;">9.1.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">terminado</td>
<td style="text-align: left;">0.18.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">texttable</td>
<td style="text-align: left;">1.7.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">thinc</td>
<td style="text-align: left;">8.3.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">threadpoolctl</td>
<td style="text-align: left;">3.6.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tifffile</td>
<td style="text-align: left;">2025.5.24</td>
</tr>
<tr class="even">
<td style="text-align: left;">tinycss2</td>
<td style="text-align: left;">1.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">topojson</td>
<td style="text-align: left;">1.9</td>
</tr>
<tr class="even">
<td style="text-align: left;">tornado</td>
<td style="text-align: left;">6.5.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">tqdm</td>
<td style="text-align: left;">4.67.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">traitlets</td>
<td style="text-align: left;">5.14.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trio</td>
<td style="text-align: left;">0.30.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">trio-websocket</td>
<td style="text-align: left;">0.12.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">typer</td>
<td style="text-align: left;">0.15.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">types-python-dateutil</td>
<td style="text-align: left;">2.9.0.20250516</td>
</tr>
<tr class="odd">
<td style="text-align: left;">typing_extensions</td>
<td style="text-align: left;">4.13.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">typing-inspect</td>
<td style="text-align: left;">0.9.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">typing-inspection</td>
<td style="text-align: left;">0.4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">tzdata</td>
<td style="text-align: left;">2025.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unidecode</td>
<td style="text-align: left;">1.4.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">uri-template</td>
<td style="text-align: left;">1.3.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">url-normalize</td>
<td style="text-align: left;">2.2.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">urllib3</td>
<td style="text-align: left;">2.4.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wasabi</td>
<td style="text-align: left;">1.1.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">wcwidth</td>
<td style="text-align: left;">0.2.13</td>
</tr>
<tr class="odd">
<td style="text-align: left;">weasel</td>
<td style="text-align: left;">0.4.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">webcolors</td>
<td style="text-align: left;">24.11.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">webdriver-manager</td>
<td style="text-align: left;">4.0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">webencodings</td>
<td style="text-align: left;">0.5.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">websocket-client</td>
<td style="text-align: left;">1.8.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">widgetsnbextension</td>
<td style="text-align: left;">4.0.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wordcloud</td>
<td style="text-align: left;">1.9.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">wrapt</td>
<td style="text-align: left;">1.17.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">wsproto</td>
<td style="text-align: left;">1.2.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">xlrd</td>
<td style="text-align: left;">2.0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">xyzservices</td>
<td style="text-align: left;">2025.4.0</td>
</tr>
<tr class="even">
<td style="text-align: left;">yarl</td>
<td style="text-align: left;">1.20.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">yellowbrick</td>
<td style="text-align: left;">1.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">zipp</td>
<td style="text-align: left;">3.21.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</details>
<details>
<summary>
<p>View file history <i class="fa-brands fa-git-alt" aria-label="git-alt"></i></p>
</summary>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1048" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1047;"><span id="cb50-1048"><a href="#cb50-1048" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`Ce fichier a été modifié __</span><span class="sc">${</span>table_commit<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs">__ fois depuis sa création le </span><span class="sc">${</span>creation_string<span class="sc">}</span><span class="vs"> (dernière modification le </span><span class="sc">${</span>last_modification_string<span class="sc">}</span><span class="vs">)`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-1" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1055" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1054;"><span id="cb51-1055"><a href="#cb51-1055" aria-hidden="true" tabindex="-1"></a>creation <span class="op">=</span> d3<span class="op">.</span><span class="fu">min</span>(</span>
<span id="cb51-1056"><a href="#cb51-1056" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb51-1057"><a href="#cb51-1057" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-1058"><a href="#cb51-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1059"><a href="#cb51-1059" aria-hidden="true" tabindex="-1"></a>last_modification <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(</span>
<span id="cb51-1060"><a href="#cb51-1060" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>))</span>
<span id="cb51-1061"><a href="#cb51-1061" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-1062"><a href="#cb51-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1063"><a href="#cb51-1063" aria-hidden="true" tabindex="-1"></a>creation_string <span class="op">=</span> creation<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"fr"</span><span class="op">,</span> {</span>
<span id="cb51-1064"><a href="#cb51-1064" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb51-1065"><a href="#cb51-1065" aria-hidden="true" tabindex="-1"></a>  <span class="st">"month"</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb51-1066"><a href="#cb51-1066" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year"</span><span class="op">:</span> <span class="st">"numeric"</span></span>
<span id="cb51-1067"><a href="#cb51-1067" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb51-1068"><a href="#cb51-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-1069"><a href="#cb51-1069" aria-hidden="true" tabindex="-1"></a>last_modification_string <span class="op">=</span> last_modification<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"fr"</span><span class="op">,</span> {</span>
<span id="cb51-1070"><a href="#cb51-1070" aria-hidden="true" tabindex="-1"></a>  <span class="st">"day"</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb51-1071"><a href="#cb51-1071" aria-hidden="true" tabindex="-1"></a>  <span class="st">"month"</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb51-1072"><a href="#cb51-1072" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year"</span><span class="op">:</span> <span class="st">"numeric"</span></span>
<span id="cb51-1073"><a href="#cb51-1073" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-1" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-2" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-3" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<div id="ojs-cell-2-4" data-nodetype="declaration">

</div>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb52" data-startfrom="1079" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1078;"><span id="cb52-1079"><a href="#cb52-1079" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>git_history_table<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-3" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb53" data-startfrom="1084" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1083;"><span id="cb53-1084"><a href="#cb53-1084" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`&lt;div&gt;</span><span class="sc">${</span>git_history_plot<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-4" data-nodetype="expression">

</div>
</div>
</div>
<table class="commit-table" border="1">
<thead>
<tr>
<th>
SHA
</th>
<th>
Date
</th>
<th>
Author
</th>
<th>
Description
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/8cc476c4">8cc476c4</a>
</td>
<td>
2025-01-27 09:58:53
</td>
<td>
lgaliana
</td>
<td>
change badges behavior
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/c326488c">c326488c</a>
</td>
<td>
2024-10-10 14:31:57
</td>
<td>
Romain Avouac
</td>
<td>
Various fixes (#565)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/580cba77">580cba77</a>
</td>
<td>
2024-08-07 18:59:35
</td>
<td>
Lino Galiana
</td>
<td>
Multilingual version as quarto profile (#533)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/005d89b8">005d89b8</a>
</td>
<td>
2023-12-20 17:23:04
</td>
<td>
Lino Galiana
</td>
<td>
Finalise l’affichage des statistiques Git (#478)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3fba6124">3fba6124</a>
</td>
<td>
2023-12-17 18:16:42
</td>
<td>
Lino Galiana
</td>
<td>
Remove some badges from python (#476)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/4cd44f35">4cd44f35</a>
</td>
<td>
2023-12-11 17:37:50
</td>
<td>
Antoine Palazzolo
</td>
<td>
Relecture NLP (#474)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/1f23de28">1f23de28</a>
</td>
<td>
2023-12-01 17:25:36
</td>
<td>
Lino Galiana
</td>
<td>
Stockage des images sur S3 (#466)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/a06a2689">a06a2689</a>
</td>
<td>
2023-11-23 18:23:28
</td>
<td>
Antoine Palazzolo
</td>
<td>
2ème relectures chapitres ML (#457)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/69cf52bd">69cf52bd</a>
</td>
<td>
2023-11-21 16:12:37
</td>
<td>
Antoine Palazzolo
</td>
<td>
[On-going] Suggestions chapitres modélisation (#452)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/889a71ba">889a71ba</a>
</td>
<td>
2023-11-10 11:40:51
</td>
<td>
Antoine Palazzolo
</td>
<td>
Modification TP 3 (#443)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/df6a66b6">df6a66b6</a>
</td>
<td>
2023-11-05 10:56:31
</td>
<td>
Julien PRAMIL
</td>
<td>
Pb redirection snippet elastic (#445)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/652009df">652009df</a>
</td>
<td>
2023-10-09 13:56:34
</td>
<td>
Lino Galiana
</td>
<td>
Finalise le cleaning (#430)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/a7711832">a7711832</a>
</td>
<td>
2023-10-09 11:27:45
</td>
<td>
Antoine Palazzolo
</td>
<td>
Relecture TD2 par Antoine (#418)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/154f09e4">154f09e4</a>
</td>
<td>
2023-09-26 14:59:11
</td>
<td>
Antoine Palazzolo
</td>
<td>
Des typos corrigées par Antoine (#411)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/9977c5dc">9977c5dc</a>
</td>
<td>
2023-08-28 10:43:36
</td>
<td>
Lino Galiana
</td>
<td>
Fix bug path pandas (#397)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/80823022">80823022</a>
</td>
<td>
2023-08-25 17:48:36
</td>
<td>
Lino Galiana
</td>
<td>
Mise à jour des scripts de construction des notebooks (#395)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3bdf3b06">3bdf3b06</a>
</td>
<td>
2023-08-25 11:23:02
</td>
<td>
Lino Galiana
</td>
<td>
Simplification de la structure 🤓 (#393)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/29ff3f58">29ff3f58</a>
</td>
<td>
2023-07-07 14:17:53
</td>
<td>
linogaliana
</td>
<td>
description everywhere
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/f21a24d3">f21a24d3</a>
</td>
<td>
2023-07-02 10:58:15
</td>
<td>
Lino Galiana
</td>
<td>
Pipeline Quarto &amp; Pages 🚀 (#365)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/003a6251">003a6251</a>
</td>
<td>
2022-10-28 18:53:05
</td>
<td>
Lino Galiana
</td>
<td>
Rebuild (#311)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/e3a6b2d6">e3a6b2d6</a>
</td>
<td>
2022-10-28 08:01:32
</td>
<td>
Lino Galiana
</td>
<td>
Proposition utilisation minio pour download openfood (#307)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/044abdb1">044abdb1</a>
</td>
<td>
2022-10-25 13:57:53
</td>
<td>
Lino Galiana
</td>
<td>
Finalise tuto elastic (#306)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/3e26719d">3e26719d</a>
</td>
<td>
2022-10-24 19:09:22
</td>
<td>
Lino Galiana
</td>
<td>
Tutoriel Elastic reprise (#305)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/1f1668a6">1f1668a6</a>
</td>
<td>
2022-10-24 10:02:16
</td>
<td>
Lino Galiana
</td>
<td>
Corrige tutoriel Elastic (#303)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/f10815b5">f10815b5</a>
</td>
<td>
2022-08-25 16:00:03
</td>
<td>
Lino Galiana
</td>
<td>
Notebooks should now look more beautiful (#260)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/bacb5a01">bacb5a01</a>
</td>
<td>
2022-07-04 19:05:20
</td>
<td>
Lino Galiana
</td>
<td>
Enrichir la partie elastic (#241)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/12965bac">12965bac</a>
</td>
<td>
2022-05-25 15:53:27
</td>
<td>
Lino Galiana
</td>
<td>
:launch: Bascule vers quarto (#226)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/2a8809fb">2a8809fb</a>
</td>
<td>
2021-10-27 12:05:34
</td>
<td>
Lino Galiana
</td>
<td>
Simplification des hooks pour gagner en flexibilité et clarté (#166)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/b5615b4a">b5615b4a</a>
</td>
<td>
2021-09-09 16:52:47
</td>
<td>
Lino Galiana
</td>
<td>
Un petit tuto Elastic (#135)
</td>
</tr>
<tr>
<td>
<a href="https://github.com/linogaliana/python-datascientist/commit/8166e221">8166e221</a>
</td>
<td>
2021-09-09 11:06:20
</td>
<td>
Lino Galiana
</td>
<td>
Wordcloud du site (#136)
</td>
</tr>
</tbody>
</table>
</details>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb54" data-startfrom="1095" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1094;"><span id="cb54-1095"><a href="#cb54-1095" aria-hidden="true" tabindex="-1"></a>git_history_table <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">table</span>(</span>
<span id="cb54-1096"><a href="#cb54-1096" aria-hidden="true" tabindex="-1"></a>  table_commit<span class="op">,</span></span>
<span id="cb54-1097"><a href="#cb54-1097" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb54-1098"><a href="#cb54-1098" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb54-1099"><a href="#cb54-1099" aria-hidden="true" tabindex="-1"></a>      <span class="dt">SHA</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="fu">md</span><span class="vs">`[</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">](</span><span class="sc">${</span>github_repo<span class="sc">}</span><span class="vs">/commit/</span><span class="sc">${</span>x<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span></span>
<span id="cb54-1100"><a href="#cb54-1100" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Description</span><span class="op">:</span> x <span class="kw">=&gt;</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">replacePullRequestPattern</span>(x<span class="op">,</span> github_repo)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb54-1101"><a href="#cb54-1101" aria-hidden="true" tabindex="-1"></a>      <span class="co">/*Date: x =&gt; x.toLocaleString("fr", {</span></span>
<span id="cb54-1102"><a href="#cb54-1102" aria-hidden="true" tabindex="-1"></a><span class="co">        "month": "numeric",</span></span>
<span id="cb54-1103"><a href="#cb54-1103" aria-hidden="true" tabindex="-1"></a><span class="co">        "day": "numeric",</span></span>
<span id="cb54-1104"><a href="#cb54-1104" aria-hidden="true" tabindex="-1"></a><span class="co">        "year": "numeric"</span></span>
<span id="cb54-1105"><a href="#cb54-1105" aria-hidden="true" tabindex="-1"></a><span class="co">        })</span></span>
<span id="cb54-1106"><a href="#cb54-1106" aria-hidden="true" tabindex="-1"></a><span class="co">      */</span></span>
<span id="cb54-1107"><a href="#cb54-1107" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb54-1108"><a href="#cb54-1108" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-1109"><a href="#cb54-1109" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-5" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb55" data-startfrom="1115" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1114;"><span id="cb55-1115"><a href="#cb55-1115" aria-hidden="true" tabindex="-1"></a>git_history_plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb55-1116"><a href="#cb55-1116" aria-hidden="true" tabindex="-1"></a>  <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb55-1117"><a href="#cb55-1117" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">ruleY</span>([<span class="dv">0</span>]<span class="op">,</span> {<span class="dt">stroke</span><span class="op">:</span> <span class="st">"royalblue"</span>})<span class="op">,</span></span>
<span id="cb55-1118"><a href="#cb55-1118" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(</span>
<span id="cb55-1119"><a href="#cb55-1119" aria-hidden="true" tabindex="-1"></a>          table_commit<span class="op">,</span></span>
<span id="cb55-1120"><a href="#cb55-1120" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">pointerX</span>({<span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">date</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">stroke</span><span class="op">:</span> <span class="st">"red"</span>}))<span class="op">,</span></span>
<span id="cb55-1121"><a href="#cb55-1121" aria-hidden="true" tabindex="-1"></a>    Plot<span class="op">.</span><span class="fu">dot</span>(table_commit<span class="op">,</span> {<span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="kw">new</span> <span class="bu">Date</span>(d<span class="op">.</span><span class="at">Date</span>)<span class="op">,</span> <span class="dt">y</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">fill</span><span class="op">:</span> <span class="st">"royalblue"</span>})</span>
<span id="cb55-1122"><a href="#cb55-1122" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb55-1123"><a href="#cb55-1123" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-6" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb56" data-startfrom="1129" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1128;"><span id="cb56-1129"><a href="#cb56-1129" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">replacePullRequestPattern</span>(inputString<span class="op">,</span> githubRepo) {</span>
<span id="cb56-1130"><a href="#cb56-1130" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Use a regular expression to match the pattern #digit</span></span>
<span id="cb56-1131"><a href="#cb56-1131" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> pattern <span class="op">=</span> <span class="ss">/#</span><span class="sc">(\d+)</span><span class="ss">/g</span><span class="op">;</span></span>
<span id="cb56-1132"><a href="#cb56-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-1133"><a href="#cb56-1133" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Replace the pattern with ${github_repo}/pull/#digit</span></span>
<span id="cb56-1134"><a href="#cb56-1134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> replacedString <span class="op">=</span> inputString<span class="op">.</span><span class="fu">replace</span>(pattern<span class="op">,</span> <span class="st">'[#$1]('</span> <span class="op">+</span> githubRepo <span class="op">+</span> <span class="st">'/pull/$1)'</span>)<span class="op">;</span></span>
<span id="cb56-1135"><a href="#cb56-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-1136"><a href="#cb56-1136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> replacedString<span class="op">;</span></span>
<span id="cb56-1137"><a href="#cb56-1137" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-7" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb57" data-startfrom="1143" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1142;"><span id="cb57-1143"><a href="#cb57-1143" aria-hidden="true" tabindex="-1"></a>github_repo <span class="op">=</span> <span class="st">"https://github.com/linogaliana/python-datascientist"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-8" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb58" data-startfrom="1148" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1147;"><span id="cb58-1148"><a href="#cb58-1148" aria-hidden="true" tabindex="-1"></a>table_commit <span class="op">=</span> {</span>
<span id="cb58-1149"><a href="#cb58-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1150"><a href="#cb58-1150" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the HTML table by its class name</span></span>
<span id="cb58-1151"><a href="#cb58-1151" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> table <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.commit-table'</span>)<span class="op">;</span></span>
<span id="cb58-1152"><a href="#cb58-1152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1153"><a href="#cb58-1153" aria-hidden="true" tabindex="-1"></a><span class="co">// Check if the table exists</span></span>
<span id="cb58-1154"><a href="#cb58-1154" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (table) {</span>
<span id="cb58-1155"><a href="#cb58-1155" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialize an array to store the table data</span></span>
<span id="cb58-1156"><a href="#cb58-1156" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> dataArray <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb58-1157"><a href="#cb58-1157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1158"><a href="#cb58-1158" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Extract headers from the first row</span></span>
<span id="cb58-1159"><a href="#cb58-1159" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> headers <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb58-1160"><a href="#cb58-1160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> table<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb58-1161"><a href="#cb58-1161" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">.</span><span class="fu">push</span>(table<span class="op">.</span><span class="at">rows</span>[<span class="dv">0</span>]<span class="op">.</span><span class="at">cells</span>[i]<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">trim</span>())<span class="op">;</span></span>
<span id="cb58-1162"><a href="#cb58-1162" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-1163"><a href="#cb58-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1164"><a href="#cb58-1164" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Iterate through the rows, starting from the second row</span></span>
<span id="cb58-1165"><a href="#cb58-1165" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> table<span class="op">.</span><span class="at">rows</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb58-1166"><a href="#cb58-1166" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> row <span class="op">=</span> table<span class="op">.</span><span class="at">rows</span>[i]<span class="op">;</span></span>
<span id="cb58-1167"><a href="#cb58-1167" aria-hidden="true" tabindex="-1"></a>        <span class="kw">var</span> rowData <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb58-1168"><a href="#cb58-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1169"><a href="#cb58-1169" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Iterate through the cells in the row</span></span>
<span id="cb58-1170"><a href="#cb58-1170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (<span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> row<span class="op">.</span><span class="at">cells</span><span class="op">.</span><span class="at">length</span><span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb58-1171"><a href="#cb58-1171" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Use headers as keys and cell content as values</span></span>
<span id="cb58-1172"><a href="#cb58-1172" aria-hidden="true" tabindex="-1"></a>            rowData[headers[j]] <span class="op">=</span> row<span class="op">.</span><span class="at">cells</span>[j]<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">trim</span>()<span class="op">;</span></span>
<span id="cb58-1173"><a href="#cb58-1173" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb58-1174"><a href="#cb58-1174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1175"><a href="#cb58-1175" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Push the rowData object to the dataArray</span></span>
<span id="cb58-1176"><a href="#cb58-1176" aria-hidden="true" tabindex="-1"></a>        dataArray<span class="op">.</span><span class="fu">push</span>(rowData)<span class="op">;</span></span>
<span id="cb58-1177"><a href="#cb58-1177" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-1178"><a href="#cb58-1178" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-1179"><a href="#cb58-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1180"><a href="#cb58-1180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> dataArray</span>
<span id="cb58-1181"><a href="#cb58-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-1182"><a href="#cb58-1182" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-9" data-nodetype="declaration">

</div>
</div>
</div>
<div class="cell hidden">
<div class="sourceCode cell-code hidden" id="cb59" data-startfrom="1188" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1187;"><span id="cb59-1188"><a href="#cb59-1188" aria-hidden="true" tabindex="-1"></a><span class="co">// Get the element with class 'git-details'</span></span>
<span id="cb59-1189"><a href="#cb59-1189" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb59-1190"><a href="#cb59-1190" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> gitDetails <span class="op">=</span> <span class="bu">document</span><span class="op">.</span><span class="fu">querySelector</span>(<span class="st">'.commit-table'</span>)<span class="op">;</span></span>
<span id="cb59-1191"><a href="#cb59-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-1192"><a href="#cb59-1192" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if the element exists</span></span>
<span id="cb59-1193"><a href="#cb59-1193" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (gitDetails) {</span>
<span id="cb59-1194"><a href="#cb59-1194" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Hide the element</span></span>
<span id="cb59-1195"><a href="#cb59-1195" aria-hidden="true" tabindex="-1"></a>      gitDetails<span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">display</span> <span class="op">=</span> <span class="st">'none'</span><span class="op">;</span></span>
<span id="cb59-1196"><a href="#cb59-1196" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-1197"><a href="#cb59-1197" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display hidden">
<div id="ojs-cell-10" data-nodetype="expression">

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code hidden" id="cb60" data-startfrom="1203" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset: source-line 1202;"><span id="cb60-1203"><a href="#cb60-1203" aria-hidden="true" tabindex="-1"></a>Plot <span class="op">=</span> <span class="pp">require</span>(<span class="st">'@observablehq/plot@0.6.12/dist/plot.umd.min.js'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="ojs-cell-11" data-nodetype="declaration">

</div>
</div>
</div>



</section>
</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-galiana2022" class="csl-entry" role="listitem">
Galiana, Lino, and Milena Suarez Castillo. 2022. <span>“Fuzzy Matching on Big-Data: An Illustration with Scanner and Crowd-Sourced Nutritional Datasets.”</span> In <em>Proceedings of the 2022 ACM Conference on Information Technology for Social Good</em>, 331–37. GoodIT ’22. New York, NY, USA: Association for Computing Machinery. <a href="https://doi.org/10.1145/3524458.3547244">https://doi.org/10.1145/3524458.3547244</a>.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Le lancement du service a créé dans votre <code>NAMESPACE Kubernetes</code> (l’ensemble de tout vos services) un cluster <code>Elastic</code>.
Vous n’avez droit qu’à un cluster par <em>namespace</em> (ou compte d’utilisateur).
Votre service <code>Jupyter</code>, <code>VSCode</code>, <code>RStudio</code>, etc. est associé au même <em>namespace</em>.
De même qu’il n’est pas nécessaire de comprendre comment fonctionne le moteur d’une voiture pour conduire,
il n’est pas nécessaire de comprendre la manière dont tout ce beau monde dialogue pour pouvoir utiliser le <code>SSP Cloud</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Vous pouvez aussi explorer les possibilités de requêtes via la <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/query-dsl.html">doc Elastic</a> et vous entrainer à un écrire avec votre index tout neuf.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@book{galiana2023,
  author = {Galiana, Lino},
  title = {Python Pour La Data Science},
  date = {2023},
  url = {https://pythonds.linogaliana.fr/},
  doi = {10.5281/zenodo.8229676},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-galiana2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Galiana, Lino. 2023. <em>Python Pour La Data Science</em>. <a href="https://doi.org/10.5281/zenodo.8229676">https://doi.org/10.5281/zenodo.8229676</a>.
</div></div></section></div></main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../content/modern-ds";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "../..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/pythonds\.linogaliana\.fr");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      if (authorPrefersDark) {
          [baseTheme, altTheme] = [altTheme, baseTheme];
      }
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "linogaliana/python-datascientist";
    script.dataset.repoId = "MDEwOlJlcG9zaXRvcnkyODAxNjE2Nzc=";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOELLtjc4B-5TX";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../content/modern-ds/elastic_approfondissement.html" class="pagination-link" aria-label="Approfondissement ElasticSearch pour des recherches de proximité géographique">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Approfondissement ElasticSearch pour des recherches de proximité géographique</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Python pour la <em>data science</em>, Lino Galiana.<br>
Licence <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i><br>
Code source disponible sur <a href="https://github.com/linogaliana/python-datascientist"><code>Github</code></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/linogaliana/python-datascientist/edit/master/content/modern-ds/elastic_intro.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/linogaliana/python-datascientist/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Site construit avec <i class="fa-brands fa-python" aria-label="python"></i> et <a href="https://quarto.org/"><code>Quarto</code></a><br>
Inspiration pour la mise en forme du site <a href="https://www.andreashandel.com">ici</a><br>
<a href="https://github.com/linogaliana/python-datascientist">Code source disponible sur <i class="fa-brands fa-github" aria-label="github"></i> <code>GitHub</code></a></p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>